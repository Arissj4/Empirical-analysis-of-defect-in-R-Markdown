repo_owner,repo_name,commit_hash,author,author_email,date,committer_name,committer_email,committer_date,message,filenames,touches_rmd,touches_r,touches_r_or_rmd,is_merge,added,deleted,changed,diff,_touch_r,_touch_rmd,bug_category,category_score
dfo-mar-odis,shinySpatialApp,baa83ad5f2ab28a9894111ea5c7b25e1265e128a,PJCoates,peterson.coates@dfo-mpo.gc.ca,2024-05-02T14:17:03Z,PJCoates,peterson.coates@dfo-mpo.gc.ca,2024-05-02T14:17:03Z,Table functions fix and start of EBSA custom report upgrade,reports/R/tableFunctions.R;reports/sections/isleMadame/ebsa/ebsa_en.Rmd;reports/sections/isleMadame/ebsa/ebsa_fr.Rmd;reports/sections/isleMadame/ebsa/ebsa_preprocessing.R,True,True,True,False,195,8,203,"---FILE: reports/R/tableFunctions.R---
@@ -184,8 +184,11 @@ create_sar_tables <- function(data_sf, sarTable, uniqueCols = c(""geometry""), ext
 # 1. allSpeciesData: datatable of all species found within the studyArea
 # 2. sarData: datatable of only listed species found within the studyArea
 create_table_MARFIS <- function(data_sf, speciesTable, sarTable) {
-  absentCode <- ""&nbsp;-&nbsp;""
-  presentCode <- ""&#x2714;""
+  #absentCode <- ""&nbsp;-&nbsp;""
+  #presentCode <- ""&#x2714;""
+  
+  absentCode <- ""\U2013""
+  presentCode <- ""\U2714""
   
   nafoList <- as.list(unique(data_sf$NAFO))
   # nafoList <- append(nafoList, ""4WG"")
@@ -238,8 +241,11 @@ create_table_MARFIS <- function(data_sf, speciesTable, sarTable) {
 # 2. datatable2: datatable of only listed species found within the studyArea
 
 create_table_ISDB <- function(data_sf, speciesTable, sarTable) {
-  absentCode <- ""&nbsp;-&nbsp;""
-  presentCode <- ""&#x2714;""
+  #absentCode <- ""&nbsp;-&nbsp;""
+  #presentCode <- ""&#x2714;""
+  
+  absentCode <- ""\U2013""
+  presentCode <- ""\U2714""
   
   nafoList <- as.list(unique(data_sf$NAFO))
   # nafoList <- append(nafoList, ""4WG"")
@@ -454,9 +460,12 @@ add_col_to_whale_summary <- function(whaleSummary, dbName, data_sf, attribute) {
 # sarSummary: updated sarSummary with added column
 #
 add_col_to_sar_summary <- function(sarSummary, dbName, dataTable, indexCol, attributeCol) {
-  absentCode <- ""&nbsp;-&nbsp;""
-  presentCode <- ""&#x2714;""
+  #absentCode <- ""&nbsp;-&nbsp;""
+  #presentCode <- ""&#x2714;""
 
+  absentCode <- ""\U2013""
+  presentCode <- ""\U2714""
+  
   if (!is.null(dataTable)){
     if (indexCol == attributeCol) {
       dataTable <- distinct(dataTable, !!sym(indexCol))
@@ -534,8 +543,11 @@ isle_madame_table <- function(data_sf, cols, colnames){
 }
 
 add_row_to_intro_summary <- function(introSummary, name, result) {
-  absentCode <- ""&nbsp;-&nbsp;""
-  presentCode <- ""&#x2714;""
+  #absentCode <- ""&nbsp;-&nbsp;""
+  #presentCode <- ""&#x2714;""
+  
+  absentCode <- ""\U2013""
+  presentCode <- ""\U2714""
   
   rowNum <- nrow(introSummary) + 1
   

---FILE: reports/sections/isleMadame/ebsa/ebsa_en.Rmd---
@@ -0,0 +1,74 @@
+---
+output:
+  bookdown::html_document2:
+    number_sections: FALSE
+    theme: paper
+bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
+---
+```{r ebsa-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+``` 
+
+```{r eval=FALSE}
+if (FALSE) { #load in data:
+  lapply(list.files(here::here(""reports/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
+  studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) 
+  intro_setup(studyArea, env = environment())  
+}
+```
+
+### **Ecologically and Biologically Significant Areas (EBSAs)** {#ebsa-section}   
+
+```{r EBSA-load, include=FALSE}
+load_rdata(c(""ebsa_rr""), regionStr, env = environment())
+```
+
+```{r EBSA-meta, results='asis'}
+write_meta(ebsa_rr, ""EN"")
+```
+A Story Map summarizing work that has been done to identify EBSAs in the Maritimes Region is available here: https://gisp.dfo-mpo.gc.ca/portal/apps/MapJournal/index.html?appid=b91f85de60f44a7b90633e4b43e3916a
+
+Dataset description from the Open Data record [@OpenData_ebsa]:
+```{r EBSA-text, results='asis'}
+writeLines(noquote(ebsa_rr$text$en))
+
+```
+
+##### *Area-Specific EBSA Search Results*
+
+```{r EBSA-results, echo=FALSE, results='asis'}
+#function for overlap
+EBSAoutput <- master_intersect(ebsa_rr$data_sf, mapDataList, getRegion=TRUE)
+
+# summary intro table
+ebsaResult <- !is.null(EBSAoutput$studyData)
+summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[EBSA](#ebsa-section)"", result=ebsaResult)
+
+
+#function for overlap
+Query_output_EBSA <- if(ebsaResult){
+    ""* The search area overlaps with identified Ecologically and Biologically Significant Areas (EBSAs).""
+  } else {
+    ""* The search area does not overlap with identified Ecologically and Biologically Significant Areas (EBSAs).""
+  }
+writeLines(Query_output_EBSA)
+
+```
+
+```{r EBSA-table,  echo=FALSE, results='asis'}
+EBSATable <- EBSA_report(EBSAoutput$studyData, lang=""EN"")
+if (!is.null(EBSATable)){
+   knitr::kable(EBSATable, align=""l"", caption=""Details for Ecologically and Biologically Significant Areas (EBSAs) overlapping the study area."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+
+```{r EBSA-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ebsa_rr, ""EN""), 'Map showing Ecologically and Biologically Significant Areas (EBSAs) within the Scotian Shelf bioregion. The search area is shown as a red outline, and a more detailed view is shown in the figure below, if relevant data are present. Data were obtained from @OpenData_ebsa.')}
+if (!is.null(EBSAoutput$regionData)){
+  plot_rr_sf(regionMap, EBSAoutput$regionData, ebsa_rr$attribute)
+}
+```
+
+```{r EBSA-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ebsa_rr, ""EN""), 'Map showing Ecologically and Biologically Significant Areas (EBSAs) within the search area (red outline). Data were obtained from @OpenData_ebsa.')}
+if(!is.null(EBSAoutput$studyData)){
+  plot_rr_sf(areaMap, EBSAoutput$mapData, ebsa_rr$attribute)
+}
+```

---FILE: reports/sections/isleMadame/ebsa/ebsa_fr.Rmd---
@@ -0,0 +1,74 @@
+
+---
+output:
+  bookdown::html_document2:
+    number_sections: FALSE
+    theme: paper
+bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
+---
+```{r ebsa-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+``` 
+
+```{r eval=FALSE}
+if (FALSE) { #load in data:
+  lapply(list.files(here::here(""reports/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
+  studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) 
+  intro_setup(studyArea, env = environment())  
+}
+```
+### **Zones d’importance écologique et biologique (ZIEB)**  
+
+```{r EBSA-load, include=FALSE}
+load_rdata(c(""ebsa_rr""), regionStr, env = environment())
+```
+
+```{r EBSA-meta, results='asis'}
+write_meta(ebsa_rr, ""FR"")
+```
+Histoir ZIEB: <https://gisp.dfo-mpo.gc.ca/portal/apps/MapJournal/index.html?appid=b91f85de60f44a7b90633e4b43e3916a>
+
+Description de l’ensemble de données (tirée du dossier des données ouvertes)  [@OpenData_ebsa]:
+```{r EBSA-text, results='asis'}
+writeLines(noquote(ebsa_rr$text$fr))
+
+```
+
+#### ***Résultats de la recherche des ZIEB par zone***  
+
+```{r EBSA-results, echo=FALSE, results='asis'}
+#function for overlap
+EBSAoutput <- master_intersect(ebsa_rr$data_sf, mapDataList, getRegion=TRUE)
+```
+ 
+```{r EBSA-check, echo=FALSE, results='asis'}
+#function for overlap
+Query_output_EBSA<-if(is.null(EBSAoutput$studyData)){
+    ""* La zone de recherche ne chevauche pas les zones d’importance écologique et biologique (ZIEB).""
+  } else {
+    ""* La zone de recherche chevauche les zones d’importance écologique et biologique (ZIEB).""
+  }
+Query_output_EBSA2<-noquote(Query_output_EBSA)
+
+writeLines(Query_output_EBSA)
+
+```
+
+```{r EBSA-table,  echo=FALSE, results='asis'}
+EBSATable <- EBSA_report(EBSAoutput$studyData, lang=""FR"")
+if (!is.null(EBSATable)){
+   knitr::kable(EBSATable, align=""l"", caption=""Details for EBSA's overlapping the study area.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+
+
+```{r EBSA-region-plot, fig.height=7, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant les zones d’importance écologique et biologique (ZIEB) par rapport à la zone de recherche définie par l’utilisateur (entourée de rouge).'}
+if (!is.null(EBSAoutput$regionData)){
+  plot_rr_sf(regionMap, EBSAoutput$regionData, ebsa_rr$attribute)
+}
+```
+
+```{r EBSA-area-plot, fig.height=7, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant les zones d’importance écologique et biologique (ZIEB) dans la zone de recherche définie par l’utilisateur (entourée de rouge).'}
+if(!is.null(EBSAoutput$studyData)){
+  plot_rr_sf(areaMap, EBSAoutput$mapData, ebsa_rr$attribute)
+}
+```

---FILE: reports/sections/isleMadame/ebsa/ebsa_preprocessing.R---
@@ -0,0 +1,27 @@
+source(here::here(""reports/dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/R/dataFunctions.R""))
+
+source(here::here(""config.R""))
+
+
+loadResult <- load_rdata(c(""CommonData"", ""ebsa_rr""), regionStr)
+
+print(""----------------EBSA----------------- "")
+if (globalControlEnv$updateGeoms) {
+    
+  ebsaPkgId <- ""d2d6057f-d7c4-45d9-9fd9-0a58370577e0""
+  
+  ebsa_rr <- get_opendata_rr(ebsaPkgId)
+  
+  esriBase <- ""https://gisp.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Ecologically_and_Biologically_Significant_Areas/MapServer/""
+  esriUrl <- paste0(esriBase, ""0"")
+  regionBbox <- sf::st_bbox(sf::st_transform(region_sf, 3857))
+  data_sf <- esri2sf::esri2sf(esriUrl, bbox=regionBbox, progress = TRUE)
+  ebsa_rr$data_sf <- sf::st_make_valid(data_sf)
+}
+
+ebsa_rr$metadata <- read_google_metadata(""ebsa_rr"", isOpenData = TRUE)
+
+save(ebsa_rr, file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""Open/ebsa_rr.RData""))
+
+",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,e8fa625bbb8add3d67e471f66034a737c98d36ff,PJCoates,peterson.coates@dfo-mpo.gc.ca,2023-06-16T12:01:09Z,PJCoates,peterson.coates@dfo-mpo.gc.ca,2023-06-16T12:01:09Z,Fix to passBay_rr Open Data pull,reports/sections/pasBay/pasBay_preprocessing.R,False,True,True,False,21,12,33,"---FILE: reports/sections/pasBay/pasBay_preprocessing.R---
@@ -12,23 +12,31 @@ if (globalControlEnv$updateGeoms) {
   
   pasBay_rr <- get_opendata_rr(pasBayPkgId)
   
-  catchDataResId <- ""9ee042ea-ab9b-4af8-8cf5-de9c89a77a95""
+  catchDataResId <- ""d128c2a5-8fa0-416d-a43d-af8d7131721b""
   catchData <- download_extract_res_files(catchDataResId)
-  catchData <- read.csv(file.path(fileLoadPath, ""/NaturalResources/Species/PassamaquoddyBayBiodiversityTrawl/new_catch_data.csv""))
-  catchData <- dplyr::select(catchData, c(""setno"", ""scientific_name"", ""common_name""))
+  #catchData <- read.csv(file.path(fileLoadPath, ""/NaturalResources/Species/PassamaquoddyBayBiodiversityTrawl/new_catch_data.csv""))
+  catchData <- dplyr::select(catchData, c(""set_ensemble"", ""scientificName_nomScientifique"", ""commonName_nomCommun""))
   
-  setDataResId <- ""b1379a08-7bbc-4ae7-b805-7e609e8d0f02""
-  setData <- download_extract_res_files(setDataResId)
   
-  pasBay <- left_join(catchData, setData, by = c(""setno"" = ""set_ensemble""))
+  setDataResId <- ""d7b2316d-91ea-4896-bb9e-539d88008dac""
+  #set data has header characters that are not supported under a normal read.csv call
+  #therefore slightly altering this script to circumvent this
+  res <- resource_show(setDataResId)
+  zipUrl <- res$url
+  setData <- read.csv(zipUrl, check.names = FALSE)
+  rm(res,zipUrl)
+  colnames(setData) = gsub(""<e9>"", ""e"", colnames(setData))
+  setData <- setData %>% rename(""longitude_finish_longitude_d.arrivee"" = `longitude_finish_longitude d'arrivee`, ""latitude_finish_latitude_d.arrivee"" = ""latitude_finish_latitude_d'arrivee"")
+  
+  pasBay <- left_join(catchData, setData, by = ""set_ensemble"")
   pasBay <- dplyr::mutate(pasBay, 
-                          wkt = paste(""LINESTRING ("", longitude_start_début_de_longitude, "" "", 
-                                      latitude_start_début_de_latitude, "", "", longitude_finish_longitude.d.arrivée, "" "",
-                                      latitude_finish_latitude_d.arrivée, "")"", sep = """"))
+                          wkt = paste(""LINESTRING ("", longitude_start_debut_de_longitude, "" "", 
+                                      latitude_start_debut_de_latitude, "", "", longitude_finish_longitude_d.arrivee, "" "",
+                                      latitude_finish_latitude_d.arrivee, "")"", sep = """"))
   pasBay$geometry <- sf::st_as_sfc(pasBay$wkt, crs = 4326)
-  pasBay <- dplyr::select(pasBay, c(""scientific_name"", ""common_name"", ""time_start_heure_de_début"", ""geometry""))
-  pasBay$common_name <- stringr::str_to_title(pasBay$common_name)
-  pasBay$scientific_name <- stringr::str_to_sentence(pasBay$scientific_name)
+  pasBay <- dplyr::select(pasBay, c(""scientificName_nomScientifique"", ""commonName_nomCommun"", ""time_start_heure_de_debut"", ""geometry""))
+  pasBay$commonName_nomCommun<- stringr::str_to_title(pasBay$commonName_nomCommun)
+  pasBay$scientificName_nomScientifique <- stringr::str_to_sentence(pasBay$scientificName_nomScientifique)
   names(pasBay) <-  c(""Scientific Name"", ""Common Name"", ""Start Time"", ""geometry"")
   
   pasBay_sf <- sf::st_as_sf(pasBay)
@@ -37,5 +45,6 @@ if (globalControlEnv$updateGeoms) {
 }
 pasBay_rr$metadata <- read_google_metadata(""pasBay_rr"", isOpenData = TRUE)
 
+
 save(pasBay_rr, file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""Open/pasBay_rr.RData""))
 ",True,False,Documentation / Formatting,3
dfo-mar-odis,shinySpatialApp,cd1b8edf4c66427a4d76228c35318e5aaec30a68,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-13T12:08:14Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-13T12:08:14Z,fix chunk label bug in french too,reports/sections/oecm/oecm_fr.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/oecm/oecm_fr.Rmd---
@@ -39,7 +39,7 @@ writeLines(noquote(oecm_rr$text$fr))
 OECMoutput <- master_intersect(oecm_rr$data_sf, mapDataList, getRegion=TRUE)
 ```
  
-```{r EBSA-check, echo=FALSE, results='asis'}
+```{r OECM-check, echo=FALSE, results='asis'}
 #function for overlap
 Query_output_OECM<-if(is.null(OECMoutput$studyData)){
     ""* ",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,ad04ed04c3705f334a1b6ddbad70da70c9954164,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-13T12:07:06Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-13T12:07:06Z,minor formaatting + fix chunk label bug,reports/sections/oecm/oecm_en.Rmd;reports/sections/oecm/oecm_preprocessing.R,True,False,True,False,10,10,20,"---FILE: reports/sections/oecm/oecm_en.Rmd---
@@ -54,7 +54,7 @@ writeLines(Query_output_OECM)
 
 ```
 
-```{r EBSA-table,  echo=FALSE, results='asis'}
+```{r OECM-table,  echo=FALSE, results='asis'}
 OECMTable <- OECM_report(OECMoutput$studyData, lang=""EN"")
 if (!is.null(OECMTable)){
    knitr::kable(OECMTable, align=""l"", caption=""Details for Other Effective Area Based Conservation Measures overlapping the study area."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")

---FILE: reports/sections/oecm/oecm_preprocessing.R---
@@ -10,15 +10,15 @@ loadResult <- load_rdata(c(""CommonData"", ""oecm_rr""), regionStr)
 print(""----------------OECM----------------- "")
 if (globalControlEnv$updateGeoms) {
 
-oecmPkgId <- ""44769543-7a23-4991-a53f-c2cf7c7a946f""
-
-oecm_rr <- get_opendata_rr(oecmPkgId, region_sf = region_sf)
-
-esriBase <- ""https://gisp.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Other_Effective_Area_Based_Conservation_Measures/MapServer/""
-esriUrl <- paste0(esriBase, ""0"")
-regionBbox <- sf::st_bbox(sf::st_transform(region_sf, 3857))
-data_sf <- esri2sf::esri2sf(esriUrl, bbox=regionBbox, progress = TRUE)
-oecm_rr$data_sf <- sf::st_make_valid(data_sf)
+  oecmPkgId <- ""44769543-7a23-4991-a53f-c2cf7c7a946f""
+  
+  oecm_rr <- get_opendata_rr(oecmPkgId, region_sf = region_sf)
+  
+  esriBase <- ""https://gisp.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Other_Effective_Area_Based_Conservation_Measures/MapServer/""
+  esriUrl <- paste0(esriBase, ""0"")
+  regionBbox <- sf::st_bbox(sf::st_transform(region_sf, 3857))
+  data_sf <- esri2sf::esri2sf(esriUrl, bbox=regionBbox, progress = TRUE)
+  oecm_rr$data_sf <- sf::st_make_valid(data_sf)
 
 }
 ",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,3f6df1a04ee6c80b7c51a4a99ba33e2df2b19292,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-09T12:16:18Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-09T12:16:18Z,"minor metadata fixes, #142, sections run, report renders",reports/R/intersectFunctions.R;reports/sections/sdm/sdm_en.Rmd;reports/sections/sdm/sdm_preprocessing.R,True,True,True,False,10,11,21,"---FILE: reports/R/intersectFunctions.R---
@@ -86,11 +86,12 @@ master_intersect <- function(data_sf, mapDataList, getRegion=FALSE, ...) {
       # duplicate geometries
       # for RV the ELAT and ELONG fields are necessary as well
       if (inherits(sf::st_geometry(data_sf), ""sfc_POINT"")) {
+        mapPoints <- sf::st_set_geometry(mapData, ""geometry"")
         if (""ELAT"" %in% colnames(mapData)) {
-          mapPoints <- dplyr::select(mapData, ELAT, ELONG, geometry)
+          mapPoints <- dplyr::select(mapPoints, ELAT, ELONG, geometry)
         }
         else {
-          mapPoints <- dplyr::select(mapData, geometry)
+          mapPoints <- dplyr::select(mapPoints, geometry)
         }
         # remove redundant geometries and set lat/long columns:
         mapPoints <- unique(mapPoints)

---FILE: reports/sections/sdm/sdm_en.Rmd---
@@ -20,7 +20,7 @@ if (FALSE) { #load in data:
 ### **Species Distribution Models (SDM): Priority Areas to Enhance Monitoring of Cetaceans** {#sdm-section}
 
 ```{r sdm-load, include=FALSE}
-load_rdata(c(""finWhale_rr"", ""harbourPorpoise_rr"", ""humpbackWhale_rr"", ""seiWhale_rr"" ), ""MAR"", env = environment())
+load_rdata(""sdm_rr"", ""MAR"", env = environment())
 ```
 
 ```{r sdm-meta, results='asis'}

---FILE: reports/sections/sdm/sdm_preprocessing.R---
@@ -15,27 +15,25 @@ if (globalControlEnv$updateGeoms) {
   finWhale_rr <-get_opendata_rr(sdmPkgId, sdmResId, region_sf = region_sf,
                                 tifFile = ""Fin_Whale.tif"")
 }
-finWhale_rr$metadata <- read_google_metadata(""finWhale_rr"", isOpenData = TRUE)
-save(finWhale_rr, file = file.path(localFileSavePath, ""Open/finWhale_rr.RData""))
+finWhale_rr$metadata <- read_google_metadata(""sdm_rr"", isOpenData = TRUE)
 
 if (globalControlEnv$updateGeoms) {
 seiWhale_rr <-get_opendata_rr(sdmPkgId, sdmResId, region_sf = region_sf,
                               tifFile = ""Sei_Whale.tif"")
 }
-seiWhale_rr$metadata <- read_google_metadata(""seiWhale_rr"", isOpenData = TRUE)
-save(seiWhale_rr, file = file.path(localFileSavePath, ""Open/seiWhale_rr.RData""))
+seiWhale_rr$metadata <- read_google_metadata(""sdm_rr"", isOpenData = TRUE)
 
 if (globalControlEnv$updateGeoms) {
 humpbackWhale_rr <-get_opendata_rr(sdmPkgId, sdmResId, region_sf = region_sf,
                               tifFile = ""Humpback_Whale.tif"")
 }
-humpbackWhale_rr$metadata <- read_google_metadata(""humpbackWhale_rr"", isOpenData = TRUE)
-save(humpbackWhale_rr, file = file.path(localFileSavePath, ""Open/humpbackWhale_rr.RData""))
+humpbackWhale_rr$metadata <- read_google_metadata(""sdm_rr"", isOpenData = TRUE)
 
 if (globalControlEnv$updateGeoms) {
 harbourPorpoise_rr <-get_opendata_rr(sdmPkgId, sdmResId, region_sf = region_sf,
                               tifFile = ""Harbour_Porpoise.tif"")
 }
-harbourPorpoise_rr$metadata <- read_google_metadata(""harbourPorpoise_rr"", isOpenData = TRUE)
-save(harbourPorpoise_rr, file = file.path(localFileSavePath, ""Open/harbourPorpoise_rr.RData""))
+harbourPorpoise_rr$metadata <- read_google_metadata(""sdm_rr"", isOpenData = TRUE)
+
+save(finWhale_rr, seiWhale_rr, humpbackWhale_rr, harbourPorpoise_rr, file = file.path(localFileSavePath, ""Open/sdm_rr.RData""))
 ",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,6611c3b799f8814b3d47e979db39f0d6afdd55fb,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-08T19:22:09Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-08T19:22:09Z,fix typos,reports/sections/nitroLoad/nitroLoad_preprocessing.R;reports/sections/run_all_sections.R,False,True,True,False,4,6,10,"---FILE: reports/sections/nitroLoad/nitroLoad_preprocessing.R---
@@ -36,5 +36,3 @@ deltaNitroLoad_rr$metadata <-  read_google_metadata(""nitroLoad_rr"", isOpenData =
 
 save(totalNitroLoad_rr, deltaNitroLoad_rr,
      file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""Open/nitroLoad_rr.RData""))
-
-terra::app()

---FILE: reports/sections/run_all_sections.R---
@@ -33,7 +33,7 @@ openDataSecs <- c(here::here(""reports/sections/benthicEffort/benthicEffort_prepr
 egisSecs <- c(here::here(""reports/sections/asf/asf_preprocessing.R""),
               here::here(""reports/sections/isdb-marfis/isdbMarfis_preprocessing.R""),
               here::here(""reports/sections/permits/permits_preprocessing.R""),
-              here::here(""reports/sections/rockweed/rockweed_preprocessing.R"")
+              here::here(""reports/sections/rockweed/rockweed_preprocessing.R""),
               here::here(""reports/sections/wsdb/wsdb_preprocessing.R"")
               )
 
@@ -51,7 +51,7 @@ inDriveSecs <- c(here::here(""reports/sections/commonSections/commonData_preproce
                  here::here(""reports/sections/ocearch/ocearch_preprocessing.R""),
                  here::here(""reports/sections/offshoreScallop/offshoreScallop_preprocessing.R""),
                  #here::here(""reports/sections/sardist/sardist_preprocessing.R""),
-                 here::here(""reports/sections/sturg/sturg_preprocessing.R"")
+                 here::here(""reports/sections/sturg/sturg_preprocessing.R""),
                  here::here(""reports/sections/threats/ThreatsPreprocessing.R""),
                  here::here(""reports/sections/whitehead/whitehead_preprocessing.R"")
 )
@@ -67,6 +67,7 @@ lost_sections <- c(here::here(""reports/sections/whelk/whelk_preprocessing.R""),
 source_preprocessing_script <- function(scriptPath) {
   tryCatch(
     expr = {
+      # need utf-8 for accents
       suppressWarnings(source(scriptPath, encoding=""utf-8""))
     },
     error = function(e){ 
@@ -80,11 +81,10 @@ source_preprocessing_script <- function(scriptPath) {
 # create global env:
 source(here::here(""config.R""))
 globalControlEnv$saveToRemote <- FALSE
-globalControlEnv$updateGeoms <- FALSE
+globalControlEnv$updateGeoms <- TRUE
 allSecs <- c(openDataSecs, egisSecs, apiSecs, inDriveSecs)
 
 if (FALSE) {
-  # need utf-8 for accents
   lapply(egisSecs, source_preprocessing_script)
   lapply(apiSecs, source_preprocessing_script)
   lapply(inDriveSecs, source_preprocessing_script)  ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,707f173ae48b362fcb57b5e3478dd53557d1cc01,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-08T13:26:49Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-08T13:26:49Z,minor formating fixes,reports/sections/nitroLoad/nitroLoad_preprocessing.R;reports/sections/whelk/whelk_preprocessing.R;reports/sections/wsdb/wsdb_preprocessing.R,False,True,True,False,55,57,112,"---FILE: reports/sections/nitroLoad/nitroLoad_preprocessing.R---
@@ -37,4 +37,4 @@ deltaNitroLoad_rr$metadata <-  read_google_metadata(""nitroLoad_rr"", isOpenData =
 save(totalNitroLoad_rr, deltaNitroLoad_rr,
      file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""Open/nitroLoad_rr.RData""))
 
-
+terra::app()

---FILE: reports/sections/whelk/whelk_preprocessing.R---
@@ -13,33 +13,32 @@ loadResult <- load_rdata(c(""CommonData"", ""whelk_rr""), regionStr)
 
 print(""---------------------WHELK SURVEY----------------------------------- "")
 if (globalControlEnv$updateGeoms) {
-
-# Open Data dataset
-whelkpkgId <- ""e606ad01-843f-4730-93fa-f944dfbbbf07""
-
-# get open data metadata
-whelk_rr <- get_opendata_rr(whelkpkgId)
-
-#This chunk will pop a warning because none of the points are within Maritimes region#
-esriBase <- ""https://gisp.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Biodiversity_of_the_whelk_Buccinum_dredge_survey_in_the_St_Lawrence_Estuary_En/MapServer/""
-esriUrl <- paste0(esriBase, ""0"")
-regionBbox <- sf::st_bbox(sf::st_transform(region_sf, 3857))
-data_sf <- esri2sf::esri2sf(esriUrl, bbox=regionBbox, progress = TRUE)
-whelk_rr$data_sf <- sf::st_make_valid(data_sf)
-
-# combining the data
-allData <- left_join(occuranceData, eventData, by=""eventID"", keep=TRUE)
-
-trimmedData <- dplyr::select(allData, c(""scientificName"", ""year"", ""decimalLatitude"", ""decimalLongitude"", ""coordinateUncertaintyInMeters"", ""minimumDepthInMeters"", ""maximumDepthInMeters""))
-trimmedData <- dplyr::filter(trimmedData, year > rrMinYear)
-
-# converting to an sf and processing
-whelk_sf <- sf::st_as_sf(trimmedData, coords=c(""decimalLongitude"", ""decimalLatitude""), crs = 4326)
-whelk_sf <- sf::st_make_valid(whelk_sf)
-whelk_sf <- sf::st_crop(whelk_sf, region_sf)
-
-# adding sf to the rr object and saving
-whelk_rr$data_sf <- whelk_sf
+  
+  # Open Data dataset
+  whelkpkgId <- ""e606ad01-843f-4730-93fa-f944dfbbbf07""
+  
+  # get open data metadata
+  whelk_rr <- get_opendata_rr(whelkpkgId)
+  
+  # download csv's from open data  
+  resId <- ""5355ea5b-ea37-4a4b-8f61-9d6b716b7d17""
+  outData <- download_extract_res_files(resId, c(""taxon_occurrence"", ""event_information""))
+  occuranceData <- data.frame(outData[1])
+  eventData <- data.frame(outData[2])
+  
+  # combining the data
+  allData <- left_join(occuranceData, eventData, by=""eventID"", keep=TRUE)
+  
+  trimmedData <- dplyr::select(allData, c(""scientificName"", ""year"", ""decimalLatitude"", ""decimalLongitude"", ""coordinateUncertaintyInMeters"", ""minimumDepthInMeters"", ""maximumDepthInMeters""))
+  trimmedData <- dplyr::filter(trimmedData, year > rrMinYear)
+  
+  # converting to an sf and processing
+  whelk_sf <- sf::st_as_sf(trimmedData, coords=c(""decimalLongitude"", ""decimalLatitude""), crs = 4326)
+  whelk_sf <- sf::st_make_valid(whelk_sf)
+  whelk_sf <- sf::st_crop(whelk_sf, region_sf)
+  
+  # adding sf to the rr object and saving
+  whelk_rr$data_sf <- whelk_sf
 }
 
 whelk_rr$metadata <- read_google_metadata(""whelk_rr"", isOpenData = TRUE)

---FILE: reports/sections/wsdb/wsdb_preprocessing.R---
@@ -6,35 +6,34 @@ loadResult <- load_rdata(c(""CommonData"", ""wsdb_rr""), regionStr)
 
 print(""------------------WSDB-------------------- "")
 if (globalControlEnv$updateGeoms) {
-
-# Whale Sightings Database (wsdb)
-
-# Accessing API needs 2 parts: 1. the authentication token, and 2. the url to query.
-# There are 3-4 useful links/endpoints to make this happen.
-# This url is the mapserver url where the data is stored:
-egisUrl <- ""https://gisd.dfo-mpo.gc.ca/arcgis/rest/services/SpatialReproducibleReporting/Map/MapServer/""
-# this url specifies the exact layer to pull data from:
-egisLayer <- paste0(egisUrl, ""0/"")
-
-# The info url is not explicitly needed but helps identify the token URL 
-infoUrl <-""https://gisd.dfo-mpo.gc.ca/arcgis/rest/info""
-# This is the token UR, it only accepts POST requests.
-tokenUrl <- ""https://gisd.dfo-mpo.gc.ca/portal/sharing/rest/generateToken""
-
-# Use helper function to get a token. (use ctrl+click to see how it works)
-token <- get_token(tokenUrl, egisUrl)
-
-# Use esri2sf to access the data from the mapserver. 
-# This requires passing in the token as a param/header:
-wsdb_sf <- esri2sf::esri2sf(egisLayer, token=token, progress = TRUE)
-
-wsdb_sf <- dplyr::select(wsdb_sf, COMMONNAME, SCIENTIFICNAME, YEAR, LATITUDE, LONGITUDE)
-wsdb_sf <- wsdb_sf %>% dplyr::filter(YEAR >= rrMinYear)
-wsdb_sf <- dplyr::rename(wsdb_sf,c(""Scientific Name"" = ""SCIENTIFICNAME"",
-                             ""CNAME""= COMMONNAME))
-wsdb_sf <- merge(wsdb_sf, cetLegend, by='Scientific Name')
-wsdb_sf <- dplyr::select(wsdb_sf, CNAME, 'Scientific Name', YEAR, Legend, LATITUDE, LONGITUDE)
-wsdb_sf <- sf::st_crop(wsdb_sf, region_sf)
+  # Whale Sightings Database (wsdb)
+  
+  # Accessing API needs 2 parts: 1. the authentication token, and 2. the url to query.
+  # There are 3-4 useful links/endpoints to make this happen.
+  # This url is the mapserver url where the data is stored:
+  egisUrl <- ""https://gisd.dfo-mpo.gc.ca/arcgis/rest/services/SpatialReproducibleReporting/Map/MapServer/""
+  # this url specifies the exact layer to pull data from:
+  egisLayer <- paste0(egisUrl, ""0/"")
+  
+  # The info url is not explicitly needed but helps identify the token URL 
+  infoUrl <-""https://gisd.dfo-mpo.gc.ca/arcgis/rest/info""
+  # This is the token UR, it only accepts POST requests.
+  tokenUrl <- ""https://gisd.dfo-mpo.gc.ca/portal/sharing/rest/generateToken""
+  
+  # Use helper function to get a token. (use ctrl+click to see how it works)
+  token <- get_token(tokenUrl, egisUrl)
+  
+  # Use esri2sf to access the data from the mapserver. 
+  # This requires passing in the token as a param/header:
+  wsdb_sf <- esri2sf::esri2sf(egisLayer, token=token, progress = TRUE)
+  
+  wsdb_sf <- dplyr::select(wsdb_sf, COMMONNAME, SCIENTIFICNAME, YEAR, LATITUDE, LONGITUDE)
+  wsdb_sf <- wsdb_sf %>% dplyr::filter(YEAR >= rrMinYear)
+  wsdb_sf <- dplyr::rename(wsdb_sf,c(""Scientific Name"" = ""SCIENTIFICNAME"",
+                               ""CNAME""= COMMONNAME))
+  wsdb_sf <- merge(wsdb_sf, cetLegend, by='Scientific Name')
+  wsdb_sf <- dplyr::select(wsdb_sf, CNAME, 'Scientific Name', YEAR, Legend, LATITUDE, LONGITUDE)
+  wsdb_sf <- sf::st_crop(wsdb_sf, region_sf)
 
 }
 ",True,False,Documentation / Formatting,3
dfo-mar-odis,shinySpatialApp,2f15fb4273a4d9564facf204f9cafee8c23102a2,PJCoates,peterson.coates@dfo-mpo.gc.ca,2022-12-07T18:09:15Z,PJCoates,peterson.coates@dfo-mpo.gc.ca,2022-12-07T18:09:15Z,removing error in save,reports/sections/oecm/oecm_preprocessing.R,False,True,True,False,1,1,2,"---FILE: reports/sections/oecm/oecm_preprocessing.R---
@@ -26,4 +26,4 @@ oecm_rr$metadata <- read_google_metadata(""oecm_rr"", isOpenData = TRUE)
 
 save(oecm_rr, file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""Open/oecm_rr.RData""))
 
-save(oecm_rr, file = file.path(localFileSavePath, ""Open/oecm_rr.RData""))
+",True,False,File I/O and Export,4
dfo-mar-odis,shinySpatialApp,99a09c90e71a9c079064cc734cff9709f7df639d,PJCoates,peterson.coates@dfo-mpo.gc.ca,2022-12-07T14:43:15Z,PJCoates,peterson.coates@dfo-mpo.gc.ca,2022-12-07T14:43:15Z,Fixed merge conflicts,reports/sections/waste/waste_preprocessing.R,False,True,True,False,0,10,10,"---FILE: reports/sections/waste/waste_preprocessing.R---
@@ -1,16 +1,6 @@
-<<<<<<< HEAD
-# contains functions for downloading open data records
-source(here::here(""reports/dataprocessing/openDataHelpers.R""))
-
-#contains load_rdata function
-source(here::here(""reports/R/dataFunctions.R""))
 
-#contains config parameters and paths
-=======
 source(here::here(""reports/dataprocessing/openDataHelpers.R""))
 source(here::here(""reports/R/dataFunctions.R""))
-
->>>>>>> 55bb2c7263f3d4d9159c3493f026a945dcb6f28a
 source(here::here(""config.R""))
 
 ",True,False,Environment / Configuration,3
dfo-mar-odis,shinySpatialApp,5a993eb19e9bb83f2d7fab90afdbd1efc8c8ff34,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-07T14:26:44Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-07T14:26:44Z,"fix plyr rename bug, #142",reports/R/tableFunctions.R;reports/dataprocessing/openDataHelpers.R;reports/sections/isdb-marfis/isdbMarfis_en.Rmd;reports/sections/narwc/narwc_preprocessing.R;reports/sections/permits/permits_preprocessing.R;reports/sections/whitehead/whitehead_preprocessing.R,True,True,True,False,19,20,39,"---FILE: reports/R/tableFunctions.R---
@@ -200,7 +200,7 @@ create_table_MARFIS <- function(data_sf, speciesTable, sarTable) {
     dplyr::summarise_all(max)%>%
     base::subset(select = -c(NAFO))
   
-  cleanDf <- rename(finalDf, Common = SPECIES_NAME) %>%
+  cleanDf <- dplyr::rename(finalDf, Common = SPECIES_NAME) %>%
     dplyr::mutate(Common = stringr::str_to_sentence(Common))
   
   for (nafoStr in nafoList) {
@@ -241,21 +241,20 @@ create_table_ISDB <- function(data_sf, speciesTable, sarTable) {
   absentCode <- ""&nbsp;-&nbsp;""
   presentCode <- ""&#x2714;""
   
-  
   nafoList <- as.list(unique(data_sf$NAFO))
   # nafoList <- append(nafoList, ""4WG"")
   nafoSpeciesFilter <- dplyr::filter(speciesTable, NAFO %in% nafoList)
   # sometime for loops are just better and R apply's can go hide in a hole:
   for (nafoStr in nafoList) {
-    nafoSpeciesFilter[nafoStr] = nafoSpeciesFilter$NAFO == nafoStr
+    nafoSpeciesFilter[nafoStr] <- nafoSpeciesFilter$NAFO == nafoStr
   }
   
   finalDf <- nafoSpeciesFilter %>% 
     dplyr::group_by(SCIENTIFIC) %>% 
     dplyr::summarise_all(max)%>%
     base::subset(select = -c(NAFO))
   
-  cleanDf <- rename(finalDf, Scientific = SCIENTIFIC) %>%
+  cleanDf <- dplyr::rename(finalDf, Scientific = SCIENTIFIC) %>%
     dplyr::rename(Common = COMMON) %>%
     dplyr::mutate(Scientific = stringr::str_to_sentence(Scientific)) %>%
     dplyr::mutate(Common = stringr::str_to_sentence(Common))

---FILE: reports/dataprocessing/openDataHelpers.R---
@@ -207,16 +207,16 @@ email_format <- function(emailStr) {
 # Converts the three types of RV data files into a single coherent sf object.
 RV_to_sf <- function(gscat, gsinf, gsspec, minYear){
   gscat <- gscat %>% tidyr::unite(""MISSION_SET"", MISSION:SETNO, remove = TRUE)
-  gscat <- gscat %>% rename(CODE = SPEC)
+  gscat <- gscat %>% dplyr::rename(CODE = SPEC)
   
   gsinf <- gsinf %>% tidyr::unite(""MISSION_SET"", MISSION:SETNO, remove = FALSE)
   gsinf$YEAR <- lubridate::year(gsinf$SDATE)
   gsinf <- gsinf %>% dplyr::filter(YEAR >= minYear)
   
   gsspec <- dplyr::distinct(gsspec)
-  gsspec <- gsspec %>% transmute(gsspec, SPEC = stringr::str_to_sentence(SPEC))
-  gsspec <- gsspec %>% transmute(gsspec, COMM = stringr::str_to_sentence(COMM))
-  gsspec <- gsspec %>% rename(""Common Name""= COMM, ""Scientific Name"" = SPEC)
+  gsspec <- gsspec %>% dplyr::transmute(gsspec, SPEC = stringr::str_to_sentence(SPEC))
+  gsspec <- gsspec %>% dplyr::transmute(gsspec, COMM = stringr::str_to_sentence(COMM))
+  gsspec <- gsspec %>% dplyr::rename(""Common Name""= COMM, ""Scientific Name"" = SPEC)
   
   out_sf <- st_as_sf(gsinf, coords = c(""SLONG"", ""SLAT""), crs = 4326)
   

---FILE: reports/sections/isdb-marfis/isdbMarfis_en.Rmd---
@@ -68,21 +68,25 @@ Code used to extract information is available here: https://github.com/dfo-mar-o
 ```{r marfis-isdb-results, include=FALSE, cache=FALSE}
 outputListI <- master_intersect(isdb_rr$data_sf, mapDataList)
 outputListM <- master_intersect(marfis_rr$data_sf, mapDataList)
-
+```
+```{r marfis-isdb-results-2, include=FALSE, cache=FALSE}
 # summary intro table
 introResultI <- !is.null(outputListI$studyData)
 summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[ISDB](#ISDB-section)"", result=introResultI)
-
+```
+```{r marfis-isdb-results-3, include=FALSE, cache=FALSE}
 # summary intro table
 introResultM <- !is.null(outputListM$studyData)
 summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[MARFIS](#MARFIS-section)"", result=introResultM)
 
-
+```
+```{r marfis-isdb-results-4, include=FALSE, cache=FALSE}
 tableList <- create_table_ISDB(outputListI$studyData, isdbSpecies_df, listed_species)
 isdbAllTable <- tableList$allSpecies
 isdbSarTable <- tableList$sarData
 summarySarTable <- add_col_to_sar_summary(summarySarTable, ""[ISDB](#ISDB-section)"", isdbSarTable, ""Common Name"", ""Common Name"")
-
+```
+```{r marfis-isdb-results-5, include=FALSE, cache=FALSE}
 tableList <- create_table_MARFIS(outputListM$studyData, marfisSpeceis_df, listed_species)
 marfisAllTable <- tableList$allSpecies
 marfisSarTable <- tableList$sarData

---FILE: reports/sections/narwc/narwc_preprocessing.R---
@@ -13,7 +13,7 @@ if (globalControlEnv$updateGeoms) {
     
   narwcExcel <- readxl::read_xlsx(path = file.path(fileLoadPath, ""NaturalResources/Species/Cetaceans/NARWC/NARWC_02-23-2022.xlsx""))
   narwcspecies <-  read.csv(file.path(fileLoadPath, ""NaturalResources/Species/Cetaceans/NARWC/NARWCSpeciesNames.csv""), stringsAsFactors = FALSE)
-  narwcspecies <- narwcspecies %>% rename(""Scientific Name""= ScientificName)
+  narwcspecies <- narwcspecies %>% dplyr::rename(""Scientific Name""= ScientificName)
   narwc <- merge(narwcExcel, narwcspecies, by='SPECNAME')
   narwc <- narwc %>% dplyr::filter(YEAR >= rrMinYear)
   narwc <- merge(narwc, cetLegend, by = 'Scientific Name')

---FILE: reports/sections/permits/permits_preprocessing.R---
@@ -1,10 +1,6 @@
 source(here::here(""reports/dataprocessing/openDataHelpers.R""))
 source(here::here(""reports/R/dataFunctions.R""))
 source(here::here(""config.R""))
-library(plyr)
-library(tibble)
-library(stringr)
-library(dplyr)
 
 loadResult = load_rdata(c(""CommonData"", ""permits_rr""), regionStr)
 
@@ -25,7 +21,7 @@ if (globalControlEnv$updateGeoms) {
   perm_df <- sf::st_drop_geometry(rawPermits) 
   
   # Get scientific name. The name will be listed within brackets
-  species_brackets = str_extract_all(perm_df$Species, ""\\([^()]+\\)"")
+  species_brackets = stringr::str_extract_all(perm_df$Species, ""\\([^()]+\\)"")
   
   # Remove the brackets and add this as a new column to the perm_df data frame
   perm_df$scientificName = substring(species_brackets, 2, nchar(species_brackets)-1)
@@ -52,7 +48,7 @@ if (globalControlEnv$updateGeoms) {
   perm_df[""scientificName""][perm_df[""scientificName""] == ""Phocoena phocoena vomerina""] = ""Phocoena phocoena""
   
   # Then combine with the MAR species spreadsheet to get other relevant info based on a common field
-  comboPermits = full_join(perm_df, listed_species, by=c(""scientificName"" = ""Scientific Name""))
+  comboPermits = dplyr::full_join(perm_df, listed_species, by=c(""scientificName"" = ""Scientific Name""))
   # Remove species information that got added from the full_join above. These are species not observed in Charlotte's spreadsheet
   # Species not in Charlotte's spreadsheet will have NA values in a variety of fields.
   comboPermits = subset(comboPermits, 

---FILE: reports/sections/whitehead/whitehead_preprocessing.R---
@@ -10,7 +10,7 @@ loadResult <- load_rdata(c(""CommonData"", ""whitehead_rr""), regionStr)
 whitehead <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/Cetaceans/Whitehead_Lab/whitehead_lab.csv""), stringsAsFactors = FALSE)
 whitehead$YEAR <- lubridate::year(whitehead$Date)
 whitehead <- whitehead %>% dplyr::filter(YEAR >= rrMinYear)
-whitehead <- whitehead %>% rename(""Scientific Name""= species.name)
+whitehead <- whitehead %>% dplyr::rename(""Scientific Name""= species.name)
 whitehead <- merge(whitehead, cetLegend, by='Scientific Name')
 whitehead <- dplyr::select(whitehead, 'Scientific Name', YEAR, Legend, Lat, Long)
 # correct the longitude values to be negative",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,ab3d21cfb8151eabd1025d67582d64bae1f3ae25,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-07T13:51:03Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-07T13:51:03Z,"fix more typos, #142",reports/R/dataFunctions.R;reports/R/textFunctions.R;reports/sections/commonSections/commonData_preprocessing.R;reports/sections/ocearch/ocearch_preprocessing.R;reports/sections/run_all_sections.R,False,True,True,False,77,76,153,"---FILE: reports/R/dataFunctions.R---
@@ -123,19 +123,18 @@ intro_setup <- function(studyArea, env=globalenv()) {
 
 
 # ------------read_google_metadata----------------
-read_google_metadata <- function(rrID, isOpenData=FALSE){
-  rrBase <- rrID
-  rrBaseName <-  substring(rrID, 1, nchar(rrID)-3) # remove _rr from name
+read_google_metadata <- function(rrId, isOpenData=FALSE){
   metadata_df <- googlesheets4::read_sheet(configMetadataSheetUrl)
-  metadataRow <- head(dplyr::filter(metadata_df, DatasetName==rrID), 1)
+  metadataRow <- head(dplyr::filter(metadata_df, DatasetName==rrId), 1)
   metadataList <- list(""contact"" = lang_list(metadataRow$Contact),
-                       ""url"" = lang_list(metadataRow$URL),
+                       ""url"" = lang_list(ifelse(!is.na(metadataRow$URL), metadataRow$URL, NA)),
                        ""searchYears""= ifelse(!is.null(metadataRow$SearchYear[[1]]),
-                                              metadataRow$SearchYear, """"),
+                                              metadataRow$SearchYear, NA),
                        ""constraints"" = lang_list(metadataRow$DataUseConstraints),
                        ""securityLevel"" = lang_list(metadataRow$SecurityLevel),
                        ""qualityTier"" =  lang_list(metadataRow$QualityTier),
-                       ""reference"" =  lang_list(metadataRow$referenceUrl),
+                       ""reference"" =  lang_list(ifelse(!is.na(metadataRow$referenceUrl),
+                                             metadataRow$referenceUrl, NA)),
                        ""pipelinePath"" = metadataRow$pipelinePath
                        )
   

---FILE: reports/R/textFunctions.R---
@@ -11,26 +11,26 @@ write_meta <- function(rr, lang) {
   if (lang == ""EN""){
     outText <- c(
       paste(""Contact:"", lang_check(metadata$contact, lang)),
-      ifelse(""url"" %in% names(metadata), paste(""URL:"", metadata$url$en), NA),
+      ifelse(!is.na(metadata$url$en), paste(""URL:"", metadata$url$en), NA),
       paste(""Last retrieved on:"", metadata$accessedOnStr$en),
-      ifelse(""searchYears"" %in% names(metadata), paste(""Search Year:"", metadata$searchYears), NA),
+      ifelse(!is.na(metadata$searchYears), paste(""Search Year:"", metadata$searchYears), NA),
       paste(""Quality tier:"", metadata$qualityTier$en),
       paste(""Security level:"", metadata$securityLevel$en), 
       paste(""Data use constraints:"", metadata$constraints$en),
-      ifelse(""reference"" %in% names(metadata), paste(""Reference:"", metadata$reference$en), NA),
-      ifelse(""pipelinePath"" %in% names(metadata), paste(""Pipeline Path:"", metadata$pipelinePath), NA)
+      ifelse(!is.na(metadata$reference$en), paste(""Reference:"", metadata$reference$en), NA),
+      ifelse(!is.na(metadata$pipelinePath), paste(""Pipeline Path:"", metadata$pipelinePath), NA)
     )
   } else if (lang == ""FR"") {
     outText <- c(
       paste(""Personne-ressource:"",lang_check(metadata$contact, lang)),
-      ifelse(""url"" %in% names(metadata), paste(""LIEN:"", metadata$url$fr), NA),
+      ifelse(!is.na(metadata$url$fr), paste(""LIEN:"", metadata$url$fr), NA),
       paste(""Consulté le:"", metadata$accessedOnStr$fr),
-      ifelse(""searchYears"" %in% names(metadata), paste(""Année de recherche:"", metadata$searchYears), NA),
+      ifelse(!is.na(metadata$searchYears), paste(""Année de recherche:"", metadata$searchYears), NA),
       paste(""Niveau de qualité:"", metadata$qualityTier$fr),
       paste(""Niveau de sécurité:"", metadata$securityLevel$fr), 
       paste(""Contraintes d'usage:"", metadata$constraints$fr),
-      ifelse(""reference"" %in% names(metadata), paste(""Reference:"", metadata$reference$fr), NA),
-      ifelse(""pipelinePath"" %in% names(metadata), paste(""Pipeline de données:"", metadata$pipelinePath), NA)
+      ifelse(!is.na(metadata$reference$fr), paste(""Reference:"", metadata$reference$fr), NA),
+      ifelse(!is.na(metadata$pipelinePath), paste(""Pipeline de données:"", metadata$pipelinePath), NA)
     )
   }
   outText <- outText[!is.na(outText)]

---FILE: reports/sections/commonSections/commonData_preprocessing.R---
@@ -4,58 +4,61 @@ source(here::here(""reports/R/dataFunctions.R""))
 
 loadResult <- load_rdata(c(""CommonData""), regionStr)
 
-# ----------------COMMON DATA-------------
-region_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/MaritimesRegionBound/geoms_slc_MarBioRegion.geojson""))
-if (regionStr == ""QC"") {
+print(""----------------COMMON DATA-------------"")
+if (globalControlEnv$updateGeoms) {
+  
   region_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/MaritimesRegionBound/geoms_slc_MarBioRegion.geojson""))
+  if (regionStr == ""QC"") {
+    region_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/MaritimesRegionBound/geoms_slc_MarBioRegion.geojson""))
+  }
+  land10m_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/Landmass/ne_10m_land_Clip.shp""), stringsAsFactors = FALSE)
+  #remove State and Province column from land10m
+  land10m_sf <- land10m_sf[-c(2)]
+  
+  land50k_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/Coast50k/Coastline50k_SHP/Land_AtlCanada_ESeaboardUS.shp""),
+                        stringsAsFactors = FALSE)
+  
+  # National boundaries (terrestrial and marine)
+  bounds_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/AdminBoundaries/AdminBounds_SHP/Boundaries_Line.shp""), stringsAsFactors = FALSE)
+  bounds_sf <- dplyr::select(bounds_sf,SRC_DESC, geometry)
+  bounds_sf <- sf::st_transform(bounds_sf, 4326) # Project to WGS84
+  
+  # Table of SARA listed species
+  listed_species <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/MAR_listed_species.csv""),
+                             stringsAsFactors = FALSE)
+  listed_species <- listed_species %>% dplyr::rename(""SARA status"" = Schedule.status,
+                                              ""COSEWIC status"" = COSEWIC.status,
+                                              ""Wild Species listing"" = Wild_Species,
+                                              ""SCIENTIFICNAME"" = Scientific_Name_upper,
+                                              ""COMMONNAME"" = Common_Name_upper,
+                                              ""Scientific Name"" = Scientific_Name,
+                                              ""Common Name"" = Common_Name)
+  row.names(listed_species) <- NULL
+  
+  # Cetacean legend file
+  cetLegend <- data.frame(""Scientific_Name"" = c(""Delphinapterus leucas"",""Balaenoptera musculus"", ""Balaenoptera physalus"",
+                                                ""Phocoena phocoena"", ""Orcinus orca"", ""Eubalaena glacialis"",
+                                                ""Hyperoodon ampullatus"", ""Balaenoptera borealis"", ""Mesoplodon bidens""),
+                          ""Legend"" = c(""Beluga Whale: Endangered (SARA & COSEWIC)"", 
+                                       ""Blue Whale: Endangered (SARA & COSEWIC)"",
+                                       ""Fin Whale: Special Concern (SARA & COSEWIC)"",
+                                       ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)"",
+                                       ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)"",
+                                       ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)"",
+                                       ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)"",
+                                       ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)"",
+                                       ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)"")
+  )
+  
+  cetLegend <- dplyr::rename(cetLegend, c(""Scientific Name"" = ""Scientific_Name""))
+  
+  rr_otherSpecies <- data.frame(""Common_Name"" = c(""LOGGERHEAD SEA TURTLE"", ""ATLANTIC WALRUS"",
+                                            ""HARBOUR SEAL LACS DES LOUPS MARINS SUBSPECIES"", 
+                                            ""LEATHERBACK SEA TURTLE""),
+                          ""Scientific_Name"" = c(""Odobenus rosmarus  rosmarus"", 
+                                                ""Phoca vitulina mellonae"", 
+                                                ""Dermochelys coriacea"",
+                                                ""Caretta caretta""))
 }
-land10m_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/Landmass/ne_10m_land_Clip.shp""), stringsAsFactors = FALSE)
-#remove State and Province column from land10m
-land10m_sf <- land10m_sf[-c(2)]
-
-land50k_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/Coast50k/Coastline50k_SHP/Land_AtlCanada_ESeaboardUS.shp""),
-                      stringsAsFactors = FALSE)
-
-# National boundaries (terrestrial and marine)
-bounds_sf <- sf::st_read(file.path(fileLoadPath, ""Boundaries/AdminBoundaries/AdminBounds_SHP/Boundaries_Line.shp""), stringsAsFactors = FALSE)
-bounds_sf <- dplyr::select(bounds_sf,SRC_DESC, geometry)
-bounds_sf <- sf::st_transform(bounds_sf, 4326) # Project to WGS84
-
-# Table of SARA listed species
-listed_species <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/MAR_listed_species.csv""),
-                           stringsAsFactors = FALSE)
-listed_species <- listed_species %>% rename(""SARA status"" = Schedule.status,
-                                            ""COSEWIC status"" = COSEWIC.status,
-                                            ""Wild Species listing"" = Wild_Species,
-                                            ""SCIENTIFICNAME"" = Scientific_Name_upper,
-                                            ""COMMONNAME"" = Common_Name_upper,
-                                            ""Scientific Name"" = Scientific_Name,
-                                            ""Common Name"" = Common_Name)
-row.names(listed_species) <- NULL
-
-# Cetacean legend file
-cetLegend <- data.frame(""Scientific_Name"" = c(""Delphinapterus leucas"",""Balaenoptera musculus"", ""Balaenoptera physalus"",
-                                              ""Phocoena phocoena"", ""Orcinus orca"", ""Eubalaena glacialis"",
-                                              ""Hyperoodon ampullatus"", ""Balaenoptera borealis"", ""Mesoplodon bidens""),
-                        ""Legend"" = c(""Beluga Whale: Endangered (SARA & COSEWIC)"", 
-                                     ""Blue Whale: Endangered (SARA & COSEWIC)"",
-                                     ""Fin Whale: Special Concern (SARA & COSEWIC)"",
-                                     ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)"",
-                                     ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)"",
-                                     ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)"",
-                                     ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)"",
-                                     ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)"",
-                                     ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)"")
-)
-
-cetLegend <- dplyr::rename(cetLegend, c(""Scientific Name"" = ""Scientific_Name""))
-
-rr_otherSpecies <- data.frame(""Common_Name"" = c(""LOGGERHEAD SEA TURTLE"", ""ATLANTIC WALRUS"",
-                                          ""HARBOUR SEAL LACS DES LOUPS MARINS SUBSPECIES"", 
-                                          ""LEATHERBACK SEA TURTLE""),
-                        ""Scientific_Name"" = c(""Odobenus rosmarus  rosmarus"", 
-                                              ""Phoca vitulina mellonae"", 
-                                              ""Dermochelys coriacea"",
-                                              ""Caretta caretta""))
-
-save(region_sf, land10m_sf, land50k_sf, bounds_sf, listed_species, cetLegend, rr_otherSpecies, file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""CommonData.RData""))
+save(region_sf, land10m_sf, land50k_sf, bounds_sf, listed_species, cetLegend, rr_otherSpecies,
+     file = file.path(get_file_save_path(globalControlEnv$saveToRemote), ""CommonData.RData""))

---FILE: reports/sections/ocearch/ocearch_preprocessing.R---
@@ -20,7 +20,7 @@ if (globalControlEnv$updateGeoms) {
   ocearch_sf <- sf::st_as_sf(ocearch, coords = c(""long"", ""lat""), crs = 4326)
   ocearch_sf <- sf::st_crop(ocearch_sf, region_sf)
 } else {
-  ocearch_sf <- ocearch_rrr$data_sf
+  ocearch_sf <- ocearch_rr$data_sf
 }
 
 ocearch_rr <- list(""title"" = ""OCEARCH Shark Tracker"",

---FILE: reports/sections/run_all_sections.R---
@@ -18,13 +18,13 @@ openDataSecs <- c(here::here(""reports/sections/benthicEffort/benthicEffort_prepr
                   here::here(""reports/sections/docks/docks_preprocessing.R""),
                   here::here(""reports/sections/ebsa/ebsa_preprocessing.R""),
                   here::here(""reports/sections/imAcoustic/imAcoustic_preprocessing.R""),
-                    #here::here(""reports/sections/janvrinIsland/janvrinIsland_preprocessing.R""),
+                   #here::here(""reports/sections/janvrinIsland/janvrinIsland_preprocessing.R""),
                   here::here(""reports/sections/lobsterEffort/lobsterEffort_preprocessing.R""),
                   here::here(""reports/sections/nbw/nbw_preprocessing.R""),
                   here::here(""reports/sections/nitroLoad/nitroLoad_preprocessing.R""),
                   here::here(""reports/sections/opprrpe/opprrpe_preprocessing.R""),
                   here::here(""reports/sections/pasBay/pasBay_preprocessing.R""),
-                  #here::here(""reports/sections/power/power_preprocessing.R""),
+                  here::here(""reports/sections/power/power_preprocessing.R""),
                   here::here(""reports/sections/rv/rv_preprocessing.R""),
                   here::here(""reports/sections/sdm/sdm_preprocessing.R""),
                   here::here(""reports/sections/waste/waste_preprocessing.R""),
@@ -35,8 +35,8 @@ openDataSecs <- c(here::here(""reports/sections/benthicEffort/benthicEffort_prepr
 egisSecs <- c(here::here(""reports/sections/asf/asf_preprocessing.R""),
               here::here(""reports/sections/isdb-marfis/isdbMarfis_preprocessing.R""),
               here::here(""reports/sections/permits/permits_preprocessing.R""),
-              here::here(""reports/sections/rockweed/rockweed_preprocessing.R""),
-              here::here(""reports/sections/wsdb/wsdb_preprocessing.R"")
+              here::here(""reports/sections/rockweed/rockweed_preprocessing.R"")
+              #here::here(""reports/sections/wsdb/wsdb_preprocessing.R"")
               )
 
 apiSecs <- c( here::here(""reports/sections/obis/obis_preprocessing.R""),
@@ -75,12 +75,11 @@ source_preprocessing_script <- function(scriptPath) {
 # create global env:
 source(here::here(""config.R""))
 globalControlEnv$saveToRemote <- FALSE
-globalControlEnv$updateGeoms <- TRUE
+globalControlEnv$updateGeoms <- FALSE
+allSecs <- c(openDataSecs, egisSecs, apiSecs, inDriveSecs)
 
 if (FALSE) {
   # need utf-8 for accents
-  allSecs <- c(openDataSecs, egisSecs, apiSecs, inDriveSecs)
-  
   lapply(egisSecs, source_preprocessing_script)
   lapply(apiSecs, source_preprocessing_script)
   lapply(inDriveSecs, source_preprocessing_script)  ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,e0f2f1614da92ee7ff5f9dc0b827563fe7d0a22e,stoyelq,74926142+stoyelq@users.noreply.github.com,2022-12-06T19:23:38Z,GitHub,noreply@github.com,2022-12-06T19:23:38Z,"Update issue templates

Add wiki entry instead of sharepoint doc.",.github/ISSUE_TEMPLATE/training-1.md,False,False,False,False,1,1,2,"---FILE: .github/ISSUE_TEMPLATE/training-1.md---
@@ -8,7 +8,7 @@ assignees: ''
 ---
 
 ### Action:
-Clone the shiny app and install all the dependencies.  Here's the loose help guide I made for this: https://086gc-my.sharepoint.com/:w:/g/personal/quentin_stoyel_dfo-mpo_gc_ca/ETa4YB3BEDVJrDT4BScj80oBJgF1I-kHe8bLTJbqyb2qDQ?e=llP8nM 
+Clone the shiny app and install all the dependencies.  Here's the loose help guide I made for this: https://github.com/dfo-mar-odis/shinySpatialApp/wiki/Cloning-the-Repository-Instructions
 
 ### Context:
 It's good to install everything at once and R is a little tricky for dependencies.  ",False,False,Documentation / Formatting,3
dfo-mar-odis,shinySpatialApp,f0339ee9efb79535fc319ebf8b3c265842d2010b,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-06T18:24:08Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-06T18:24:08Z,"fix typos throughout scripts, #142",reports/dataprocessing/openDataHelpers.R;reports/sections/imAcoustic/imAcoustic_preprocessing.R;reports/sections/janvrinIsland/janvrinIsland_preprocessing.R;reports/sections/lobsterEffort/lobsterEffort_preprocessing.R;reports/sections/nitroLoad/nitroLoad_preprocessing.R;reports/sections/opprrpe/opprrpe_preprocessing.R;reports/sections/power/power_preprocessing.R;reports/sections/waste/waste_preprocessing.R,False,True,True,False,35,51,86,"---FILE: reports/dataprocessing/openDataHelpers.R---
@@ -1,9 +1,6 @@
 
-if(!(""ckanr"" %in% (.packages()))){
-  install.packages(""ckanr"") #you need to install the packages every time since it is a fresh container
-  library(ckanr)
-  ckanr_setup(url=""https://open.canada.ca/data"")
-}
+library(ckanr)
+
 library(sf)
 sf::sf_use_s2(FALSE)
 library(httr)

---FILE: reports/sections/imAcoustic/imAcoustic_preprocessing.R---
@@ -11,7 +11,7 @@ source(here::here(""config.R""))
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""imAcoustic_rr""), regionStr)
 
-# ---------------------A Novel Video and Acoustic Survey of the Seaweeds of Isle Madame-----------------------------------
+print("" ------------Acoustic Survey of Isle Madame-----------------------"")
 if (globalControlEnv$updateGeoms) {
   
 pkgId <- ""ebdd8f91-9131-45f0-8aec-aba9f65e3fae""

---FILE: reports/sections/janvrinIsland/janvrinIsland_preprocessing.R---
@@ -11,16 +11,19 @@ source(here::here(""config.R""))
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""janvrinIsland_rr""), regionStr)
 
-# ---------------------Javrin Island Eelgrass-----------------------------------
-
-esriUrl <- ""https://gisd.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Netforce/MapServer/""
-janvrinIsland_sf <- esri2sf::esri2sf(paste0(esriUrl, ""1""), progress = TRUE)
-janvrinIsland_sf$`Eelgrass Observation` <- janvrinIsland_sf$Eelgrass_Observation
-
-janvrinIsland_sf <- sf::st_transform(janvrinIsland_sf, crs = 4326) %>%
-  sf::st_make_valid() %>%
-  sf::st_crop(region_sf)
-
+print(""---------------------Javrin Island Eelgrass-----------------------------------"")
+if (globalControlEnv$updateGeoms) {
+    
+  esriUrl <- ""https://gisd.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Netforce/MapServer/""
+  janvrinIsland_sf <- esri2sf::esri2sf(paste0(esriUrl, ""1""), progress = TRUE)
+  janvrinIsland_sf$`Eelgrass Observation` <- janvrinIsland_sf$Eelgrass_Observation
+  
+  janvrinIsland_sf <- sf::st_transform(janvrinIsland_sf, crs = 4326) %>%
+    sf::st_make_valid() %>%
+    sf::st_crop(region_sf)
+} else {
+  janvrinIsland_sf <- janvrinIsland_rr$data_sf
+}
 janvrinIsland_rr <- list(""title"" = ""Janvrin Island Eelgrass Presence/Absence"",
                          ""data_sf"" = janvrinIsland_sf,
                          ""datasetName"" = ""Janvrin Island eelgrass"",

---FILE: reports/sections/lobsterEffort/lobsterEffort_preprocessing.R---
@@ -1,12 +1,7 @@
-# contains functions for downloading open data records
-source(here::here(""dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/R/dataFunctions.R""))
 
-#contains load_rdata function
-source(here::here(""app/R/dataFunctions.R""))
-
-#contains config parameters and paths
 source(here::here(""config.R""))
-library(httr)
 
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""lobsterEffort_rr""), regionStr)
@@ -18,9 +13,11 @@ if (globalControlEnv$updateGeoms) {
   
   lobsterEffort_rr <- get_opendata_rr(lobsterEffortPkgId)
   
-  url <- ""https://gisp.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Maritimes_Inshore_Lobster_Landings_Effort_2012_2014_EN/MapServer""
-  lobsterEffort_sf <- get_esri_rest(url, layer=""1"")
-  lobsterEffort_rr$data_sf <- sf::st_make_valid(lobsterEffort_sf)
+  esriBase <- ""https://gisp.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Maritimes_Inshore_Lobster_Landings_Effort_2012_2014_EN/MapServer/""
+  esriUrl <- paste0(esriBase, ""1"")
+  regionBbox <- sf::st_bbox(sf::st_transform(region_sf, 2961))
+  data_sf <- esri2sf::esri2sf(esriUrl, bbox=regionBbox, progress = TRUE)
+  lobsterEffort_rr$data_sf <- sf::st_make_valid(data_sf)
   # already in 4326 and cropped.
 }
 

---FILE: reports/sections/nitroLoad/nitroLoad_preprocessing.R---
@@ -1,10 +1,6 @@
-# contains functions for downloading open data records
-source(here::here(""dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/R/dataFunctions.R""))
 
-#contains load_rdata function
-source(here::here(""app/R/dataFunctions.R""))
-
-#contains config parameters and paths
 source(here::here(""config.R""))
 
 

---FILE: reports/sections/opprrpe/opprrpe_preprocessing.R---
@@ -11,7 +11,7 @@ source(here::here(""config.R""))
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""opprrpe_rr""), regionStr)
 
-print(""---------------------TEMPLATE-----------------------------------"")
+print(""---------------------OPPRRPE-----------------------------------"")
 
 if (globalControlEnv$updateGeoms) {
   pkgId <- ""f32ce23d-4a16-4eaa-9648-2f02a98b91af""

---FILE: reports/sections/power/power_preprocessing.R---
@@ -1,13 +1,7 @@
-# contains functions for downloading open data records
-source(here::here(""dataprocessing/openDataHelpers.R""))
-
-#contains load_rdata function
+source(here::here(""reports/dataprocessing/openDataHelpers.R""))
 source(here::here(""reports/R/dataFunctions.R""))
-
-#contains config parameters and paths
 source(here::here(""config.R""))
 
-
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""power_rr""), regionStr)
 
@@ -18,12 +12,12 @@ if (globalControlEnv$updateGeoms) {
   
   power_rr <- get_opendata_rr(powerPkgId)
   
-  url <- ""https://geoappext.nrcan.gc.ca/arcgis/rest/services/Energy/clean_energy_generating_stations_fgp/MapServer""
+  url <- ""https://geoappext.nrcan.gc.ca/arcgis/rest/services/Energy/clean_energy_generating_stations_fgp/MapServer/""
   # only take stations east of Thunder Bay, crop to region later
-  where <- ""Longitude > -90""
-  power_sf <- get_esri_rest(url, layer=""0"", where=where)
-  power_rr$data_sf <- sf::st_crop(power_sf, region_sf) %>% 
-    sf::st_make_valid()
+  esriUrl <- paste0(url, ""0"")
+  regionBbox <- sf::st_bbox(sf::st_transform(region_sf, 3978))
+  data_sf <- esri2sf::esri2sf(esriUrl,  bbox=regionBbox, progress = TRUE)
+  power_rr$data_sf <- sf::st_make_valid(data_sf)
   # already in 4326.
 }
 

---FILE: reports/sections/waste/waste_preprocessing.R---
@@ -1,13 +1,10 @@
-# contains functions for downloading open data records
-source(here::here(""dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/dataprocessing/openDataHelpers.R""))
+source(here::here(""reports/R/dataFunctions.R""))
 
-#contains load_rdata function
-source(here::here(""app/R/dataFunctions.R""))
-
-#contains config parameters and paths
 source(here::here(""config.R""))
 
 
+
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""waste_rr""), regionStr)
 ",True,False,Dependency / Package,3
dfo-mar-odis,shinySpatialApp,8dbe7e5523b2d68174e4a63f3491baa92089b9a7,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-02T17:56:35Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-12-02T17:56:35Z,fix global env gotcha!,config.R;reports/sections/run_all_sections.R,False,True,True,False,7,4,11,"---FILE: config.R---
@@ -34,7 +34,9 @@ rr_openDataList <- data.frame(""rrStr"" = c(""ebsa_rr"",
 configMetadataSheetUrl <- ""1lEhBikDNAec-X88q1C02Aw6lOP8gKOkUlDurMznOAOI""
 githubRepo <- ""https://github.com/dfo-mar-odis/shinySpatialApp/tree/main/""
 
-
-globalControlEnv <- new.env()
-globalControlEnv$saveToRemote <- FALSE
-globalControlEnv$updateGeoms <- TRUE
+# only create env if it doesn't already exists.
+if (!exists(""globalControlEnv"", mode=""environment"")){
+  globalControlEnv <- new.env()
+  globalControlEnv$saveToRemote <- FALSE
+  globalControlEnv$updateGeoms <- TRUE
+}

---FILE: reports/sections/run_all_sections.R---
@@ -60,6 +60,7 @@ inDriveSecs <- c(here::here(""reports/sections/commonSections/commonData_preproce
 
 allSecs <- c(openDataSecs, egisSecs, apiSecs, inDriveSecs)
 
+# create global env:
 source(here::here(""config.R""))
 globalControlEnv$saveToRemote <- FALSE
 globalControlEnv$updateGeoms <- FALSE",True,False,Environment / Configuration,3
dfo-mar-odis,shinySpatialApp,27f9e474d9da66abcfedf978d015cd0e0d8c899a,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-30T19:09:31Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-30T19:09:31Z,"make some fixes, use google in a few sections",reports/R/dataFunctions.R;reports/sections/asf/asf_preprocessing.R;reports/sections/benthicEffort/benthicEffort_preprocessing.R;reports/sections/blueWhaleHab/bwhab_preprocessing.R,False,True,True,False,6,21,27,"---FILE: reports/R/dataFunctions.R---
@@ -125,18 +125,19 @@ intro_setup <- function(studyArea, env=globalenv()) {
 # ------------read_google_metadata----------------
 read_google_metadata <- function(rrID, pipelinePath=NULL, isOpenData=FALSE){
   rrBase <- rrID
+  rrBaseName <-  substring(rrID, 1, nchar(rrID)-3) # remove _rr from name
   metadata_df <- googlesheets4::read_sheet(configMetadataSheetUrl)
   metadataRow <- head(dplyr::filter(metadata_df, DatasetName==rrID), 1)
   metadataList <- list(""contact"" = lang_list(metadataRow$Contact),
                        ""url"" = lang_list(metadataRow$URL),
-                       ""searchYears""= ifelse(!is.null(metadataRow$SearchYear),
+                       ""searchYears""= ifelse(!is.null(metadataRow$SearchYear[[1]]),
                                               metadataRow$SearchYear, """"),
                        ""constraints"" = lang_list(metadataRow$DataUseConstraints),
                        ""securityLevel"" = lang_list(metadataRow$SecurityLevel),
                        ""qualityTier"" =  lang_list(metadataRow$QualityTier),
                        ""pipelinePath"" = ifelse(!is.null(pipelinePath), pipelinePath,
                                                paste0(githubRepo, ""reports/sections/"",
-                                                      rrBase, ""/"", rrBase, ""_preprocessing.R""))
+                                                      rrBaseName, ""/"", rrBaseName, ""_preprocessing.R""))
                        )
   
   # date nonesense:

---FILE: reports/sections/asf/asf_preprocessing.R---
@@ -32,15 +32,6 @@ names(asf_sf) <- c(""River name"", ""Status"", ""geoms"")
 asf_rr <- list(""title"" = ""Atlantic salmon rivers of Eastern North America"",
                 ""data_sf"" = asf_sf,
                 ""attribute"" = ""Status"",
-                ""metadata"" = list(""contact"" = ""<ncrabbe@asf.ca>"", 
-                                  ""url"" = lang_list(""<https://gisd.dfo-mpo.gc.ca/portal/home/item.html?id=eed6dd1d26354b6f83235032b89ac576>""),
-                                  ""url internal"" = lang_list(""<https://gisd.dfo-mpo.gc.ca/portal/home/item.html?id=eed6dd1d26354b6f83235032b89ac576>""), 
-                                  ""accessedOnStr"" = list(""en"" =""August 18, 2022"", ""fr"" = ""18 Aout 2022"") ,
-                                  ""accessDate"" = as.Date(""2022-08-18""),
-                                  ""securityLevel"" = internalUse,
-                                  ""qualityTier"" = highQuality,
-                                  ""constraints"" = internalUse,
-                                  ""pipelinePath"" = paste0(githubRepo, ""reports/sections/asf/asf_preprocessing.R"")
-                )
+                ""metadata"" = read_google_metadata(""asf_rr"")
 )
 save(asf_rr, file = file.path(localFileSavePath, ""Secure/asf_rr.RData""))

---FILE: reports/sections/benthicEffort/benthicEffort_preprocessing.R---
@@ -32,9 +32,7 @@ if (length(allRasters) > 0){
 }
 
 benthicEffort_rr <- ea_rr
-benthicEffort_rr$metadata$qualityTier <- mediumQuality
-benthicEffort_rr$metadata$pipelinePath = paste0(githubRepo, ""reports/sections/benthicEffort/benthicEffort_preprocessing.R"")
-
+benthicEffort_rr$metadata <- read_google_metadata(""benthicEffort_rr"", isOpenData = TRUE)
 benthicEffort_rr$data_sf <- mergeRaster
 
 save(benthicEffort_rr, file = file.path(localFileSavePath, ""Open/benthicEffort_rr.RData""))

---FILE: reports/sections/blueWhaleHab/bwhab_preprocessing.R---
@@ -16,14 +16,9 @@ blueWhaleHab_sf <- dplyr::select(blueWhaleHab_sf, c(""Activity""))
 blueWhaleHab_sf <- sf::st_crop(blueWhaleHab_sf, region_sf)
 blueWhaleHab_rr$data_sf <- blueWhaleHab_sf
 
-blueWhaleHab_rr$metadata$contact <- email_format(""gddaiss-dmsaisb\\@dfo-mpo.gc.ca"")
-blueWhaleHab_rr$metadata$qualityTier <- highQuality
-blueWhaleHab_rr$metadata$pipelinePath <- paste0(githubRepo, ""reports/sections/bwhab/bwhab_preprocessing.R"")
-
-blueWhaleHab_rr$attribute <- ""Activity""
+blueWhaleHab_rr$metadata <- read_google_metadata(""blueWhaleHab_rr"", isOpenData = TRUE)
 blueWhaleHab_rr$metadata$reference <- lang_list(""<https://waves-vagues.dfo-mpo.gc.ca/Library/40687776.pdf>"")
 
-
 save(blueWhaleHab_rr, file = file.path(localFileSavePath, ""Open/blueWhaleHab_rr.RData""))
 
 ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,c7faaec511d0df5fbda25d3c604644a7621d6291,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-30T12:18:08Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-30T12:18:08Z,fix leftover remote save path,reports/sections/offshore_scallop/offshore_scallop_preprocessing.R,False,True,True,False,1,1,2,"---FILE: reports/sections/offshore_scallop/offshore_scallop_preprocessing.R---
@@ -69,5 +69,5 @@ offshoreScallop_rr <- list(
                     
                     )
   )
-save(offshoreScallop_rr, bankLabels, file = file.path(remoteFileSavePath, ""Protected/offshoreScallop_rr.RData""))
+save(offshoreScallop_rr, bankLabels, file = file.path(localFileSavePath, ""Protected/offshoreScallop_rr.RData""))
 ",True,False,File I/O and Export,4
dfo-mar-odis,shinySpatialApp,7608f60ddef3208c5aa4ca534f0ebafcc90423d6,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-25T19:44:44Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-25T19:44:44Z,fix typos,reports/sections/obis/obis_preprocessing.R;reports/sections/power/power_preprocessing.R;reports/sections/rockweed/rockweed_preprocessing.R;reports/sections/wsdb/wsdb_preprocessing.R,False,True,True,False,10,10,20,"---FILE: reports/sections/obis/obis_preprocessing.R---
@@ -76,10 +76,10 @@ obis_rr <- list(""title"" = ""Ocean Biodiversity Information System (OBIS)"",
                 ""attribute"" = ""NONE"",
                 ""metadata"" = list(""contact"" = email_format(""helpdesk@obis.org""), 
                                   ""url"" = lang_list(""<https://obis.org/>""),
-                                  ""accessedOnStr"" = list(""en"" =""April 28 2022 using robis"", 
-                                                        ""fr"" = ""28 avril 2022 par robis"") ,
-                                  ""accessDate"" = as.Date(""2022-04-28""),
-                                  ""searchYears"" = ""2010-2021"",
+                                  ""accessedOnStr"" = list(""en"" =""November 25 2022 using robis"", 
+                                                        ""fr"" = ""25 novembre 2022 par robis"") ,
+                                  ""accessDate"" = as.Date(""2022-11-25""),
+                                  ""searchYears"" = ""2010-2022"",
                                   ""securityLevel"" = noneList,
                                   ""qualityTier"" = variableQuality,
                                   ""constraints"" = noneList,

---FILE: reports/sections/power/power_preprocessing.R---
@@ -2,7 +2,7 @@
 source(here::here(""dataprocessing/openDataHelpers.R""))
 
 #contains load_rdata function
-source(here::here(""app/R/dataFunctions.R""))
+source(here::here(""reports/R/dataFunctions.R""))
 
 #contains config parameters and paths
 source(here::here(""config.R""))

---FILE: reports/sections/rockweed/rockweed_preprocessing.R---
@@ -27,9 +27,9 @@ rockweed_rr <- list(""title"" = ""Satellite-based Maps of Intertidal Vegetation and
                     ""attribute"" = ""status"",
                     ""metadata"" = list(""contact"" = email_format(""Gordana.Lazin@dfo-mpo.gc.ca""), 
                                       ""url"" = lang_list(""<https://gisd.dfo-mpo.gc.ca/portal/home/item.html?id=cbf26467bce84abc972a04e88581a030>""),
-                                      ""accessedOnStr"" = list(""en"" =""July 28 2022"", 
-                                                             ""fr"" = ""28 juillet 2022"") ,
-                                      ""accessDate"" = as.Date(""2022-07-28""),
+                                      ""accessedOnStr"" = list(""en"" =""November 25 2022"", 
+                                                             ""fr"" = ""25 novembre 2022"") ,
+                                      ""accessDate"" = as.Date(""2022-11-25""),
                                       ""searchYears"" = ""2020"",
                                       ""securityLevel"" = noneList,
                                       ""qualityTier"" = mediumQuality,

---FILE: reports/sections/wsdb/wsdb_preprocessing.R---
@@ -10,7 +10,7 @@ loadResult <- load_rdata(c(""CommonData"", ""wsdb_rr""), regionStr)
 # Accessing API needs 2 parts: 1. the authentication token, and 2. the url to query.
 # There are 3-4 useful links/endpoints to make this happen.
 # This url is the mapserver url where the data is stored:
-egisUrl <- ""https://gisd.dfo-mpo.gc.ca/arcgis/rest/services/FGP/Whale_Sightings_Database/MapServer/""
+egisUrl <- ""https://gisd.dfo-mpo.gc.ca/arcgis/rest/services/SpatialReproducibleReporting/Map/MapServer/""
 # this url specifies the exact layer to pull data from:
 egisLayer <- paste0(egisUrl, ""0/"")
 
@@ -41,7 +41,7 @@ wsdb_rr <- list(""title"" = ""Whale Sightings Database"",
                                   ""url"" = lang_list(""<http://www.inter.dfo-mpo.gc.ca/Maritimes/SABS/popec/sara/Database>""),
                                   ""url internal"" = lang_list(""<https://gisd.dfo-mpo.gc.ca/portal/home/webmap/viewer.html?webmap=7b4dd9e932864700a2f44ed70cc75b40&extent=-82.7098,36.4078,-30.8983,53.5042>""), 
                                   ""accessedOnStr"" = list(""en"" =""April 7, 2021 by Amanda Babin"", ""fr"" = ""7 avril 2021 par Amanda Babin"") ,
-                                  ""accessDate"" = as.Date(""2020-10-27""),
+                                  ""accessDate"" = as.Date(""2021-04-07""),
                                   ""searchYears"" = paste(rrMinYear, ""-2020"", sep=""""),
                                   ""securityLevel"" = noneList,
                                   ""qualityTier"" = lowQuality,",True,False,Environment / Configuration,3
dfo-mar-odis,shinySpatialApp,4eb4dac0ed4ff831d6fb964a230b537ced4cd783,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-18T15:50:51Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-11-18T15:50:51Z,"fixed a typo, how are they still typos?",reports/sections/rv/rv_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/rv/rv_en.Rmd---
@@ -66,7 +66,7 @@ if (is.null(outputList$studyData)) {
     Report_RV <- ""* There are relevant records in the Maritimes Research Vessel (RV) Survey for this search area.""
     surveyTypeTable <- table(unique(outputList$studyData[,c('ELAT','ELONG','geometry', 'surveyType')])$surveyType)
     surveyTypeDf <- as.data.frame(surveyTypeTable)
-    names(surveyTypeDf) <- c(""Suvery"", ""Number of trawl samples"")
+    names(surveyTypeDf) <- c(""Survey"", ""Number of trawl samples"")
     rownames(surveyTypeDf) <- NULL
   }
 Report_RV<-noquote(Report_RV)",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,ae227e636c540b85a4ba15eb1c36c45e457950ed,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-10-25T16:34:56Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-10-25T16:34:56Z,fix gremlins in null condition,reports/sections/sarsearch/sarsearch_en.rmd,True,False,True,False,7,6,13,"---FILE: reports/sections/sarsearch/sarsearch_en.rmd---
@@ -59,13 +59,14 @@ outputList <- master_intersect(sarsearch_rr$data_sf, mapDataList, getRegion = TR
 introResult <- !is.null(outputList$studyData)
 summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[SAR search DMapp](#sarsearch-section)"", result=introResult)
 
-sarsearchTable <- sf::st_drop_geometry(outputList$studyData)
-sarsearchTable <- if (!is.null(outputList$studyData)) {
-    dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
+sarsearchTable <- NULL
+if (!is.null(outputList$studyData)) {
+  sarsearchTable <- sf::st_drop_geometry(outputList$studyData)
+  dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
   names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Geometry Type"", ""Notes"")  
-sarsearchTable[is.na(sarsearchTable)] <- """"
-row.names(sarsearchTable) <- NULL  
-      }
+  sarsearchTable[is.na(sarsearchTable)] <- """"
+  row.names(sarsearchTable) <- NULL  
+}
 
 ```
 ",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,cfbb32fe999a0c336d53f8c29c77ea7678c6f8f0,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-10-25T14:41:22Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-10-25T14:41:22Z,added if statement so things don't break whehn there is no data in the search - this will solve issues to run #122,reports/sections/sarsearch/sarsearch_en.rmd,True,False,True,False,3,4,7,"---FILE: reports/sections/sarsearch/sarsearch_en.rmd---
@@ -60,14 +60,13 @@ introResult <- !is.null(outputList$studyData)
 summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[SAR search DMapp](#sarsearch-section)"", result=introResult)
 
 sarsearchTable <- sf::st_drop_geometry(outputList$studyData)
-#sarsearchTable <- dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
 sarsearchTable <- if (!is.null(outputList$studyData)) {
     dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
   names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Geometry Type"", ""Notes"")  
-    }
-
 sarsearchTable[is.na(sarsearchTable)] <- """"
-row.names(sarsearchTable) <- NULL
+row.names(sarsearchTable) <- NULL  
+      }
+
 ```
 
 ```{r sarsearch-check, echo=FALSE, results='asis',}",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,054d0323c92fa3b4efe577283a596768db876596,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-10-25T14:37:44Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-10-25T14:37:44Z,Updated code so things don't run if outputList$studyData is empty. This fixed report so we can work on #122.,reports/sections/sarsearch/sarsearch_en.rmd,True,False,True,False,6,4,10,"---FILE: reports/sections/sarsearch/sarsearch_en.rmd---
@@ -59,13 +59,15 @@ outputList <- master_intersect(sarsearch_rr$data_sf, mapDataList, getRegion = TR
 introResult <- !is.null(outputList$studyData)
 summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[SAR search DMapp](#sarsearch-section)"", result=introResult)
 
-
 sarsearchTable <- sf::st_drop_geometry(outputList$studyData)
-sarsearchTable <- dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
-names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Geometry Type"", ""Notes"")
+#sarsearchTable <- dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
+sarsearchTable <- if (!is.null(outputList$studyData)) {
+    dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
+  names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Geometry Type"", ""Notes"")  
+    }
+
 sarsearchTable[is.na(sarsearchTable)] <- """"
 row.names(sarsearchTable) <- NULL
-
 ```
 
 ```{r sarsearch-check, echo=FALSE, results='asis',}",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,e91776a7bbd9ccba3040998e0fae2f59cbf9053e,stoyelq,74926142+stoyelq@users.noreply.github.com,2022-10-20T12:51:12Z,GitHub,noreply@github.com,2022-10-20T12:51:12Z,"Update issue templates

Add the RRRequests template",.github/ISSUE_TEMPLATE/rrrequests.md,False,False,False,False,21,0,21,"---FILE: .github/ISSUE_TEMPLATE/rrrequests.md---
@@ -0,0 +1,21 @@
+---
+name: RRRequests
+about: Record report generation.
+title: 'RRRequests: Area + Topic'
+labels: ''
+assignees: ''
+
+---
+
+### Activity
+Generate a reproducible report for INSERT AREA requested by INSERT NAME.
+
+### Context
+Details around the request here: why was it requested?  Include snapshot of the area + any relevant details from the email
+
+### Perceived Effort:
+1
+
+### When is this done:
+- [ ] Report sent out
+- [ ] Report stored on IN folder.",False,False,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,d3841d550f4ea75fc6f4b15330c4b7e18b7b0ea5,stoyelq,74926142+stoyelq@users.noreply.github.com,2022-10-12T16:34:40Z,GitHub,noreply@github.com,2022-10-12T16:34:40Z,Test issue template for updating data sources,.github/ISSUE_TEMPLATE/update-data.md,False,False,False,False,23,0,23,"---FILE: .github/ISSUE_TEMPLATE/update-data.md---
@@ -0,0 +1,23 @@
+---
+name: Update Data
+about: Update data source
+title: ''
+labels: ''
+assignees: ''
+
+---
+
+**Data source to update**
+
+**Why**
+RR data sources require periodic updates to keep the report up to date. 
+
+**Steps:**
+ - [ ] Update local data
+ - [ ] Test rendering report
+ - [ ] Update Remote
+ - [ ] Update metadata sheet
+ - [ ] Regenerate the Checkdate csv
+
+**Estimated Effort:**
+1",False,False,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,1458ef5d3aa250df3af81f54ce722bafab2b4940,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-08-25T14:23:54Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-08-25T14:23:54Z,fix handling of lines and linestrings,reports/sections/sarsearch/sarseach_fr.rmd;reports/sections/sarsearch/sarsearch_en.rmd;reports/sections/sarsearch/sarsearch_preprocessing.R,True,False,True,False,92,47,139,"---FILE: reports/sections/sarsearch/sarseach_fr.rmd---
@@ -6,70 +6,110 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r template-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sarsearch-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}
-if (FALSE) { # load in generic data, e.g.functions, study area, and base maps:
+if (FALSE) { 
+  # load in generic data, e.g.functions, study area, and base maps into the 
+  # environment, when knitting, these will be loaded through the child rmd.
   lapply(list.files(here::here(""reports/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
-  
-  # load the last study area generated by the app
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson""))
-  
   intro_setup(studyArea, env = environment())
 }
 ```
 
-### **Template Section Title** {#template-section}
+### **SAR search DMapps Data** {#sarsearch-section}
 
-```{r template-load, include=FALSE}
+```{r sarsearch-load, include=FALSE}
 # load in section specific data
-load_rdata(c(""template_rr""), regionStr, env = environment())
+load_rdata(c(""sarsearch_rr""), regionStr, env = environment())
 
 ```
 
-```{r template-meta, results='asis'}
+```{r sarsearch-meta, results='asis'}
 # metadata blurb at start of each section
-write_meta(template_rr, ""FR"")
+write_meta(sarsearch_rr, ""EN"")
 ```
 
-SECTION TEXT ADDED HERE.
+Species data collected in the Species At Risk (SAR) search application (part of DFO's DMapps suite) was extracted and is presented below.
+
+-   The data originates from both external and internal sources, and must not to be shared or used outside DFO.
+
+-    Sources include data mining from COSEWIC reports.
+
+-    The data is not comprehensive in any way. It is likely that there are records of occurrence for any given species that have not been included or represented and likely does not represent the latest records, findings, or distribution for any given species.
 
+-   Although the data is accurate based on its original source, it is from a variety of sources and varies in quality depending on the source for any given record.
 
-#### *Area-specific Template results*
-```{r template-results, include=FALSE, cache=FALSE}
+-   While every reasonable effort has been made to ensure that the data is correct, DFO Species at Risk Program does not warrant or guarantee the accuracy, completeness, or currency of the data for any specific use.
+
+-    Data that are represented only by ""Regions"" in the record and/or the map only implies that the species has been found in the specified region(s). ""Regions"" must not be used as polygons of distribution.
+
+-   A data point can either represent the exact location at which a species was found or may be used to indicate the presence of a species in any given waterbody. Please consult all information for any given record before making any interpretation.
+
+#### *Area-specific Sarsearch results*
+
+```{r sarsearch-results, include=FALSE, cache=FALSE}
 # clip the data to the Study and Map areas:
-templateOutputList <- master_intersect(template_rr$data_sf, mapDataList)
+outputList <- master_intersect(sarsearch_rr$data_sf, mapDataList, getRegion = TRUE)
+
+
+# summary intro table
+introResult <- !is.null(outputList$studyData)
+summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[SAR search DMapp](#sarsearch-section)"", result=introResult)
+
+
+sarsearchTable <- sf::st_drop_geometry(outputList$studyData)
+sarsearchTable <- dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
+names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Geometry Type"", ""Notes"")
+sarsearchTable[is.na(sarsearchTable)] <- """"
+row.names(sarsearchTable) <- NULL
 
-# Create tables based off of the Scientific Name column, one with all species found,
-# and one with only the Species at Risk found.
-tableList <- create_sar_tables(templateOutputList$studyData, listed_species)
-templateAllTable <- tableList$allSpecies
-templateSarTable <- tableList$sarData
 ```
 
-```{r template-check, echo=FALSE, results='asis',}
+```{r sarsearch-check, echo=FALSE, results='asis',}
 # Check if there is any data in the study area
-templateReport <- if (is.null(templateOutputList$studyData)) {
-  ""* There are no relevant template records for this search area.""
+sarsearchReport <- if (is.null(outputList$studyData)) {
+  ""* There are no relevant SAR search records for this search area.""
 } else {
-  ""* There are relevant template records for this search area.""
+  ""* There are relevant SAR search records for this search area.""
+}
+writeLines(noquote(sarsearchReport))
+```
+
+```{r sarsearch-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sarsearch_rr, ""EN""), 'SAR search results within the region and the search area defined by the user (red outline). The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+if (!is.null(outputList$regionData)) {
+  pointData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, c(""POINT"", ""MULTIPOINT"")), ]
+  lineData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, c(""LINESTRING"", ""MULTILINESTRING"")), ]
+  polyData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, c(""POLYGON"", ""MULTIPOLYGON"")), ]
+  
+  polyMap <- plot_rr_sf(regionMap, polyData, attribute = ""NONE"", alpha = 0.5)
+  lineMap <- plot_rr_sf(polyMap, lineData)
+  plot_rr_sf(lineMap, pointData, attribute = ""NONE"")
 }
-writeLines(noquote(templateReport))
 ```
 
-```{r template-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(template_rr, ""FR""), 'Map showing the search area defined by the user (red outline) used to query information from template records.')}
-if (!is.null(templateOutputList$studyData)) {
-  # common plotting function:
-  plot_rr_sf(areaMap, templateOutputList$mapData, attribute = 
-               template_rr$attribute)
+```{r sarsearch-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sarsearch_rr, ""EN""), 'SAR search results within the search area defined by the user (red outline).The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+if (!is.null(outputList$studyData)) {
+  pointData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, c(""POINT"", ""MULTIPOINT"")), ]
+  lineData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, c(""LINESTRING"", ""MULTILINESTRING"")), ]
+  polyData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, c(""POLYGON"", ""MULTIPOLYGON"")), ]
+  
+  polyMap <- plot_rr_sf(areaMap, polyData, attribute = sarsearch_rr$attribute, 
+                        alpha = 0.5)
+  lineMap <- plot_rr_sf(polyMap, lineData)
+  plot_rr_sf(lineMap, pointData, attribute = sarsearch_rr$attribute)
+ 
 }
 ```
+
 <br>
-```{r template-table}
-if (!is.null(templateOutputList$studyData)) {
-  if (nrow(templateSarTable) > 0) {
-    knitr::kable(templateSarTable, align = ""l"", caption = paste(""\\label{tab:template_table}"", write_caption_blurb(template_rr, ""FR""), ""Template records of species contained within the search area and listed by the Species At Risk Act (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Frequency represents the subset of the sampling locations out of the total where each species is present. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>""), booktabs = T, escape = F, linesep = """") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+
+```{r sarsearch-table}
+if (!is.null(outputList$studyData)) {
+  if (nrow(sarsearchTable) > 0) {
+    knitr::kable(sarsearchTable, align = ""l"", caption = paste(""\\label{tab:sarsearch_table}"", write_caption_blurb(sarsearch_rr, ""EN""), ""SAR search records of species contained within the search area and listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Frequency represents the subset of the sampling locations out of the total where each species is present. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>""), booktabs = T, escape = F, linesep = """") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
   }
 }
 ```

---FILE: reports/sections/sarsearch/sarsearch_en.rmd---
@@ -61,8 +61,8 @@ summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[SAR sear
 
 
 sarsearchTable <- sf::st_drop_geometry(outputList$studyData)
-sarsearchTable <- dplyr::select(sarsearchTable, c(species_name, year, name, source, notes))
-names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Notes"")
+sarsearchTable <- dplyr::select(sarsearchTable, c(species_name, year, name, source, record_type, notes))
+names(sarsearchTable) <- c(""Species Name"", ""Year"", ""Location Name"", ""Source"", ""Geometry Type"", ""Notes"")
 sarsearchTable[is.na(sarsearchTable)] <- """"
 row.names(sarsearchTable) <- NULL
 
@@ -81,22 +81,26 @@ writeLines(noquote(sarsearchReport))
 ```{r sarsearch-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sarsearch_rr, ""EN""), 'SAR search results within the region and the search area defined by the user (red outline). The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(outputList$regionData)) {
   pointData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, c(""POINT"", ""MULTIPOINT"")), ]
-  lineData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, ""LINESTRING""), ]
-  polyData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, ""POLYGON""), ]
+  lineData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, c(""LINESTRING"", ""MULTILINESTRING"")), ]
+  polyData <- outputList$regionData[sf::st_is(outputList$regionData$geometry, c(""POLYGON"", ""MULTIPOLYGON"")), ]
   
-  plot_rr_sf(regionMap, pointData, attribute = ""NONE"")
+  polyMap <- plot_rr_sf(regionMap, polyData, attribute = ""NONE"", alpha = 0.5)
+  lineMap <- plot_rr_sf(polyMap, lineData)
+  plot_rr_sf(lineMap, pointData, attribute = ""NONE"")
 }
 ```
 
 ```{r sarsearch-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sarsearch_rr, ""EN""), 'SAR search results within the search area defined by the user (red outline).The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(outputList$studyData)) {
   pointData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, c(""POINT"", ""MULTIPOINT"")), ]
-  lineData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, ""LINESTRING""), ]
-  polyData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, ""POLYGON""), ]
+  lineData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, c(""LINESTRING"", ""MULTILINESTRING"")), ]
+  polyData <- outputList$mapData[sf::st_is(outputList$mapData$geometry, c(""POLYGON"", ""MULTIPOLYGON"")), ]
   
-  
-  plot_rr_sf(areaMap, pointData, attribute = 
-               sarsearch_rr$attribute)
+  polyMap <- plot_rr_sf(areaMap, polyData, attribute = sarsearch_rr$attribute, 
+                        alpha = 0.5)
+  lineMap <- plot_rr_sf(polyMap, lineData)
+  plot_rr_sf(lineMap, pointData, attribute = sarsearch_rr$attribute)
+ 
 }
 ```
 

---FILE: reports/sections/sarsearch/sarsearch_preprocessing.R---
@@ -39,10 +39,11 @@ raise <- httr::content(res, as=""text"")
 #parse JSON
 poly_df <- jsonlite::fromJSON(raise)
 
-poly_df$geometry <- lapply(poly_df$geometry, function(geom) {
+poly_df$geometry <- mapply(function(geomType, geom) {
   if (!is.null(geom)) {
+    # swap the geom columns so lat-long is long-lat for sf
     geom <- matrix(geom[, 2:1], ncol=2)
-    if (nrow(geom) < 4) {
+    if (geomType == ""line"") {
       outGeom <- sf::st_linestring(geom)  
     } else {
       geomClosed <- rbind(geom, geom[1, ])
@@ -53,13 +54,13 @@ poly_df$geometry <- lapply(poly_df$geometry, function(geom) {
     outGeom <- sf::st_polygon()
   }
   return(outGeom)
-})
+}, poly_df$record_type, poly_df$geometry)
 
 poly_sf <- sf::st_as_sf(poly_df)
 sarsearch_sf <- rbind(sarsearch_sf, poly_sf)
 
 sarsearch_sf <- sarsearch_sf[!sf::st_is_empty(sarsearch_sf),,]
-sarsearch_sf <- dplyr::select(sarsearch_sf, ""name"", ""source"", ""year"", ""notes"", ""species_name"", ""geometry"")
+sarsearch_sf <- dplyr::select(sarsearch_sf, ""name"", ""source"", ""year"", ""notes"", ""species_name"", ""record_type"", ""geometry"")
 sf::st_crs(sarsearch_sf) <- 4326
 
 # rr object structure:",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,fa0e1f344d30270a863c8007e4d52d99999eb18c,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-08-18T12:18:01Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-08-18T12:18:01Z,removing incorrect link,reports/sections/crithab/crithab_preprocessing.R,False,True,True,False,0,1,1,"---FILE: reports/sections/crithab/crithab_preprocessing.R---
@@ -40,7 +40,6 @@ leatherback_rr <- list(""title"" = "" Leatherback Sea Turtle draft critical habitat
                        ""data_sf"" = leatherback_sf,
                        ""attribute"" = ""NONE"",
                        ""metadata"" = list(""contact"" = email_format(""info@dfo-mpo.gc.ca""),
-                                         ""url"" = lang_list(""<https://www.narwc.org/sightings-database.html>""),
                                          ""accessedOnStr"" = list(""en"" =""February 25 2021"", ""fr"" = ""25 février 2021"") ,
                                          ""accessDate"" = as.Date(""2021-02-25""),
                                          ""securityLevel"" = noneList,",True,False,Implementation / Logic,3
dfo-mar-odis,shinySpatialApp,f94b449356ec7637041c4da1d5833008bca31c82,gomezcatalina,gomezcatalina@users.noreply.github.com,2022-07-22T14:54:00Z,GitHub,noreply@github.com,2022-07-22T14:54:00Z,"Mike's new code to extract MARFIS and ISDB 

Issue #98 in the RAP board provides more context",reports/sections/isdb-marfis/extraction.R,False,True,True,False,179,0,179,"---FILE: reports/sections/isdb-marfis/extraction.R---
@@ -0,0 +1,179 @@
+library(lubridate)
+library(dplyr)
+library(sf)
+
+theSubUnitShape <- ""c:/Users/mcmahonm/OneDrive - DFO-MPO/Support/RR/geometry/NAFO_polyBlocks.shp""
+theSubUnitField <- ""UnitArea""
+
+nafo_sf <- st_read(theSubUnitShape)
+nafo_sf$Shape_Leng<- nafo_sf$ORIG_FID <- nafo_sf$Shape_Le_1 <- nafo_sf$Shape_Area <- nafo_sf$OBJECTID <- NULL
+colnames(nafo_sf)[colnames(nafo_sf)==""UnitArea""] <- ""NAFO""
+nafo_sf$NAFO <- toupper(nafo_sf$NAFO)
+saveRDS(nafo_sf, file = ""c:/Users/mcmahonm/OneDrive - DFO-MPO/Support/RR/geometry/NAFO_sf.rds"")
+
+#only need some MARFIS data, so let's not crash our computer
+#only need some of the MARFIS data, so let's just get what we need. 
+makeMarfis<-function(agg.poly.shp = theSubUnitShape, agg.poly.field= theSubUnitField){
+  
+  load(""C:/DFO-MPO/wrangledData/MARFISSCI.PRO_SPC_INFO.RData"")
+  load(""C:/DFO-MPO/wrangledData/MARFISSCI.NAFO_UNIT_AREAS.RData"")
+  load(""C:/DFO-MPO/wrangledData/MARFISSCI.SPECIES.RData"")
+  marf <- PRO_SPC_INFO
+  marf <- merge(marf,SPECIES[,c(""SPECIES_CODE"", ""SPECIES_NAME"")], all.x=T) 
+  marf <- merge(marf, NAFO_UNIT_AREAS[,c(""AREA_ID"", ""NAFO_AREA"")], all.x = T, by.x=""NAFO_UNIT_AREA_ID"", by.y=""AREA_ID"")
+  #Exclude buyer code 9004(confirmed this corresponds only with BUYER_ID 1643 which is in PRO_SPC_INFO
+  marf <- marf[which(marf$BUYER_ID != 1643),]
+  marfFields <- c (""PRO_SPC_INFO_ID"", ""YEAR"", ""YEAR_LANDED"",""LATITUDE"", ""LONGITUDE"", ""NAFO_AREA"",
+                   ""SPECIES_CODE"", ""SPECIES_NAME"", ""RND_WEIGHT_KGS"")
+  rm(list=c(""PRO_SPC_INFO"", ""NAFO_UNIT_AREAS"", ""SPECIES""))
+
+  marf[marf$NAFO_AREA %in% c(""OUTU"",""XXXX""),""NAFO_AREA""] <- NA
+    
+  #report is spatial - no coordinates or NAFO areas, need to drop
+  marf <- marf[!is.na(marf$NAFO_AREA) | (!is.na(marf$LATITUDE) & !is.na(marf$LONGITUDE)),]
+  marfCoords <- unique(marf[!is.na(marf$LATITUDE) & !is.na(marf$LONGITUDE), c(""PRO_SPC_INFO_ID"", ""LATITUDE"", ""LONGITUDE"")])
+  marfCoords<-  Mar.utils::identify_area(df = marfCoords, lat.field = ""LATITUDE"", lon.field = ""LONGITUDE"", agg.poly.shp = agg.poly.shp, agg.poly.field = agg.poly.field)
+  marfCoords$UnitArea <- toupper(marfCoords$UnitArea)
+  marf <- merge(marf, marfCoords[,c(""PRO_SPC_INFO_ID"", ""UnitArea"")], all.x = T)
+  rm(marfCoords)
+  #drop the records that are outside of the range of the shp or are invalid
+  marf <- marf[!is.na(marf$UnitArea) & !(marf$UnitArea %in% c(""<OUTSIDE KNOWN AREAS>"",""<IMPOSSIBLE COORD>"")),]
+  #if no coordinate can be calculated, uese the supplied one instead
+  marf$NAFO <- marf$NAFO_AREA
+  marf[!is.na(marf$UnitArea),""NAFO""]<-marf[!is.na(marf$UnitArea),""UnitArea""]
+  marf$UnitArea  <- marf$NAFO_AREA <- marf$LATITUDE <- marf$LONGITUDE <-  marf$PRO_SPC_INFO_ID <- NULL
+  marf <- marf %>%
+    group_by(YEAR_LANDED, SPECIES_CODE ,SPECIES_NAME ,NAFO) %>%
+    summarise(RND_WEIGHT_KGS = sum(RND_WEIGHT_KGS), .groups = ""keep"")%>%
+    as.data.frame()
+  return(marf)
+}
+
+makeISDB <- function(agg.poly.shp = theSubUnitShape, agg.poly.field= theSubUnitField){
+  load(""C:/DFO-MPO/wrangledData/ISDB.ISCATCHES.RData"")
+  load(""C:/DFO-MPO/wrangledData/ISDB.ISFISHSETS.RData"")
+  load(""C:/DFO-MPO/wrangledData/ISDB.ISSPECIESCODES.RData"")
+  load(""C:/DFO-MPO/wrangledData/ISDB.ISSETPROFILE_WIDE.RData"")
+  load(""C:/DFO-MPO/wrangledData/ISDB.ISTRIPS.RData"")
+  
+  isdb <- ISFISHSETS[,c(""FISHSET_ID"", ""TRIP_ID"", ""NAFAREA_ID"", ""SETCD_ID"")]
+  isdb <- merge(isdb, ISCATCHES[,c(""FISHSET_ID"", ""EST_COMBINED_WT"", ""SPECCD_ID"")], all.x = T)
+  isdb <- merge(isdb, ISSETPROFILE_WIDE[,c(""YEAR"",""LATITUDE"",""LONGITUDE"", ""FISHSET_ID"")], all.x = T)
+  isdb <- merge(isdb, ISSPECIESCODES[, c(""SPECCD_ID"", ""COMMON"", ""SCIENTIFIC"")], all.x = T)
+  isdb <- merge(isdb, ISTRIPS[,c(""TRIP_ID"", ""TRIPCD_ID"")], all.x = T)
+  
+  rm(list=c(""ISFISHSETS"", ""ISCATCHES"", ""ISSETPROFILE_WIDE"", ""ISSPECIESCODES"", ""ISTRIPS""))
+  #retain only commercial trip types (i.e. exclude industry surveys)
+  isdb <- isdb[isdb$TRIPCD_ID <7010 | isdb$TRIPCD_ID == 7057| isdb$TRIPCD_ID == 7099,]
+  #Commercial sets: retaining:
+  #   1 - COMMERCIAL
+  #   7 - COMMERCIAL - C AND P
+  #  10 - COMMERCIAL INDEX
+  isdb <- isdb[isdb$SETCD_ID %in% c(1,7,10),]
+  isdb$TRIP_ID <- isdb$SETCD_ID <- NULL
+  isdb <- isdb[!is.na(isdb$SPECCD_ID),]
+  isdbCoords <- unique(isdb[!is.na(isdb$LATITUDE) & !is.na(isdb$LONGITUDE), c(""FISHSET_ID"", ""LATITUDE"", ""LONGITUDE"")])
+  isdbCoords<-  Mar.utils::identify_area(df = isdbCoords, lat.field = ""LATITUDE"", lon.field = ""LONGITUDE"", agg.poly.shp = theSubUnitShape, agg.poly.field = theSubUnitField)
+  isdbCoords$UnitArea <- toupper(isdbCoords$UnitArea)
+  isdb <- merge(isdb, isdbCoords[,c(""FISHSET_ID"", ""UnitArea"")], all.x = T)
+  rm(isdbCoords)
+  #drop the records that are outside of the range of the shp or are invalid
+  isdb <- isdb[!is.na(isdb$UnitArea) & !(isdb$UnitArea %in% c(""<OUTSIDE KNOWN AREAS>"",""<IMPOSSIBLE COORD>"")),]
+  
+  #if no coordinate can be calculated, uese the supplied one instead
+  isdb$NAFO <- isdb$NAFAREA_ID
+  isdb[!is.na(isdb$UnitArea),""NAFO""]<-isdb[!is.na(isdb$UnitArea),""UnitArea""]
+  isdb$UnitArea  <- isdb$NAFAREA_ID <- isdb$LATITUDE <- isdb$LONGITUDE <-  isdb$FISHSET_ID <- NULL
+  isdb <- isdb %>%
+    group_by(YEAR, SPECCD_ID,COMMON,SCIENTIFIC,NAFO) %>%
+    summarise(EST_COMBINED_WT = sum(EST_COMBINED_WT), .groups = ""keep"")%>%
+    as.data.frame()
+  return(isdb)
+}
+
+makeAnnualSfs<-function(data = NULL, yearField = NULL, savePath = getwd(), filename=NULL, nafoSf = nafo_sf){
+  #remove data with no year
+  data <- data[!is.na(data[,yearField]),]
+  #remove current year and first year since neither will not have all of the data
+  data <- data[data[,yearField] < lubridate::year(Sys.Date()),]
+  data <- data[data[,yearField] > min(data[,yearField]),]
+  allYrs <- sort(unique(data[,yearField]))
+  for (y in 1:length(allYrs)){
+    thisYr <- data[data[,yearField] == allYrs[y],]
+    thisYr_sf <- merge(nafoSf, thisYr, all=T)
+    saveRDS(thisYr_sf, file = file.path(savePath,paste0(filename,""_"",allYrs[y],""_sf.rds"")))
+    rm(thisYr_sf)
+  }
+}
+
+# Code below creates the files I shared, and requires data to already be on your computer 
+#
+if(F){
+  marf <- makeMarfis()
+  isdb <- makeISDB()
+  saveRDS(marf, file = ""c:/Users/mcmahonm/OneDrive - DFO-MPO/Support/RR/marfis/marfis_raw.rds"")
+  saveRDS(isdb, file = ""c:/Users/mcmahonm/OneDrive - DFO-MPO/Support/RR/isdb/isdb_raw.rds"")
+  makeAnnualSfs(data = isdb, yearField = ""YEAR"", savePath = ""c:/Users/McMahonM/OneDrive - DFO-MPO/Support/RR/isdb/"", filename = ""isdb"")
+  makeAnnualSfs(data = marf, yearField = ""YEAR_LANDED"", savePath = ""c:/Users/McMahonM/OneDrive - DFO-MPO/Support/RR/marfis/"", filename = ""marfis"")
+}
+#
+#
+
+
+# Code below makes example plots using the provided data
+#
+
+if (F){
+  
+marfis_2018_sf <- readRDS(""C:/Users/McMahonM/OneDrive - DFO-MPO/Support/RR/marfis/marfis_2018_sf.rds"")
+isdb_2018_sf <- readRDS(""C:/Users/McMahonM/OneDrive - DFO-MPO/Support/RR/isdb/isdb_2018_sf.rds"")
+m_halibut_2018 <- marfis_2018_sf %>% 
+  filter(SPECIES_CODE ==130)
+m_swordfish_2018 <- marfis_2018_sf %>% 
+  filter(SPECIES_CODE ==251)  
+i_seaurchins_2018 <- isdb_2018_sf %>% 
+  filter(SPECCD_ID ==6400)
+i_blueSharks_2018 <- isdb_2018_sf %>% 
+  filter(SPECCD_ID ==231)
+
+#get bbox of data
+ext <- st_bbox(marfis_2018_sf)
+
+library(ggplot2)
+library(viridis)
+
+#marfis plots
+ggplot() + 
+  ggtitle(""MARFIS 2018: Halibut"") +
+  geom_sf(data = m_halibut_2018, aes(fill = RND_WEIGHT_KGS))+
+  scale_fill_viridis_c() +
+  geom_sf(data = Mar.data::coast_lores_sf) +
+  coord_sf(xlim = c(ext[[""xmin""]], ext[[""xmax""]]), ylim = c(ext[[""ymin""]], ext[[""ymax""]]), expand = FALSE) 
+
+ggplot() + 
+  ggtitle(""MARFIS 2018: Swordfish"") +
+  geom_sf(data = m_swordfish_2018, aes(fill = RND_WEIGHT_KGS))+
+  scale_fill_viridis_c() +
+  geom_sf(data = Mar.data::coast_lores_sf) +
+  coord_sf(xlim = c(ext[[""xmin""]], ext[[""xmax""]]), ylim = c(ext[[""ymin""]], ext[[""ymax""]]), expand = FALSE) 
+#isdb plots
+ggplot() + 
+  ggtitle(""ISDB 2018: Sea Urchins"") +
+  geom_sf(data = i_seaurchins_2018, aes(fill = EST_COMBINED_WT))+
+  scale_fill_viridis_c() +
+  geom_sf(data = Mar.data::coast_lores_sf) +
+  coord_sf(xlim = c(ext[[""xmin""]], ext[[""xmax""]]), ylim = c(ext[[""ymin""]], ext[[""ymax""]]), expand = FALSE) 
+
+ggplot() + 
+  ggtitle(""ISDB 2018: Blue Sharks"") +
+  geom_sf(data = i_blueSharks_2018, aes(fill = EST_COMBINED_WT))+
+  scale_fill_viridis_c() +
+  geom_sf(data = Mar.data::coast_lores_sf) +
+  coord_sf(xlim = c(ext[[""xmin""]], ext[[""xmax""]]), ylim = c(ext[[""ymin""]], ext[[""ymax""]]), expand = FALSE) 
+
+
+}
+#
+
+
+",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,25c4510862d7f0cde1dc99ff3e5ffb25d93b2564,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-07-15T18:00:42Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-07-15T18:00:42Z,fix plot labels bug,reports/R/plotFunctions.R,False,True,True,False,3,0,3,"---FILE: reports/R/plotFunctions.R---
@@ -206,7 +206,10 @@ plot_points <- function(baseMap, data_sf, attribute=""NONE"", legendName="""",
                                             xlim = baseMap$coordinates$limits$x * c(0.998, 1.002),
                                             ylim = baseMap$coordinates$limits$y * c(1.002, 0.998)
     )
+  } else {
+    labelLayer <- NULL
   }
+  
     
   pointMap <- baseMap +
     dataLayer +",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,a97e2b8b06577b369c1d7ad4f15ca83544333091,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-07-07T17:55:38Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-07-07T17:55:38Z,"set quality tier, fix typos",app/templates/EN/generic_intro.Rmd;config.R;reports/sections/imAcoustic/imAcoustic_preprocessing.R;reports/sections/isdb-marfis/isdbMarfis_en.Rmd;reports/sections/isleMadame/presence_sections/bnWhale_preprocessing.R;reports/sections/isleMadame/presence_sections/fbWhale_preprocessing.R;reports/sections/isleMadame/presence_sections/greySeal_preprocessing.R;reports/sections/isleMadame/presence_sections/harbourPorpoise_preprocessing.R;reports/sections/isleMadame/presence_sections/harbourSeal_preprocessing.R;reports/sections/isleMadame/presence_sections/imSalmonRivers_preprocessing.R;reports/sections/isleMadame/presence_sections/imSalmon_preprocessing.R;reports/sections/isleMadame/presence_sections/lobster_preprocessing.R;reports/sections/isleMadame/presence_sections/narWhale_preprocessing.R;reports/sections/isleMadame/presence_sections/snowCrab_preprocessing.R;reports/sections/isleMadame/presence_sections/ssClam_preprocessing.R;reports/sections/isleMadame/presence_sections/tuna_preprocessing.R;reports/sections/obis/obis_en.Rmd;reports/sections/opprrpe/opprrpe_preprocessing.R,True,False,True,False,33,20,53,"---FILE: app/templates/EN/generic_intro.Rmd---
@@ -111,6 +111,12 @@ if (file.exists(introTableFilePath)){
   load(introTableFilePath)
   if (is.data.frame(finalSummaryIntroTable)){
     if (nrow(finalSummaryIntroTable) > 0){
+      
+      absentCode <- ""&nbsp;-&nbsp;""
+      presentCode <- ""&#x2714;""
+
+      finalSummaryIntroTable <-dplyr:: mutate_all(finalSummaryIntroTable, ~ kableExtra::cell_spec(., color = ifelse(. == presentCode, ""white"", """"), background = ifelse(. == presentCode, ""green"", """"), escape = FALSE))
+      
       knitr::kable(finalSummaryIntroTable, align=""l"",
         caption = ""Overview of which data sources queried have results within the study area"", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
     }

---FILE: config.R---
@@ -14,6 +14,12 @@ fileLoadPath <- file.path(""//ent.dfo-mpo.ca"",""ATLShares"", ""Science"", ""BIODataSvc
 
 rr_openDataList <- data.frame(""rrStr"" = c(""ebsa_rr"", ""crithab_rr"", ""sardist_rr"", 
                                           ""nbw_rr"", ""blueWhaleHab_rr"", ""finWhale_rr"", 
-                                          ""rv_rr"", ""pasBay_rr"", ""benthicEffort_rr""))
+                                          ""rv_rr"", ""pasBay_rr"", ""benthicEffort_rr"",
+                                          ""fbWhale_rr"", ""bnWhale_rr"", ""greySeal_rr"",
+                                          ""harbourPorpoise_rr"", ""harbourSeal_rr"", 
+                                          ""imsalmon_rr"", ""imSalmonRivers_rr"",
+                                          ""imLobster_rr"", ""narWhale_rr"", ""snowCrab_rr"",
+                                          ""ssClam_rr"", ""tuna_rr"", ""imAcoustic_rr"",
+                                          ""opprrpe_rr""))
 
 

---FILE: reports/sections/imAcoustic/imAcoustic_preprocessing.R---
@@ -25,6 +25,6 @@ imAcoustic_rr$data_sf <- sf::st_transform(imAcoustic_sf, crs = 4326) %>%
 
 imAcoustic_rr$attribute <- ""None""
 imAcoustic_rr$metadata$qualityTier <- highQuality
-imAcoustic_rr$datasetName <- ""A Novel Video and Acoustic Survey of the Seaweeds of Isle Madame""
+imAcoustic_rr$datasetName <- ""Novel Video and Acoustic Survey of the Seaweeds of Isle Madame""
 save(imAcoustic_rr, file = file.path(localFileSavePath, ""Open/imAcoustic_rr.RData""))
 

---FILE: reports/sections/isdb-marfis/isdbMarfis_en.Rmd---
@@ -56,11 +56,11 @@ outputListM <- master_intersect(marfis_rr$data_sf, mapDataList)
 
 # summary intro table
 introResultI <- !is.null(outputListI$studyData)
-summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[ISDB](#isdb-section)"", result=introResultI)
+summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[ISDB](#ISDB-section)"", result=introResultI)
 
 # summary intro table
 introResultM <- !is.null(outputListM$studyData)
-summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[MARFIS](#marfis-section)"", result=introResultM)
+summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name=""[MARFIS](#MARFIS-section)"", result=introResultM)
 
 
 

---FILE: reports/sections/isleMadame/presence_sections/bnWhale_preprocessing.R---
@@ -29,7 +29,7 @@ bnWhale_rr$data_sf <- sf::st_transform(bnWhale_sf, crs = 4326) %>%
 
 
 bnWhale_rr$attribute <- ""None""
-bnWhale_rr$metadata$qualityTier <- highQuality
+bnWhale_rr$metadata$qualityTier <- mediumQuality
 bnWhale_rr$datasetName <- ""Bottlenose Whale Presence""
 save(bnWhale_rr, file = file.path(localFileSavePath, ""Open/bnWhale_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/fbWhale_preprocessing.R---
@@ -29,7 +29,7 @@ fbWhale_rr$data_sf <- sf::st_transform(fbWhale_sf, crs = 4326) %>%
 
 
 fbWhale_rr$attribute <- ""None""
-fbWhale_rr$metadata$qualityTier <- highQuality
+fbWhale_rr$metadata$qualityTier <- mediumQuality
 fbWhale_rr$datasetName <- ""Finback Whale Presence""
 save(fbWhale_rr, file = file.path(localFileSavePath, ""Open/fbWhale_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/greySeal_preprocessing.R---
@@ -29,7 +29,7 @@ greySeal_rr$data_sf <- sf::st_transform(greySeal_sf, crs = 4326) %>%
 
 
 greySeal_rr$attribute <- ""None""
-greySeal_rr$metadata$qualityTier <- highQuality
+greySeal_rr$metadata$qualityTier <- mediumQuality
 greySeal_rr$datasetName <- ""Grey Seal Presence""
 save(greySeal_rr, file = file.path(localFileSavePath, ""Open/greySeal_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/harbourPorpoise_preprocessing.R---
@@ -29,7 +29,7 @@ harbourPorpoise_rr$data_sf <- sf::st_transform(harbourPorpoise_sf, crs = 4326) %
 
 
 harbourPorpoise_rr$attribute <- ""None""
-harbourPorpoise_rr$metadata$qualityTier <- highQuality
+harbourPorpoise_rr$metadata$qualityTier <- mediumQuality
 harbourPorpoise_rr$datasetName <- ""Harbour Porpoise Presence""
 save(harbourPorpoise_rr, file = file.path(localFileSavePath, ""Open/harbourPorpoise_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/harbourSeal_preprocessing.R---
@@ -29,7 +29,7 @@ harbourSeal_rr$data_sf <- sf::st_transform(harbourSeal_sf, crs = 4326) %>%
 
 
 harbourSeal_rr$attribute <- ""None""
-harbourSeal_rr$metadata$qualityTier <- highQuality
+harbourSeal_rr$metadata$qualityTier <- mediumQuality
 harbourSeal_rr$datasetName <- ""Harbour Seal Presence""
 save(harbourSeal_rr, file = file.path(localFileSavePath, ""Open/harbourSeal_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/imSalmonRivers_preprocessing.R---
@@ -26,7 +26,7 @@ imSalmonRivers_rr$data_sf <- sf::st_transform(imSalmonRivers_sf, crs = 4326) %>%
 
 
 imSalmonRivers_rr$attribute <- ""DU""
-imSalmonRivers_rr$metadata$qualityTier <- highQuality
+imSalmonRivers_rr$metadata$qualityTier <- mediumQuality
 imSalmonRivers_rr$datasetName <- ""Salmon Rivers Presence""
 save(imSalmonRivers_rr, file = file.path(localFileSavePath, ""Open/imSalmonRivers_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/imSalmon_preprocessing.R---
@@ -29,7 +29,7 @@ imSalmon_rr$data_sf <- sf::st_transform(imSalmon_sf, crs = 4326) %>%
 
 
 imSalmon_rr$attribute <- ""None""
-imSalmon_rr$metadata$qualityTier <- highQuality
+imSalmon_rr$metadata$qualityTier <- mediumQuality
 imSalmon_rr$datasetName <- ""Atlantic Salmon Presence""
 save(imSalmon_rr, file = file.path(localFileSavePath, ""Open/imSalmon_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/lobster_preprocessing.R---
@@ -9,7 +9,7 @@ source(here::here(""config.R""))
 
 
 # load in rr objects, CommonData contains data such as land borders, etc.
-loadResult <- load_rdata(c(""CommonData"", ""imLobsterrr""), regionStr)
+loadResult <- load_rdata(c(""CommonData"", ""imLobster_rr""), regionStr)
 
 # ---------------------Bluefin Tuna Presence-----------------------------------
 pkgId <- ""47bf4555-ce3c-492f-a367-a6eab1862970""
@@ -29,7 +29,7 @@ imLobster_rr$data_sf <- sf::st_transform(imLobster_sf, crs = 4326) %>%
 
 
 imLobster_rr$attribute <- ""None""
-imLobster_rr$metadata$qualityTier <- highQuality
+imLobster_rr$metadata$qualityTier <- mediumQuality
 imLobster_rr$datasetName <- ""American Lobster Presence""
 save(imLobster_rr, file = file.path(localFileSavePath, ""Open/imLobster_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/narWhale_preprocessing.R---
@@ -29,7 +29,7 @@ narWhale_rr$data_sf <- sf::st_transform(narWhale_sf, crs = 4326) %>%
 
 
 narWhale_rr$attribute <- ""None""
-narWhale_rr$metadata$qualityTier <- highQuality
+narWhale_rr$metadata$qualityTier <- mediumQuality
 narWhale_rr$datasetName <- ""North Atlantic Right Whale Presence""
 save(narWhale_rr, file = file.path(localFileSavePath, ""Open/narWhale_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/snowCrab_preprocessing.R---
@@ -30,7 +30,7 @@ snowCrab_rr$data_sf <- sf::st_transform(snowCrab_sf, crs = 4326) %>%
 
 
 snowCrab_rr$attribute <- ""Overall Presence""
-snowCrab_rr$metadata$qualityTier <- highQuality
+snowCrab_rr$metadata$qualityTier <- mediumQuality
 snowCrab_rr$datasetName <- ""Snow Crab Presence""
 save(snowCrab_rr, file = file.path(localFileSavePath, ""Open/snowCrab_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/ssClam_preprocessing.R---
@@ -28,7 +28,7 @@ ssClam_rr$data_sf <- sf::st_transform(ssClam_sf, crs = 4326) %>%
   sf::st_crop(region_sf)
 
 ssClam_rr$attribute <- ""OVERALL_PRESENCE""
-ssClam_rr$metadata$qualityTier <- highQuality
+ssClam_rr$metadata$qualityTier <- mediumQuality
 ssClam_rr$datasetName <- ""Soft Shelled Clams Presence""
 save(ssClam_rr, file = file.path(localFileSavePath, ""Open/ssClam_rr.RData""))
 

---FILE: reports/sections/isleMadame/presence_sections/tuna_preprocessing.R---
@@ -29,7 +29,7 @@ tuna_rr$data_sf <- sf::st_transform(tuna_sf, crs = 4326) %>%
 
 
 tuna_rr$attribute <- ""None""
-tuna_rr$metadata$qualityTier <- highQuality
+tuna_rr$metadata$qualityTier <- mediumQuality
 tuna_rr$datasetName <- ""Bluefin Tuna Presence""
 save(tuna_rr, file = file.path(localFileSavePath, ""Open/tuna_rr.RData""))
 

---FILE: reports/sections/obis/obis_en.Rmd---
@@ -110,9 +110,9 @@ summarySarTable <- add_col_to_sar_summary(summarySarTable, ""[GBIF](#gbif-section
 ```
 
 ```{r gbif-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-reportGbif <-  if (is.null(gbifClipped$studyData)) {
-  ""*	There are no relevant records in the Global Biodiversity Information Facility (GBIF) and iNaturalist for this search area.""
-} else if (is.null(inaturalistClipped$studyData)){
+reportGbif <-  if (is.null(gbifClipped$studyData) & is.null(inaturalistClipped$studyData)) {
+  ""*	There are no relevant records in the Global Biodiversity Information Facility (GBIF) for this search area.""
+} else if (!is.null(inaturalistClipped$studyData)){
   ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF) for this search area.""
 } else {
   ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF), including iNaturalist entries for this search area.""  

---FILE: reports/sections/opprrpe/opprrpe_preprocessing.R---
@@ -28,6 +28,7 @@ opprrpe_rr$data_sf <- sf::st_transform(opprrpe_sf, crs = 4326) %>%
 
 
 opprrpe_rr$attribute <- ""Response Area""
+opprrpe_rr$metadata$qualityTier <- highQuality
 
 save(opprrpe_rr, file = file.path(localFileSavePath, ""Open/opprrpe_rr.RData""))
 ",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,b59322084673801d9ce41f4fd2e9089201833609,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-07-07T16:35:40Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-07-07T16:35:40Z,fix typos,app/templates/EN/context/habitat.Rmd;reports/R/tableFunctions.R,True,False,True,False,3,3,6,"---FILE: app/templates/EN/context/habitat.Rmd---
@@ -6,5 +6,5 @@ This module describes outputs of habitat derived from a variety of sources. Area
 ```{r child = here::here(""reports/sections/rockweed/rockweed_en.Rmd"")}
 ```
 
-```{r child = here::here(""reports/sections/imAcostic/imAcoustic_en.Rmd"")}
+```{r child = here::here(""reports/sections/imAcoustic/imAcoustic_en.Rmd"")}
 ```

---FILE: reports/R/tableFunctions.R---
@@ -390,12 +390,12 @@ EBSA_report <- function(EBSA_sf, lang=""EN"") {
                                                            Name, Bioregion)))
     EBSATable <- unique(EBSATable)
     row.names(EBSATable) <- NULL
-    names(EBSATable) <- c(""Report"", ""Report URL"", ""Location"", ""Bioreigon"")
+    names(EBSATable) <- c(""Report"", ""Report URL"", ""Location"", ""Bioregion"")
   } else if (lang==""FR"" & !is.null(EBSA_sf)) {
     EBSATable <- sf::st_drop_geometry(dplyr::select(EBSA_sf, c(Rapport, RapportURL,
                                                            Nom, Bioregion)))
     EBSATable <- unique(EBSATable)
-    names(EBSATable) <- c(""Report"", ""Report URL"", ""Location"", ""Bioreigon"")
+    names(EBSATable) <- c(""Report"", ""Report URL"", ""Location"", ""Bioregion"")
     row.names(EBSATable) <- NULL
 
   }",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,31b8027dc0e2edc46b436124cf3affd266819b1f,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-19T10:50:17Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-19T10:50:17Z,fix sardist library import and whelk contacts,DESCRIPTION;reports/sections/whelk/whelk_en.rmd;reports/sections/whelk/whelk_preprocessing.R,True,False,True,False,4,2,6,"---FILE: DESCRIPTION---
@@ -32,5 +32,6 @@ Imports:
     whisker,
     bookdown,
     pagedown,
-    lwgeom
+    lwgeom,
+    gridExtra
 RoxygenNote: 7.1.1

---FILE: reports/sections/whelk/whelk_en.rmd---
@@ -15,7 +15,7 @@ if (FALSE) {
   # environment, when knitting, these will be loaded through the child rmd.
   lapply(list.files(here::here(""reports/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson""))
-  intro_setup(studyArea, env = environment(), regionStr = regionStr)
+  intro_setup(studyArea, env = environment())
 }
 ```
 

---FILE: reports/sections/whelk/whelk_preprocessing.R---
@@ -18,6 +18,7 @@ resId <- ""5355ea5b-ea37-4a4b-8f61-9d6b716b7d17""
 
 # get open data metadata
 whelk_rr <- get_opendata_rr(pkgId, NULL)
+whelk_rr$metadata$contact <- whelk_rr$metadata$contact$fr
 
 # download csv's from open data
 outData <- download_extract_res_files(resId, c(""taxon_occurrence"", ""event_information""))",True,True,Dependency / Package,7
dfo-mar-odis,shinySpatialApp,749b3931e24b1c9db42fe2e7cd791a4e3a3edcec,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T15:55:49Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T15:55:49Z,fix the figure caption again because it was bad,reports/sections/sturg/sturg_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/sturg/sturg_en.Rmd---
@@ -52,7 +52,7 @@ sturgCheck <- if (is.null(sturgOutputList$studyData)) {
 writeLines(noquote(sturgCheck))
 ```
 
-```{r sturg-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""EN""), 'Survey sites illustrating Atlantic Sturgeon foraging areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy. The red outline represents the search area.')}
+```{r sturg-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""EN""), 'Survey sites illustrating Atlantic Sturgeon foraging areas sampled during 2020 in the Upper Bay of Fundy within the search area (red outline). Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy.')}
 if (!is.null(sturgOutputList$studyData)) {
   plot_rr_sf(areaMap, sturgOutputList$mapData, sturg_rr$attribute, outlines=FALSE,
              labelData=sturgOutputList$mapData, labelAttribute = ""siteId"")",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,0662144f0b43ba7301fa1959123895274dc4fc27,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T15:55:18Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T15:55:18Z,fix figure caption,reports/sections/sturg/sturg_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/sturg/sturg_en.Rmd---
@@ -52,7 +52,7 @@ sturgCheck <- if (is.null(sturgOutputList$studyData)) {
 writeLines(noquote(sturgCheck))
 ```
 
-```{r sturg-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""EN""), 'Survey sites illustrating Atlantic Sturgeon foraging areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy.')}
+```{r sturg-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""EN""), 'Survey sites illustrating Atlantic Sturgeon foraging areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy. The red outline represents the search area.')}
 if (!is.null(sturgOutputList$studyData)) {
   plot_rr_sf(areaMap, sturgOutputList$mapData, sturg_rr$attribute, outlines=FALSE,
              labelData=sturgOutputList$mapData, labelAttribute = ""siteId"")",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,95d7db40522e07404b32be60a829f6e6caed08e0,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T15:53:24Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T15:53:24Z,fix figure caption,reports/sections/sdm/sdm_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/sdm/sdm_en.Rmd---
@@ -61,7 +61,7 @@ summaryHabTable <- add_to_hab_summary(summaryHabTable, ""SDM"", ""[SDM](#sdm-sectio
  knitr::kable(tableSDM, align=""cccc"", caption=paste(write_caption_blurb(finWhale_rr, ""EN""), ""Search results identifying if the search area overlaps (i.e., TRUE) or does not overlap (i.e., FALSE) with the Priority Area to Enhance Monitoring of several species of cetaceans (Fin Whale, Harbour Porpoise, Humpback Whale and Sei Whale).""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 ```
 
-```{r sdm-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(finWhale_rr, ""EN""), 'Maps of consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate) for Fin Whales, Harbour Porpoises, Humpback Whales and Sei Whales. Yellow polygons (habitats with high suitability) represent areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in @Gomez2020SDM, these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure.')}
+```{r sdm-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(finWhale_rr, ""EN""), 'Maps of consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate) for Fin Whales, Harbour Porpoises, Humpback Whales and Sei Whales. The red outline represents the search area. Yellow polygons (habitats with high suitability) represent areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in @Gomez2020SDM, these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure. Data were obtained from @OpenData_cetacean_imp.')}
 plot_cetaceans_4grid(finWhale_rr$data_sf, harbourPorpoise_rr$data_sf, humpbackWhale_rr$data_sf, seiWhale_rr$data_sf, studyArea, land10m_sf, 50, bounds_sf)
 
 ```",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,709cc6d54bf5d9b5561fdd3cad95b12955f37963,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T12:53:04Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-18T12:53:04Z,Add whelk reference. Fix figure caption. Add a comma,reports/sections/whelk/whelk_en.rmd,True,False,True,False,3,3,6,"---FILE: reports/sections/whelk/whelk_en.rmd---
@@ -11,7 +11,7 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 
 ```{r eval=FALSE}
 if (FALSE) { 
-  # load in generic data, e.g.functions, study area, and base maps into the 
+  # load in generic data, e.g., functions, study area, and base maps into the 
   # environment, when knitting, these will be loaded through the child rmd.
   lapply(list.files(here::here(""reports/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson""))
@@ -38,7 +38,7 @@ writeLines(noquote(whelk_rr$text$en))
 ```
 
 
-#### ***Area-specific Whelk Surveyresults***
+#### ***Area-Specific Whelk Survey Results***
 ```{r whelk-results, include=FALSE, cache=FALSE}
 # clip the data to the Study and Map areas:
 whelkOutputList <- master_intersect(whelk_rr$data_sf, mapDataList)
@@ -62,7 +62,7 @@ whelkReport <- if (is.null(whelkOutputList$studyData)) {
 writeLines(noquote(whelkReport))
 ```
 
-```{r whelk-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(whelk_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query information from whelk records.')}
+```{r whelk-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(whelk_rr, ""EN""), 'Map of whelk records within the search area (red outline) from @OpenData_shelk.')}
 if (!is.null(whelkOutputList$studyData)) {
   # common plotting function:
   plot_rr_sf(areaMap, whelkOutputList$mapData, attribute = ",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,95cb5a2e64dba97eed9ba7bddc8f62bf229219ea,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T19:55:48Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T19:55:48Z,"Fix the figure/table captions.
Still a bit unclear what Megawatts actually refers to in the legend. Is it an annual average?",reports/sections/power/power_en.rmd,True,False,True,False,2,2,4,"---FILE: reports/sections/power/power_en.rmd---
@@ -76,7 +76,7 @@ powerReport <- if (is.null(powerOutputList$studyData)) {
 writeLines(noquote(powerReport))
 ```
 
-```{r power-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(power_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query disposal site records.')}
+```{r power-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(power_rr, ""EN""), 'Map of clean power generation sites observed within the search area (red outline). Sites displayed outside of the search area are visualized for context, but not included in the results listed in the Table below. The absence of a power generation site should be interpreted as an absence of reporting, not necessarily as an absence of power generation sites in the area.')}
 if (!is.null(powerOutputList$studyData)) {
     plot(plot_rr_sf(areaMap, powerOutputList$mapData, 
                     attribute=power_rr$attribute, size=6,
@@ -87,6 +87,6 @@ if (!is.null(powerOutputList$studyData)) {
 
 ```{r power-all-table}
 if (!is.null(powerOutputList$studyData)) {
-knitr::kable(powerTable, align=""l"", caption=paste(""\\label{tab:power_table}"", write_caption_blurb(power_rr, ""EN""), ""Clean power generation sites contained within the search area, The absence of a power generation site in this table should be interpreted as an absence of reporting, not necessarily as an absence of power generation sites in the area. </b>""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(powerTable, align=""l"", caption=paste(""\\label{tab:power_table}"", write_caption_blurb(power_rr, ""EN""), ""Clean power generation sites contained within the search area. The absence of a power generation site in this table should be interpreted as an absence of reporting, not necessarily as an absence of power generation sites in the area. </b>""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,dd8913eb3dab814baeca2b33fb396493c877b5e7,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T19:46:14Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T19:46:14Z,"punctuation errors
capitalize things
rephrase figure caption just a little bit",reports/sections/ocearch/ocearch_en.Rmd,True,False,True,False,3,3,6,"---FILE: reports/sections/ocearch/ocearch_en.Rmd---
@@ -27,9 +27,9 @@ load_rdata(c(""ocearch_rr""), ""MAR"", env = environment())
 write_meta(ocearch_rr, ""EN"")
 ```
 
-OCEARCH is a data-centric organization built to help scientists collect previously unattainable data in the ocean while open sourcing our research and explorations. Open sourcing and inclusion at every level, and in real-time, allows the world to participate in their projects while being aware of the developing science. OCEARCH shares the data, including samples collected and tracking data, with collaborating institutions and students who request them for their studies. The tracking data is also open-sourced to the public via the OCEARCH Tracker. The OCEARCH Tracker is a free app that lets users observe the navigational pattern of animals that have been tagged with satellite tracking technology. White Shark (_Carcharodon carcharias_) locations from satellite trackers are summarized in this section from 1 Jan 2013 to 31 Oct 2020. A speed filter was run with 3 m/s as the maximum speed and 2.5 km as the potential error of locations. This filter removed approximately 100 locations out of 2,000. Resulting points ere then visualized in ArcGIS to identify potential errors and remove locations that seemed implausible. Each shark location was individually plotted to do a second visual examination and to remove or flag errors/outliers. There is additional QA/QC that could still be performed to this dataset to capture additional issues (e.g. there may be single shark locations in Canadian waters during a period of time that the speed filter would not remove or that were not captured in the visual inspection). The absence of White Sharks in this section map should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.
+OCEARCH is a data-centric organization built to help scientists collect previously unattainable data in the ocean while open sourcing our research and explorations. Open sourcing and inclusion at every level, and in real-time, allows the world to participate in their projects while being aware of the developing science. OCEARCH shares the data, including samples collected and tracking data, with collaborating institutions and students who request them for their studies. The tracking data is also open-sourced to the public via the OCEARCH Tracker. The OCEARCH Tracker is a free app that lets users observe the navigational pattern of animals that have been tagged with satellite tracking technology. White Shark (_Carcharodon carcharias_) locations from satellite trackers are summarized in this section from 1 Jan 2013 to 31 Oct 2020. A speed filter was run with 3 m/s as the maximum speed and 2.5 km as the potential error of locations. This filter removed approximately 100 locations out of 2,000. Resulting points ere then visualized in ArcGIS to identify potential errors and remove locations that seemed implausible. Each shark location was individually plotted to do a second visual examination and to remove or flag errors/outliers. There is additional QA/QC that could still be performed to this dataset to capture additional issues (e.g., there may be single shark locations in Canadian waters during a period of time that the speed filter would not remove or that were not captured in the visual inspection). The absence of White Sharks in this section map should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.
 
-##### *Area-specific OCEARCH Shark Tracker search results*
+##### *Area-Specific OCEARCH Shark Tracker Search Results*
 ```{r ocearch-results, include=FALSE, cache=FALSE}
 
 ocearchOutputList <- master_intersect(ocearch_rr$data_sf, mapDataList)
@@ -56,7 +56,7 @@ Report_ocearch <- if (is.null(ocearchOutputList$studyData)) {
 Report_obis<-noquote(Report_ocearch)
 writeLines(Report_ocearch)
 ```
-```{r ocearch-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ocearch_rr, ""EN""), 'OCEARCH track observations of White Sharks observed within the search area (red outline). Dataset set has not yet been completely error-checked. The absence of White Shark in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.')}
+```{r ocearch-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ocearch_rr, ""EN""), 'OCEARCH track observations of White Sharks within the search area (red outline). Dataset set has not yet been completely error-checked. The absence of White Shark in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.')}
 if (!is.null(ocearchOutputList$studyData)) {
   plot_rr_sf(areaMap, ocearchOutputList$mapPoints)
 }",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,e322c61e463d6de189644045ff982dfa7264bd3c,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T19:40:19Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T19:40:19Z,"fixed the inaturalist table caption.
made obis/gbif data current",reports/sections/obis/obis_en.Rmd,True,False,True,False,6,6,12,"---FILE: reports/sections/obis/obis_en.Rmd---
@@ -27,7 +27,7 @@ load_rdata(c(""obis_rr""), regionStr, env = environment())
 write_meta(obis_rr, ""EN"")
 ```
 
-OBIS is a global, open-access data and information clearing-house on marine biodiversity for science, conservation, and sustainable development [@OBIS]. Their vision is to build and maintain a global alliance that collaborates with scientific communities to facilitate free and open-access to, and application of, biodiversity and biogeographic data and information on marine life. OBIS accepts data from any organization, consortium, project or individual who wishes to contribute data [@OBIS]. As of April 2022, OBIS has over 100 million species occurrence records and over 4,400 datasets globally.
+OBIS is a global, open-access data and information clearing-house on marine biodiversity for science, conservation, and sustainable development [@OBIS]. Their vision is to build and maintain a global alliance that collaborates with scientific communities to facilitate free and open-access to, and application of, biodiversity and biogeographic data and information on marine life. OBIS accepts data from any organization, consortium, project or individual who wishes to contribute data [@OBIS]. As of May 2022, OBIS has over 100 million species occurrence records and over 4,400 datasets globally.
 
 
 ### **Global Biodiversity Information Facility (GBIF) and iNaturalist** {#gbif-section}
@@ -40,15 +40,15 @@ load_rdata(c(""gbif_rr""), regionStr, env = environment())
 write_meta(gbif_rr, ""EN"")
 ```
 
-GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth [@GBIF]. Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of April 2022, GBIF has over 2.1 billion species occurrence records and over 68,000 datasets globally. 
+GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth [@GBIF]. Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of May 2022, GBIF has over 2.1 billion species occurrence records and over 69,000 datasets globally. 
 
 iNaturalist is an open-source platform where naturalists, citizen scientists, and biologists can map species observations [@iNaturalist]. As of April 2022, iNaturalist has over 95 million species observations and over 2.1 million registered users/contributors globally. Every week, iNaturalist data that are considered ""Research Grade"" (i.e., the record contains a date, is georeferenced, has photos or sounds, isn't a captive or cultivated organism, and two thirds of identifiers agree on the species identification) are added to GBIF (more information here:
 <https://www.gbif.org/dataset/50c9509d-22c7-4a22-a47d-8c48425ef4a7>). iNaturalist records are not added to OBIS.
 
 For more information about these sources, please see the supplementary material.
 
 
-##### *Area-specific OBIS search results*
+##### *Area-Specific OBIS Search Results*
 
 ```{r obis-results, include=FALSE, cache=FALSE}
 outputList <- master_intersect(obis_rr$data_sf, mapDataList, Year = minYear)
@@ -79,7 +79,7 @@ if (!is.null(outputList$studyData)) {
 }
 ```
 
-##### *Area-specific GBIF search results*
+##### *Area-Specific GBIF Search Results*
 
 ```{r gbif-results, cache=FALSE, include=FALSE}
 inaturalist_sf = subset(gbif_rr$data_sf, title == ""iNaturalist Research-grade Observations"")
@@ -118,7 +118,7 @@ if (!is.null(gbifClipped$studyData)) {
 }
 ```
 
-##### *Area-specific iNaturalist search results*
+##### *Area-Specific iNaturalist Search Results*
 
 ```{r inaturalist-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbif_rr, ""EN""), 'Research-grade iNaturalist observations within the search area (red outline) of species that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Observations are coloured to show coordinate uncertainties of the data, where observations with coordinate uncertainties >20 km represent locations that have been obscured due to geoprivacy concerns (e.g., hunting). NAs refer to observations with no provided coordinate uncertainty. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. ')}
 if (!is.null(inaturalistClipped$studyData)) {
@@ -128,7 +128,7 @@ if (!is.null(inaturalistClipped$studyData)) {
 
 ```{r inaturalist-table, echo=FALSE, results='asis'}
 if (!is.null(inaturalistClipped$studyData)) {
-  knitr::kable(inaturalistTable, align=""l"", caption=paste(write_caption_blurb(gbif_rr, ""EN""), ""Research-grade iNaturalist observations within the search area (red outline) of species that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Observations are coloured to show coordinate uncertainties of the data, where observations with coordinate uncertainties >20 km represent locations that have been obscured due to geoprivacy concerns (e.g., hunting). NAs refer to observations with no provided coordinate uncertainty. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+  knitr::kable(inaturalistTable, align=""l"", caption=paste(write_caption_blurb(gbif_rr, ""EN""), ""Research-grade iNaturalist observations of species observed within the search area that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. URLs contain links to a complete dataset description. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
 ",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,552f829096fc51948ea63991ae8cea7c40461e88,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T17:20:24Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T17:20:24Z,fix spelling of Status,reports/R/tableFunctions.R,False,True,True,False,3,3,6,"---FILE: reports/R/tableFunctions.R---
@@ -421,11 +421,11 @@ mpa_table <- function(mpa_sf, lang=""EN"") {
 
 
   if (lang==""EN"" & !is.null(mpa_sf)) {
-    names(mpaTable) <- c(""Site #"", ""Site Name"", ""Satus"", ""Size (km2)"")
+    names(mpaTable) <- c(""Site #"", ""Site Name"", ""Status"", ""Size (km2)"")
   } else if (lang==""FR"" & !is.null(mpa_sf)) {
-    names(mpaTable) <- c(""Site #"", ""Site Name"", ""Satus"", ""Size (km2)"")
+    names(mpaTable) <- c(""Site #"", ""Site Name"", ""Status"", ""Size (km2)"")
   } else {
-    names(mpaTable) <- c(""Site #"", ""Site Name"", ""Satus"", ""Size (km2)"")
+    names(mpaTable) <- c(""Site #"", ""Site Name"", ""Status"", ""Size (km2)"")
   }
   mpaTable <- distinct(mpaTable)
   return(mpaTable)",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,f56e0c3391ce520ae3b6c78af1613cadaee99676,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T16:47:45Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T16:47:45Z,Fix reference in figure caption,reports/sections/blueWhaleHab/bwhab_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/blueWhaleHab/bwhab_en.Rmd---
@@ -59,7 +59,7 @@ polyText <- noquote(polyText)
 writeLines(polyText)
 ```
 
-```{r bw-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""EN""), 'Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging and migration. These areas identified in the report by Lesage et al. (2018) are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population.')}
+```{r bw-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""EN""), 'Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging and migration. These areas identified in the report by @Lesage2018 are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population.')}
 if (!is.null(blueWhaleHab_rr$data_sf)){
   bwPlotList <- plot_rr_sf(regionMap, blueWhaleHab_rr$data_sf, blueWhaleHab_rr$attribute, getColorMap = TRUE)
   bwPlotList$polyMap",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,0321f4a4e8502676d7c628e386edd06c7d9e7e5f,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T15:56:53Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T15:56:53Z,fix some references,reports/sections/threats/ThreatMitigation-supplementary.Rmd,True,False,True,False,4,4,8,"---FILE: reports/sections/threats/ThreatMitigation-supplementary.Rmd---
@@ -12,11 +12,11 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 
 **Threats** are defined as “any human activity or process that has caused, is causing, or may cause harm, death, or behavioral changes to a wildlife species at risk, or the destruction, degradation, and/or impairment of its habitat, to the extent that population-level effects occur. A human activity may exacerbate a natural process” [@DFO2014_Threat]. 
 
-Threats therefore encompass both natural and anthropogenic activities, and are typically required to be discussed in relation to both the species and its habitat. Threats can be both indirect (e.g., altered fire regime, reduction in prey populations, introduced species) or direct (e.g., entanglement in fishing gear) [@DFO2014_Threat]. Naturally occurring processes (e.g., aging, disease, or predation) are only considered to be threats if they have been altered by human activities, or pose a threat to a critically small or isolated population [@DFO2014_Threat]. Identifying threats and determining how they may affect each species are crucial to prioritize recovery measures and inform management decisions [@DFO2014_Threat].
+Threats therefore encompass both natural and anthropogenic activities, and are typically required to be discussed in relation to both the species and its habitat. Threats can be both indirect (e.g., altered fire regime, reduction in prey populations, introduced species) or direct [e.g., entanglement in fishing gear, @DFO2014_Threat]. Naturally occurring processes (e.g., aging, disease, or predation) are only considered to be threats if they have been altered by human activities, or pose a threat to a critically small or isolated population [@DFO2014_Threat]. Identifying threats and determining how they may affect each species are crucial to prioritize recovery measures and inform management decisions [@DFO2014_Threat].
 
 Threats are mentioned in many of the documents within the SARA recovery planning process (Figure \@ref(fig:sara-chart)). However, due to issues such as changes in the requirements of these documents over time, and limited species information, the level of detail for threats may be varied.
 
-**Mitigation** refers to the measures used to avoid, minimize, eliminate, reduce, control or offset adverse effects of each threat (adapted from the Impact Assessment @IAA). 
+**Mitigation** refers to the measures used to avoid, minimize, eliminate, reduce, control or offset adverse effects of each threat [adapted from the Impact Assessment Act -@IAA]. 
 
 Similar to threats, mitigation measures are not consistently included or characterized throughout each document created as part of the SARA recovery planning process, and may have different levels of detail for each species. Generally, the most detailed information of mitigation measures for each threat are found within a species’ Action Plan (for species designated extirpated, endangered or threatened), or Management Plan (for species of special concern). Associated information within each document may include descriptions such as timelines for completion, and suggested jurisdictions/organizations to undertake each mitigation measure (e.g., government bodies, universities, industry). Mitigation measures for each threat may not be explicitly stated as such, but may instead be referred to as other terms such as “conservation measures” or “recovery measures” when addressing the proposed action for each threat.
 
@@ -29,7 +29,7 @@ SARA is carried out through the SARA recovery planning process, a multi-step app
 Although the creation of certain documents is a requirement under SARA, delays in the process are known to occur [@mcdevitt2015_missing]. In addition, many species are still under review for the addition to SARA (the full list is included here: <https://www.canada.ca/en/environment-climate-change/services/species-risk-act-accord-funding/listing-process/wildlife-species-amendment-list-schedule-1.html>). Species assessed by COSEWIC but still under consideration for Schedule 1 will therefore likely have a COSEWIC status report and Recovery Potential Assessment, but will not have a Recovery Strategy, Action Plan, or Management Plan. As well, deviations in the process may occur for some species, factors such as the availability of resources at the time. Therefore, not all of the documents listed in Figure \@ref(fig:sara-chart) may be available for each species, despite its designation. Lastly, documents which do not address threats or threat mitigation are not included in this section of the Report (e.g., Response Statements created by the DFO minister). However, these are available on the Species at Risk Registry if required (URLs are provided in Tables \@ref(tab:cosewic-table) and \@ref(tab:sara-table)). 
 
 
-```{r sara-chart, out.width = ""100%"", fig.cap = ""Simplified overview of the recovery planning process under the Canadian Species at Risk Act (adapted from Newediuk et al. (2021) and McDevitte-Irwin et al. (2015)). The documents reviewed for threat information in this review are represented as orange boxes. In addition, blue boxes represent government bodies, and green boxes represent actions taken. More detailed explanations of each box are included in the main text. Letters in white circles refer to SARA designations including EX: extirpated, T: threatened, E: endangered, and SC: special concern. The process reads from left to right, starting with the creation of the COSEWIC Status Report. Where applicable, mandated time frames are shown above the arrows, although the process may experience time delays at various steps [@mcdevitt2015_missing]. Recovery Potential Assessments (RPAs) are typically not created for species with a COSEWIC designation of special concern. Threat Assessments (not shown) are typically created as part the RPA process, and may be created as a separate document. Schedule 1 is the official federal list of wildlife species at risk."", echo=FALSE}
+```{r sara-chart, out.width = ""100%"", fig.cap = ""Simplified overview of the recovery planning process under the Canadian Species at Risk Act [adapted from Newediuk et al. -@newediuk2021_sociopolitical; McDevitte-Irwin et al. -@mcdevitt2015_missing]. The documents reviewed for threat information in this review are represented as orange boxes. In addition, blue boxes represent government bodies, and green boxes represent actions taken. More detailed explanations of each box are included in the main text. Letters in white circles refer to SARA designations including EX: extirpated, T: threatened, E: endangered, and SC: special concern. The process reads from left to right, starting with the creation of the COSEWIC Status Report. Where applicable, mandated time frames are shown above the arrows, although the process may experience time delays at various steps [@mcdevitt2015_missing]. Recovery Potential Assessments (RPAs) are typically not created for species with a COSEWIC designation of special concern. Threat Assessments (not shown) are typically created as part the RPA process, and may be created as a separate document. Schedule 1 is the official federal list of wildlife species at risk."", echo=FALSE}
 knitr::include_graphics(here::here(""reports/sections/Threats/SARAFlowchart.jpg""))
 ```
 
@@ -59,7 +59,7 @@ RPAs are typically provided to the DFO Minister after COSEWIC provides a species
 
 ###### *Change in RPA Procedure Over Time*
 
-RPAs were first developed in 2004 and new guidelines were developed in 2007 [@DFO2007_RPA]. Clarification to the process including how to document threat information was later provided [@DFO2010_Guidelines]. This lead to the creation of Threat Assessment guidelines [@DFO2014_Threat]. Due to these changes in procedure, the level of detail for RPAs may be different for each species, depending on when the information was compiled and published. Occasionally, RPAs are not created for certain species despite their COSEWIC designation (e.g., for leatherback sea turtles; @DFO2020_Turtles). Threat Assessments are also required to be conducted as part of the RPAs [@DFO2014_Threat]. However, Threat Assessments are sometimes created as standalone documents, and are therefore described in a separate section below.
+RPAs were first developed in 2004 and new guidelines were developed in 2007 [@DFO2007_RPA]. Clarification to the process including how to document threat information was later provided [@DFO2010_Guidelines]. This lead to the creation of Threat Assessment guidelines [@DFO2014_Threat]. Due to these changes in procedure, the level of detail for RPAs may be different for each species, depending on when the information was compiled and published. Occasionally, RPAs are not created for certain species despite their COSEWIC designation [e.g., for leatherback sea turtles, @DFO2020_Turtles]. Threat Assessments are also required to be conducted as part of the RPAs [@DFO2014_Threat]. However, Threat Assessments are sometimes created as standalone documents, and are therefore described in a separate section below.
 
 ###### *Types of RPAs*
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,4cd5166dbcbb954cde63a3e8fc563c1cb241fd3c,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T15:22:04Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T15:22:04Z,fix bullet point type. FYI dashes (-) have less ugly spacing and are better than ones with an asterisk (*). Thank you Catalina for figuring this out!,reports/sections/threats/ThreatMitigation-supplementary.Rmd,True,False,True,False,3,3,6,"---FILE: reports/sections/threats/ThreatMitigation-supplementary.Rmd---
@@ -89,9 +89,9 @@ The COSEWIC assessments for aquatic species are submitted to The Minister of Fis
 
 Within nine months of receiving the recommendations from the Minister, the Governor in Council must decide whether to:
 
-*	Accept the COSEWIC assessment and add the species to SARA;
-*	Not add to the list; or
-*	Refer back to COSEWIC for further information and consideration.
+-	Accept the COSEWIC assessment and add the species to SARA;
+-	Not add to the list; or
+-	Refer back to COSEWIC for further information and consideration.
 
 If a species is recommended to be added to SARA, various documents must be compiled based on its status. A Recovery Strategy must be created and posted on the SAR Public Registry within one year if the species is classified as endangered, or within two years if the species is listed as threatened or extirpated. After the Recovery Strategies are created, an Action Plan must be created for these species. There is no set timeline for completion for Action Plans, although typically an expected timeline for completion is provided in the Recovery Strategy. If a species is designated as special concern, Management Plans are created instead of Recovery Strategies and Action Plans. Management Plans must be created within three years of listing. 
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,2b31c18266d5549b2537ca429c274ccf318ae15c,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T15:13:56Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T15:13:56Z,I really don't think this matters but there are so many weird spacing issues that keeps showing up,reports/sections/obis/obis-supplementary_en.Rmd,True,False,True,False,1,2,3,"---FILE: reports/sections/obis/obis-supplementary_en.Rmd---
@@ -69,8 +69,7 @@ iNaturalist [-@iNaturalist] is an open-source platform where naturalists, citize
 iNaturalist records include a coordinate uncertainty, which is added by the user to provide an estimation of the geopositional accuracy of the observation. This may reflect information such as the accuracy of the user's phone's GPS, or an estimation of error if an observation was spotted from a distance
 (<https://greece.inaturalist.org/posts/28376-making-yourobservations-more-valuable-for-conservation-location-uncertainty>).
 
-For species that may be put at risk if their true location is known (e.g., due to hunting or poaching), the location can be obscured, either at the request of the submitter, or done automatically by iNaturalist. iNaturalist moderators may obscure a species location if the species has a certain conservation status (e.g., the International Union for Conservation of Nature, IUCN, equivalent of ""Near
-Threatened"" or worse), or based on local knowledge of the species in the region (<https://www.inaturalist.org/pages/curator+guide>). For species with obscured locations, a random location within a 0.2 x 0.2 degree cell (\~22 km x 22 km) is generated (<https://www.inaturalist.org/pages/help#geoprivacy>). In GBIF, it is not explicitly stated if the species position has been obscured, but can implied if the coordinate uncertainty is \~22 km.
+For species that may be put at risk if their true location is known (e.g., due to hunting or poaching), the location can be obscured, either at the request of the submitter, or done automatically by iNaturalist. iNaturalist moderators may obscure a species location if the species has a certain conservation status (e.g., the International Union for Conservation of Nature, IUCN, equivalent of ""Near Threatened"" or worse), or based on local knowledge of the species in the region (<https://www.inaturalist.org/pages/curator+guide>). For species with obscured locations, a random location within a 0.2 x 0.2 degree cell (\~22 km x 22 km) is generated (<https://www.inaturalist.org/pages/help#geoprivacy>). In GBIF, it is not explicitly stated if the species position has been obscured, but can implied if the coordinate uncertainty is \~22 km.
 
 Due to these issues with the coordinate uncertainty, occurrence records from iNaturalist data are listed separately within the GBIF data section, and the associated coordinate uncertainty is provided.
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,2962d5d20d1574d6e35d3f13d88809e8f25cd8f5,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T14:43:15Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T14:43:15Z,"fix phrasing/wording mistakes.
How did I make so many mistakes?!",reports/sections/obis/obis-supplementary_en.Rmd,True,False,True,False,3,9,12,"---FILE: reports/sections/obis/obis-supplementary_en.Rmd---
@@ -14,11 +14,9 @@ Both OBIS and GBIF are large online data portals, consisting of numerous dataset
 
 ### **Data Structure**
 
-Data submitted to GBIF and OBIS must be formatted according to the Darwin Core, a body of standards outlining how to format biological data (<https://obis.org/manual/darwincore/> and <https://www.gbif.org/darwin-core>). These standards define which attributes (i.e., column names) are included when structuring the datasets, and describe how other supplemental information such as study design, associated environmental conditions (e.g., sea surface temperature), or biological characteristics (e.g., abundance, biomass, etc.) can be formatted and included. Due to these requirements, OBIS and GBIF are generally best suited for point data, although other vector formats (e.g., lines, polygons) can be uploaded. Because this report focuses on species presence, detailed information outlining the study design, environmental conditions, or biological characteristics are not included, but may be available for each dataset if required.
+Data submitted to GBIF [-@GBIF] and OBIS [-@OBIS] are formatted according to the Darwin Core, a body of standards for compiling biodiversity data (see <https://obis.org/manual/darwincore/> and <https://www.gbif.org/darwin-core> for more information). These standards define which attributes (i.e., column names) are included when structuring the datasets, and how information such as study design, associated environmental conditions (e.g., sea surface temperature), or biological characteristics (e.g., abundance, biomass, etc.) can be formatted and included. Due to these requirements, OBIS and GBIF are generally primarily suited for point data, although other vector formats (e.g., lines, polygons) are also uploaded. Because this report focuses on species presence, detailed information outlining the study design, environmental conditions, or biological characteristics are not included, but may be available for each dataset if required.
 
-OBIS and GBIF submissions also follow the Ecological Metadata Language format, a metadata standard for ecological data (more information here: <https://obis.org/manual/eml/>). This is created as an XML file for each dataset.
-
-For more detailed metadata including information such as the data collection date, survey methods, institution name, and license type, refer to the provided URL for each dataset.
+OBIS and GBIF submissions also follow the Ecological Metadata Language format, a metadata standard for ecological data (more information here: <https://obis.org/manual/eml/>). This is created as an XML file for each dataset. For more detailed metadata including information such as the data collection date, survey methods, institution name, and license type, refer to the provided URL for each dataset.
 
 ### **Disclaimers**
 
@@ -41,7 +39,6 @@ OBIS performs multiple data quality checks, including flagging data over land. F
 Several of the datasets uploaded to OBIS and GBIF are also listed as separate data sources/sections within this report. These have been removed from this section of the report and include:
 
 -   Maritimes Research Vessel Surveys
-
 -   Whale Sightings Database (named ""DFO Maritimes Region Cetacean
     Sightings"" in OBIS and GBIF)
 
@@ -62,18 +59,15 @@ are various options the data submitter can select from. The following cases were
 The following cases provide relevant information and were combined within the report:
 
 - MaterialSample: A physical sample from the sampling event has been retained. The recorded location is the in situ sampling location.
-
 - PreservedSpecimen: organism is collected at the recorded location but then preserved (e.g., in ethanol at a location such as museum, university, or research institute).
-
 - HumanObservation: includes visual sightings of the organism, or observations where specimens were collected and then discarded after counting (e.g., a benthic grab sample).
-
 - Unknown: includes records without a defined basis of record or with an unrecognized value for this field
 
 Observations may also be listed as MachineObservation, which are derived from machine or computer-based detections such as automated sensors (e.g., DNA sequencers), acoustic tagging, or image recognition. Currently, there are no MachineObservation records for fish or invertebrate species in this region.
 
 ### **iNaturalist Data**
 
-iNaturalist is an open-source platform where naturalists, citizen scientists, and biologists can map species observations [@iNaturalist]. As of April 2022, iNaturalist has over 95 million species observations and over 2.1 million registered users/contributors globally. Every week, iNaturalist data that are considered ""Research Grade"" (i.e., the record contains a date, is georeferenced, has photos or sounds, isn't a captive or cultivated organism, and two thirds of identifiers agree on the species identification) are added to GBIF (more information here:
+iNaturalist [-@iNaturalist] is an open-source platform where naturalists, citizen scientists, and biologists can map species observations. As of April 2022, iNaturalist has over 95 million species observations and over 2.1 million registered users/contributors globally. Every week, iNaturalist data that are considered ""Research Grade"" (i.e., the record contains a date, is georeferenced, has photos or sounds, isn't a captive or cultivated organism, and two thirds of identifiers agree on the species identification) are added to GBIF (more information here:
 <https://www.gbif.org/dataset/50c9509d-22c7-4a22-a47d-8c48425ef4a7>).
 iNaturalist records are not added to OBIS.
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,e7168dd6b76c3df7f7b905515de9e1299a2b8312,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T12:46:48Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-17T12:46:48Z,fix reference- it goes in square brackets,app/templates/EN/generic_intro.Rmd,True,False,True,False,1,1,2,"---FILE: app/templates/EN/generic_intro.Rmd---
@@ -74,7 +74,7 @@ This report is intended to provide a first-order view of the data available with
 -	Unless otherwise specified, data were queried from 2010 to present. This was selected as an arbitrary time range to present the most recent information. Please contact data providers if data outside of these ranges are required.
 -	Current outputs of species observations in the report aggregate all years in summary plots and tables (e.g., 2010-2021). Annual summaries are not displayed. If you require annual summaries or other information beyond species presence, please contact relevant data providers/custodians for each data source.
 -	All maps in this report are for informational purposes and are not suitable for legal or surveying purposes. Maps represent only the approximate location of boundaries.
--	This report is intended for internal DFO use only. Privacy screening (i.e., the rule of 5; see @DFO2020_RuleOfFive) is not yet integrated into all data products and summaries generated by the report.
+-	This report is intended for internal DFO use only. Privacy screening [i.e., the rule of 5; see @DFO2020_RuleOfFive] is not yet integrated into all data products and summaries generated by the report.
 -	Outputs of this report are not suitable for real-time, dynamic spatial planning.
 -	Because coastal areas of the Scotian Shelf bioregion are generally not adequately sampled to characterize fine-scale ecological characteristics (i.e., species, habitat composition and variability within a sub-regional focal area), the distribution of (some) species featured within the report, when the search area is near to the coast, should be used as a first-order estimate limited by the spatial-temporal resolution of available data.
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,17d9fe7b8790db6ac4552b27df65e9987260c67f,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-13T17:26:43Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-13T17:26:43Z,fix figure text,reports/sections/permits/permits_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/permits/permits_en.Rmd---
@@ -80,7 +80,7 @@ Report_permit = noquote(Report_permit)
 writeLines(Report_permit)
 ```
 
-```{r permit-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(permits_rr, ""EN""), 'Map of species records obtained from the Species at Risk Act (SARA) Section 73 permits (black circles) observed within the search area (red outline). Permits are not created for species of special concern. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+```{r permit-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(permits_rr, ""EN""), 'Map of species records obtained from the Species at Risk Act (SARA) Section 73 permits (black circles) observed within the search area (red outline). Permits are not created for species of special concern. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,1719810b66e2ee6563cb92fac2c4181eacebe59f,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-11T18:28:43Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-11T18:28:43Z,fix sentence structure in final bullet point,reports/sections/permits/permits_en.Rmd,True,False,True,False,1,1,2,"---FILE: reports/sections/permits/permits_en.Rmd---
@@ -58,7 +58,7 @@ Please note the following caveats and disclaimers relevant to this section:
 * Only permits for which DFO is the regulatory authority were obtained. This includes aquatic species (as defined by SARA), except for those found on federal lands, which are administered by the Parks Canada Agency. 
 * Latitude and longitude formats differ between reports; therefore, all coordinates were converted to decimal degrees to promote consistency. 
 * In some instances, coordinate information was not included in the permits. Data from these instances were not included in this section. 
-* In the case that report records are inconclusive (species is unknown), they are omitted from the spreadsheet.
+* Cases where report records are inconclusive (species is unknown) were omitted from this section.
 
 #### ***Area-specific SARA Section 73 permits search results***
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,ac0457f822f50172c0a9aa49aabc64b898eae304,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-11T16:23:50Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-11T16:23:50Z,fix lat long switcharoo,DESCRIPTION;reports/sections/permits/permits_en.Rmd;reports/sections/permits/permits_preprocessing.R,True,False,True,False,10,3,13,"---FILE: DESCRIPTION---
@@ -31,5 +31,9 @@ Imports:
     tidyverse,
     whisker,
     bookdown,
-    pagedown
+    pagedown,
+    readxl,
+    plyr,
+    tibble,
+    stringr
 RoxygenNote: 7.1.1

---FILE: reports/sections/permits/permits_en.Rmd---
@@ -63,7 +63,7 @@ Please note the following caveats and disclaimers relevant to this section:
 #### ***Area-specific SARA Section 73 permits search results***
 
 ```{r permits-results, include=FALSE, cache=FALSE}
-outputList = master_intersect(permits_rr$data_sf, mapDataList, Year = minYear)
+outputList = master_intersect(permits_rr$data_sf, mapDataList, getRegion = TRUE)
 
 permitTable = create_sar_tables(outputList$studyData, listed_species)$sarData
 ```

---FILE: reports/sections/permits/permits_preprocessing.R---
@@ -64,7 +64,10 @@ permits = dplyr::select(comboPermits, LatDD, LongDD, scientificName, `Common Nam
                              `SARA status`)
 
 # Convert to sf object. CRS 4326 is WGS84
-permits_sf = sf::st_as_sf(permits, coords = c(""LatDD"", ""LongDD""), crs = 4326)
+permits_sf = sf::st_as_sf(permits, coords = c(""LongDD"", ""LatDD""), crs = 4326)
+
+# set scientific name column:
+names(permits_sf)[names(permits_sf) == 'scientificName'] <- 'Scientific Name'
 
 # Store data as RR object and set metadata
 permits_rr = list(""title"" = ""Section 73 Permits"", ",True,True,Dependency / Package,6
dfo-mar-odis,shinySpatialApp,7bd2896995e5b6dc7ae3c06034727a884107a07b,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-11T13:57:30Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-11T13:57:30Z,fix title,reports/sections/permits/permits_en.Rmd,True,False,True,False,1,2,3,"---FILE: reports/sections/permits/permits_en.Rmd---
@@ -60,13 +60,12 @@ Please note the following caveats and disclaimers relevant to this section:
 * In some instances, coordinate information was not included in the permits. Data from these instances were not included in this section. 
 * In the case that report records are inconclusive (species is unknown), they are omitted from the spreadsheet.
 
-#### ***Area-specific Permits search results***
+#### ***Area-specific SARA Section 73 permits search results***
 
 ```{r permits-results, include=FALSE, cache=FALSE}
 outputList = master_intersect(permits_rr$data_sf, mapDataList, Year = minYear)
 
 permitTable = create_sar_tables(outputList$studyData, listed_species)$sarData
-summarySarTable = add_col_to_sar_summary(summarySarTable, ""[OBIS](#OBIS-section)"", permitTable, ""Common Name"", ""Common Name"")
 ```
 
 ```{r permits-check, echo=FALSE, results='asis',}",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,1fde49993741ad25c03ac8823ac04df89bffaa9e,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-11T13:52:48Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-11T13:52:48Z,fix typos,reports/sections/permits/permits_en.Rmd,True,False,True,False,3,5,8,"---FILE: reports/sections/permits/permits_en.Rmd---
@@ -47,9 +47,9 @@ As well, the competent Minister must be of the opinion that all 3 of the followi
 * All feasible measures will be taken to minimize the impact of the activity on the species or its critical habitat or the residences of its individuals.
 * The activity will not jeopardize the survival or recovery of the species.
 
-Sample activities for which permits may be issued include: obtaining biological samples from the organism for research purposes, electrofishing to evaluate species populations, rescue activities to release entangled species, creating bypasses and traps for species, and conducting surveys, transects, and/or photographing for research purposes. Note that construction or development projects near water (e.g., constructions of bridges, maintenance of harbours, etc.) may also require a SARA permit. However, this is an additional process and requires other forms of authorization (see more information here <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>); therefore, data from these projects are therefore not included in this section. 
+Sample activities for which permits may be issued include: obtaining biological samples from the organism for research purposes, electrofishing to evaluate species populations, rescue activities to release entangled species, creating bypasses and traps for species, and conducting surveys, transects, and/or photographing for research purposes. Construction or development projects near water (e.g., constructions of bridges, maintenance of harbours, etc.) may also require a SARA permit. However, this is an additional process and requires other forms of authorization (see more information here <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>); therefore, data from these projects are therefore not included in this section. 
 
-In support of the expansion and integration of additional data sources, Species at Risk records from these DFO-issued Section 73 permits were mined and summarized in this section for internal DFO needs. Location and species information were obtained and summarized in this section. Due to issues surrounding Protected information, more specific information such as permit number or the project description are not included, but can be obtained from the SARA contact listed above, if needed. 
+In support of the expansion and integration of additional data sources, Species at Risk records from these DFO-issued Section 73 permits were mined and summarized in this section. Location and species information were extracted. Due to issues surrounding Protected information, more specific information such as permit number or the project description are not included, but can be obtained from the SARA contact listed above, if needed. 
 
 Please note the following caveats and disclaimers relevant to this section:
 
@@ -69,7 +69,6 @@ permitTable = create_sar_tables(outputList$studyData, listed_species)$sarData
 summarySarTable = add_col_to_sar_summary(summarySarTable, ""[OBIS](#OBIS-section)"", permitTable, ""Common Name"", ""Common Name"")
 ```
 
-
 ```{r permits-check, echo=FALSE, results='asis',}
 Report_permit = if (is.null(outputList$studyData)) {
   ""* There are no relevant SARA Section 73 Permit records for this search area.""
@@ -80,8 +79,7 @@ Report_permit = noquote(Report_permit)
 writeLines(Report_permit)
 ```
 
-
-```{r permit-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(permits_rr, ""EN""), 'Map species records obtained from the Species at Risk Act (SARA) Section 73 permits (black circles) observed within the search area (red outline). Permits are not created for species of special concern. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+```{r permit-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(permits_rr, ""EN""), 'Map of species records obtained from the Species at Risk Act (SARA) Section 73 permits (black circles) observed within the search area (red outline). Permits are not created for species of special concern. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,2f5450b4217034de2e454d4bef25a4007b9c7379,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-05T17:31:09Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-05T17:31:09Z,Fix formatting,reports/sections/permits/permits_en.Rmd,True,False,True,False,9,3,12,"---FILE: reports/sections/permits/permits_en.Rmd---
@@ -43,15 +43,21 @@ Sample activities for which permits may be issued include: obtaining biological
 
 In support of the expansion and integration of additional data sources, Species at Risk records from these DFO-issued Section 73 permits were mined and summarized in this section for internal DFO needs. Information extracted from the reports includes relevant details on Species at Risk interactions that occurred under specific permits. In the Excel file, the following information is being compiled: Year, Month, Day, Latitude, Longitude, Water Body, Species, Number of Individuals, Project Activity and Permit Report Number. The Report Number allows authorized DFO staff to review the permit files if required. 
 
-Please note the following caveats and disclaimers relevant to this section:
 
-To prevent misinterpretation of any guidelines, all bulleted lists have been obtained directly from: <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>. To ensure consistency in formatting, minor grammar edits may have been made.
+### Questions to ask Sean Butler during May 5 meeting:
+
+* Why are there are permits for humpback whales and common minke whales if they are not Schedule 1 species?
+* There are permits for *Phocoena phocoena vomerina* (harbour seals). *Vomerina* indicates the Pacific population. Is this a mistake?
+* ""Projects near water"" (e.g., constructions of bridges) also require a Permits, but require other forms of authorization. Were these included in the Permits Charlotte was looking at?
+
+Please note the following caveats and disclaimers relevant to this section:
 
+* To prevent misinterpretation of any guidelines, all bulleted lists have been obtained directly from: <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>. To ensure consistency in formatting, minor grammar edits may have been made.
 * The SARA prohibitions (first paragraph) do not apply to species listed as special concern. The information regarding permits is therefore not applicable to species of special concern.
 * DFO is the regulatory authority for issuing permits for aquatic species (as defined by SARA) other than species in waters found on federal lands administered by the Parks Canada Agency. This section only contains information for DFO-issued permits.
 * Latitude and longitude formats differ between reports; therefore, all coordinates were converted to decimal degrees to promote consistency. 
 * Permits for projects occurring near water are not included (see here for more details).
-* Who to contact for permit information???
+* Something about Permit #!!!
 * Protected information is not part of the data mining exercise CLARIFY
 * In the case that report records are inconclusive (species is unknown), they are omitted from the spreadsheet.
 ",False,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,141270b953f6c19e4b5152d248d2e89be9719a07,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-04T17:25:15Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-04T17:25:15Z,Fix typos in comments #73,reports/sections/offshore_scallop/offshore_scallop_en.rmd;reports/sections/offshore_scallop/offshore_scallop_preprocessing.R,True,False,True,False,2,3,5,"---FILE: reports/sections/offshore_scallop/offshore_scallop_en.rmd---
@@ -61,7 +61,6 @@ if (!is.null(osOutputList$studyData)) {
   
   names(osTable)[1]<-""Year""
   names(osTable)[2]<-""Month""
-  
 }
 
 

---FILE: reports/sections/offshore_scallop/offshore_scallop_preprocessing.R---
@@ -7,13 +7,13 @@ source(here::here(""reports/R/dataFunctions.R""))
 #contains config parameters and paths
 source(here::here(""config.R""))
 
-library(lubridate) # load it to use year/month/day as functions and headers
+library(lubridate) # load library to use year/month/day as functions and headers
 
 # load in rr objects, CommonData contains data such as land borders, etc.
 loadResult <- load_rdata(c(""CommonData"", ""offshoreScallop_rr""), regionStr)
 
 # ---------------------TEMPLATE-----------------------------------
-# FI ME!
+# FIX ME!
 load(""C:/Users/StoyelQ/Desktop/Work/Reproducible_reports/test/OSdat.RData"")
 
 #format date and separate y m d",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,081bde20d1e920fbc24576f45c0b0e55bfa8f4b3,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-04T17:15:35Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-04T17:15:35Z,fix mistakes in the spreadsheet,reports/sections/permits/permits_preprocessing.R,False,True,True,False,26,3,29,"---FILE: reports/sections/permits/permits_preprocessing.R---
@@ -30,13 +30,36 @@ species_brackets = str_extract_all(permits$Species, ""\\([^()]+\\)"")
 # Remove the brackets and add this as a new column to the permits data frame
 permits$scientificName = substring(species_brackets, 2, nchar(species_brackets)-1)
 
-# Remove sea turtle data (we aren't including this for now)
-permits = permits[!(permits$scientificName==""Dermochelys coriacea""),]
+# There are some species that need to be removed/edited in the permit spreadsheets
+# I noticed these issues when joining with the MAR spreadsheet below
+# It is easier to fix them at this step though!
+
+# Remove leatherback sea turtles (we aren't including these for now)
+permits = permits[!(permits$scientificName==""Dermochelys coriacea""),] 
+# A few leatherback sea turtles were entered with scientific names between commas instead of brackets. Remove these too.
+permits = permits[!(permits$scientificName==""haracter(0""),] 
+# Remove the ones that accidentally have an extra space at the end
+permits = permits[!(permits$scientificName==""Dermochelys coriacea ""),] 
+
+# Remove common minke whale: not COSEWIC-listed or Schedule 1. Unsure why there are permits for these
+permits = permits[!(permits$scientificName==""Balaena rostrata""),] 
+# There's also one record with an accidental space that can be removed
+permits = permits[!(permits$scientificName=="" Balaena rostrata""),] 
+# Remove (NW Atlantic) humpback whales: not COSEWIC-listed or Schedule 1. Unsure why there are permits.
+permits = permits[!(permits$scientificName==""Megaptera novaeangliae""),] 
+# There's also one record with an accidental space that can be removed
+permits[""scientificName""][permits[""scientificName""] == "" Balaenoptera musculus""] = ""Balaenoptera musculus""
+
+# Charlotte's spreadsheet had an extra 
+permits[""scientificName""][permits[""scientificName""] == ""Phocoena phocoena vomerina""] = ""Phocoena phocoena""
+
+
+
 
 # Then combine with the MAR species spreadsheet to get other relevant info (e.g., SARA/COSEWIC statuses)
 comboPermits = full_join(permits, listed_species, by=c(""scientificName"" = ""Scientific Name""))
 
-comboPermits = dplyr::select(comboPermits, Year, LatDD, LongDD, ""Scientific Name"")
+#comboPermits = dplyr::select(comboPermits, Year, LatDD, LongDD, ""Scientific Name"")
 
 
 ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,0b3dafd22de5b13368489900ff7c3169793e6aed,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-03T19:41:35Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-03T19:41:35Z,fix preprocessing steps,reports/sections/permits/permits_preprocessing.R,False,True,True,False,50,3,53,"---FILE: reports/sections/permits/permits_preprocessing.R---
@@ -1,12 +1,59 @@
 source(here::here(""reports/dataprocessing/openDataHelpers.R""))
 source(here::here(""reports/R/dataFunctions.R""))
 source(here::here(""config.R""))
+library(readxl)
+library(plyr)
+library(tibble)
+library(stringr)
+library(dplyr)
 
-loadResult <- load_rdata(c(""CommonData"", ""permits_rr""), regionStr)
+loadResult = load_rdata(c(""CommonData"", ""permits_rr""), regionStr)
 
 #------------------permits--------------------
 # SARA Section 73 Permits (permits)
-# permits <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/Cetaceans/WSDB/MarWSDB_20210407.csv""), stringsAsFactors = FALSE)
+
+# Determine file path for permit data
+xl_data = file.path(fileLoadPath, ""NaturalResources/Species/Permits/SARAdata_withCoordinates.xlsx"")
+
+# Get the sheet names from the spreadsheet (there is one sheet per year, from 2010 to 2020)
+sheets = excel_sheets(path = xl_data)
+
+# Read in the data from each sheet in the Excel file. Each sheet will be its own list
+list_all = lapply(sheets, function (x) read_excel (xl_data, sheet = x))
+
+# Combine each list into a single dataframe
+permits = rbind.fill(list_all)
+
+# Get scientific name. The name will be listed within brackets.
+species_brackets = str_extract_all(permits$Species, ""\\([^()]+\\)"")
+
+# Remove the brackets and add this as a new column to the permits data frame
+permits$scientificName = substring(species_brackets, 2, nchar(species_brackets)-1)
+
+# Remove sea turtle data (we aren't including this for now)
+permits = permits[!(permits$scientificName==""Dermochelys coriacea""),]
+
+# Then combine with the MAR species spreadsheet to get other relevant info (e.g., SARA/COSEWIC statuses)
+comboPermits = full_join(permits, listed_species, by=c(""scientificName"" = ""Scientific Name""))
+
+comboPermits = dplyr::select(comboPermits, Year, LatDD, LongDD, ""Scientific Name"")
+
+
+
+
+
+# Select required columns
+permits = dplyr::select(permits, Year, LatDD, LongDD, Species)
+
+#permits = dplyr::rename(wsdb,c(""Scientific Name"" = ""scientificName"", 
+                               ""COMMONNAME""))
+
+
+
+
+
+
+
 # permits <- dplyr::select(wsdb, COMMONNAME, SCIENTIFICNAME, YEAR, LATITUDE, LONGITUDE)
 # permits <- wsdb %>% dplyr::filter(YEAR >= rrMinYear)
 # permits <- dplyr::rename(wsdb,c(""Scientific Name"" = ""SCIENTIFICNAME"",
@@ -23,7 +70,7 @@ permits_rr <- list(""title"" = ""Section 73 Permits"",
                                   ""url"" = lang_list(""<https://www.canada.ca/en/environment-climate-change/services/species-risk-public-registry/policies-guidelines/permitting-under-section-73.html>""),
                                   ""accessedOnStr"" = list(""en"" =""April 26, 2022 by Charlotte Smith"", ""fr"" = ""26 avril 2022 par Charlotte Smith"") ,
                                   ""accessDate"" = as.Date(""2022-04-26""),
-                                  ""searchYears"" = paste(rrMinYear, ""-2022"", sep=""""),
+                                  ""searchYears"" = paste(rrMinYear, ""-2020"", sep=""""),
                                   ""securityLevel"" = noneList,
                                   ""qualityTier"" = mediumQuality,
                                   ""constraints"" = internalUse",True,False,Data / Input Handling,3
dfo-mar-odis,shinySpatialApp,ebcb84c9a0665e4f5cf1680abc6f170f19c345fd,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-03T17:21:05Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-05-03T17:21:05Z,add citation and fix list formatting,reports/sections/permits/permits_en.Rmd,True,False,True,False,11,10,21,"---FILE: reports/sections/permits/permits_en.Rmd---
@@ -15,7 +15,7 @@ load_rdata(c(""threats_rr""), regionStr, env = environment())
 
 ### SARA Section 73 Permits
 
-The Species at Risk Act (2002) contains several prohibitions to protect Schedule 1 species. Under Sections 32 and 33 of SARA, it is an offence to:
+The Species at Risk Act [-@SARA2002] contains several prohibitions to protect Schedule 1 species. Under Sections 32 and 33 of SARA, it is an offence to:
 
 * Kill, harm, harass, capture or take an individual of a species listed as extirpated, endangered or threatened under SARA.
 * Possess, collect, buy, sell or trade an individual (or any part or derivative of such an individual) of a species listed as extirpated, endangered or threatened under SARA.
@@ -35,19 +35,20 @@ As well, the competent Minister must be of the opinion that all 3 of the followi
 * All feasible measures will be taken to minimize the impact of the activity on the species or its critical habitat or the residences of its individuals.
 * The activity will not jeopardize the survival or recovery of the species.
 
-Sample activities for which permits may be issued include: obtaining biological samples from the organism for research purposes, electrofishing to evaluate species populations, rescue activities to release entangled species, creating bypasses and traps for species, and conducting surveys/transects/photographing. Note that construction or development projects near water (e.g., constructions of bridges, maintenance of harbours, etc.) also require a SARA Permit. However, this is an additional process and requires other forms of authorization (see more information here <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>). 
+Sample activities for which permits may be issued include: obtaining biological samples from the organism for research purposes, electrofishing to evaluate species populations, rescue activities to release entangled species, creating bypasses and traps for species, and conducting surveys, transects, and/or photographing for research purposes. Note that construction or development projects near water (e.g., constructions of bridges, maintenance of harbours, etc.) also require a SARA Permit. However, this is an additional process and requires other forms of authorization (see more information here <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>). 
 
 In support of the expansion and integration of additional data sources, Species at Risk records from these DFO-issued Section 73 permits were mined and summarized in this section for internal DFO needs. Information extracted from the reports includes relevant details on Species at Risk interactions that occurred under specific permits. In the Excel file, the following information is being compiled: Year, Month, Day, Latitude, Longitude, Water Body, Species, Number of Individuals, Project Activity and Permit Report Number. The Report Number allows authorized DFO staff to review the permit files if required. 
 
 Please note the following caveats and disclaimers relevant to this section:
 
-*To prevent misinterpretation of any guidelines, all bulleted lists have been obtained directly from: https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html. To ensure consistency in formatting, minor grammar edits may have been made.
-*The SARA prohibitions (first paragraph) do not apply to species listed as special concern. The information regarding permits is therefore not applicable to species of special concern.
-*DFO is the regulatory authority for issuing permits for aquatic species (as defined by SARA) other than species in waters found on federal lands administered by the Parks Canada Agency. This section only contains information for DFO-issued permits.
-*Latitude and longitude formats differ between reports; therefore, all coordinates were converted to decimal degrees to promote consistency. 
-*Permits for projects occurring near water are not included (see here for more details).
-*Who to contact for permit information???
-*Protected information is not part of the data mining exercise CLARIFY
-*In the case that report records are inconclusive (species is unknown), they are omitted from the spreadsheet.
+To prevent misinterpretation of any guidelines, all bulleted lists have been obtained directly from: <https://www.dfo-mpo.gc.ca/pnw-ppe/index-eng.html>. To ensure consistency in formatting, minor grammar edits may have been made.
+
+* The SARA prohibitions (first paragraph) do not apply to species listed as special concern. The information regarding permits is therefore not applicable to species of special concern.
+* DFO is the regulatory authority for issuing permits for aquatic species (as defined by SARA) other than species in waters found on federal lands administered by the Parks Canada Agency. This section only contains information for DFO-issued permits.
+* Latitude and longitude formats differ between reports; therefore, all coordinates were converted to decimal degrees to promote consistency. 
+* Permits for projects occurring near water are not included (see here for more details).
+* Who to contact for permit information???
+* Protected information is not part of the data mining exercise CLARIFY
+* In the case that report records are inconclusive (species is unknown), they are omitted from the spreadsheet.
 
 ",False,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,511e381c630fd842209d4594f07a6857c5378995,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-03T14:21:22Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-05-03T14:21:22Z,"fix select bug, return to flat-earther mode",app/modules/fullReport.R;reports/R/intersectFunctions.R,False,True,True,False,2,2,4,"---FILE: app/modules/fullReport.R---
@@ -22,7 +22,7 @@ fullReportUI <- function(id) {
           ),
           selected = c(
             ""species/NSARP_dist_crithab.Rmd"",
-            ""species/fish_invertebrates_ceteaceans""
+            ""species/fish_invertebrates_ceteaceans.Rmd""
           )
         ),
         checkboxGroupInput(

---FILE: reports/R/intersectFunctions.R---
@@ -27,7 +27,7 @@ library(sp)
 #                NULL unless getRegion is TRUE.
 # 4. mapPoints: Unique collection of points to be plotted on a map.
 master_intersect <- function(data_sf, mapDataList, getRegion=FALSE, ...) {
-
+  sf::sf_use_s2(FALSE)
   # check that data_sf is an accepted format:
   if (is.null(data_sf)) {
     outList <- list(regionData = NULL,",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,e62239b6d28ab3f833ed31519ed71d3aad99a3ce,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-05-03T12:36:08Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2022-05-03T12:36:08Z,"Proposing a new caveat, as recommeded by OTN during the hackathon https://github.com/dfo-mar-odis/shinySpatialApp/issues/69",DESCRIPTION;app/templates/EN/generic_intro.Rmd,True,False,True,False,3,1,4,"---FILE: DESCRIPTION---
@@ -30,5 +30,6 @@ Imports:
     robis,
     tidyverse,
     whisker,
-    bookdown
+    bookdown,
+    packageName
 RoxygenNote: 7.1.1

---FILE: app/templates/EN/generic_intro.Rmd---
@@ -87,6 +87,7 @@ This report is intended to provide a first-order view of the data available with
 - This report is not intended to provide the data itself, but to summarize what is available. Users are encouraged to:
   - Access the original data source if more information is required,
   - Circulate this document to all contacts outlined in the different sections of the report for each data source, to ensure the veracity of inference drawn from the report, and to provide any supplemental information that may support the provision of science advice.
+- Data and metadata summarized in this report may change frequently because different sources of information may change, or may get updated, without prior notice. Consequently, reports may summarize different outputs of the same polygon depending on their date of creation. 
 -	The focus of this report is on available observations of species presence and not on absences, quantities (e.g., species abundance or biomass), frequency, or catch information.
 -	The absence of a species in this report should be interpreted as an absence of observation or reporting of the species within the user-defined search area, not necessarily as a true absence of the species.
 -	Unless otherwise specified, data were queried from 2010 to present. This was selected as an arbitrary time range to present the most recent information. Please contact data providers if data outside of these ranges are required.",False,True,Dependency / Package,6
dfo-mar-odis,shinySpatialApp,fc2385cd206dbc1fbdc2b79bdd625404b37513c8,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-04-29T14:45:18Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-04-29T14:45:18Z,fix citation format,reports/sections/obis/obisCommon_en.Rmd,True,False,True,False,2,2,4,"---FILE: reports/sections/obis/obisCommon_en.Rmd---
@@ -32,7 +32,7 @@ load_rdata(c(""gbif_rr""), regionStr, env = environment())
 write_meta(gbif_rr, ""EN"")
 ```
 
-GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth [@GBIF2022]. Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of April 2022, GBIF has over 2.1 billion species occurrence records and over 68,000 datasets globally. 
+GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth [@GBIF]. Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of April 2022, GBIF has over 2.1 billion species occurrence records and over 68,000 datasets globally. 
 
 
 
@@ -169,7 +169,7 @@ Observations may also be listed as MachineObservation, which are derived from ma
 #### iNaturalist data
 
 iNaturalist is an open-source platform where naturalists, citizen
-scientists, and biologists can map species observations [iNaturalist2022]. As of April 2022, iNaturalist has over 95 million species
+scientists, and biologists can map species observations [@iNaturalist]. As of April 2022, iNaturalist has over 95 million species
 observations and over 2.1 million registered users/contributors
 globally. Every week, iNaturalist data that are considered ""Research
 Grade"" (i.e., the record contains a date, is georeferenced, has photos",False,True,Documentation / Formatting,4
dfo-mar-odis,shinySpatialApp,f8193cdcfbe5ab1cb294e57e15f0379a5743417e,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-04-29T12:40:10Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-04-29T12:40:10Z, slight grammer fixes :cop:,reports/Modus-operandi-RAP.Rmd,True,False,True,False,38,38,76,"---FILE: reports/Modus-operandi-RAP.Rmd---
@@ -11,87 +11,87 @@ output:
     highlight: tango
 ---
 
-
 ```{r setup, include=FALSE}
 knitr::opts_chunk$set(echo = TRUE)
 # requires R package `rmdformats`
 ```
 
 ## The Strategic Reproducible Analytical Pipeline (RAP) Initiative
 
-The Strategic Science Planning and Program Integrity (SSPPI) division in DFO Maritimes supports various projects and presents many opportunities to modernize data management and reporting practices. In 2018, requests to the division to identify and summarize the available DFO and non-DFO datasets within the Maritimes Region were becoming increasingly frequent. Born out of frustration and a need for swift and effective approaches, a team of self-proclaimed Strategic Reproducible Analytical Pipeline (RAP) Champions was formed to automate the creation of these Reports. The primary objective of this initiative has been to develop a web-based tool to generate Reproducible Reports to identify and describe DFO and non-DFO datasets within a user-defined area. Specifically, this project address internal requests that support processes that provide frequent and standardized advice, such as CSAS, Marine Spatial Planning, Aquaculture Siting Responses, and Environmental Response, which have an emphasis on Species at Risk. 
+The Strategic Science Planning and Program Integrity (SSPPI) division in DFO Maritimes supports various projects and presents many opportunities to modernize data management and reporting practices. In 2018, requests to the division to identify and summarize the available DFO and non-DFO datasets within the Maritimes Region were becoming increasingly frequent. Born out of frustration and a need for swift and effective approaches, a team of self-proclaimed Strategic Reproducible Analytical Pipeline (RAP) Champions was formed to automate the creation of these Reports. The primary objective of this initiative has been to develop a web-based tool to generate Reproducible Reports to identify and describe DFO and non-DFO datasets within a user-defined area. Specifically, this project address internal requests that support processes that provide frequent and standardized advice, such as CSAS, Marine Spatial Planning, Aquaculture Siting Responses, and Environmental Response, which have an emphasis on Species at Risk.
 
-As Strategic RAP Champions, we strive for an open and understanding culture within our group. How we implement this is constantly evolving and changing. However, we believe that digital tools can enhance the work we do to effectively collaborate with a growing network of internal and external partners (including organizations outside of Canada). Our focus on co-creation remains key for prioritization and accountability, to ensure that our work is truly helpful to DFO. We also value the continued advancement of new skills, intrinsic curiosity, and the pursuit of new opportunities, and this has been a major factor in our success in overcoming various frustrating obstacles. We acknowledge that there is no perfect balance for managing these competing and conflicting tasks and interests, but this can be at least partially remedied by continuous scope prioritization and close cooperation within our team (Bjarnason et al., 2012). Although we are highly ambitious, we consider it especially important to have reasonable expectations for ourselves and team members, given the backdrop of the COVID-19 pandemic, and other challenging personal and global events that can hinder workplace productivity and wellbeing (Cleary et al., 2020; Sigahi et al., 2021). 
+As Strategic RAP Champions, we strive for an open and understanding culture within our group. How we implement this is constantly evolving and changing. However, we believe that digital tools can enhance the work we do to effectively collaborate with a growing network of internal and external partners (including organizations outside of Canada). Our focus on co-creation remains key for prioritization and accountability, to ensure that our work is truly helpful to DFO. We also value the continued advancement of new skills, intrinsic curiosity, and the pursuit of new opportunities, and this has been a major factor in our success in overcoming various frustrating obstacles. We acknowledge that there is no perfect balance for managing these competing and conflicting tasks and interests, but this can be at least partially remedied by continuous scope prioritization and close cooperation within our team (Bjarnason et al., 2012). Although we are highly ambitious, we consider it especially important to have reasonable expectations for ourselves and team members, given the backdrop of the COVID-19 pandemic, and other challenging personal and global events that can hinder workplace productivity and wellbeing (Cleary et al., 2020; Sigahi et al., 2021).
 
-This document takes inspiration from discussions, brainstorming sessions, [examples from succesful companies](/company/culture/all-remote/remote-work-report/), as well as learning and development opportunities. We have adopted lots of ideas from the [GitLab's Guide to All-Remote](https://about.gitlab.com/company/culture/all-remote/guide/) to craft our own guide to keep improving the way we work and support each other. 
+This document takes inspiration from discussions, brainstorming sessions, [examples from successful companies](/company/culture/all-remote/remote-work-report/), as well as learning and development opportunities. We have adopted lots of ideas from the [GitLab's Guide to All-Remote](https://about.gitlab.com/company/culture/all-remote/guide/) to craft our own guide to keep improving the way we work and support each other.
 
-## RAP Disclaimer 
+## RAP Disclaimer
 
-- Our intention is to share how we do our work and how we support each other. We love sharing our solutions to complex problems. This guide, however, is not intended as a prescriptive guide for other teams.
-- Many sections from this document are verbatim of other initiatives/sites, with minor edits to adjust it to our own context. All credit belongs to the original source (primarily, GitLab's documentation). If anybody believes this to be not fair use, we will take this down immediately.
-- This guide draws inspiration from all-remote organizations; however, we are not advocating for all-remote structure (e.g. we want to participate in croquet tournaments at [BIO](https://www.bio.gc.ca/index-en.php).
+-   Our intention is to share how we do our work and how we support each other. We love sharing our solutions to complex problems. This guide, however, is not intended as a prescriptive guide for other teams.
+-   Many sections from this document are verbatim of other initiatives/sites, with minor edits to adjust it to our own context. All credit belongs to the original source (primarily, GitLab's documentation). If anybody believes this to be not fair use, we will take this down immediately.
+-   This guide draws inspiration from all-remote organizations; however, we are not advocating for all-remote structure (e.g. we want to participate in croquet tournaments at [BIO](https://www.bio.gc.ca/index-en.php)).
 
 ## Strategic RAP Champions: who are we?
 
 This section is a modified version of the [RAP champions network in the UK](https://gss.civilservice.gov.uk/about-us/champion-networks/reproducible-analytical-pipeline-rap-champions/).
 
 Strategic RAP champions support the implementation of reproducible analytical pipelines at DFO. This includes:
 
-- Promoting reproducible analysis (i.e. analysis with a clear audit trail that explains how and why it was carried out),
-- Actively using reproducible analytical pipelines (i.e. the software methods used to make analysis reproducible),
-- Sharing knowledge and providing advice and support to members of the analytical community who want to learn about, and implement, reproducible analysis and reproducible analytical pipelines.
-- Using platforms like GitHub or GItLab to share code so others can learn, use and/or adapt what has been done.
+-   Promoting reproducible analysis (i.e. analysis with a clear audit trail that explains how and why it was carried out),
+-   Actively using reproducible analytical pipelines (i.e. the software methods used to make analysis reproducible),
+-   Sharing knowledge and providing advice and support to members of the analytical community who want to learn about, and implement, reproducible analysis and reproducible analytical pipelines.
+-   Using platforms like GitHub or GItLab to share code so others can learn, use and/or adapt what has been done.
+
+As Strategic RAP Champions:
+
+-   We aim for progress, not perfection. Perfectionism is an impediment: iterative work requires most things to spend a lot of time in ""draft"".
 
-As Strategic RAP Champions: 
-- We aim for progress, not perfection. Perfectionism is an impediment: iterative work requires most things to spend a lot of time in “draft"".  
-- We celebrate incremental improvements equally, if not more, than massive launches
+-   We celebrate incremental improvements equally, if not more, than massive launches
 
-We welcome all that would like to be part of this initiative. It is open to anyone who is working on, or considering, reproducible analytical pipelines. 
+We welcome all that would like to be part of this initiative. It is open to anyone who is working on, or considering, reproducible analytical pipelines.
 
 ## The Strategic RAP Manifesto
 
 This section is a modified version of the [GitLab's manifesto](https://about.gitlab.com/company/culture/all-remote/guide/).
 
-- Working and collaborating with a large network of partners from different places (instead of from a central location).
-- Formal communication channels (over informal communication channels).
-- Writing down and recording knowledge (over verbal explanations).
-- Written processes (to compliment over on-the-job training).
-- Public sharing of information (over need-to-know access).
-- Opening up documents for editing by anyone (over top-down control of documents).
-- Asynchronous communication (over synchronous communication).
-- Flexible working hours (over set working hours, within the scope of our job description).
-- The results of work (over micro-management of the hours put in).
+-   Working and collaborating with a large network of partners from different places (instead of from a central location).
+-   Formal communication channels (over informal communication channels).
+-   Writing down and recording knowledge (over verbal explanations).
+-   Written processes (to compliment over on-the-job training).
+-   Public sharing of information (over need-to-know access).
+-   Opening up documents for editing by anyone (over top-down control of documents).
+-   Asynchronous communication (over synchronous communication).
+-   Flexible working hours (over set working hours, within the scope of our job description).
+-   The results of work (over micro-management of the hours put in).
 
 ## How we work and how we communicate information
 
-Coordinating big programs and projects with a large network of collaborators require tools that can foster trust, communication, and shared goals. There are three key dimensions to successfully embrace collaboration, and to thrive in our roles: the organizational, the technical, and the social. Communication is KEY to all of this. With a common goal, strategic planning, and the right collaboration tools, working in a virtual environment can be incredible productive, fun and efficient. This will be increasingly more important as we move to a hybrid environment were it will be more difficult to get organized in a synchronous fashion with member of different organizations and teams.
+Coordinating big programs and projects with a large network of collaborators require tools that can foster trust, communication, and shared goals. There are three key dimensions to successfully embrace collaboration, and to thrive in our roles: the organizational, the technical, and the social. Communication is KEY to all of this. With a common goal, strategic planning, and the right collaboration tools, working in a virtual environment can be incredible productive, fun and efficient. This will be increasingly more important as we move to a hybrid environment where it will be more difficult to get organized in a synchronous fashion with member of different organizations and teams.
 
 This section includes material from the course [How to Manage a Remote Team](https://www.coursera.org/learn/remote-team-management).
 
-- Self-service: It's not what you know. It's knowing **where to look**. We are committed to become more intentional about documenting processes, and it is entirely counter to how typical work environments are structured. Learn more about the [importance of self-searching, self-learning, and self-service organization](/company/culture/all-remote/self-service/).
+-   Self-service: It's not what you know. It's knowing **where to look**. We are committed to become more intentional about documenting processes, and in contrast to how typical work environments are structured. Learn more about the [importance of self-searching, self-learning, and self-service organization](/company/culture/all-remote/self-service/).
 
-- Informal communication: We are committed to creating an atmosphere where team members feel comfortable reaching out to anyone to converse about topics unrelated to work.
+-   Informal communication: We are committed to creating an atmosphere where team members feel comfortable reaching out to anyone to converse about topics unrelated to work.
 
-- Asynchronous communication: Asynchronous communication is the art of communicating and moving projects forward without the need for collaborators or stakeholders to be available at the same time your message is sent. Mastering asynchronous workflows is vital to avoiding dysfunction and enjoying outsized efficiencies. The benefits include enabling many collaborators to work effectively, reducing meetings, and enabling team members to work on a flexible schedule — all of which raise morale and productivity. However, shifting to this way of working requires a lot of large and small adjustments.Learn more about [implementing asynchronous workflows at GitLab](/company/culture/all-remote/asynchronous/).Asynchronous workflows are more easily adopted when you foster a culture of progress over perfection. Practicing iteration means sharing work that is in draft; working on multiple projects at once; and having a low level of shame. Perfectionism is an impediment: iterative work requires most things to spend a lot of time in “draft,” while they wait for another party to unblock progress. This requires intention and effort. If you're only working on a single project, asynchronous can feel taxing and inefficient, as you're perpetually waiting for another party to unblock you. This creates idle time and makes synchronicity seem alluring. If you're working on five ongoing projects, for example, it's much easier to make iterative progress on one, tag a person or team for desired input or action, and switch to another ongoing project while you wait. If you cycle through your assigned projects, making iterative improvements on each before handing off, you're able to create minimum viable change for many more projects, while being less concerned over the immediate response to any one of the projects in particular.
-Asynchronous works well when you manage multiple concurrent projects, though this does require discipline and an ability to context switch and compartmentalize. Aim for progress, not perfection. Asynchronous workflows require a culture where incremental improvements are celebrated equally, if not more, than massive launches. If leadership casts shame on unfinished or unpolished work, workers will be reluctant to work asynchronously. Rather, they will optimize for delaying work until a satisfactory amount of consensus gathering can occur. Consensus feels good, but can easily mask inefficiency, progress, and innovation.
+-   Asynchronous communication: Asynchronous communication is the art of communicating and moving projects forward without the need for collaborators or stakeholders to be available at the same time your message is sent. Mastering asynchronous workflows is vital to avoiding dysfunction and enjoying outsized efficiencies. The benefits include enabling many collaborators to work effectively, reducing meetings, and enabling team members to work on a flexible schedule --- all of which raise morale and productivity. However, shifting to this way of working requires a lot of large and small adjustments.Learn more about [implementing asynchronous workflows at GitLab](/company/culture/all-remote/asynchronous/). Asynchronous workflows are more easily adopted when you foster a culture of progress over perfection. Practicing iteration means sharing work that is in draft; working on multiple projects at once, and having a low level of shame. Perfectionism is an impediment: iterative work requires most things to spend a lot of time in ""draft,"" while they wait for another party to unblock progress. Achieving asynchronous workflows requires intention and effort. If you're only working on a single project, asynchronous can feel taxing and inefficient, as you're perpetually waiting for another party to unblock you. This creates idle time and makes synchronicity seem alluring. If you're working on five ongoing projects, for example, it's much easier to make iterative progress on one, tag a person or team for desired input or action, and switch to another ongoing project while you wait. If you cycle through your assigned projects, making iterative improvements on each before handing off, you're able to create minimum viable change for many more projects, while being less concerned over the immediate response to any one of the projects in particular. Asynchronous works well when you manage multiple concurrent projects, though this does require discipline and an ability to context switch and compartmentalize. Aim for progress, not perfection. If leadership casts shame on unfinished or unpolished work, workers will be reluctant to work asynchronously. Rather, they will optimize for delaying work until a satisfactory amount of consensus gathering can occur. Consensus feels good, but can easily mask inefficiency, progress, and innovation.
 
-- Documentation: Good project management practices keep everything flowing, even in a remote, asynchronous environment. If you’ve got good communication and documentation strategies, it becomes much easier to implement strong project and task management. But there are still some considerations to take into account. Project management is largely similar whether you’re in a colocated or remote environment. The main difference is the preference for asynchronous work. Standup meetings can be much more rare, because they are often more difficult to execute. Many of GitLab’s projects use an asynchronous, written check-in for standups, posted in a shared channel, instead of a synchronous meeting. Without the reliance on synchronous check-ins, there’s increased need for good documentation. People will always have questions and need information. To make this function across time zones, it’s important to create a single source of truth for any initiative. Without strong documentation, projects and teams quickly become chaotic and inefficient. As Strategic RAP Champions we love these principles and we are exploring how to transition to a model like this.
+-   Documentation: Good project management practices keep everything flowing, especially in a remote, asynchronous environment. If you've got good communication and documentation strategies, it becomes much easier to implement strong project and task management. But there are still some considerations to take into account. Project management is largely similar whether you're in a colocated or remote environment. The main difference is the preference for asynchronous work. Standup meetings can be much more rare, because they are often more difficult to execute. Many of GitLab's projects use an asynchronous, written check-in for standups, posted in a shared channel, instead of a synchronous meeting. Without the reliance on synchronous check-ins, there's increased need for good documentation. People will always have questions and need information. To make this function across time zones, it's important to create a single source of truth for any initiative. Without strong documentation, projects and teams quickly become chaotic and inefficient. As Strategic RAP Champions we love these principles and we are exploring how to transition to a model like this.
 
-- Meetings: We continue to challenge ideas to decide when a meeting is necessary and when other tools are more suitable to support our projects, our team, and our individual work. Communicating effectively and responsibly through text often required more energy and efforts comapred with in-person meetings.
+-   Meetings: We continue to challenge ideas to decide when a meeting is necessary and when other tools are more suitable to support our projects, our team, and our individual work. Communicating effectively and responsibly through text often required more energy and efforts comapred with in-person meetings.
 
-- In-person interactions: There are many advantages of having in-person interactions, and although this will never be possible with all the collaborators of projects, it is still an important component for our team.
+-   In-person interactions: There are many advantages of having in-person interactions, and although this will never be possible with all the collaborators of projects, it is still an important component for our team.
 
 ## Our Tools
 
 The above mentioned components are mostly extracted from GitLab's training material. We are starting a pilot in our team to explore how to test and adopt many of these principles, with appropriate tools. We are concerned about tool overload ad their long-lasting usefulness. We will continue to adopt lessons learned, we are committed to re-think ideas, and we will continue to share our lessons learned.
 
 Currently, our key collaborations tools include:
 
-- Microsoft Teams
-- [Virtual communities of practice](https://sites.google.com/view/science-collaboration-hubs/home) 
-- [Our own Strategic RAP board linked to our code repository](https://github.com/orgs/dfo-mar-odis/projects/2)
-- [Jamboards](https://jamboard.google.com/)
+-   Microsoft Teams
+-   [Virtual communities of practice](https://sites.google.com/view/science-collaboration-hubs/home)
+-   [Our own Strategic RAP board linked to our code repository](https://github.com/orgs/dfo-mar-odis/projects/2)
+-   [Jamboards](https://jamboard.google.com/)
 
 ## Final Thoughts
 
-Do you have advice / ideas you may want to share? Please reach out! We are always happy to share our approaches and support our colleagues at DFO and beyond. 
+Do you have advice / ideas you may want to share? Please reach out! We are always happy to share our approaches and support our colleagues at DFO and beyond.",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,86cc42e84446b5486ecca849a0970890e0f1302d,David Beauchesne,david.beauchesne@uqar.ca,2022-04-08T19:45:14Z,David Beauchesne,david.beauchesne@uqar.ca,2022-04-08T19:45:14Z,path and section issue,app/R/renderReport.R;app/modules/fullReport.R;app/templates/EN/generic_intro.Rmd;app/templates/FR/generic_intro.Rmd,True,True,True,False,29,47,76,"---FILE: app/R/renderReport.R---
@@ -3,7 +3,7 @@
 #' @param geoms sf object selected.
 #' @param lang target language, ""EN""/""FR""
 #' @param fl file name (optional).
-#' @param species human_threats, context different parts to be added.
+#' @param parts subsections to include in the report
 #' @param u_name, u_email, u_text, u_comments User details.
 #' @param dir_out output directory.
 #' @param dir_tpl path to template directory.
@@ -17,7 +17,7 @@
 #'   `dir_out`: directory where report is saved
 #'
 #
-render_full_report <- function(geoms, lang, species, human_threats, context,
+render_full_report <- function(geoms, lang, parts,
   u_name, u_email, u_text, u_comments, dir_out = ""output"", fl = """",
   dir_tpl = here::here(""app/templates""), keep.origin = FALSE) {
     
@@ -56,13 +56,7 @@ render_full_report <- function(geoms, lang, species, human_threats, context,
 
   data_all <- list(
     path_to_geoms = flge$relrmd,
-    add_species_parts = add_sections(
-      species, lang, dir_tpl, ""species""
-    ),
-    add_human_threats_parts = add_sections(
-      human_threats, lang, dir_tpl, ""human_threats""
-    ),
-    add_context_parts = add_sections(context, lang, dir_tpl, ""context""),
+    add_parts = add_sections(parts, lang, dir_tpl),
     u_name = u_name,
     u_email = u_email,
     u_text = u_text,
@@ -103,10 +97,10 @@ render_full_report <- function(geoms, lang, species, human_threats, context,
 }
 
 
-add_sections <- function(files, lang, dir_in, dir_part) {
+add_sections <- function(files, lang, dir_in) {
   if (length(files)) {
     # cannot use a vector of length > 1 so lapply() is called
-    fls <- lapply(files, function(x) glue_path(dir_in, lang, dir_part, x))
+    fls <- lapply(files, function(x) glue_path(dir_in, lang, x))
     fls <- paste0(""'"", unlist(fls), ""'"")
     glue(""```{{r, child = c({glue_collapse(fls, sep = ', ')})}}\n```"")
 

---FILE: app/modules/fullReport.R---
@@ -19,16 +19,16 @@ fullReportUI <- function(id) {
             ""Aquatic Invasive Species""
           ),
           choiceValues = c(
-            ""NSARP_dist_crithab.Rmd"",
-            ""fish_inverts.Rmd"",
-            ""cetaceans.Rmd"",
-            ""aquatic_invasive.Rmd""
+            ""species/NSARP_dist_crithab.Rmd"",
+            ""species/fish_inverts.Rmd"",
+            ""species/cetaceans.Rmd"",
+            ""species/aquatic_invasive.Rmd""
           ),
           selected = c(
-            ""NSARP_dist_crithab.Rmd"",
-            ""fish_inverts.Rmd"",
-            ""cetaceans.Rmd"",
-            ""aquatic_invasive.Rmd""
+            ""species/NSARP_dist_crithab.Rmd"",
+            ""species/fish_inverts.Rmd"",
+            ""species/cetaceans.Rmd"",
+            ""species/aquatic_invasive.Rmd""
           )
         ),
         checkboxGroupInput(
@@ -39,12 +39,12 @@ fullReportUI <- function(id) {
             ""Habitat""
           ),
           choiceValues = c(
-            ""spatial_planning.Rmd"",
-            ""habitat.Rmd""
+            ""context/spatial_planning.Rmd"",
+            ""context/habitat.Rmd""
           ),
           selected = c(
-            ""spatial_planning.Rmd"",
-            ""habitat.Rmd""
+            ""context/spatial_planning.Rmd"",
+            ""context/habitat.Rmd""
           )
         ),
         checkboxGroupInput(
@@ -57,10 +57,10 @@ fullReportUI <- function(id) {
             ""Cumulative impact mapping""
           ),
           choiceValues = c(
-            ""fishing.Rmd"",
-            ""shipping.Rmd"",
-            ""miscellaneous.Rmd"",
-            ""cumulative.Rmd""
+            ""human_threats/fishing.Rmd"",
+            ""human_threats/shipping.Rmd"",
+            ""human_threats/miscellaneous.Rmd"",
+            ""human_threats/cumulative.Rmd""
           ),
         ),
       ),
@@ -143,9 +143,11 @@ fullReportServer <- function(id, geoms, preview, u_details) {
             u_email = u_details$email,
             u_text = input$u_text,
             u_comments = input$u_comments,
-            species = input$species,
-            human_threats = input$human_threats,
-            context = input$context, 
+            parts = c(
+              input$species, 
+              input$context, 
+              input$human_threats
+            ),
             fl = input$report_name
           )
           removeNotification(id)

---FILE: app/templates/EN/generic_intro.Rmd---
@@ -121,14 +121,7 @@ knitr::kable(table_tier,align=""l"",
 <!-- MAIN SECTIONS -->
 
 # **SEARCH RESULTS**  
-{{add_species_parts}}
-
-
-<!-- Human threats -->
-{{add_human_threats_parts}}
-
-<!-- EBSA -->
-{{add_context_parts}}
+{{add_parts}}
 
 <!-- GENERIC END -->
 

---FILE: app/templates/FR/generic_intro.Rmd---
@@ -45,7 +45,7 @@ Ce document résume les données régionales, y compris les renseignements sur l
 
 Le présent document est conçu comme un outil de rapport reproductible, appuyé par le langage de balisage R et généré par une interface d’application R-Shiny hébergée sur le réseau du MPO. Les résumés et les résultats des rapports sont basés sur des données extraites d’une zone de recherche fournie par l’utilisateur (un polygone d’intérêt focal) avec un tampon défini par l’utilisateur (Figure 1). Les instructions d’utilisation de l’interface R-Shiny sont fournies dans le manuel technique. En raison du caractère sensible potentiel de certaines données et informations, l’accès aux données de l’application doit être accordé, et le rapport est destiné à un usage interne uniquement.  
 
-````{r area-map-plot, fig.height=8, fig.width=11, fig.cap='Carte montrant la zone de recherche définie par l’utilisateur (entourée en rouge) pour rechercher des informations et générer automatiquement ce rapport. '}
+``{r area-map-plot, fig.height=8, fig.width=11, fig.cap='Carte montrant la zone de recherche définie par l’utilisateur (entourée en rouge) pour rechercher des informations et générer automatiquement ce rapport. '}
 
 par(mar = c(4, 4, .1, .1))
 mapDataList$areaMap
@@ -96,14 +96,7 @@ Définitions pertinentes pour les espèces inscrites en vertu de la _Loi sur les
 
 <!-- MAIN SECTIONS -->
 # **SEARCH RESULTS**  
-{{add_species_parts}}
-
-
-<!-- Human threats -->
-{{add_human_threats_parts}}
-
-<!-- EBSA -->
-{{add_context_parts}}
+{{add_parts}}
 
 <!-- GENERIC END -->
 ",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,f275cb33fcc0c4157ac103a3eb69b90bc019e98d,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-03-31T16:14:00Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-03-31T16:14:00Z,fixed various typos,reports/sections/threats/ThreatMitigation.Rmd,True,False,True,False,15,14,29,"---FILE: reports/sections/threats/ThreatMitigation.Rmd---
@@ -25,9 +25,9 @@ Click [here](#threats-results) to skip to the search results with the applicable
 
 Threats therefore encompass both natural and anthropogenic activities, and are typically required to be discussed in relation to both the species and its habitat. Threats can be both indirect (e.g., altered fire regime, reduction in prey populations, introduced species) or direct (e.g., entanglement in fishing gear) [@DFO2014_Threat]. Naturally occurring processes (e.g., aging, disease, or predation) are only considered to be threats if they have been altered by human activities, or pose a threat to a critically small or isolated population [@DFO2014_Threat]. Identifying threats and determining how they may affect each species are crucial to prioritize recovery measures and inform management decisions [@DFO2014_Threat].
 
-Threats are mentioned in many of the documents mentioned in the SARA recovery planning process (Figure \@ref(fig:sara-chart). However, due to issues such as changes in the requirements of these documents over time, and limited species information, the level of detail for threats may be varied.
+Threats are mentioned in many of the documents mentioned in the SARA recovery planning process (Figure \@ref(fig:sara-chart)). However, due to issues such as changes in the requirements of these documents over time, and limited species information, the level of detail for threats may be varied.
 
-**Mitigation** refers to the measures used to avoid, minimize, eliminate, reduce, control or offset adverse effects of each threat (adapted from the [@IAA]). 
+**Mitigation** refers to the measures used to avoid, minimize, eliminate, reduce, control or offset adverse effects of each threat (adapted from the Impact Assessment @IAA). 
 
 Similar to threats, mitigation measures are not consistently included or characterized throughout each document created as part of the SARA recovery planning process, and may have different levels of detail for each species. Generally, the most detailed information for mitigation measures for each threat are found within a species’ Action Plan (for species designated extirpated, endangered or threatened), or Management Plan (for species of special concern). Associated information within each document may include descriptions such as timelines for completion, and suggested jurisdictions/organizations to undertake each mitigation measure (e.g., government bodies, universities, industry). Mitigation measures for each threat may not be explicitly stated as such, but may instead be referred to as other terms such as “conservation measures” or “recovery measures” when addressing the proposed action for each threat.
 
@@ -43,14 +43,14 @@ Although the creation of certain documents is a requirement under SARA, delays i
 knitr::include_graphics(here::here(""reports/sections/Threats/SARAFlowchart.jpg""))
 ```
 
-##### ***Committee on the Status of Endangered Wildlife in Canada (COSEWIC)   Status Reports***
+##### ***Committee on the Status of Endangered Wildlife in Canada (COSEWIC) Status Reports***
 COSEWIC creates detailed technical reports that summarize information about the species, including threats that they face. COSEWIC compiles available data, knowledge and information about the species, and provides listing (i.e., status) recommendations to the competent minister. These reports are also intended to provide a baseline of biological information to assess a species’ status. More detailed information on the COSEWIC process can be found here: <https://www.cosewic.ca/index.php/en-ca/assessment-process/wildlife-species-assessment-process-categories-guidelines.html>
 
 The same definitions for each designations are used for species listed in Schedule 1. However, in some cases the COSEWIC and SARA designations may differ, based on factors such as the listing decision made by the Governor in Council. 
 
 COSEWIC reports are available for each species on the SAR Public Registry (Tables \@ref(tab:cosewic-table), \@ref(tab:sara-table) and <https://species-registry.canada.ca/index-en.html#/species?sortBy=commonNameSort&sortDirection=asc&pageSize=10>). 
 
-##### ***Recovery Potential Assessments:***
+##### ***Recovery Potential Assessments***
 Recovery Potential Assessments (RPAs) are documents of scientific information created by DFO Science. They are only a requirement for aquatic species and are therefore not created for non-aquatic species. DFO creates RPAs using the best available scientific information, data analyses, modelling, and expert opinion. These documents are also used to inform other processes within the SARA Recovery planning such as listing recommendations (i.e., which status to assign a species), and the creation of other documents such as Recovery Strategies and Action Plans. Specifically, RPAs consist of three main phases (sections) to assess: 
 
 1. The current/recent species status; 
@@ -73,7 +73,7 @@ RPAs are peer-reviewed by the Canadian Science Advisory Secretariat (CSAS) and c
 RPAs compiled in Tables \@ref(tab:cosewic-table) and \@ref(tab:sara-table) were obtained from the Federal Science Libraries Network by searching for “Recovery Potential Assessments” of each species (and its DU) in the Search tab: <https://science-libraries.canada.ca/eng/fisheries-oceans/>
 Alternatively, RPAs be searched for specifically by publication series type or region on the CSAS website: <http://www.dfo-mpo.gc.ca/csas-sccs/index-eng.htm>
 
-##### ***Threat Assessment:***
+##### ***Threat Assessment***
 The most detailed information regarding species threats are found within Threat Assessments. These are documents produced by DFO to characterize and prioritize threats in a nationally consistent and standardized manner. Guidelines for creating detailed information on producing Threat Assessments were developed in 2014 and can be found here [@DFO2014_Threat]: <https://waves-vagues.dfo-mpo.gc.ca/Library/363987.pdf>.  
 
 The document in the above URL provides a detailed schema for documenting threat information in a tabular format for categories such as the Likelihood of Occurrence, Level of Impact, Causal Certainty, Threat Risk, Threat Occurrence, Threat Frequency, and Threat Extent. These are then quantified and scored using standardized format (e.g., scored as extreme, high, medium, low, or unknown). Notably, Threat Assessments identify and describe threats at both the population level (also known as Designatable Unit, DU, by COSEWIC) and species level. Evaluating threats at the population level may help identify how threats can vary over a species range, which can therefore enable a better allocation of resources for threat mitigation [@DFO2014_Threat].
@@ -88,7 +88,7 @@ Because threat assessment information is standardized and comparable between spe
 ##### ***Competent Minister***
 The COSEWIC assessments for aquatic species are submitted to The Minister of Fisheries and Oceans (often referred to as “the competent Minister”). The Minister of Environment and Climate Change Canada is the competent Minister responsible for all other (i.e., non-aquatic) species. Within 90 days of receiving the COSEWIC assessment, the Minister must issue a Response Statement indicating timelines for action and how they intend to respond to the assessment. After the Response Statement is issued, the Minister goes through additional consultations with the public before sending the listing recommendation to the Governor in Council. There is no set timeline for how long these consultations may take [@mcdevitt2015_missing]. These recommendations from the Minister consider the ecological, social and economic costs and benefits of adding the species to SARA. COSEWIC assessments, RPAs and Threat Assessments help inform the ecological considerations of these recommendations. 
 
-##### ***Governor in Council:***
+##### ***Governor in Council***
 Within nine months of receiving the recommendations from the Minister, the Governor in Council must decide whether to:
 
 *	Accept the COSEWIC assessment and add the species to SARA
@@ -97,14 +97,14 @@ Within nine months of receiving the recommendations from the Minister, the Gover
 
 If a species is recommended to be added to SARA, various documents must be compiled based on its status. A Recovery Strategy must be created and posted on the SAR Public Registry within one year if the species is classified as endangered, or within two years if the species is listed as threatened or extirpated. After the Recovery Strategies are created, an Action Plan must be created for these species. There is no set timeline for completion for Action Plans, although typically an expected timeline for completion is provided in the Recovery Strategy. If a species is designated as special concern, Management Plans are created instead of Recovery Strategies and Action Plans. Management Plans must be created within three years of listing. 
 
-##### ***Recovery Strategy:***
+##### ***Recovery Strategy***
 Recovery Strategies are documents prepared by the competent minister that address threats to the species, identify critical habitat, and set the goals and objectives for species recovery. They also specify the actions taken to stop or reverse the decline of the species, although detailed planning is described in the species’ Action Plan. More information on Recovery Strategies and their goals and objectives can be found here: <https://wildlife-species.canada.ca/species-risk-registry/sar/recovery/recovery_e.cfm>
 
 A Recovery Strategy must be created and posted on the SAR Public Registry within one year for species with a SARA classification of endangered, or within two years if the species is listed as threatened or extirpated. Recovery Strategies are not created for species of special concern (Figure \@ref(fig:sara-chart)).
 
 Recovery Strategies included in Table \@ref(tab:sara-table) were obtained for each species from the SAR Public Registry: <https://species-registry.canada.ca/index-en.html#/species?sortBy=commonNameSort&sortDirection=asc&pageSize=10>
 
-##### ***Action Plan:***
+##### ***Action Plan***
 Action Plans are documents created by the competent Minister that outline how to implement the goals and objectives specified in the species’ Recovery Strategy. In particular, they identify ways to reduce threats to the species, how to protect its critical habitat, and identify which jurisdictions or organizations will implement these recovery/mitigation measures. In addition to ecological and biological considerations, Action Plans also address the socio-economic costs and benefits of these mitigation measures. Action Plans are created for species with a SARA listing of extirpated, endangered or threatened, but not for species of special concern. Under SARA, there is no set timeline for completion for Action Plans, although Recovery Strategies typically specify when an Action Plan will be completed. 
 
 Although these documents are typically only created for Schedule 1 species, the Parks Canada Agency has created multi-species Action Plans for species within National Parks or National Historic Sites. In these Action Plans, recovery measures for species that have been assessed by COSEWIC but are not in Schedule 1 may be mentioned (e.g., American Eel (*Anguilla rostrata*) with the Multi-species Action Plan for Kejimkujik National Park and National Historic Site of Canada: <https://wildlife-species.canada.ca/species-risk-registry/virtual_sara/files/plans/Ap-Kejimkujik-v00-2017Feb07-Eng.pdf>). Since these Actions Plans are available on the SAR Public Registry despite not being listed in Schedule 1, they have still been provided in Table \@ref(tab:cosewic-table) in order to have a comprehensive list of all SARA-related documents (Table \@ref(tab:cosewic-table)).
@@ -114,8 +114,8 @@ More information on Action Plans and their goals and objectives can be found her
 
 Action Plans included in Tables \@ref(tab:cosewic-table) and \@ref(tab:sara-table) were obtained for each species from the SAR Public Registry: <https://species-registry.canada.ca/index-en.html#/species?sortBy=commonNameSort&sortDirection=asc&pageSize=10>
 
-##### ***Management Plan:***
-Management Plans are created for species of special concern within 3 years of being listed. They are similar to Recovery Strategies, although they do not identify critical habitat.
+##### ***Management Plan***
+Management Plans are created for species of special concern within three years of being listed. They are similar to Recovery Strategies, although they do not identify critical habitat.
 Therefore, they address threats to the species, and set the goals and objectives for species recovery. Management Plans are not created for species listed as extirpated, endangered or threatened.
 
 More information on Management Plans and their goals and objectives can be found here:
@@ -135,6 +135,7 @@ Management Plans included in Table \@ref(tab:sara-table) were obtained for each
 #### ***SARA Recovery Planning Process documents*** {#threats-results}
 
 ```{r cosewic-table, echo = FALSE, results = ""asis""}
+options(knitr.kable.NA = """")
 knitr::kable(nonScheduleOne, align = ""l"", caption = ""Documents containing threat and threat mitigation information for aquatic species that have been assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) but are not currently listed in Schedule 1. Documents that are formally required by DFO as part of the SARA recovery planning process are provided, for species observed in any of the datasets within this Report  . The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Some species may have several COSEWIC populations, which may trigger the creation of a separate series of documents for each population. In many of the datasets in this Report, the COSEWIC population may not be known. Instead, documents have been compiled for all COSEWIC populations within the Maritimes region and surrounding area. Readers of the Report should use their best judgment to determine which set of documents may be the most applicable based on the search area. Blank entries in the table may be present for various reasons, for example, the document may still in progress but not yet published, or was not created due to a lack of resources. In addition, some documents may not be required based on the COSEWIC designation. RPAs are typically not created for species with a COSEWIC status of special concern. Typically, only species that have been included in Schedule 1 will have Action Plans. However, multi-species Action Plans have been created by Parks Canada Agency for several National Parks or National Historic Sites and are included in the table, if they are available on the species’ SAR Public Registry. RPA Research Documents may only be available in French for several species found within the Quebec region. The documents and species listed in this table are current as of December 2021. New documents or changes in listings may take place as the recovery planning process progresses."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 
 ```
@@ -151,21 +152,21 @@ Please refer to the DFO (2014) guidelines for conducting Threat Assessments for
 The Threat Assessment documents for each species are also provided in the Table captions. Users of the Report should refer to each species document for a full explanation of each table.
 
 ```{r mudpiddock-table, echo = FALSE, results = ""asis""}
-knitr::kable(mudPiddockTable, align = ""l"", caption = ""Threat assessment summary for Atlantic Mud-piddock in Canadian waters based on DFO 2014 guidance (obtained from p. 12 in https://waves-vagues.dfo-mpo.gc.ca/Library/40868308.pdf."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(mudPiddockTable, align = ""l"", caption = ""Threat assessment summary for Atlantic Mud-piddock in Canadian waters based on DFO 2014 guidance (obtained from p. 12 in https://waves-vagues.dfo-mpo.gc.ca/Library/40868308.pdf"", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 
 ```{r leatherback-table, echo = FALSE, results = ""asis""}
-knitr::kable(leatherbackTable, align = ""l"", caption = ""Threat assessment for Leatherback Sea Turtles in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO (2014) guidance (obtained from pp. 10-11 in https://waves-vagues.dfo-mpo.gc.ca/Library/40949497.pdf)."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(leatherbackTable, align = ""l"", caption = ""Threat assessment for Leatherback Sea Turtles in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO (2014) guidance (obtained from pp. 10-11 in https://waves-vagues.dfo-mpo.gc.ca/Library/40949497.pdf). Numbers in round brackets refer to Notes specified below the table."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 Notes:
 
 1. Threat risk is unknown because there have been no records of interaction in these fisheries.
 2. Fishing might not be happening all the time, but these fisheries are open year-round so, as a precautionary approach, the frequency is considered continuous.
 3. Vertical lines from fixed pots/traps/barrels.
-
+</span>
 
 ```{r loggerhead-table, echo = FALSE, results = ""asis""}
-knitr::kable(loggerheadTable, align = ""l"", caption = ""Threat assessment for the Loggerhead Sea Turtle in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO 2014a guidance (the last three rows represent threats that occur only outside of Canada. Obtained from p. 11 in https://waves-vagues.dfo-mpo.gc.ca/Library/40624201.pdf)"", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(loggerheadTable, align = ""l"", caption = ""Threat assessment for the Loggerhead Sea Turtle in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO 2014a guidance (the last three rows represent threats that occur only outside of Canada. Obtained from p. 11 in https://waves-vagues.dfo-mpo.gc.ca/Library/40624201.pdf) Numbers in round brackets refer to Notes specified below the table."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 
 ```
 Notes:",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,9e8e6f09e2a66f7ac8cf6766547eb99f04655672,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-03-30T18:39:20Z,stfinnis,stephen.finnis@dfo-mpo.gc.ca,2022-03-30T18:39:20Z,Fixed a few typos and included correct data source for each Table,reports/sections/threats/ThreatMitigation.Rmd,True,False,True,False,9,11,20,"---FILE: reports/sections/threats/ThreatMitigation.Rmd---
@@ -9,13 +9,11 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ```{r threats-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
-
 ```{r threats-load, include=FALSE}
 load_rdata(c(""threats_rr""), regionStr, env = environment())
-```
-
+``` 
+ 
 ### **Species at Risk: Threats and Mitigation**
-
 This section of the Report represents a literature review conducted by Stephen Finnis in December 2021 in an attempt to compile and summarize the available threat and mitigation information for aquatic species at risk within the DFO Maritimes region. Together, threats and threat mitigation are important for aiding species recovery, and are addressed at various stages in the SARA recovery planning process, the multi-step approach for providing legal protection for species at risk. This process is complex, and many challenges arise when attempting to compile this information in a standardized manner that is comparable for all species. This section therefore summarizes the recovery planning process and provides an overview of the various parties involved, steps, and documents created, with an emphasis on threats and threat mitigation. In addition, the documents created by DFO within this process are compiled in this section for each aquatic species at risk (i.e., those assessed by the Committee on the Status of Endangered Wildlife in Canada and/or listed within the Species at Risk Act) observed within the search area.  
 
 The SARA recovery planning process is fundamental to the work of this Report. This section is intended to be expanded upon as the Reproducible Reporting initiative develops. 
@@ -38,10 +36,10 @@ Similar to threats, mitigation measures are not consistently included or charact
 #### ***Overview of the SARA recovery planning process***
 SARA is carried out through the SARA recovery planning process, a multi-step approach aimed at addressing the goals listed above (Figure \@ref(fig:sara-chart)). This process involves various parties, actions, timelines, and documents created at each steps. Each box in the process in Figure \@ref(fig:sara-chart) is explained in more detail, and relevant documents produced by DFO are compiled for aquatic species that have been assessed by COSEWIC (Table \@ref(tab:cosewic-table)) or listed by SARA (Table \@ref(tab:sara-table)) within the search area. The entire Species at Risk Act is included online (<https://laws.justice.gc.ca/eng/acts/S-15.3/FullText.html>) and is summarized in various formats in the literature [@mcdevitt2015_missing, @montgomery2021_role, @newediuk2021_sociopolitical] and government websites (e.g., <https://www.canada.ca/en/environment-climate-change/services/species-risk-act-accord-funding/listing-process/act.html>). 
 
-Although the creation of certain documents is a requirement under SARA, delays in the process are known to occur (@mcdevitt2015_missing). In addition, many species are still under review for the addition to SARA (the full list is included here: <https://www.canada.ca/en/environment-climate-change/services/species-risk-act-accord-funding/listing-process/wildlife-species-amendment-list-schedule-1.html>). Species assessed by COSEWIC but still under consideration for Schedule 1 will therefore likely have a COSEWIC status report and Recovery Potential Assessment, but will not have a Recovery Strategy, Action Plan, or Management Plan. As well, deviations in the process may occur for some species, factors such as the availability of resources at the time. Therefore, not all of the documents listed in Figure \@ref(fig:sara-chart) may be available for each species, despite its designation . Lastly, documents which do not address threats or threat mitigation are not included in this section of the Report (e.g., Response Statements created by the DFO minister). However, these are available on the Species at Risk Registry if required (URLs are provided in Tables \@ref(tab:cosewic-table) and \@ref(tab:sara-table)). 
+Although the creation of certain documents is a requirement under SARA, delays in the process are known to occur [@mcdevitt2015_missing]. In addition, many species are still under review for the addition to SARA (the full list is included here: <https://www.canada.ca/en/environment-climate-change/services/species-risk-act-accord-funding/listing-process/wildlife-species-amendment-list-schedule-1.html>). Species assessed by COSEWIC but still under consideration for Schedule 1 will therefore likely have a COSEWIC status report and Recovery Potential Assessment, but will not have a Recovery Strategy, Action Plan, or Management Plan. As well, deviations in the process may occur for some species, factors such as the availability of resources at the time. Therefore, not all of the documents listed in Figure \@ref(fig:sara-chart) may be available for each species, despite its designation . Lastly, documents which do not address threats or threat mitigation are not included in this section of the Report (e.g., Response Statements created by the DFO minister). However, these are available on the Species at Risk Registry if required (URLs are provided in Tables \@ref(tab:cosewic-table) and \@ref(tab:sara-table)). 
 
 
-```{r sara-chart, fig.cap = ""Simplified overview of the recovery planning process under the Canadian Species at Risk Act (adapted from Newediuk et al. (2021) and McDevitte-Irwin et al. (2015)). The documents reviewed for threat information in this review are represented by the orange boxes. Orange boxes represent documents created, blue boxes represent government bodies, and green boxes represent actions taken. More detailed explanations of each box are included in the main text. Letters in white circles refer to SARA designations including EX: extirpated, T: threatened, E: endangered, and SC: special concern. The process reads from left to right, starting with the creation of the COSEWIC Status Report. Where applicable, mandated time frames are shown above the arrows, although the process may experience time delays at various steps [@mcdevitt2015_missing]. Recovery Potential Assessments (RPAs) are typically not created for species with a COSEWIC designation of special concern. Threat Assessments (not shown) are typically created as part the RPA process, and may be created as a separate document. Schedule 1 is the official federal list of wildlife species at risk."", echo=FALSE}
+```{r sara-chart, out.width = ""100%"", fig.cap = ""Simplified overview of the recovery planning process under the Canadian Species at Risk Act (adapted from Newediuk et al. (2021) and McDevitte-Irwin et al. (2015)). The documents reviewed for threat information in this review are represented by the orange boxes. Orange boxes represent documents created, blue boxes represent government bodies, and green boxes represent actions taken. More detailed explanations of each box are included in the main text. Letters in white circles refer to SARA designations including EX: extirpated, T: threatened, E: endangered, and SC: special concern. The process reads from left to right, starting with the creation of the COSEWIC Status Report. Where applicable, mandated time frames are shown above the arrows, although the process may experience time delays at various steps [@mcdevitt2015_missing]. Recovery Potential Assessments (RPAs) are typically not created for species with a COSEWIC designation of special concern. Threat Assessments (not shown) are typically created as part the RPA process, and may be created as a separate document. Schedule 1 is the official federal list of wildlife species at risk."", echo=FALSE}
 knitr::include_graphics(here::here(""reports/sections/Threats/SARAFlowchart.jpg""))
 ```
 
@@ -137,13 +135,13 @@ Management Plans included in Table \@ref(tab:sara-table) were obtained for each
 #### ***SARA Recovery Planning Process documents*** {#threats-results}
 
 ```{r cosewic-table, echo = FALSE, results = ""asis""}
-knitr::kable(mtcars[1:5,], align = ""l"", caption = ""Documents containing threat and threat mitigation information for aquatic species that have been assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) but are not currently listed in Schedule 1. Documents that are formally required by DFO as part of the SARA recovery planning process are provided, for species observed in any of the datasets within this Report  . The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Some species may have several COSEWIC populations, which may trigger the creation of a separate series of documents for each population. In many of the datasets in this Report, the COSEWIC population may not be known. Instead, documents have been compiled for all COSEWIC populations within the Maritimes region and surrounding area. Readers of the Report should use their best judgment to determine which set of documents may be the most applicable based on the search area. Blank entries in the table may be present for various reasons, for example, the document may still in progress but not yet published, or was not created due to a lack of resources. In addition, some documents may not be required based on the COSEWIC designation. RPAs are typically not created for species with a COSEWIC status of special concern. Typically, only species that have been included in Schedule 1 will have Action Plans. However, multi-species Action Plans have been created by Parks Canada Agency for several National Parks or National Historic Sites and are included in the table, if they are available on the species’ SAR Public Registry. RPA Research Documents may only be available in French for several species found within the Quebec region. The documents and species listed in this table are current as of December 2021. New documents or changes in listings may take place as the recovery planning process progresses."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(nonScheduleOne, align = ""l"", caption = ""Documents containing threat and threat mitigation information for aquatic species that have been assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) but are not currently listed in Schedule 1. Documents that are formally required by DFO as part of the SARA recovery planning process are provided, for species observed in any of the datasets within this Report  . The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Some species may have several COSEWIC populations, which may trigger the creation of a separate series of documents for each population. In many of the datasets in this Report, the COSEWIC population may not be known. Instead, documents have been compiled for all COSEWIC populations within the Maritimes region and surrounding area. Readers of the Report should use their best judgment to determine which set of documents may be the most applicable based on the search area. Blank entries in the table may be present for various reasons, for example, the document may still in progress but not yet published, or was not created due to a lack of resources. In addition, some documents may not be required based on the COSEWIC designation. RPAs are typically not created for species with a COSEWIC status of special concern. Typically, only species that have been included in Schedule 1 will have Action Plans. However, multi-species Action Plans have been created by Parks Canada Agency for several National Parks or National Historic Sites and are included in the table, if they are available on the species’ SAR Public Registry. RPA Research Documents may only be available in French for several species found within the Quebec region. The documents and species listed in this table are current as of December 2021. New documents or changes in listings may take place as the recovery planning process progresses."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 
 ```
 
 
 ```{r sara-table, echo = FALSE, results = ""asis""}
-knitr::kable(mtcars[1:5,], align = ""l"", caption = ""Documents containing threat and threat mitigation information for aquatic species that are listed in Schedule 1, if they have been observed in any of the datasets within this Report. Documents included are those formally required by DFO as part of the SARA recovery planning process are provided. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Some species may have several COSEWIC populations, which may trigger the creation of a separate series of documents for each population. In many of the datasets in this Report, the COSEWIC population may not be known. Instead, documents have been compiled for all COSEWIC populations within the Maritimes region and surrounding area. Readers of the Report should use their best judgment to determine which set of documents may be the most applicable based on the search area. Blank entries in the table may be present for various reasons, for example, the document may still in progress but not yet published, or was not created due to a lack of resources. In addition, some documents may not be required based on the COSEWIC designation. RPAs are typically not created for species with a COSEWIC status of special concern. Recovery Strategies and Action Plans are created for species with a SARA designation of threatened, extirpated or endangered, while Management Plans are instead created for species with a SARA designation of special concern. RPA Research Documents may only be available in French for several species found within the Quebec region. The documents and species listed in this table are current as of December 2021. New documents or changes in listings may take place as the recovery planning process progresses."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(scheduleOne, align = ""l"", caption = ""Documents containing threat and threat mitigation information for aquatic species that are listed in Schedule 1, if they have been observed in any of the datasets within this Report. Documents included are those formally required by DFO as part of the SARA recovery planning process are provided. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Some species may have several COSEWIC populations, which may trigger the creation of a separate series of documents for each population. In many of the datasets in this Report, the COSEWIC population may not be known. Instead, documents have been compiled for all COSEWIC populations within the Maritimes region and surrounding area. Readers of the Report should use their best judgment to determine which set of documents may be the most applicable based on the search area. Blank entries in the table may be present for various reasons, for example, the document may still in progress but not yet published, or was not created due to a lack of resources. In addition, some documents may not be required based on the COSEWIC designation. RPAs are typically not created for species with a COSEWIC status of special concern. Recovery Strategies and Action Plans are created for species with a SARA designation of threatened, extirpated or endangered, while Management Plans are instead created for species with a SARA designation of special concern. RPA Research Documents may only be available in French for several species found within the Quebec region. The documents and species listed in this table are current as of December 2021. New documents or changes in listings may take place as the recovery planning process progresses."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 
 There are three available Threat assessment documents for Schedule 1 species in the Maritimes region. 
@@ -153,11 +151,11 @@ Please refer to the DFO (2014) guidelines for conducting Threat Assessments for
 The Threat Assessment documents for each species are also provided in the Table captions. Users of the Report should refer to each species document for a full explanation of each table.
 
 ```{r mudpiddock-table, echo = FALSE, results = ""asis""}
-knitr::kable(mtcars[1:5,], align = ""l"", caption = ""Threat assessment summary for Atlantic Mud-piddock in Canadian waters based on DFO 2014 guidance (obtained from p. 12 in <https://waves-vagues.dfo-mpo.gc.ca/Library/40868308.pdf)>."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(mudPiddockTable, align = ""l"", caption = ""Threat assessment summary for Atlantic Mud-piddock in Canadian waters based on DFO 2014 guidance (obtained from p. 12 in https://waves-vagues.dfo-mpo.gc.ca/Library/40868308.pdf."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 
 ```{r leatherback-table, echo = FALSE, results = ""asis""}
-knitr::kable(mtcars[1:5,], align = ""l"", caption = ""Threat assessment for Leatherback Sea Turtles in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO (2014) guidance (obtained from pp. 10-11 in <https://waves-vagues.dfo-mpo.gc.ca/Library/40949497.pdf>)."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(leatherbackTable, align = ""l"", caption = ""Threat assessment for Leatherback Sea Turtles in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO (2014) guidance (obtained from pp. 10-11 in https://waves-vagues.dfo-mpo.gc.ca/Library/40949497.pdf)."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 Notes:
 
@@ -167,7 +165,7 @@ Notes:
 
 
 ```{r loggerhead-table, echo = FALSE, results = ""asis""}
-knitr::kable(mtcars[1:5,], align = ""l"", caption = ""Threat assessment for the Loggerhead Sea Turtle in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO 2014a guidance (the last three rows represent threats that occur only outside of Canada.) (obtained from p. 11 in <https://waves-vagues.dfo-mpo.gc.ca/Library/40624201.pdf>)."", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(loggerheadTable, align = ""l"", caption = ""Threat assessment for the Loggerhead Sea Turtle in the Broader Northwest Atlantic Population and in Atlantic Canadian waters based on DFO 2014a guidance (the last three rows represent threats that occur only outside of Canada. Obtained from p. 11 in https://waves-vagues.dfo-mpo.gc.ca/Library/40624201.pdf)"", booktabs = T, escape = F, linesep="""") %>% kableExtra::kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 
 ```
 Notes:",False,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,65414d038a67b4cf31830c7779caebc6b7a6cebb,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T17:24:03Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T17:24:03Z,"clean up error catching, table working, #51",reports/R/intersectFunctions.R;reports/sections/benthicEffort/benthicEffort_en.Rmd,True,True,True,False,3,7,10,"---FILE: reports/R/intersectFunctions.R---
@@ -43,14 +43,12 @@ master_intersect <- function(data_sf, mapDataList, getRegion=FALSE, ...) {
   if (inherits(data_sf, ""RasterLayer"")) {
     raster_sf <- sf::st_as_sfc(sf::st_bbox(data_sf))
     if (getRegion & (length(sf::st_intersection(raster_sf, mapDataList$region)) > 0)) {
-      region_sp <- sf::as_Spatial(mapDataList$region)
-      regionData <- raster::crop(data_sf, region_sp)
+      regionData <- raster::crop(data_sf, sf::as_Spatial(mapDataList$region))
     } else {
       regionData <- NULL
     }
     if (length(sf::st_intersection(raster_sf, sf::st_as_sf(mapArea))) > 0) {
-      map_sp <- sf::as_Spatial(mapArea)
-      mapData <- raster::crop(data_sf, map_sp)
+      mapData <- raster::crop(data_sf, sf::as_Spatial(mapArea))
     } else {
       mapData <- NULL
     }

---FILE: reports/sections/benthicEffort/benthicEffort_en.Rmd---
@@ -37,12 +37,10 @@ writeLines(noquote(benthicEffort_rr$text$en))
 
 #### ***Area-specific fishing effort search results***
 
-```{r benthicEffort-results, echo=TRUE, error=TRUE, message=FALSE, results='asis'}
-
+```{r benthicEffort-results, echo=FALSE, results='asis'}
 outputListBenthicEffort <- master_intersect(benthicEffort_rr$data_sf, mapDataList,
                                            getRegion=TRUE)
 
-
 ```
 
 ```{r benthicEffort-haTable, echo=FALSE, results='asis'}",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,4a93c5745aa48eeb846df6c2d284e1f5ebad0aea,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T17:18:29Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T17:18:29Z,fix raster voodoo in master intersect,app/ui.R;reports/R/intersectFunctions.R;reports/R/plotFunctions.R;reports/sections/benthicEffort/benthicEffort_en.Rmd;reports/sections/commonSections/commonHA.Rmd;reports/sections/commonSections/commonIntro.Rmd;reports/sections/docks/docks_en.rmd;reports/sections/lobsterEffort/lobsterEffort_en.rmd;reports/sections/nitroLoad/nitroLoad_en.rmd;reports/sections/power/power_en.rmd;reports/sections/waste/waste_en.rmd,True,True,True,False,49,36,85,"---FILE: app/ui.R---
@@ -72,6 +72,17 @@ ui <- fluidPage(
               # Three selections panels
               tabsetPanel(
 
+                tabPanel(
+                  ""Draw from map"",
+                  myhelptxt(""Use the interactive map on the right side to create geometries (points, lines or polygons).""),
+                  numericInput(""from_map_buffer"", label = ""Optional buffer (m)"", value = ""0"", min = 0),
+                  myhelptxt(""Save created geometry for use when generating report.""),
+                  actionButton('save_from_map', 'Save from map', icon = icon(""download"")),
+                  hspace(2),
+                  uiOutput(""created_from_map"", inline = TRUE),
+                  uiOutput(""from_map_not"", inline = TRUE)
+                ),
+                
                 tabPanel(
                   ""Bounding box"",
                   myhelptxt(""Use the fields below to create a bounding box.""),
@@ -113,17 +124,6 @@ ui <- fluidPage(
                   actionButton('save_pt', 'Save', icon = icon(""download""))
                 ),
 
-                tabPanel(
-                  ""Draw from map"",
-                  myhelptxt(""Use the interactive map on the right side to create geometries (points, lines or polygons).""),
-                  numericInput(""from_map_buffer"", label = ""Optional buffer (m)"", value = ""0"", min = 0),
-                  myhelptxt(""Save created geometry for use when generating report.""),
-                  actionButton('save_from_map', 'Save from map', icon = icon(""download"")),
-                  hspace(2),
-                  uiOutput(""created_from_map"", inline = TRUE),
-                  uiOutput(""from_map_not"", inline = TRUE)
-                ),
-
                 tabPanel(
                   ""Import files"",
                   myhelptxt(""Import your own file. The file will be read by

---FILE: reports/R/intersectFunctions.R---
@@ -1,3 +1,6 @@
+library(raster)
+library(sp)
+
 # The functions in this file are used to clip various data sources (e.g. MARFIS, ISDB, etc.)
 # with the studyArea selected and summarize the data for tables within the final document.
 #
@@ -38,14 +41,16 @@ master_intersect <- function(data_sf, mapDataList, getRegion=FALSE, ...) {
   mapArea <- sf::st_as_sfc(mapDataList$bboxMap)
 
   if (inherits(data_sf, ""RasterLayer"")) {
-    raster_sf <- sf::st_as_sfc(st_bbox(data_sf))
+    raster_sf <- sf::st_as_sfc(sf::st_bbox(data_sf))
     if (getRegion & (length(sf::st_intersection(raster_sf, mapDataList$region)) > 0)) {
-      regionData <- raster::crop(data_sf, mapDataList$region)
+      region_sp <- sf::as_Spatial(mapDataList$region)
+      regionData <- raster::crop(data_sf, region_sp)
     } else {
       regionData <- NULL
     }
     if (length(sf::st_intersection(raster_sf, sf::st_as_sf(mapArea))) > 0) {
-      mapData <- raster::crop(data_sf, region_sf)
+      map_sp <- sf::as_Spatial(mapArea)
+      mapData <- raster::crop(data_sf, map_sp)
     } else {
       mapData <- NULL
     }

---FILE: reports/R/plotFunctions.R---
@@ -383,10 +383,10 @@ scale_bar_layer <- function(data_sf, attribute, continuous, minValue, maxValue,
     }
     if (fill){
       scaleBarLayer <- scale_fill_continuous(type=""viridis"", name=legendName, 
-                                             labels = comma, limits=c(minValue, maxValue))    
+                                             labels = scales::comma, limits=c(minValue, maxValue))    
     } else {
       scaleBarLayer <- scale_color_continuous(type=""viridis"", name=legendName, 
-                                             labels = comma, limits=c(minValue, maxValue))  
+                                             labels = scales::comma, limits=c(minValue, maxValue))  
     }
     
   } else {

---FILE: reports/sections/benthicEffort/benthicEffort_en.Rmd---
@@ -5,13 +5,14 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
+
 ```{r benthic-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ```
 
-```{r benthic-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")} 
+```{r benthic-load-common-ha, child = here::here(""reports/sections/commonSections/commonHA.Rmd"")} 
 ``` 
 
-```{r eval=FALSE}
+```{r eval = FALSE}
 if (FALSE) { #load in data:
   lapply(list.files(here::here(""reports/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) 
@@ -36,14 +37,17 @@ writeLines(noquote(benthicEffort_rr$text$en))
 
 #### ***Area-specific fishing effort search results***
 
-```{r benthicEffort-results, echo=FALSE, results='asis'}
-outputListBenthicEffort <- master_intersect(benthicEffort_rr$data_sf, mapDataList, getRegion=TRUE)
+```{r benthicEffort-results, echo=TRUE, error=TRUE, message=FALSE, results='asis'}
+
+outputListBenthicEffort <- master_intersect(benthicEffort_rr$data_sf, mapDataList,
+                                           getRegion=TRUE)
+
 
 ```
 
 ```{r benthicEffort-haTable, echo=FALSE, results='asis'}
 if (!is.null(outputListBenthicEffort$studyData)) {
-  rrEnv$haClassTable$Benthic.Fishing.Effort <- list(""Coastal"" = FALSE, 
+  rrEnv$haClassTable$`Benthic Fishing Effort` <- list(""Coastal"" = FALSE, 
                                                     ""Offshore"" = TRUE, 
                                                     ""Shoreline"" = FALSE)
 }

---FILE: reports/sections/commonSections/commonIntro.Rmd---
@@ -21,7 +21,7 @@ if (!exists(""mapDataList"")){
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) # last area from app.
   intro_setup(studyArea, env = environment())
   #  need to reset this variable here.
-  assign(""rrEnv"", new.env(), envir = knitr::knit_global())
+  assign(""rrEnv"", new.env(), envir =environment())
   rrEnv$commonObis <- TRUE
 
 }

---FILE: reports/sections/docks/docks_en.rmd---
@@ -9,10 +9,10 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ```{r docks-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r docks-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")} 
+```{r docks-load-common-ha, child = here::here(""reports/sections/commonSections/commonHA.Rmd"")} 
 ``` 
 
-```{r eval = False}
+```{r eval = FALSE}
 if (FALSE) { 
   # load in generic data, e.g.functions, study area, and base maps into the 
   # environment, when knitting, these will be loaded through the child rmd.
@@ -45,14 +45,15 @@ writeLines(noquote(docks_rr$text$en))
 #### ***Area-specific man-made solid results***
 ```{r docks-results, include=FALSE, cache=FALSE}
 # clip the data to the Study and Map areas:
-docksOutputList <- master_intersect(docks_rr$data_sf, mapDataList, getRegion=TRUE)
+docksOutputList <- master_intersect(docks_rr$data_sf, mapDataList,
+                                    getRegion=TRUE)
 
 ```
 
 
 ```{r docks-haTable, echo=FALSE, results='asis'}
 if (!is.null(docksOutputList$studyData)) {
-  rrEnv$haClassTable$Manmade.Structures <- list(""Coastal"" = FALSE, 
+  rrEnv$haClassTable$`Manmade Structures` <- list(""Coastal"" = FALSE, 
                                                 ""Offshore"" = FALSE, 
                                                 ""Shoreline"" = TRUE)
 }

---FILE: reports/sections/lobsterEffort/lobsterEffort_en.rmd---
@@ -9,16 +9,18 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ```{r lobsterEffort-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r lobsterEffort-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivties.Rmd"")}
+```{r lobsterEffort-load-common-ha, child = here::here(""reports/sections/commonSections/commonHA.Rmd"")}
 ```
 
-```{r eval=False}
+```{r eval=FALSE}
 if (FALSE) { 
   # load in generic data, e.g.functions, study area, and base maps into the 
   # environment, when knitting, these will be loaded through the child rmd.
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson""))
   intro_setup(studyArea, env = environment())
+  assign(""rrEnv"", new.env(), envir=globalenv())
+  rrEnv$haClassTable <- data.frame(row.names=c(""Coastal"", ""Shoreline"", ""Offshore""))
 }
 ```
 
@@ -51,7 +53,7 @@ lobsterOutputList <- master_intersect(lobsterEffort_rr$data_sf, mapDataList, get
 
 ```{r lobsterEffort-haTable, echo=FALSE, results='asis'}
 if (!is.null(lobsterOutputList$studyData)) {
-  rrEnv$haClassTable$Lobster.Effort <- list(""Coastal"" = TRUE, 
+  rrEnv$haClassTable$`Lobster Effort` <- list(""Coastal"" = TRUE, 
                                             ""Offshore"" = FALSE, 
                                             ""Shoreline"" = TRUE)
 }
@@ -72,7 +74,8 @@ if (!is.null(lobsterOutputList$studyData)) {
     plot(plot_rr_sf(regionMap, lobsterOutputList$regionData, 
                     attribute=lobsterEffort_rr$attribute, 
                     legendName=""Catch weight (kg/yr)"", 
-                    continuousAttr=TRUE))}
+                    continuousAttr=TRUE))
+  }
 ```
 
 ```{r lobsterEffort-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(lobsterEffort_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query lobster fishing effort records.')}

---FILE: reports/sections/nitroLoad/nitroLoad_en.rmd---
@@ -9,10 +9,10 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ```{r nitroLoad-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r nitroLoad-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivties.Rmd"")}
+```{r nitroLoad-load-common-ha, child = here::here(""reports/sections/commonSections/commonHA.Rmd"")}
 ```
 
-```{r eval=False}
+```{r eval=FALSE}
 if (FALSE) { 
   # load in generic data, e.g.functions, study area, and base maps into the 
   # environment, when knitting, these will be loaded through the child rmd.
@@ -54,7 +54,7 @@ deltaOutputList <- master_intersect(deltaNitroLoad_rr$data_sf, mapDataList, getR
 
 ```{r nitroLoad-haTable, echo=FALSE, results='asis'}
 if (!is.null(totalOutputList$studyData)) {
-  rrEnv$haClassTable$Nitrogen.Loading <- list(""Coastal"" = TRUE, 
+  rrEnv$haClassTable$`Nitrogen Loading` <- list(""Coastal"" = TRUE, 
                                             ""Offshore"" = TRUE, 
                                             ""Shoreline"" = TRUE)
 }

---FILE: reports/sections/power/power_en.rmd---
@@ -9,7 +9,7 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ```{r power-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r power-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")}
+```{r power-load-common-ha, child = here::here(""reports/sections/commonSections/commonHA.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/waste/waste_en.rmd---
@@ -9,10 +9,10 @@ bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ```{r waste-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r waste-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")}
+```{r waste-load-common-ha, child = here::here(""reports/sections/commonSections/commonHA.Rmd"")}
 ```
 
-```{r eval=False}
+```{r eval=FALSE}
 if (FALSE) { 
   # load in generic data, e.g.functions, study area, and base maps into the 
   # environment, when knitting, these will be loaded through the child rmd.",True,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,974614c521b0dc8fee4d5705df9c9b86fd72b0b9,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T13:56:58Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T13:56:58Z,"fix isdb-marfis tables for null case, fix comments",app/modules/fullReport.R;reports/R/tableFunctions.R;reports/sections/isdb-marfis/isdbMarfis_en.Rmd,True,True,True,False,26,12,38,"---FILE: app/modules/fullReport.R---
@@ -81,7 +81,7 @@ fullReportUI <- function(id) {
           label = ""Subtitle"",
           value = ""Synthesis prepared by the Reproducible Reporting Team, steering committee and advisors in Maritimes Region.""
         ),
-        textAreaInput(""u_comments"", label = ""Comments"", value = """"),
+        textAreaInput(ns(""u_comments""), label = ""Comments"", value = """"),
         textInput(
           ns(""report_name""),
           label = ""Report filename (optional, do not specify the file extension)"",

---FILE: reports/R/tableFunctions.R---
@@ -218,6 +218,8 @@ create_table_MARFIS <- function(data_sf, sarTable, speciesTable, ...) {
     sarData <- dplyr::select(sarData, 'Scientific Name', 'Common Name',
                              ""SARA status"",""COSEWIC status"", Records)
     sarData$`Scientific Name` <- italicize_col(sarData$`Scientific Name`)
+    sarData <- sarData[with(sarData, order(-Records)), ]
+    row.names(sarData) <- NULL
   }
   
 
@@ -232,9 +234,8 @@ create_table_MARFIS <- function(data_sf, sarTable, speciesTable, ...) {
 
   # order the tables by number of Records (decreasing)
   allSpeciesData <- allSpeciesData[with(allSpeciesData, order(-Records)), ]
-  sarData <- sarData[with(sarData, order(-Records)), ]
+  
   row.names(allSpeciesData) <- NULL
-  row.names(sarData) <- NULL
   outList <- list(""allSpeciesData"" = allSpeciesData, ""sarData"" = sarData)
   return(outList)
 }

---FILE: reports/sections/isdb-marfis/isdbMarfis_en.Rmd---
@@ -89,22 +89,35 @@ writeLines(Report_marfis)
 ```
 
 ```{r isdb-SAR-table}
-if (!is.null(outputListI$studyData)) {
-knitr::kable(isdbSarTable, align=""l"", caption=paste(write_caption_blurb(isdb_rr, ""EN""), ""Industry Survey Database (ISDB) records of species observed within the search area and listed by the <i>Species at Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+if (!is.null(isdbSarTable)) {
+    if (nrow(isdbSarTable) > 0) {
+
+knitr::kable(isdbSarTable, align=""l"", caption=paste(write_caption_blurb(isdb_rr, ""EN""), ""Industry Survey Database (ISDB) records of species observed within the search area and listed by the <i>Species at Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+      }
+  } 
 ```
 <br><br>
 ```{r isdb-all-table}
-if (!is.null(outputListI$studyData)) {
-  knitr::kable(isdbAllTable, align=""l"", caption=paste(write_caption_blurb(isdb_rr, ""EN""), ""Industry Survey Database (ISDB) records of <u>all species</u> observed within the search area, summarized by species or species group. Records do not necessarily correspond to number of individuals. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+if (!is.null(isdbAllTable)) {
+  if (nrow(isdbAllTable) > 0) {
+  knitr::kable(isdbAllTable, align=""l"", caption=paste(write_caption_blurb(isdb_rr, ""EN""), ""Industry Survey Database (ISDB) records of <u>all species</u> observed within the search area, summarized by species or species group. Records do not necessarily correspond to number of individuals. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+    }
+  } 
 ```
 
 ```{r marfis-SAR-table}
-if (!is.null(outputListM$studyData)) {
-  knitr::kable(marfisSarTable, align=""l"", caption=paste(write_caption_blurb(marfis_rr, ""EN""), ""Maritimes Fishery Information System (MARFIS) records of species observed within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+if (!is.null(marfisSarTable)) {
+    if (nrow(marfisSarTable) > 0) {
+  knitr::kable(marfisSarTable, align=""l"", caption=paste(write_caption_blurb(marfis_rr, ""EN""), ""Maritimes Fishery Information System (MARFIS) records of species observed within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+      }
+  } 
 ```
 <br><br>
 ```{r marfis-all-table}
-if (!is.null(outputListM$studyData)) {
-  knitr::kable(marfisAllTable, caption=paste(write_caption_blurb(marfis_rr, ""EN""), ""Maritimes Fishery Information System (MARFIS) records of <u>all species</u> observed within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""")  %>% column_spec(1, width=""15cm"")
-} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+if (!is.null(marfisAllTable)) {
+      if (nrow(marfisAllTable) > 0) {
+  knitr::kable(marfisAllTable, caption=paste(write_caption_blurb(marfis_rr, ""EN""), ""Maritimes Fishery Information System (MARFIS) records of <u>all species</u> observed within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""")  %>% column_spec(1, width=""15cm"") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+      }
+  }
+
 ```",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,13f6528fcbd27f0f5b004823f0a6fd09d2215bb8,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T12:42:31Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-24T12:42:31Z,fix reports paths,app/templates/EN/human_threats/cumulative.Rmd;reports/sections/commonSections/commonIntro.Rmd;reports/sections/docks/docks_en.rmd;reports/sections/docks/docks_fr.rmd;reports/sections/lobsterEffort/lobsterEffort_en.rmd;reports/sections/lobsterEffort/lobsterEffort_fr.rmd;reports/sections/nitroLoad/nitroLoad_en.rmd;reports/sections/nitroLoad/nitroLoad_fr.rmd;reports/sections/power/power_en.rmd;reports/sections/power/power_fr.rmd;reports/sections/waste/waste_en.rmd;reports/sections/waste/waste_fr.rmd,True,False,True,False,22,21,43,"---FILE: app/templates/EN/human_threats/cumulative.Rmd---
@@ -1,24 +1,24 @@
 ## Cumulative impact mapping 
 
-```{r child = here::here(""sections/nitroLoad/nitroLoad_en.rmd"")}
+```{r child = here::here(""reports/sections/nitroLoad/nitroLoad_en.rmd"")}
 ```
 
-```{r child = here::here(""sections/docks/docks_en.rmd"")}
+```{r child = here::here(""reports/sections/docks/docks_en.rmd"")}
 ```
 
-```{r child = here::here(""sections/waste/waste_en.rmd"")}
+```{r child = here::here(""reports/sections/waste/waste_en.rmd"")}
 ```
 
-```{r child = here::here(""sections/power/power_en.rmd"")}
+```{r child = here::here(""reports/sections/power/power_en.rmd"")}
 ```
 
 
 ## Fishing
 
-```{r child = here::here(""sections/benthicEffort/benthicEffort_en.rmd"")}
+```{r child = here::here(""reports/sections/benthicEffort/benthicEffort_en.rmd"")}
 ```
 
-```{r child = here::here(""sections/lobsterEffort/lobsterEffort_en.rmd"")}
+```{r child = here::here(""reports/sections/lobsterEffort/lobsterEffort_en.rmd"")}
 ```
 
 

---FILE: reports/sections/commonSections/commonIntro.Rmd---
@@ -21,7 +21,8 @@ if (!exists(""mapDataList"")){
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) # last area from app.
   intro_setup(studyArea, env = environment())
   #  need to reset this variable here.
-  rrEnv <- new.env()
+  assign(""rrEnv"", new.env(), envir = knitr::knit_global())
   rrEnv$commonObis <- TRUE
+
 }
 ```

---FILE: reports/sections/docks/docks_en.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r docks-load-common, child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r docks-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r docks-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")} 

---FILE: reports/sections/docks/docks_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 if (FALSE) { # load in generic data, e.g.functions, study area, and base maps:
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   

---FILE: reports/sections/lobsterEffort/lobsterEffort_en.rmd---
@@ -6,10 +6,10 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r lobsterEffort-load-common, child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r lobsterEffort-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r lobsterEffort-load-common-ha, child = here::here(""sections/commonSections/commonHumanActivties.Rmd"")}
+```{r lobsterEffort-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivties.Rmd"")}
 ```
 
 ```{r eval=False}

---FILE: reports/sections/lobsterEffort/lobsterEffort_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 if (FALSE) { # load in generic data, e.g.functions, study area, and base maps:
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   

---FILE: reports/sections/nitroLoad/nitroLoad_en.rmd---
@@ -6,10 +6,10 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r nitroLoad-load-common, child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r nitroLoad-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r nitroLoad-load-common-ha, child = here::here(""sections/commonSections/commonHumanActivties.Rmd"")}
+```{r nitroLoad-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivties.Rmd"")}
 ```
 
 ```{r eval=False}

---FILE: reports/sections/nitroLoad/nitroLoad_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 if (FALSE) { # load in generic data, e.g.functions, study area, and base maps:
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   

---FILE: reports/sections/power/power_en.rmd---
@@ -6,10 +6,10 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r power-load-common, child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r power-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r power-load-common-ha, child = here::here(""sections/commonSections/commonHumanActivities.Rmd"")}
+```{r power-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/power/power_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 if (FALSE) { # load in generic data, e.g.functions, study area, and base maps:
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   

---FILE: reports/sections/waste/waste_en.rmd---
@@ -6,10 +6,10 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r waste-load-common, child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r waste-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
-```{r waste-load-common-ha, child = here::here(""sections/commonSections/commonHumanActivities.Rmd"")}
+```{r waste-load-common-ha, child = here::here(""reports/sections/commonSections/commonHumanActivities.Rmd"")}
 ```
 
 ```{r eval=False}

---FILE: reports/sections/waste/waste_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 if (FALSE) { # load in generic data, e.g.functions, study area, and base maps:
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source)
   ",False,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,c8dda2d7b0e2dc2e50505f6faee53c525dd5d608,Kevin Cazelles,kevin.cazelles@insileco.io,2022-03-13T00:29:40Z,Kevin Cazelles,kevin.cazelles@insileco.io,2022-03-13T00:40:48Z,"Improve user details validation

The validation functions were home-made ones and pretty basic.
Fortunately shinyvalidate offer and function that can validate
the content of inputs and also provide a visual feedback to users
so they can fixed the problem. Also a reactive values properly
setup was added to handle the user consent in a better way.",.gitignore;app/R/helpers.R;app/R/renderReport.R;app/global.R;app/modules/customReport.R;app/modules/fullReport.R;app/server.R;app/www/wrong.html,False,True,True,False,72,43,115,"---FILE: .gitignore---
@@ -16,6 +16,7 @@ app/www/*.html
 app/www/reports/*
 !app/www/reports/.gitkeep
 !app/www/empty_report.html
+!app/www/wrong.html
 
 
 *.log

---FILE: app/R/helpers.R---
@@ -71,7 +71,7 @@ switch_ext <- function(x, y) {
 # clear extra HTML in www
 clear_www_html <- function() {
   html_fl <- list.files(""www"", pattern = ""*.html$"", full.names = TRUE)
-  donotrm <- paste0(""www/"", c(""empty_report""), "".html"")
+  donotrm <- paste0(""www/"", c(""empty_report"", ""wrong""), "".html"")
   file.remove(html_fl[! html_fl %in% donotrm])
 }
 

---FILE: app/R/renderReport.R---
@@ -97,7 +97,7 @@ render_full_report <- function(geoms, lang, species, human_threats, context,
     # this is done to generate a html preview (see ""report"" tab)
     html <- switch_ext(basename(rmd_ready), ""html"")
     preview_html <- glue_path(""www"", ""reports"", html)
-    msgInfo(""Copying HTML"")
+    msgInfo(""Copying HTML to www/"")
     jj <- file.copy(
       glue_path(dir_out, html), 
       preview_html,

---FILE: app/global.R---
@@ -1,12 +1,12 @@
 # PACKAGES 
 library(shiny)
 library(shinyjs)
+library(shinyvalidate)
 library(leaflet)
 library(leafem)
 library(mapedit)
 library(sf)
 library(glue)
-library(shinyvalidate)
 
 
 # load R scripts (including packages)

---FILE: app/modules/customReport.R---
@@ -29,22 +29,21 @@ customReportUI <- function(id) {
 }
 
 
-customReportServer <- function(id, geoms, preview, u_name, u_email, u_consent) {
+customReportServer <- function(id, geoms, preview, u_details) {
   moduleServer(
     id,
     function(input, output, session) {
       
       shinyjs::hide(id = ""report_dl"")
       
       observeEvent(input$report_gen, {
-        # print(u_consent)
-        # print(u_name)
-        if (length(u_consent) != 3) {
+        if (!u_details$consent) {
           showNotification(
             ""Please abide by terms and conditions in 'User' tab."", 
             type = ""error""
           )
         } else {
+          shinyjs::hide(id = ""report_dl"")
           # Check and save geom 
           msgInfo(""Saving geoms"")
           if (is.null(geoms$final)) {
@@ -72,8 +71,8 @@ customReportServer <- function(id, geoms, preview, u_name, u_email, u_consent) {
             whisker::whisker.render(
               readLines(tpl, warn = FALSE), 
               list(
-                u_name = u_name,
-                u_email = u_email,
+                u_name = u_details$name,
+                u_email = u_details$email,
                 u_text = ""Synthesis prepared by the Reproducible Reporting Team, steering committee and advisors in Maritimes Region.""
               )
             ),  

---FILE: app/modules/fullReport.R---
@@ -110,7 +110,7 @@ fullReportUI <- function(id) {
 
 
 
-fullReportServer <- function(id, geoms, preview, u_name, u_email, u_consent) {
+fullReportServer <- function(id, geoms, preview, u_details) {
 
   moduleServer(
     id,
@@ -121,7 +121,7 @@ fullReportServer <- function(id, geoms, preview, u_name, u_email, u_consent) {
 
       observeEvent(input$generate_rmd, {
         
-        if (length(u_consent) != 3) {
+        if (!u_details$consent) {
           output$render_success <- info_valid(""Please abide by terms and conditions in 'User' tab."", FALSE)
         } else {
           shinyjs::hide(id = ""outputs_dl"")
@@ -139,8 +139,8 @@ fullReportServer <- function(id, geoms, preview, u_name, u_email, u_consent) {
           chk <- render_full_report(
             geoms = geoms$final,
             lang = input$lang,
-            u_name = u_name, 
-            u_email = u_email,
+            u_name = u_details$name, 
+            u_email = u_details$email,
             u_text = input$u_text,
             u_comments = input$u_comments,
             species = input$species,
@@ -177,11 +177,12 @@ fullReportServer <- function(id, geoms, preview, u_name, u_email, u_consent) {
                 on.exit(removeNotification(id), add = TRUE)
                 fs::file_copy(pagedown::chrome_print(preview$full_html), file)
               })
-            
-            
+
           } else {
             showNotification(""Abort rendering"", type = ""error"")
+            preview$full_html <- ""www/wrong.html""
             output$render_success <- info_valid(chk$msg, FALSE)
+            print(preview$full_html)
             shinyjs::hide(id = ""outputs_dl"")
             shinyjs::hide(id = ""report_dl"")
           }

---FILE: app/server.R---
@@ -15,27 +15,37 @@ server <- function(input, output, session) {
   })
 
   # VALID AND STORE USER INFO
+  u_details <- reactiveValues(
+    name = NULL,
+    email = NULL,
+    notes = NULL,
+    consent = FALSE
+  )
   valid_details <- reactive({
+    # Create a validator (see shinyvalidate)
+    iv <- InputValidator$new()
+    iv$add_rule(""u_name"", sv_required())
+    iv$add_rule(""u_email"", sv_email())
+    # iv$add_rule(""u_notes"", sv_required())
+    iv$enable()
 
-    # 2Bimproved with shinyvalidate
-    # improve consent
     output$valid_details <- renderText("""")
-    if (check_name(input$u_name)) {
-      if (check_email(input$u_email)) {
-        if (length(input$u_consent) == 3) {
-          output$valid_details <- info_valid(""All good!"")
-        } else {
-          output$valid_details <- info_valid(""Please abide by terms and conditions in the User tab."",
-          FALSE)
-        }
+    u_details$consent <- FALSE
+    if (iv$is_valid()) {
+      if (length(input$u_consent) == 3) {
+        output$valid_details <- info_valid(""All good!"")
+        u_details$name <- input$u_name
+        u_details$email <- input$u_email
+        u_details$notes <- input$u_notes
+        u_details$consent <- TRUE
       } else {
-        output$valid_details <- info_valid(""Please enter a valid email."",
-         FALSE)
+        output$valid_details <- info_valid(""Please abide by terms and conditions in the User tab."",
+        FALSE)
       }
     } else {
-      output$valid_details <- info_valid(""Please enter a valid name."",
+      output$valid_details <- info_valid(""Please fill out all required fields"",
         FALSE)
-      }
+    } 
   })
 
   observeEvent(input$get_u_details, { valid_details() })
@@ -239,27 +249,28 @@ server <- function(input, output, session) {
   )
 
   # FULL REPORT
-  fullReportServer(""tmp_full_report"", geoms, preview, input$u_name,
-    input$u_email, input$u_consent)
+  fullReportServer(""tmp_full_report"", geoms, preview, u_details)
 
   # FULL REPORT PREVIEW
   output$full_report_html <- renderUI({
-      if (preview$full_html == ""www/empty_report.html"") {
-        includeHTML(preview$full_html)
-      } else {
-        # remove www/ for inclusion in iframe
-        html <- strsplit(preview$full_html, ""www/"")[[1]][2]
-        # NB iframe is used so the css of the report does not affect the css of 
-        # the app
-        tags$iframe(id = ""iframe_report"", src = html, width = '100%',
-          frameborder = 'no')
-      }
+      switch(
+        preview$full_html,
+        ""www/empty_report.html"" = includeHTML(preview$full_html),
+        ""www/wrong.html"" = includeHTML(preview$full_html),
+        {
+          # not using include HTML here
+          # remove www/ for inclusion in iframe
+          html <- strsplit(preview$full_html, ""www/"")[[1]][2]
+          # iframe used to isolate the css of the report from the css of the app
+          tags$iframe(id = ""iframe_report"", src = html, width = '100%',
+            frameborder = 'no')
+        }
+      )
     })
 
 
   # CUSTOM REPORT
-  customReportServer(""custom_report"", geoms, preview, input$u_name, 
-    input$u_email, input$u_consent)
+  customReportServer(""custom_report"", geoms, preview, u_details)
 
   # CUSTOM REPORT PREVIEW
   output$custom_report_html <- renderUI({

---FILE: app/www/wrong.html---
@@ -0,0 +1,17 @@
+<br>
+
+<style>
+  #msg_warning {
+    color: #e41848;
+    text-align: center;
+  }
+
+</style>
+
+<h1 id=""msg_warning"" style=""font-size: 7em"">
+<i class=""fa fa-exclamation-triangle"" role=""presentation"" aria-label=""exclamation-triangle icon""></i>
+</h1>
+
+<h2 id=""msg_warning"">
+  Something went wrong while rendering the report!
+</h2>",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,585489d5b4033f21f6023bff65bfebee7f1eaaac,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-09T15:54:31Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-03-09T15:54:31Z,fix common chunk labeling,app/templates/EN/context/habitat.Rmd;reports/sections/benthicEffort/benthicEffort_en.Rmd;reports/sections/benthicEffort/benthicEffort_fr.Rmd;reports/sections/blueWhaleHab/bwhab_en.Rmd;reports/sections/blueWhaleHab/bwhab_fr.Rmd;reports/sections/conservationSites/conservationSites_en.Rmd;reports/sections/conservationSites/conservationSites_fr.Rmd;reports/sections/crithab/crithab_en.Rmd;reports/sections/crithab/crithab_fr.Rmd;reports/sections/ebsa/ebsa_en.Rmd;reports/sections/ebsa/ebsa_fr.Rmd;reports/sections/electrofishing/ef_en.rmd;reports/sections/ilts/ilts_en.Rmd;reports/sections/ilts/ilts_fr.Rmd;reports/sections/isdb-marfis/isdbMarfis_en.Rmd;reports/sections/isdb-marfis/isdbMarfis_fr.Rmd;reports/sections/narwc/narwc_en.Rmd;reports/sections/narwc/narwc_fr.Rmd;reports/sections/nbw/nbw_en.Rmd;reports/sections/nbw/nbw_fr.Rmd;reports/sections/obis/obisCet_en.Rmd;reports/sections/obis/obisCet_fr.Rmd;reports/sections/obis/obisFish_en.Rmd;reports/sections/obis/obisFish_fr.Rmd;reports/sections/ocearch/ocearch_en.Rmd;reports/sections/ocearch/ocearch_fr.Rmd;reports/sections/pasBay/pasBay_en.Rmd;reports/sections/pasBay/pasBay_fr.Rmd;reports/sections/rockweed/rockweed_en.Rmd;reports/sections/rockweed/rockweed_fr.Rmd;reports/sections/rv/rv_en.Rmd;reports/sections/rv/rv_fr.Rmd;reports/sections/sardist/sardist_en.Rmd;reports/sections/sardist/sardist_fr.Rmd;reports/sections/sdm/sdm_en.Rmd;reports/sections/sdm/sdm_fr.Rmd;reports/sections/sturg/sturg_en.Rmd;reports/sections/sturg/sturg_fr.Rmd;reports/sections/template/template_en.rmd;reports/sections/template/template_fr.rmd;reports/sections/whelk/whelk_en.rmd;reports/sections/whelk/whelk_fr.rmd;reports/sections/whitehead/whitehead_en.Rmd;reports/sections/whitehead/whitehead_fr.Rmd;reports/sections/wsdb/wsdb_en.Rmd;reports/sections/wsdb/wsdb_fr.Rmd,True,False,True,False,45,50,95,"---FILE: app/templates/EN/context/habitat.Rmd---
@@ -1,8 +1,3 @@
----
-output: html_document
-editor_options:
-  chunk_output_type: console
----
 ## **HABITAT INFORMATION**
 
 This module describes outputs of habitat derived from a variety of sources. Area-specific outputs are provided in sub-sections labelled according to each data source. Data descriptions, references and contact information are provided at the beginning of each sub-section.

---FILE: reports/sections/benthicEffort/benthicEffort_en.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r benthic-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/benthicEffort/benthicEffort_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r benthic-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/blueWhaleHab/bwhab_en.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r bwhab-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/blueWhaleHab/bwhab_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r bwhab-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/conservationSites/conservationSites_en.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r MPA-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/conservationSites/conservationSites_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r MPA-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/crithab/crithab_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r crithab-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/crithab/crithab_fr.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r crithab-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```  
 
 ```{r eval=FALSE}

---FILE: reports/sections/ebsa/ebsa_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r ebsa-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/ebsa/ebsa_fr.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r ebsa-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/electrofishing/ef_en.rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r ef-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/ilts/ilts_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r ilts-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/ilts/ilts_fr.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r ilts-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/isdb-marfis/isdbMarfis_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r isdb-marfis-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ```  
 
 ```{r eval=FALSE}

---FILE: reports/sections/isdb-marfis/isdbMarfis_fr.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r isdb-marfis-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/narwc/narwc_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r narwc-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/narwc/narwc_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
+```{r narwc-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")} 
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/nbw/nbw_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r nbw-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/nbw/nbw_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r nbw-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/obis/obisCet_en.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r obisCet-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/obis/obisCet_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r obisCet-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```  
 
 ```{r eval=FALSE}

---FILE: reports/sections/obis/obisFish_en.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r obis-fish-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/obis/obisFish_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r obis-fish-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/ocearch/ocearch_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r ocearch-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/ocearch/ocearch_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r ocearch-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/pasBay/pasBay_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r pasBay-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```  
 
 ```{r eval=FALSE}

---FILE: reports/sections/pasBay/pasBay_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r pasBay-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/rockweed/rockweed_en.Rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
+```{r rockweed-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 if (FALSE) { 
   # load in generic data, e.g.functions, study area, and base maps into the 
   # environment, when knitting, these will be loaded through the child rmd.

---FILE: reports/sections/rockweed/rockweed_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r rockweed-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 ```{r eval=FALSE}
 if (FALSE) { #load in data:

---FILE: reports/sections/rv/rv_en.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r rv-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/rv/rv_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r rv-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/sardist/sardist_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sardist-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```  
 
 ```{r eval=FALSE}

---FILE: reports/sections/sardist/sardist_fr.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sardist-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ``` 
 
 ```{r eval=FALSE}

---FILE: reports/sections/sdm/sdm_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sdm-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```  
 
 ```{r eval=FALSE}

---FILE: reports/sections/sdm/sdm_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sdm-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/sturg/sturg_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sturg-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/sturg/sturg_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r sturg-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/template/template_en.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r template-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/template/template_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r template-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/whelk/whelk_en.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r whelk-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/whelk/whelk_fr.rmd---
@@ -6,7 +6,7 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r whelk-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/whitehead/whitehead_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r whitehead-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/whitehead/whitehead_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r whitehead-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/wsdb/wsdb_en.Rmd---
@@ -6,7 +6,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r wsdb-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}

---FILE: reports/sections/wsdb/wsdb_fr.Rmd---
@@ -5,7 +5,7 @@ output:
     theme: paper
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
-```{r child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
+```{r wsdb-load-common, child = here::here(""reports/sections/commonSections/commonIntro.Rmd"")}
 ```
 
 ```{r eval=FALSE}",False,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,e39cb9345f4be6203646b817ea538fa67d1d1ed4,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-02-11T12:49:06Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-02-11T12:49:06Z,"fix geometry recasting, plotting bugs",app/R/intersectFunctions.R;app/R/plotFunctions.R;app/Rmd/human_activities_EN.Rmd;sections/benthicEffort/benthicEffort_en.Rmd;sections/docks/docks_en.rmd;sections/lobsterEffort/lobsterEffort_en.rmd;sections/nitroLoad/nitroLoad_en.rmd;sections/waste/waste_en.rmd,True,True,True,False,89,41,130,"---FILE: app/R/intersectFunctions.R---
@@ -64,17 +64,16 @@ master_intersect <- function(data_sf, mapDataList, getRegion=FALSE, ...) {
     mapPoints = NULL
     
   } else {
-    geometryType <- toString(st_geometry_type(data_sf, by_geometry = FALSE))
     # Crop data
     if (getRegion) {
-      regionData <- st_crop(data_sf, mapDataList$region) %>% st_cast(geometryType)
+      regionData <- st_crop(data_sf, mapDataList$region)
       if (nrow(regionData) == 0) {regionData <- NULL}
     } else {
       regionData <- NULL
     }
     
-    mapData <- st_crop(data_sf, mapArea) %>% st_cast(geometryType)
-    studyData <- st_crop(mapData, mapDataList$studyArea) %>% st_cast(geometryType)
+    mapData <- st_crop(data_sf, mapArea)
+    studyData <- st_crop(mapData, mapDataList$studyArea)
     
     # if there is no intersect with the box, set return to NULL
     if (nrow(mapData) == 0) {mapData <- NULL}

---FILE: app/R/plotFunctions.R---
@@ -12,19 +12,27 @@
 
 plot_rr_sf <- function(baseMap, data_sf, ...) {
   
+  if (is.null(data_sf)) {
+    return(baseMap)
+  }
+  if (nrow(data_sf) == 0) {
+    return(baseMap)
+  }
+  
+  # only check first row of data_sf to avoid sfc_geometry for mixed poly/multiploys and lines/multilines
   if (inherits(data_sf, ""RasterLayer"")) {
     
     outPlot <- plot_raster(baseMap, data_sf, ...)
     
-  }else if (inherits(sf::st_geometry(data_sf), c(""sfc_POINT""))) {
+  }else if (inherits(sf::st_geometry(data_sf[1, ]), c(""sfc_POINT""))) {
     
     outPlot <- plot_points(baseMap, data_sf, ...)
     
-  } else if (inherits(sf::st_geometry(data_sf), c(""sfc_POLYGON"", ""sfc_MULTIPOLYGON"", ""sfc_GEOMETRY""))) {
+  } else if (inherits(sf::st_geometry(data_sf[1, ]), c(""sfc_POLYGON"", ""sfc_MULTIPOLYGON""))) {
     
     outPlot <- plot_polygons(baseMap, data_sf, ...)
     
-  } else if (inherits(sf::st_geometry(data_sf), c(""sfc_LINESTRING"", ""sfc_MULTILINESTRING""))) {
+  } else if (inherits(sf::st_geometry(data_sf[1, ]), c(""sfc_LINESTRING"", ""sfc_MULTILINESTRING""))) {
     
     outPlot <- plot_lines(baseMap, data_sf, ...)
     
@@ -257,7 +265,8 @@ plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute,
       colorMap <- colorMap[names(colorMap) %in% polyData[[attribute]]]
     }
     
-    polyFill <- scale_bar_layer(polyData, attribute, continuousAttr, minScale, maxScale, legendName)
+    polyFill <- scale_bar_layer(polyData, attribute, continuousAttr, minScale,
+                                maxScale, legendName, colorMap)
     
     if (outlines) {
       polyPlot <- geom_sf(data=polyData, polyAes, colour=clr, alpha=alpha)
@@ -360,7 +369,7 @@ get_rr_color_map <- function(dataCol) {
   return(colorMap)
 }
 
-scale_bar_layer <- function(data_sf, attribute, continuous, minValue, maxValue, legendName, fill=TRUE){
+scale_bar_layer <- function(data_sf, attribute, continuous, minValue, maxValue, legendName, colorMap, fill=TRUE){
   if (continuous){
     if (is.null(minValue)){
       minScale = min(data_sf[[attribute]])

---FILE: app/Rmd/human_activities_EN.Rmd---
@@ -7,6 +7,22 @@ editor_options:
 
 This module summarizes human activity information available from various DFO and non-DFO sources.
 
-```{r child = here::here(""sections/benthicEffort/benthicEffort_en.Rmd"")}
+```{r child = here::here(""sections/nitroLoad/nitroLoad_en.rmd"")}
 ```
 
+```{r child = here::here(""sections/benthicEffort/benthicEffort_en.rmd"")}
+```
+
+```{r child = here::here(""sections/lobsterEffort/lobsterEffort_en.rmd"")}
+```
+
+```{r child = here::here(""sections/docks/docks_en.rmd"")}
+```
+
+```{r child = here::here(""sections/waste/waste_en.rmd"")}
+```
+
+```{r child = here::here(""sections/power/power_en.rmd"")}
+```
+
+

---FILE: sections/benthicEffort/benthicEffort_en.Rmd---
@@ -28,19 +28,33 @@ Dataset description from the Open Data record [@OpenData_benthicEffort]:
 writeLines(noquote(benthicEffort_rr$text$en))
 ```
 
-#### ***Area-specific SAR distribution search results***
+#### ***Area-specific fishing effort search results***
 
 ```{r benthicEffort-results, echo=FALSE, results='asis'}
 outputListBenthicEffort <- master_intersect(benthicEffort_rr$data_sf, mapDataList, getRegion=TRUE)
 
 ```
 
+
+```{r benthicEffort-check, echo=FALSE, results='asis',}
+# Check if there is any data in the study area
+benthicEffortReport <- if (is.null(outputListBenthicEffort$mapData)) {
+  ""* There are no relevant records of fishing effort in bethic areas for this search area.""
+} else {
+  ""* There are relevant records of fishing effort in bethic areas for this search area.""
+}
+writeLines(noquote(benthicEffortReport))
+```
 <br>
-```{r benthicEffort-plot, fig.height=7, fig.width=11, fig.show=""hold"", out.width=""50%"", fig.cap=paste(write_caption_blurb(benthicEffort_rr, ""EN""), 'Maps showing the benthic fishing effort with the search area defined by the user (red outline).')}
-if (!is.null(outputListBenthicEffort$regionData)) {
-  par(mar = c(4, 4, .1, .1))
-  plot(plot_rr_sf(mapDataList$areaMap, outputListBenthicEffort$mapData, bgCutoff=15))
-  plot(plot_rr_sf(mapDataList$regionMap, outputListBenthicEffort$regionData, bgCutoff=15))
+```{r benthicEffort-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(benthicEffort_rr, ""EN""), 'Maps showing the benthic fishing effort with the search area defined by the user (red outline).')}
+if (!is.null(outputListBenthicEffort$mapData)) {
+  plot_rr_sf(mapDataList$regionMap, outputListBenthicEffort$regionData, bgCutoff=15)
+}
+```
+
+```{r benthicEffort-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(benthicEffort_rr, ""EN""), 'Maps showing the benthic fishing effort with the search area defined by the user (red outline).')}
+if (!is.null(outputListBenthicEffort$mapData)) {
+  plot_rr_sf(mapDataList$areaMap, outputListBenthicEffort$mapData, bgCutoff=15)
 }
 ```
 

---FILE: sections/docks/docks_en.rmd---
@@ -30,7 +30,7 @@ write_meta(docks_rr, ""EN"")
 ```
 
 Dataset description from the Open Data record [@OpenData_docks]:
-```{r nitroLoad-text, results='asis'}
+```{r docks-text, results='asis'}
 writeLines(noquote(docks_rr$text$en))
 
 ```

---FILE: sections/lobsterEffort/lobsterEffort_en.rmd---
@@ -30,7 +30,7 @@ write_meta(lobsterEffort_rr, ""EN"")
 ```
 
 Dataset description from the Open Data record [@OpenData_lobsterEffort]:
-```{r nitroLoad-text, results='asis'}
+```{r lobsterEffort-text, results='asis'}
 writeLines(noquote(lobsterEffort_rr$text$en))
 
 ```
@@ -53,21 +53,23 @@ lobsterEffortReport <- if (is.null(lobsterOutputList$studyData)) {
 writeLines(noquote(lobsterEffortReport))
 ```
 
-```{r lobsterEffort-plot, fig.height=7, fig.width=11, fig.show=""hold"", out.width=""50%"", fig.cap=paste(write_caption_blurb(lobsterEffort_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query lobster fishing effort records at a regional and local scale.')}
+```{r lobsterEffort-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(lobsterEffort_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query lobster fishing effort records.')}
 if (!is.null(lobsterOutputList$studyData)) {
-    par(mar = c(4, 4, .1, .1))
-    totalRegionMax <- max(lobsterOutputList$regionData[[lobsterEffort_rr$attribute]])
-    totalRegionMin <- min(lobsterOutputList$regionData[[lobsterEffort_rr$attribute]])
     plot(plot_rr_sf(regionMap, lobsterOutputList$regionData, 
                     attribute=lobsterEffort_rr$attribute, 
                     legendName=""Catch weight (kg/yr)"", 
-                    continuousAttr=TRUE))
+                    continuousAttr=TRUE))}
+```
+
+```{r lobsterEffort-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(lobsterEffort_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query lobster fishing effort records.')}
+if (!is.null(lobsterOutputList$studyData)) {
+    totalRegionMax <- max(lobsterOutputList$regionData[[lobsterEffort_rr$attribute]])
+    totalRegionMin <- min(lobsterOutputList$regionData[[lobsterEffort_rr$attribute]])
     plot(plot_rr_sf(areaMap, lobsterOutputList$mapData, 
                     attribute=lobsterEffort_rr$attribute, 
                     legendName=""Catch weight (kg/yr)"", 
                     continuousAttr=TRUE, 
-                    minScale=totalRegionMin, maxScale=totalRegionMax))
- 
-}
+                    minScale=totalRegionMin, maxScale=totalRegionMax))}
 ```
 
+

---FILE: sections/nitroLoad/nitroLoad_en.rmd---
@@ -55,40 +55,48 @@ nitroLoadReport <- if (is.null(totalOutputList$studyData) & is.null(deltaOutputL
 writeLines(noquote(nitroLoadReport))
 ```
 
-```{r totalNitroLoad-plot, fig.height=7, fig.width=11, fig.show=""hold"", out.width=""50%"", fig.cap=paste(write_caption_blurb(totalNitroLoad_rr, ""EN""), 'Map showing Total Nitrogen load (kg N/yr). Calculated in: [@nitroLoad_pub] ')}
+```{r totalNitroLoad-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(totalNitroLoad_rr, ""EN""), 'Map showing Total Nitrogen load (kg N/yr). Calculated in: [@nitroLoad_pub].')}
 if (!is.null(totalOutputList$studyData)) {
-    par(mar = c(4, 4, .1, .1))
-    totalRegionMax <- max(totalOutputList$regionData[[totalNitroLoad_rr$attribute]])
-    totalRegionMin <- min(totalOutputList$regionData[[totalNitroLoad_rr$attribute]])
     plot(plot_rr_sf(regionMap, totalOutputList$regionData, 
                     attribute=totalNitroLoad_rr$attribute, 
                     legendName=""Nitrogen Load (kg/yr)"", 
                     continuousAttr=TRUE))
+}
+```
+
+```{r totalNitroLoad-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(totalNitroLoad_rr, ""EN""), 'Map showing Total Nitrogen load (kg N/yr). Calculated in: [@nitroLoad_pub].')}
+if (!is.null(totalOutputList$studyData)) {
+    totalRegionMax <- max(totalOutputList$regionData[[totalNitroLoad_rr$attribute]])
+    totalRegionMin <- min(totalOutputList$regionData[[totalNitroLoad_rr$attribute]])
     plot(plot_rr_sf(areaMap, totalOutputList$mapData, 
                     attribute=totalNitroLoad_rr$attribute, 
                     legendName=""Nitrogen Load (kg/yr)"", 
                     continuousAttr=TRUE, 
                     minScale=totalRegionMin, maxScale=totalRegionMax))
 
-  
+    }
+```
+
+```{r deltaNitroLoad-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(deltaNitroLoad_rr, ""EN""), 'Map showing the Mean ratio between the total nitrogen embayment loading rate and the sum of the rates of tidal exchange and freshwater recharge. Calculated in: [@nitroLoad_pub].')}
+if (!is.null(deltaOutputList$studyData)) {
+    plot(plot_rr_sf(regionMap, deltaOutputList$regionData, 
+                    attribute=deltaNitroLoad_rr$attribute, 
+                    legendName=""Ratio"", 
+                    continuousAttr=TRUE))
 }
 ```
 
-```{r deltaNitroLoad-plot, fig.height=7, fig.width=11, fig.show=""hold"", out.width=""50%"", fig.cap=paste(write_caption_blurb(totalNitroLoad_rr, ""EN""), 'Map showing the Mean ratio between the total nitrogen embayment loading rate and the sum of the rates of tidal exchange and freshwater recharge. Calculated in: [@nitroLoad_pub].')}
+```{r deltaNitroLoad-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(deltaNitroLoad_rr, ""EN""), 'Map showing the Mean ratio between the total nitrogen embayment loading rate and the sum of the rates of tidal exchange and freshwater recharge. Calculated in: [@nitroLoad_pub].')}
 if (!is.null(deltaOutputList$studyData)) {
-    par(mar = c(4, 4, .1, .1))
     deltaRegionMax <- max(deltaOutputList$regionData[[deltaNitroLoad_rr$attribute]])
     deltaRegionMin <- min(deltaOutputList$regionData[[deltaNitroLoad_rr$attribute]])
-    plot(plot_rr_sf(regionMap, deltaOutputList$regionData,
+    plot(plot_rr_sf(areaMap, deltaOutputList$mapData, 
                     attribute=deltaNitroLoad_rr$attribute, 
                     legendName=""Ratio"", 
-                    continuousAttr=TRUE))
-    plot(plot_rr_sf(areaMap, deltaOutputList$mapData,
-                    attribute=deltaNitroLoad_rr$attribute, 
-                    legendName=""Ratio"", continuousAttr=TRUE,
+                    continuousAttr=TRUE, 
                     minScale=deltaRegionMin, maxScale=deltaRegionMax))
 
-  
-}
+    }
 ```
 
+

---FILE: sections/waste/waste_en.rmd---
@@ -58,7 +58,7 @@ writeLines(noquote(wasteReport))
 if (!is.null(wasteOutputList$studyData)) {
     plot(plot_rr_sf(areaMap, wasteOutputList$mapData, 
                     attribute=waste_rr$attribute, outlines=FALSE,
-                    legendName=""Nitrogen Load (kg/yr)"", lwd=2))
+                    legendName=""Waste Site Status"", lwd=2))
 
 }
 ```",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,b83387fda54e24b1df82a9a0c714bcfdc18d55e9,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-31T15:16:32Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-31T15:16:32Z,fix summary tables,app/R/tableFunctions.R,False,True,True,False,4,2,6,"---FILE: app/R/tableFunctions.R---
@@ -482,12 +482,14 @@ add_col_to_sar_summary <- function(sarSummary, dbName, dataTable, indexCol, attr
     dataTable$speciesCol <- dataTable[[indexCol]]
     dataTable <- filter(dataTable, speciesCol %in% sarSummary$Species)
   } else {
+    # dataTable was null:
     dataTable <- sarSummary
     dataTable$speciesCol <- dataTable$Species
     dataTable$summaryCol <- rep(absentCode, nrow(sarSummary))
   }
 
-  sarSummary[[dbName]] <- merge(sarSummary, dataTable, by.x=""Species"", by.y =""speciesCol"", all=TRUE)$summaryCol
+  sarSummary[[dbName]] <- dplyr::left_join(sarSummary, dataTable, by=c(""Species"" = ""speciesCol""))$summaryCol
+  
   return(sarSummary)
 }
 # ---------add_to_hab_summary-------
@@ -509,7 +511,7 @@ add_to_hab_summary <- function(summaryTable, colName, dbName, dataTable, indexCo
     dataTable$speciesCol <- dataTable[[indexCol]]
     dataTable <- filter(dataTable, speciesCol %in% summaryTable$Species)
     dataTable <- filter(dataTable, lengths(summaryCol) > 0)
-    tempCol <- merge(summaryTable, dataTable, by.x=""Species"", by.y =""speciesCol"", all=TRUE)$summaryCol
+    tempCol <- dplyr::left_join(summaryTable, dataTable, by=c(""Species""=""speciesCol""))$summaryCol
 
     # nested ifelse to set column value to either new value if not NA, or
     # combination of old and new if both were present",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,763e9c5f0b328470521b31e9e217858156c754c9,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-28T17:54:24Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-28T17:54:24Z,"fix conditional sections, update french obis",app/Rmd/intro_EN.Rmd;sections/commonSections/commonIntro.Rmd;sections/obis/obisCet_en.Rmd;sections/obis/obisCet_fr.Rmd;sections/obis/obisCommon_fr.Rmd;sections/obis/obisFish_en.Rmd;sections/obis/obisFish_fr.Rmd,True,False,True,False,368,50,418,"---FILE: app/Rmd/intro_EN.Rmd---
@@ -14,27 +14,9 @@ output:
 bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
 ---
 
-```{r load-data-and-functions, echo=FALSE, include=FALSE, cache=FALSE}
-source(here::here(""config.R""))
-lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source) # check helpers.R for a list of packages
-studyArea <- sf::st_read(""{{path_to_geoms}}"")
-# Uncomment the following to test fixed polygon:
-# studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) # last area from app.
-# studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_test.geojson"")) #Offshore
-# studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_coastal_test.geojson"")) #coastal
-# studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_no_land.geojson"")) #no land
-intro_setup(studyArea, env = environment(), regionStr = regionStr)
-```
-
 ```{r child = here::here(""sections/commonSections/commonIntro.Rmd"")}
 ```
 
-<!-- # ```{r child = c('../Rmd/report_cetaceans_EN.Rmd', 'report_fish_EN.Rmd', 'report_habitat_EN.Rmd', 'report_planning_EN.Rmd', 'report_SARA_EN.Rmd')} -->
-<!-- # ``` -->
-<!--```{r child = '../Rmd/report_planning_EN.Rmd'}
-```-->
-
-<!-- END  -->
 
 <!-- MAIN SECTIONS -->
 For more information about this report, please contact Quentin.Stoyel@dfo-mpo.gc.ca. Please circulate this report to all relevant contacts provided in each section to verify and supplement information.

---FILE: sections/commonSections/commonIntro.Rmd---
@@ -18,8 +18,8 @@ if (!exists(""mapDataList"")){
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) # last area from app.
   intro_setup(studyArea, env = environment(), regionStr=regionStr)
   # need to clear this global env variable here.
-  if (exists(""commonObis"")) { 
-    rm(""commonObis"")
+  if (exists(""commonObis"", envir=globalenv())) { 
+    rm(""commonObis"", envir=globalenv())
   }
 }
 ```
\ No newline at end of file

---FILE: sections/obis/obisCet_en.Rmd---
@@ -23,7 +23,7 @@ load_rdata(c(""obisCet_rr"", ""gbifCet_rr""), regionStr, env = environment())
 ```
 
 ```{r cet-short-obis, results = 'asis', eval=exists('commonObis')}
-cat('### **Ocean Biodiversity Information System and Global Biodiversity Information Facility** \n\n To avoid duplication of text, please refer to the overview for OBIS and GBIF provided in the Fish and Invertebrates section. ')
+cat('### **Ocean Biodiversity Information System and Global Biodiversity Information Facility** \n\n To avoid duplication of text, please refer to the overview for OBIS and GBIF provided in the Fish and Invertebrates section: [OBIS section](#OBIS-section). ')
 ```
 
 ```{r child = here::here(""sections/obis/obisCommon_en.Rmd""), eval=!exists('commonObis')}

---FILE: sections/obis/obisCet_fr.Rmd---
@@ -16,21 +16,26 @@ if (FALSE) { #load in data:
 ```{r child = here::here(""sections/commonSections/commonCet.Rmd"")}
 ```
 
-### **Système d’information sur la biodiversité des océans (SIBO) [pour les cétacés]**  {#obis-cetacean-section}
+```{r obis-gbif-cet-load, include=FALSE}
+load_rdata(c(""obisCet_rr"", ""gbifCet_rr""), regionStr, env = environment())
 
-```{r obis-cetacean-load, include=FALSE}
-load_rdata(c(""obisCet_rr""), regionStr, env = environment())
 ```
 
-```{r obis-cetacean-meta, results='asis'}
-write_meta(obisCet_rr, ""FR"")
+```{r cet-short-obis, results = 'asis', eval=exists('commonObis')}
+cat('### **Ocean Biodiversity Information System and Global Biodiversity Information Facility** \n\n To avoid duplication of text, please refer to the overview for OBIS and GBIF provided in the Fish and Invertebrates section: [OBIS section](#OBIS-section). ')
 ```
 
-Une recherche du SIBO a été effectuée pour trouver d’autres documents pertinents pour les cétacés inscrits en vertu de la LEP, ou évalués par le COSEPAC. Un processus de CQ de premier niveau a été effectué en supprimant les rapports en double qui sont également présents dans la BDOB. Les versions subséquentes de ce rapport viseront à étendre nos efforts de CQ pour cette source d’information.
+```{r child = here::here(""sections/obis/obisCommon_fr.Rmd""), eval=!exists('commonObis')}
+# chunk will only run if commonObis variable does not exist, set in commonObis.rmd.
+```
 
 #### ***Résultats de la recherche du SIBO pour les cétacés, par zone***
-```{r obis-cetacean, include=FALSE, cache=FALSE}
+
+```{r obis-cetecean, cache=FALSE, include=FALSE}
 obisClipped <- master_intersect(obisCet_rr$data_sf, mapDataList)
+
+obisTable <- create_sar_tables(obisClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
+
 linkedSectionText <- ""[OBIS-Cetaceans](##obis-cetacean-section)""
 if (!is.null(obisClipped$studyData)) {
   whaleSummaryTable <- add_col_to_whale_summary(whaleSummaryTable, linkedSectionText, obisClipped$studyData, obisCet_rr$attribute)
@@ -40,18 +45,73 @@ if (!is.null(obisClipped$studyData)) {
 }
 
 ```
-*
-```{r obis-cetacean-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+
+```{r obis-cetecean-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
 Report_obis_cet <-  if (is.null(obisClipped$studyData)) {
-  ""Il n’existe aucun registre pertinent pour les cétacés dans le système d’information sur la biodiversité des océans (SIBO) pour cette zone de recherche.""
+  ""* There are no relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area.""
 } else {
-  ""Il existe des registres pertinents pour les cétacés dans le système d’information sur la biodiversité des océans (SIBO) pour cette zone de recherche.""
+  ""* There are relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area.""
 }
 writeLines(Report_obis_cet)
 ```
-
-```{r obis-cetacean-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisCet_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du SIBO pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> . L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.')}
+```{r obis-cetecean-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisCet_rr, ""FR""), 'Map of Ocean Biodiversity Information System (OBIS) observation records of cetaceans observed within the search area (red outline), and listed by the Species at Risk Act (SARA) and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Coloured circles indicate individual observations for each whale species. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Absence may be related to low or no survey effort. Sightings information is known to under-represent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings near shore (< 300 m from the coastline) are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. Observations ≥ 300 m from shore were removed due to positional accuracy and species identification concerns. ')}
 if (!is.null(obisClipped$studyData)) {
   plot_rr_sf(areaMap, obisClipped$mapData, attribute = obisCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }
 ```
+
+```{r obis-cetacean-table, echo=FALSE, results='asis'}
+if (!is.null(obisClipped$studyData)) {
+  knitr::kable(obisTable, align=""l"", caption=paste(write_caption_blurb(obisCet_rr, ""FR""), ""Ocean Biodiversity Information System (OBIS) observation records of cetacean species observed within the search area, and listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. URLs contain links to a complete dataset description. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Observations ≥ 300 m from shore were removed due to positional accuracy and species identification concerns.""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+
+
+#### ***Area-specific GBIF  search results***
+
+```{r gbif-cetacean-results, cache=FALSE, include=FALSE}
+inaturalist_sf = subset(gbifCet_rr$data_sf, title == ""iNaturalist Research-grade Observations"")
+inaturalistClipped <- master_intersect(inaturalist_sf, mapDataList)
+inaturalistTable <- create_sar_tables(inaturalistClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
+
+
+otherGbif_sf = subset(gbifCet_rr$data_sf, title != ""iNaturalist Research-grade Observations"")
+gbifClipped <- master_intersect(otherGbif_sf, mapDataList)
+gbifTable <- create_sar_tables(gbifClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
+# Add to summary tables!
+
+```
+
+```{r gbif-cetacean-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+reportGbif <-  if (is.null(gbifClipped$studyData)) {
+  ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF) for this search area.""
+} else if (is.null(inaturalistClipped$studyData)){
+  ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF) for this search area.""
+} else {
+  ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF) including iNaturalist entries for this search area.""  
+}
+writeLines(reportGbif)
+```
+
+```{r gbif-cetacean-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbifCet_rr, ""FR""), 'Map of Global Biodiversity Information Facility (GBIF) observation records of cetaceans observed within the search area (red outline), and listed by the Species at Risk Act (SARA) and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Coloured circles indicate individual observations for each whale species. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Absence may be related to low or no survey effort. Sightings information is known to under-represent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections.  Sightings near shore (< 300 m from the coastline) are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. Observations ≥ 300 m from shore were removed due to positional accuracy and species identification concerns. ')}
+if (!is.null(gbifClipped$studyData)) {
+  plot_rr_sf(areaMap, gbifClipped$mapData, attribute=gbifCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
+}
+```
+
+```{r gbif-cetacean-table, echo=FALSE, results='asis'}
+if (!is.null(gbifClipped$studyData)) {
+  knitr::kable(gbifTable, align=""l"", caption=paste(write_caption_blurb(gbifCet_rr, ""FR""), ""Global Biodiversity Information Facility (GBIF) observation records of cetacean species observed within the search area, and listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. URLs contain links to a complete dataset description. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Observations ≥ 300 m from shore were removed due to positional accuracy and species identification concerns. ""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+```{r inaturalist-cetaceans-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbifCet_rr, ""FR""), 'Research-grade iNaturalist observations within the search area (red outline) of cetacean species that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Observations are coloured to show coordinate uncertainties of the data, where observations with coordinate uncertainties >20 km represent locations that have been obscured due to geoprivacy concerns (e.g., hunting). NAs refer to observations with no provided coordinate uncertainty. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+if (!is.null(inaturalistClipped$studyData)) {
+  plot_rr_sf(areaMap, inaturalistClipped$mapData, attribute=gbifCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
+}
+```
+
+```{r inaturalist-cetaceans-table, echo=FALSE, results='asis'}
+if (!is.null(inaturalistClipped$studyData)) {
+  knitr::kable(inaturalistTable, align=""l"", caption=paste(write_caption_blurb(gbifCet_rr, ""FR""), ""Research-grade iNaturalist observations of cetaceans within the search area and listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). URLs contain links to a complete dataset description. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
\ No newline at end of file

---FILE: sections/obis/obisCommon_fr.Rmd---
@@ -0,0 +1,227 @@
+---
+output:
+  bookdown::html_document2:
+    number_sections: FALSE
+    theme: paper
+bibliography: '`r here::here(""app/data/mybiblio.bib"")`'
+editor_options: 
+  markdown: 
+    wrap: 72
+---
+
+### **Ocean Biodiversity Information System (OBIS)**{#OBIS-section}
+
+```{r obis-load, include=FALSE}
+# prevent furture common obis sections from running
+assign('commonObis', TRUE, envir = globalenv()) 
+load_rdata(c(""obisFish_rr""), regionStr, env = environment())
+```
+
+```{r obis-meta, results='asis'}
+write_meta(obisFish_rr, ""FR"")
+```
+
+OBIS is a global, open-access data and information clearing-house on marine biodiversity for science, conservation, and sustainable development [@OBIS]. Their vision is to build and maintain a global alliance that collaborates with scientific communities to facilitate free and open-access to, and application of, biodiversity and biogeographic data and information on marine life. OBIS accepts data from any organization, consortium, project or individual who wishes to contribute data (OBIS, 2021). As of December 2021, OBIS has over 80 million species occurrence records and over 4,300 datasets globally.
+
+
+### **Global Biodiversity Information Facility (GBIF)** {#gbif-section}
+
+```{r gbif-load, include=FALSE}
+load_rdata(c(""gbifFish_rr""), regionStr, env = environment())
+```
+
+```{r gbif-meta, results='asis'}
+write_meta(gbifFish_rr, ""FR"")
+```
+
+GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth (GBIF, 2021). Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of December 2021, GBIF has over 1.9 billion species occurrence records and over 63,000 datasets globally. 
+
+
+
+### Background descriptions for both OBIS and GBIF
+
+Both OBIS and GBIF are large online data portals, consisting of numerous
+datasets from multiple sources. Due to their many commonalities, the
+following descriptions and caveats are applicable to both and therefore
+written together.
+
+#### Data structure
+
+Data submitted to GBIF and OBIS must be formatted according to the
+Darwin Core, a body of standards outlining how to format biological data
+(<https://obis.org/manual/darwincore/> and
+<https://www.gbif.org/darwin-core>). These standards define which
+attributes (i.e., column names) are included when structuring the
+datasets, and describe how other supplemental information such as study
+design, associated environmental conditions (e.g., sea surface
+temperature), or biological characteristics (e.g., abundance, biomass,
+etc.) can be formatted and included. Due to these requirements, OBIS and
+GBIF are generally best suited for point data, although other vector
+formats (e.g., lines, polygons) can be uploaded. Because this report
+focuses on species presence, detailed information outlining the study
+design, environmental conditions, or biological characteristics are not
+included, but may be available for each dataset if required.
+
+OBIS and GBIF submissions also follow the Ecological Metadata Language
+format, a metadata standard for ecological data (more information here:
+<https://obis.org/manual/eml/>). This is created as an XML file for each
+dataset.
+
+For more detailed metadata including information such as the data
+collection date, survey methods, institution name, and license type,
+refer to the provided URL for each dataset.
+
+#### Disclaimers
+
+There are various issues involved with using data extracted from OBIS
+and GBIF, which are described below in more detail. Future iterations of
+this reporting tool will aim at expanding our quality checks to address
+these concerns. Because these portals contain data from many different
+sources, this is not an exhaustive list of all of the potential caveats
+of each data source. Users should refer to each source separately to
+review these concerns.
+
+#### Differing research objectives
+
+Each dataset within these portals was acquired to fulfill its own unique
+research objectives, and therefore may not be suitable for all
+applications. When data are viewed spatially, other factors that can
+affect the results including the study design, data collection methods,
+and collection date may not be immediately apparent. In particular, the
+absence of a species should be interpreted as an absence of reporting,
+not necessarily as an absence of the species in the area.
+
+#### Observations over land
+
+Although this report focuses on marine biodiversity data, observations
+on land for the species of interest are often uploaded to these portals.
+Several aquatic species have life history strategies involving presence
+within freshwater ecosystems, rather than existing solely within marine
+or oceanic ecosystems (e.g., anadromous fish). Observations appearing
+""on land"" may therefore represent species observed within freshwater
+ecosystems such as rivers or ponds, which may not be obvious in the
+Figures shown. Fish and invertebrate species occurring on land were
+therefore not removed from the report. Cetaceans observations on land
+typically indicate that animals were sighted from shore. Any
+observations \>300 m from the shore were removed due to positional
+accuracy and species identification concerns. Because geopositional
+errors are known to occur within these portals, users should
+double-check observations occurring on land to ensure they contain
+accurate information.
+
+OBIS performs multiple data quality checks, including flagging data over
+land. For a complete description of the QC procedures OBIS performs, see
+<https://github.com/iobis/obis-qc> and Vandepitte et al. (2015). Data
+quality checks are less extensive in GBIF, various information is
+required (e.g., scientific name, event date) or the records will not be
+accepted (<https://www.gbif.org/data-quality-requirements-occurrences>).
+
+#### Duplicate datasets
+
+Several of the datasets uploaded to OBIS and GBIF are also listed as
+separate data sources/sections within this report. These have been
+removed from this section of the report and include:
+
+-   Maritimes Research Vessel Surveys
+
+-   Whale Sightings Database (named ""DFO Maritimes Region Cetacean
+    Sightings"" in OBIS and GBIF)
+
+Duplicates datasets and occurrence records may also exist between OBIS
+and GBIF. Data contributors are encouraged to upload to both portals
+simultaneously, although in some instances, data is only uploaded to one
+portal, which can lead to discrepancies between the two. Also, records
+are often shared between multiple data contributors, and as a result,
+some records may be included in several different datasets. Currently, R
+tools are being developed to address these data duplicate issues
+(<https://www.rdocumentation.org/packages/spoccutils/versions/0.1.0/topics/spocc_duplicates>).
+These tools may be incorporated in future iterations of this report when
+they become available.
+
+#### Additional data
+
+In some cases, data uploaded to OBIS or GBIF may not represent the
+entire dataset available. Users should review the URLs for each dataset
+to identify these instances and contact the original data providers if
+there are additional records that may be useful.
+
+#### Basis of Record
+
+The Basis of Record field (i.e., column name) is a required term that specifies the nature of
+the record, such as how the observation was obtained or stored (more
+information here: <https://obis.org/manual/darwincore/#records>). There
+are various options the data submitter can select from. The following
+cases were removed from the report because they do not contain relevant
+or current specimen data:
+
+-   FossilSpecimen: specimen is a fossil record.
+
+-   LivingSpecimen: specimen is intentionally kept or cultivated such as
+    a culture organism, zoo or aquarium species.
+
+The following cases provide relevant information and were combined
+within the report:
+
+-   MaterialSample: A physical sample from the sampling event has been
+    retained. The recorded location is the in situ sampling location.
+
+-   PreservedSpecimen: organism is collected at the recorded location
+    but then preserved (e.g., in ethanol at a location such as museum,
+    university, or research institute.)
+
+-   HumanObservation: includes visual sightings of the organism, or
+    observations where specimens were collected and then discarded after
+    counting (e.g., a benthic grab sample).
+
+-   Unknown: includes records without a defined basis of record or with
+    an unrecognized value for this field
+
+Observations may also be listed as MachineObservation, which are derived from machine or computer-based detections such as automated sensors (e.g., DNA sequencers), acoustic tagging, or image recognition. Currently, there are no MachineObservation records for fish or invertebrate species in this region.
+
+#### iNaturalist data
+
+iNaturalist is an open-source platform where naturalists, citizen
+scientists, and biologists can map species observations (iNaturalist,
+2021). As of December 2021, iNaturalist has over 86 million species
+observations and over 1.9 million registered users/contributors
+globally. Every week, iNaturalist data that are considered ""Research
+Grade"" (i.e., the record contains a date, is georeferenced, has photos
+or sounds, isn't a captive or cultivated organism, and two thirds of
+identifiers agree on the species identification) are added to GBIF (more
+information here:
+<https://www.gbif.org/dataset/50c9509d-22c7-4a22-a47d-8c48425ef4a7>).
+iNaturalist records are not added to OBIS.
+
+iNaturalist records include a coordinate uncertainty, which is added by
+the user to provide an estimation of the geopositional accuracy of the
+observation. This may reflect information such as the accuracy of the
+user's phone's GPS, or an estimation of error if an observation was
+spotted from a distance
+(<https://greece.inaturalist.org/posts/28376-making-yourobservations-more-valuable-for-conservation-location-uncertainty>).
+
+For species that may be put at risk if their true location is known
+(e.g., due to hunting or poaching), the location can be obscured, either
+at the request of the submitter, or done automatically by iNaturalist.
+iNaturalist moderators may obscure a species location if the species has
+a certain conservation status (e.g., the IUCN equivalent of ""Near
+Threatened"" or worse), or based on local knowledge of the species in the
+region (<https://www.inaturalist.org/pages/curator+guide>). For species
+with obscured locations, a random location within a 0.2 x 0.2 degree
+cell (\~22 km x 22 km) is generated
+(<https://www.inaturalist.org/pages/help#geoprivacy>). In GBIF, it is
+not explicitly stated if the species position has been obscured, but can
+implied if the coordinate uncertainty is \~22 km.
+
+Due to these issues with the coordinate uncertainty, occurrence records
+from iNaturalist data are listed separately within the GBIF data
+section, and the associated coordinate uncertainty is provided.
+
+#### Data searches
+
+OBIS and GBIF records included in this section were extracted using the
+robis (Provoost & Bosch, 2021) and rgbif (Chamberlain et al., 2021) R
+packages, respectively. Data in this report were compiled for fish and
+invertebrate species that have been listed by SARA, and/or assessed by
+COSEWIC within the user-defined search area. The code used for these
+searches can be found here:
+<https://github.com/dfo-mar-odis/shinySpatialApp>.

---FILE: sections/obis/obisFish_en.Rmd---
@@ -19,7 +19,7 @@ load_rdata(c(""obisFish_rr"", ""gbifFish_rr""), regionStr, env = environment())
 ```
 
 ```{r child = here::here(""sections/obis/obisCommon_en.Rmd""), eval=!exists('commonObis')}
-# chunk will only run if commonObis variable does not exist, set in common obis.
+# chunk will only run if commonObis variable does not exist, set in common obis, removed in commonIntro.
 ```
 
 #### ***Area-specific OBIS fish and invertebrate search results***

---FILE: sections/obis/obisFish_fr.Rmd---
@@ -13,44 +13,93 @@ if (FALSE) { #load in data:
 }
 ```
 
-### **Système d’information sur la biodiversité des océans (SIBO)**  
-
-```{r obis-load, include=FALSE}
-load_rdata(c(""obisFish_rr""), ""MAR"", env = environment())
+```{r obis-gbif-load, include=FALSE}
+load_rdata(c(""obisFish_rr"", ""gbifFish_rr""), regionStr, env = environment())
 ```
 
-```{r obis-meta, results='asis'}
-write_meta(obisFish_rr, ""FR"")
+```{r child = here::here(""sections/obis/obisCommon_fr.Rmd""), eval=!exists('commonObis')}
+# chunk will only run if commonObis variable does not exist, set in common obis, removed in commonIntro.
 ```
 
-Le SIBO est un centre mondial de données et d’information en libre accès sur la biodiversité marine pour la science, la conservation et le développement durable. Il a pour vision de bâtir et de maintenir une alliance mondiale qui collabore avec les communautés scientifiques pour faciliter l’accès libre et ouvert à la biodiversité et aux données et informations biogéographiques sur la vie marine, ainsi que leur application. Des recherches du SIBO ont été effectuées pour trouver d’autres documents pertinents pour les espèces inscrites en vertu de la LEP ou évaluées par le COSEPAC. Les versions futures de cet outil de production de rapports viseront à élargir nos vérifications de la qualité de la base de données du SIBO.
-
 #### ***Résultats de recherche du SIBO sur les poissons et les invertébrés par zone***
 
 ```{r obis-results, include=FALSE, cache=FALSE}
 outputList <- master_intersect(obisFish_rr$data_sf, mapDataList, Year = minYear)
 
-obisTable <- create_sar_tables(outputList$studyData, listed_species, extraCols = c())$sarData
+obisTable <- create_sar_tables(outputList$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 summarySarTable <- add_col_to_sar_summary(summarySarTable, ""[OBIS](#OBIS-section)"", obisTable, ""Common Name"", ""Common Name"")
 ```
-*
+
 ```{r obis-check, echo=FALSE, results='asis',}
 Report_obis <- if (is.null(outputList$studyData)) {
-  ""Il n’y a aucun registre pertinent dans le système d’information sur la biodiversité des océans (SIB)O pour cette zone de recherche.""
+  ""* There are no relevant records in the Ocean Biodiversity Information System (OBIS) for this search area.""
 } else {
-  ""Il y a des registres pertinents dans le système d’information sur la biodiversité des océans (SIB)O pour cette zone de recherche.""
+  ""* There are relevant records in the Ocean Biodiversity Information System (OBIS) for this search area.""
 }
 Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
-```{r obis-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisFish_rr, ""FR""), ' Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) a été utilisée pour rechercher des informations dans les registres d’observation du SIBO sur les espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>')}
+
+```{r obis-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisFish_rr, ""FR""), 'Map of Ocean Biodiversity Information System (OBIS) observation records (black circles) of fish or invertebrate species observed within the search area (red outline) and listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }
 ```
 
-```{r obis-table, echo=FALSE, results='asis', caption=""Les espèces prioritaires avec des observations contenues dans la base de données du SIBO, dans la zone de recherche.""}
+```{r obis-table, echo=FALSE, results='asis'}
 if (!is.null(outputList$studyData)) {
-  knitr::kable(obisTable, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Registres d’observation du système d’information sur la biodiversité des océans (SIBO) des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+  knitr::kable(obisTable, align=""l"", caption=paste(write_caption_blurb(obisFish_rr, ""FR""), ""Ocean Biodiversity Information System (OBIS) observation records of fish and invertebrate species observed within the search area, and listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. URLs contain links to a complete dataset description. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+
+
+#### ***Area-specific GBIF  search results***
+
+```{r gbif-results, cache=FALSE, include=FALSE}
+inaturalist_sf = subset(gbifFish_rr$data_sf, title == ""iNaturalist Research-grade Observations"")
+inaturalistClipped <- master_intersect(inaturalist_sf, mapDataList)
+inaturalistTable <- create_sar_tables(inaturalistClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
+
+otherGbif_sf = subset(gbifFish_rr$data_sf, title != ""iNaturalist Research-grade Observations"")
+gbifClipped <- master_intersect(otherGbif_sf, mapDataList)
+gbifTable <- create_sar_tables(gbifClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
+
+
+# Add to summary tables!
+
+```
+
+```{r gbif-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+reportGbif <-  if (is.null(gbifClipped$studyData)) {
+  ""*	There are no relevant records in the Global Biodiversity Information Facility (GBIF) for this search area.""
+} else if (is.null(inaturalistClipped$studyData)){
+  ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF) for this search area.""
+} else {
+  ""*	There are relevant records in the Global Biodiversity Information Facility (GBIF) including iNaturalist entries for this search area.""  
+}
+writeLines(reportGbif)
+```
+
+```{r gbif-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbifFish_rr, ""FR""), 'Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+if (!is.null(gbifClipped$studyData)) {
+  plot_rr_sf(areaMap, gbifClipped$mapData, attribute=gbifFish_rr$attribute)
+}
+```
+
+```{r gbif-table, echo=FALSE, results='asis'}
+if (!is.null(gbifClipped$studyData)) {
+  knitr::kable(gbifTable, align=""l"", caption=paste(write_caption_blurb(gbifFish_rr, ""FR""), ""Global Biodiversity Information Facility (GBIF) observation records of fish and invertebrate species observed within the search area, and listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. URLs contain links to a complete dataset description. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. ""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+
+```{r inaturalist-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbifFish_rr, ""FR""), 'Research-grade iNaturalist observations within the search area (red outline) of fish or invertebrate species that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Observations are coloured to show coordinate uncertainties of the data, where observations with coordinate uncertainties >20 km represent locations that have been obscured due to geoprivacy concerns (e.g., hunting). NAs refer to observations with no provided coordinate uncertainty. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. ')}
+if (!is.null(inaturalistClipped$studyData)) {
+  plot_rr_sf(areaMap, inaturalistClipped$mapData, attribute=gbifFish_rr$attribute)
+}
+```
+
+```{r inaturalist-table, echo=FALSE, results='asis'}
+if (!is.null(inaturalistClipped$studyData)) {
+  knitr::kable(inaturalistTable, align=""l"", caption=paste(write_caption_blurb(gbifFish_rr, ""FR""), ""Research-grade iNaturalist observations within the search area (red outline) of fish or invertebrate species that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Observations are coloured to show coordinate uncertainties of the data, where observations with coordinate uncertainties >20 km represent locations that have been obscured due to geoprivacy concerns (e.g., hunting). NAs refer to observations with no provided coordinate uncertainty. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```",False,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,1b2e69c9d2937973ac7da778206e8e3b5fbb22a3,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-26T16:36:23Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-26T16:36:23Z,fix dir names,app/R/dataFunctions.R,False,True,True,False,1,1,2,"---FILE: app/R/dataFunctions.R---
@@ -3,7 +3,7 @@ source(here::here(""config.R""))
 # function to make sure that the data dir for this region is set up
 data_dir_check <- function() {
   data_dir <- here::here(""app/data/"", regionStr)
-  dirList <- file.path(data_dir, c(""open"", ""secure"", ""protected""))
+  dirList <- file.path(data_dir, c(""Open"", ""Secure"", ""Protected""))
   # if dir already exists, this will fail silently
   output <- lapply(dirList, dir.create, showWarnings = FALSE)
   return()",True,False,Environment / Configuration,3
dfo-mar-odis,shinySpatialApp,921361fa36cd986527ca56f76e047fba16e6e0dd,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-21T14:32:17Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-21T14:32:17Z,fix ebsa repport links,sections/ebsa/ebsa_preprocessing.R,False,True,True,False,0,2,2,"---FILE: sections/ebsa/ebsa_preprocessing.R---
@@ -17,8 +17,6 @@ openEbsa_rr <- get_opendata_rr(ebsaPkgId, ebsaResId, region_sf = region_sf,
                                checkDate = ebsaCheckDate)
 if(!is.null(openEbsa_rr)) {
   ebsa_rr <- openEbsa_rr
-  ebsa_rr$data_sf$Report_URL <- str_replace(ebsa_rr$data_sf$Report_URL,
-                                            "".pdf"", "".html"")
   ebsa_rr$metadata$qualityTier <- highQuality
   ebsa_rr$metadata$contact <- email_format(""carissa.philippe\\@dfo-mpo.gc.ca"")
   save(ebsa_rr, file = file.path(localFileSavePath, ""Open/ebsa_rr.RData""))",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,b0280ef3bf5fd9912cf05ce87b983a26aeb64e47,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-21T14:27:56Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-21T14:27:56Z,fix common obis section processing,sections/commonSections/commonIntro.Rmd;sections/obis/obisCet_en.Rmd;sections/obis/obisCommon_en.Rmd;sections/obis/obisFish_en.Rmd,True,False,True,False,9,5,14,"---FILE: sections/commonSections/commonIntro.Rmd---
@@ -16,6 +16,10 @@ if (!exists(""mapDataList"")){
   source(here::here(""config.R""))
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source) # check helpers.R for a   list of packages
   studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson"")) # last area from app.
-  intro_setup(studyArea, env = environment(), regionStr=regionStr)  
+  intro_setup(studyArea, env = environment(), regionStr=regionStr)
+  # need to clear this global env variable here.
+  if (exists(""commonObis"")) { 
+    rm(""commonObis"")
+  }
 }
 ```
\ No newline at end of file

---FILE: sections/obis/obisCet_en.Rmd---
@@ -27,8 +27,7 @@ cat('### **Ocean Biodiversity Information System and Global Biodiversity Informa
 ```
 
 ```{r child = here::here(""sections/obis/obisCommon_en.Rmd""), eval=!exists('commonObis')}
-# chunk will only run if commonObis variable does not exist.
-assign('commonObis', TRUE, envir = globalenv())
+# chunk will only run if commonObis variable does not exist, set in commonObis.rmd.
 ```
 
 #### ***Area-specific OBIS cetacean search results***

---FILE: sections/obis/obisCommon_en.Rmd---
@@ -12,6 +12,8 @@ editor_options:
 ### **Ocean Biodiversity Information System (OBIS)**{#OBIS-section}
 
 ```{r obis-load, include=FALSE}
+# prevent furture common obis sections from running
+assign('commonObis', TRUE, envir = globalenv()) 
 load_rdata(c(""obisFish_rr""), regionStr, env = environment())
 ```
 

---FILE: sections/obis/obisFish_en.Rmd---
@@ -19,8 +19,7 @@ load_rdata(c(""obisFish_rr"", ""gbifFish_rr""), regionStr, env = environment())
 ```
 
 ```{r child = here::here(""sections/obis/obisCommon_en.Rmd""), eval=!exists('commonObis')}
-# chunk will only run if commonObis variable does not exist.
-assign('commonObis', TRUE, envir = globalenv())
+# chunk will only run if commonObis variable does not exist, set in common obis.
 ```
 
 #### ***Area-specific OBIS fish and invertebrate search results***",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,5a9402f5cfa15808e75114bf85f575db893bd60c,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-06T14:22:34Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2022-01-06T14:22:34Z,fix conditional common obis section,sections/commonSections/commonData_preprocessing.R;sections/obis/gbif_preprocessing.R;sections/obis/obisCet_en.Rmd;sections/obis/obisCommon_en.Rmd;sections/obis/obisFish_en.Rmd;sections/obis/obis_preprocessing.R,True,True,True,False,54,55,109,"---FILE: sections/commonSections/commonData_preprocessing.R---
@@ -28,8 +28,6 @@ listed_species <- listed_species %>% rename(""SARA status"" = Schedule.status,
                                             ""COMMONNAME"" = Common_Name_upper,
                                             ""Scientific Name"" = Scientific_Name,
                                             ""Common Name"" = Common_Name)
-listed_species <- listed_species[!c(listed_species$`COSEWIC status` == ""No Status"" & listed_species$`SARA status` == ""No Status""), ]
-listed_species <- listed_species[!c(listed_species$`COSEWIC status` == ""Non-active"" & listed_species$`SARA status` == ""No Status""), ]
 row.names(listed_species) <- NULL
 
 # Cetacean legend file

---FILE: sections/obis/gbif_preprocessing.R---
@@ -81,6 +81,9 @@ gbif_df = dplyr::select(gbif_df, ""Scientific Name"", ""Common Name"", COSEWIC.popul
                         basisOfRecord, eventDate, coordinateUncertaintyInMeters,
                         decimalLatitude, decimalLongitude)
 
+names(gbif_df)[names(gbif_df) == 'url'] <- 'URL'
+names(gbif_df)[names(gbif_df) == 'citation'] <- 'Citation'
+
 # Separate out the iNaturalist records and the Machine Observations records for making tables/figures
 machineobs = subset(gbif_df, basisOfRecord == ""MACHINE_OBSERVATION"")
 everythingelse = subset(gbif_df, title != ""iNaturalist Research-grade Observations"" & # exclude iNaturalist data

---FILE: sections/obis/obisCet_en.Rmd---
@@ -16,38 +16,27 @@ if (FALSE) { #load in data:
 ```{r child = here::here(""sections/commonSections/commonCet.Rmd"")}
 ```
 
-### **Ocean Biodiversity Information System (OBIS) [for cetaceans]** {#obis-cetacean-section}
 
-```{r obis-cetacean-load, include=FALSE}
-load_rdata(c(""obisCet_rr""), regionStr, env = environment())
-```
+```{r obis-gbif-cet-load, include=FALSE}
+load_rdata(c(""obisCet_rr"", ""gbifCet_rr""), regionStr, env = environment())
 
-```{r obis-cetacean-meta, results='asis'}
-write_meta(obisCet_rr, ""EN"")
 ```
 
-OBIS is a global, open-access data and information clearing-house on marine biodiversity for science, conservation, and sustainable development [@OBIS]. Their vision is to build and maintain a global alliance that collaborates with scientific communities to facilitate free and open-access to, and application of, biodiversity and biogeographic data and information on marine life. OBIS accepts data from any organization, consortium, project or individual who wishes to contribute data (OBIS, 2021). As of December 2021, OBIS has over 80 million species occurrence records and over 4,300 datasets globally.
-
-
-### **Global Biodiversity Information Facility (GBIF)** {#gbif-fish-section}
-
-```{r gbif-cetacean-load, include=FALSE}
-load_rdata(c(""gbifCet_rr""), regionStr, env = environment())
+```{r cet-short-obis, results = 'asis', eval=exists('commonObis')}
+cat('### **Ocean Biodiversity Information System and Global Biodiversity Information Facility** \n\n To avoid duplication of text, please refer to the overview for OBIS and GBIF provided in the Fish and Invertebrates section. ')
 ```
 
-```{r gbif-cetacean-meta, results='asis'}
-write_meta(gbifCet_rr, ""EN"")
+```{r child = here::here(""sections/obis/obisCommon_en.Rmd""), eval=!exists('commonObis')}
+# chunk will only run if commonObis variable does not exist.
+assign('commonObis', TRUE, envir = globalenv())
 ```
 
-GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth (GBIF, 2021). Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of December 2021, GBIF has over 1.9 billion species occurrence records and over 63,000 datasets globally. 
-
-
 #### ***Area-specific OBIS cetacean search results***
 
 ```{r obis-cetecean, cache=FALSE, include=FALSE}
 obisClipped <- master_intersect(obisCet_rr$data_sf, mapDataList)
 
-obisTable <- create_sar_tables(obisClipped$studyData, listed_species, extraCols = c(""url"", ""citation""))$sarData
+obisTable <- create_sar_tables(obisClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 
 linkedSectionText <- ""[OBIS-Cetaceans](##obis-cetacean-section)""
 if (!is.null(obisClipped$studyData)) {
@@ -57,7 +46,6 @@ if (!is.null(obisClipped$studyData)) {
  summarySarTable <- add_col_to_sar_summary(summarySarTable, linkedSectionText, NULL, ""specIndex"", linkedSectionText)
 }
 
-
 ```
 
 ```{r obis-cetecean-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
@@ -86,12 +74,12 @@ if (!is.null(obisClipped$studyData)) {
 ```{r gbif-cetacean-results, cache=FALSE, include=FALSE}
 inaturalist_sf = subset(gbifCet_rr$data_sf, title == ""iNaturalist Research-grade Observations"")
 inaturalistClipped <- master_intersect(inaturalist_sf, mapDataList)
-inaturalistTable <- create_sar_tables(inaturalistClipped$studyData, listed_species, extraCols = c(""url"", ""citation""))$sarData
+inaturalistTable <- create_sar_tables(inaturalistClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 
 
 otherGbif_sf = subset(gbifCet_rr$data_sf, title != ""iNaturalist Research-grade Observations"")
 gbifClipped <- master_intersect(otherGbif_sf, mapDataList)
-gbifTable <- create_sar_tables(gbifClipped$studyData, listed_species, extraCols = c(""url"", ""citation""))$sarData
+gbifTable <- create_sar_tables(gbifClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 # Add to summary tables!
 
 ```
@@ -109,7 +97,7 @@ writeLines(reportGbif)
 
 ```{r gbif-cetacean-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbifCet_rr, ""EN""), 'Map of Global Biodiversity Information Facility (GBIF) observation records of cetaceans observed within the search area (red outline), and listed by the Species at Risk Act (SARA) and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Coloured circles indicate individual observations for each whale species. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Absence may be related to low or no survey effort. Sightings information is known to under-represent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections.  Sightings near shore (< 300 m from the coastline) are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. Observations ≥ 300 m from shore were removed due to positional accuracy and species identification concerns. ')}
 if (!is.null(gbifClipped$studyData)) {
-  plot_rr_sf(areaMap, gbifClipped$mapData, attribute=gbifCet_rr$attribute)
+  plot_rr_sf(areaMap, gbifClipped$mapData, attribute=gbifCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }
 ```
 
@@ -120,7 +108,7 @@ if (!is.null(gbifClipped$studyData)) {
 ```
 ```{r inaturalist-cetaceans-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(gbifCet_rr, ""EN""), 'Research-grade iNaturalist observations within the search area (red outline) of cetacean species that have been added to the Global Biodiversity Information Facility (GBIF). Species included have been listed by the Species at Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Species designated as “Not at Risk” by SARA or COSEWIC are not included in this search. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. Observations are coloured to show coordinate uncertainties of the data, where observations with coordinate uncertainties >20 km represent locations that have been obscured due to geoprivacy concerns (e.g., hunting). NAs refer to observations with no provided coordinate uncertainty. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(inaturalistClipped$studyData)) {
-  plot_rr_sf(areaMap, inaturalistClipped$mapData, attribute=gbifCet_rr$attribute)
+  plot_rr_sf(areaMap, inaturalistClipped$mapData, attribute=gbifCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }
 ```
 

---FILE: sections/obis/obisCommon_en.Rmd---
@@ -9,6 +9,33 @@ editor_options:
     wrap: 72
 ---
 
+### **Ocean Biodiversity Information System (OBIS)**{#OBIS-section}
+
+```{r obis-load, include=FALSE}
+load_rdata(c(""obisFish_rr""), regionStr, env = environment())
+```
+
+```{r obis-meta, results='asis'}
+write_meta(obisFish_rr, ""EN"")
+```
+
+OBIS is a global, open-access data and information clearing-house on marine biodiversity for science, conservation, and sustainable development [@OBIS]. Their vision is to build and maintain a global alliance that collaborates with scientific communities to facilitate free and open-access to, and application of, biodiversity and biogeographic data and information on marine life. OBIS accepts data from any organization, consortium, project or individual who wishes to contribute data (OBIS, 2021). As of December 2021, OBIS has over 80 million species occurrence records and over 4,300 datasets globally.
+
+
+### **Global Biodiversity Information Facility (GBIF)** {#gbif-section}
+
+```{r gbif-load, include=FALSE}
+load_rdata(c(""gbifFish_rr""), regionStr, env = environment())
+```
+
+```{r gbif-meta, results='asis'}
+write_meta(gbifFish_rr, ""EN"")
+```
+
+GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth (GBIF, 2021). Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of December 2021, GBIF has over 1.9 billion species occurrence records and over 63,000 datasets globally. 
+
+
+
 ### Background descriptions for both OBIS and GBIF
 
 Both OBIS and GBIF are large online data portals, consisting of numerous

---FILE: sections/obis/obisFish_en.Rmd---
@@ -13,41 +13,22 @@ if (FALSE) { #load in data:
 }
 ```
 
-### **Ocean Biodiversity Information System (OBIS)**{#OBIS-section}
 
-```{r obis-load, include=FALSE}
-load_rdata(c(""obisFish_rr""), regionStr, env = environment())
+```{r obis-gbif-load, include=FALSE}
+load_rdata(c(""obisFish_rr"", ""gbifFish_rr""), regionStr, env = environment())
 ```
 
-```{r obis-meta, results='asis'}
-write_meta(obisFish_rr, ""EN"")
-```
-
-OBIS is a global, open-access data and information clearing-house on marine biodiversity for science, conservation, and sustainable development [@OBIS]. Their vision is to build and maintain a global alliance that collaborates with scientific communities to facilitate free and open-access to, and application of, biodiversity and biogeographic data and information on marine life. OBIS accepts data from any organization, consortium, project or individual who wishes to contribute data (OBIS, 2021). As of December 2021, OBIS has over 80 million species occurrence records and over 4,300 datasets globally.
-
-
-### **Global Biodiversity Information Facility (GBIF)** {#gbif-fish-section}
-
-```{r gbif-load, include=FALSE}
-load_rdata(c(""gbifFish_rr""), regionStr, env = environment())
-```
-
-```{r gbif-meta, results='asis'}
-write_meta(gbifFish_rr, ""EN"")
-```
-
-GBIF is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth (GBIF, 2021). Similar to OBIS, GBIF accepts data from various contributors such as university laboratories, government departments or private research institutions, although GBIF accepts both marine and terrestrial species data. As of December 2021, GBIF has over 1.9 billion species occurrence records and over 63,000 datasets globally. 
-
-```{r child = here::here(""sections/obis/obisCommon_en.Rmd"")}
-
+```{r child = here::here(""sections/obis/obisCommon_en.Rmd""), eval=!exists('commonObis')}
+# chunk will only run if commonObis variable does not exist.
+assign('commonObis', TRUE, envir = globalenv())
 ```
 
 #### ***Area-specific OBIS fish and invertebrate search results***
 
 ```{r obis-results, include=FALSE, cache=FALSE}
 outputList <- master_intersect(obisFish_rr$data_sf, mapDataList, Year = minYear)
 
-obisTable <- create_sar_tables(outputList$studyData, listed_species, extraCols = c(""url"", ""citation""))$sarData
+obisTable <- create_sar_tables(outputList$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 summarySarTable <- add_col_to_sar_summary(summarySarTable, ""[OBIS](#OBIS-section)"", obisTable, ""Common Name"", ""Common Name"")
 ```
 
@@ -79,11 +60,11 @@ if (!is.null(outputList$studyData)) {
 ```{r gbif-results, cache=FALSE, include=FALSE}
 inaturalist_sf = subset(gbifFish_rr$data_sf, title == ""iNaturalist Research-grade Observations"")
 inaturalistClipped <- master_intersect(inaturalist_sf, mapDataList)
-inaturalistTable <- create_sar_tables(inaturalistClipped$studyData, listed_species, extraCols = c(""url"", ""citation""))$sarData
+inaturalistTable <- create_sar_tables(inaturalistClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 
 otherGbif_sf = subset(gbifFish_rr$data_sf, title != ""iNaturalist Research-grade Observations"")
 gbifClipped <- master_intersect(otherGbif_sf, mapDataList)
-gbifTable <- create_sar_tables(gbifClipped$studyData, listed_species, extraCols = c(""url"", ""citation""))$sarData
+gbifTable <- create_sar_tables(gbifClipped$studyData, listed_species, extraCols = c(""URL"", ""Citation""))$sarData
 
 
 # Add to summary tables!

---FILE: sections/obis/obis_preprocessing.R---
@@ -3,8 +3,6 @@ source(here::here(""app/R/dataFunctions.R""))
 library(robis)
 source(here::here(""config.R""))
 
-
-
 loadResult <- load_rdata(c(""CommonData"", ""obisCet_rr"", ""obisFish_rr""), regionStr)
 
 #-------------------OBIS-------------------
@@ -61,6 +59,10 @@ obis_df = dplyr::select(comboDataNS.remove, scientificName, ""Common Name"",
                    basisOfRecord, shoredistance, decimalLatitude, 
                    decimalLongitude)
 
+names(obis_df)[names(obis_df) == 'url'] <- 'URL'
+names(obis_df)[names(obis_df) == 'citation'] <- 'Citation'
+
+
 # Things I still need to do:
 # Separate fish/invertebrates from cetaceans (this should also remove sea turtle records)
 # Once that is done, exclude cetacean data that are >300m from shore i.e. ""shoredistance < -300""",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,be6fa83e52ec6cf0e409448123c0a0edee3cad26,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-12-02T15:59:19Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-12-02T15:59:19Z,"reorder rmds, fix cron schedule, dump marfis/isdb plot",.github/workflows/opendataCheck.yml;app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/report_cetaceans_FR.Rmd;app/Rmd/report_fish_EN.Rmd;app/Rmd/report_fish_FR.Rmd;sections/isdb-marfis/isdbMarfis_en.Rmd;sections/isdb-marfis/isdbMarfis_fr.Rmd,True,False,True,False,16,33,49,"---FILE: .github/workflows/opendataCheck.yml---
@@ -9,7 +9,8 @@ on:
         default: 'World'
         required: false
   schedule:
-  - cron: ""0 0 10 * *""
+  # run at 10am every wednesday
+  - cron: ""0 10 * * 3""
 
 jobs:
   open_data_check:

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -14,6 +14,9 @@ Please refer to the Passive Acoustic Cetacean Map (PACM) to explore when and whe
 This module does not endeavor to describe every source of information available; the data presented does not represent all available cetacean sightings data within the search area and additional sightings may be available from other sources, or more recent data may be available than what is presented here. In addition to the presence-only data, there may be data available that can be used to support species-specific conclusions about habitat preferences and possible or known occurrence near and within the search area. Please refer to the cited publications for additional information and contact Angelia.Vanderlaan@dfo-mpo.gc.ca (North Atlantic Right Whales) and Hilary.Moors-Murphy@dfo-mpo.gc.ca (other cetacean species) to discuss additional sources of information (e.g., acoustic detections). Data and sources not explicitly included in this report include information from past studies/publications, acoustic detections, prey sampling and tagging. While the value of these data in predicting and describing cetacean occurrences is vital, these types of data are not available for all species and are not yet available for data querying. In the future, as information from other data sources becomes available, these new data will help to provide a more comprehensive understanding of cetacean habitat use and occurrence in the search areas.
 
 
+```{r child = here::here(""sections/obis/obisCet_en.Rmd"")}
+```
+
 ```{r child = here::here(""sections/wsdb/wsdb_en.Rmd"")}
 ```
 
@@ -23,10 +26,6 @@ This module does not endeavor to describe every source of information available;
 ```{r child = here::here(""sections/narwc/narwc_en.Rmd"")}
 ```
 
-```{r child = here::here(""sections/obis/obisCet_en.Rmd"")}
-```
-
-
 ```{r cetacean-summary-table, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
 if (FALSE) {
   whaleSummaryTable <- subset(whaleSummaryTable, select = -c(specIndex))
@@ -40,7 +39,6 @@ if (FALSE) {
 }
 ```
 
-
 ```{r child = here::here(""sections/sdm/sdm_en.Rmd"")}
 ```
 

---FILE: app/Rmd/report_cetaceans_FR.Rmd---
@@ -16,6 +16,8 @@ Veuillez consulter le Passive Acoustic Cetacean Map (PACM) pour examiner quand e
 La présente section ne vise pas à décrire toutes les sources d’information disponibles; les données présentées ne représentent pas toutes les données disponibles sur les observations de cétacés dans la zone de recherche, et d’autres observations peuvent provenir d’autres sources ou de données plus récentes que celles présentées ici. En plus des données sur la présence seulement, certaines des données disponibles peuvent être utilisées pour appuyer les conclusions propres aux espèces au sujet des préférences en matière d’habitat et de la présence possible ou connue à proximité et à l’intérieur de la zone de recherche. Veuillez consulter les publications citées pour obtenir de plus amples renseignements et communiquer avec Angelia Vanderlaan (baleines noires de l’Atlantique Nord) et Hilary Moors-Murphy (autres espèces de cétacés) pour discuter d’autres sources d’information (p. ex., détections acoustiques). Les données et les sources qui ne sont pas explicitement incluses dans le présent rapport comprennent des renseignements tirés d’études ou de publications antérieures, des détections acoustiques, l’échantillonnage des proies et le marquage. Bien que la valeur de ces données dans la prévision et la description de la présence des cétacés soit vitale, ces types de données ne sont pas disponibles pour toutes les espèces et ne peuvent pas encore être interrogées. À l’avenir, à mesure que l’information provenant d’autres sources de données deviendra disponible, ces nouvelles données aideront à mieux comprendre l’utilisation de l’habitat des cétacés et la présence de ceux-ci dans les zones de recherche.
 
 
+```{r child = here::here(""sections/obis/obisCet_fr.Rmd"")}
+```
 
 ```{r child = here::here(""sections/wsdb/wsdb_fr.Rmd"")}
 ```
@@ -26,9 +28,6 @@ La présente section ne vise pas à décrire toutes les sources d’information
 ```{r child = here::here(""sections/narwc/narwc_fr.Rmd"")}
 ```
 
-```{r child = here::here(""sections/obis/obisCet_fr.Rmd"")}
-```
-
 ```{r cetacean-summary-table, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
 if (FALSE) {
   whaleSummaryTable <- subset(whaleSummaryTable, select = -c(specIndex))

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -20,11 +20,13 @@ This module describes outputs of fish and marine invertebrates derived from a va
 ```{r child = here::here(""sections/isdb-marfis/isdbMarfis_en.Rmd"")}
 ```
 
-```{r child = here::here(""sections/obis/obisFish_en.Rmd"")}
-```
-
 ```{r child = here::here(""sections/sturg/sturg_en.Rmd"")}
 ```
 
 ```{r child = here::here(""sections/ocearch/ocearch_en.Rmd"")}
 ```
+
+```{r child = here::here(""sections/obis/obisFish_en.Rmd"")}
+```
+
+

---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -21,12 +21,13 @@ La présente section décrit les résultats tirés des sources de données suiva
 ```{r child = here::here(""sections/isdb-marfis/isdbMarfis_fr.Rmd"")}
 ```
 
-```{r child = here::here(""sections/obis/obisFish_fr.Rmd"")}
-```
-
 ```{r child = here::here(""sections/sturg/sturg_fr.Rmd"")}
 ```
 
 ```{r child = here::here(""sections/ocearch/ocearch_fr.Rmd"")}
 ```
 
+```{r child = here::here(""sections/obis/obisFish_fr.Rmd"")}
+```
+
+

---FILE: sections/isdb-marfis/isdbMarfis_en.Rmd---
@@ -85,15 +85,6 @@ Report_marfis<-noquote(Report_marfis)
 writeLines(Report_marfis)
 ```
 
-```{r marfis-isdb-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(marfis_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.')}
-if (!is.null(outputListI$studyData) & !is.null(outputListM$studyData)) {
-  areaMap + geom_point(data = outputListI$mapPoints, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = outputListM$mapPoints, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListI$studyData)) {
-    areaMap + geom_point(data = outputListI$mapPoints, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListM$studyData)) {
-        areaMap + geom_point(data = outputListM$mapPoints, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-}
-```
 ```{r isdb-SAR-table}
 if (!is.null(outputListI$studyData)) {
 knitr::kable(isdbSarTable, align=""l"", caption=paste(write_caption_blurb(isdb_rr, ""EN""), ""Industry Survey Database (ISDB) records of species observed within the search area and listed by the <i>Species at Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>""), booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")

---FILE: sections/isdb-marfis/isdbMarfis_fr.Rmd---
@@ -83,15 +83,6 @@ Report_marfis<-noquote(Report_marfis)
 writeLines(Report_marfis)
 ```
 
-```{r marfis-isdb-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(isdb_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) utilisée pour demander des renseignements agrégés provenant des dossiers d’observation du Système d’information sur les pêches des Maritimes (SIPMAR) et/ou de la Base de données des relevés de l’industrie (BDRI), qui sont présentés sous forme de points noirs, pour toutes les espèces. La règle des cinq n’a pas été appliquée.')}
-if (!is.null(outputListI$studyData) & !is.null(outputListM$studyData)) {
-  areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListI$studyData)) {
-    areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListM$studyData)) {
-        areaMap + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-}
-```
 ```{r isdb-SAR-table}
 if (!is.null(outputListI$studyData)) {
 knitr::kable(isdbSarTable, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation de la base de données des relevés de l’industrie des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>TSi une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,17ad207f67bf0f5cb2d4b12d07df0f232971a27d,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-24T14:35:46Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-24T14:35:46Z,"set fig heights, fix sdm axis ticks",app/R/plotFunctions.R;app/R/tableFunctions.R;sections/blueWhaleHab/bwhab_en.Rmd;sections/blueWhaleHab/bwhab_fr.Rmd;sections/conservationSites/conservationSites_en.Rmd;sections/conservationSites/conservationSites_fr.Rmd;sections/crithab/crithab_en.Rmd;sections/crithab/crithab_fr.Rmd;sections/ebsa/ebsa_en.Rmd;sections/ebsa/ebsa_fr.Rmd;sections/ilts/ilts_en.Rmd;sections/ilts/ilts_fr.Rmd;sections/isdb-marfis/isdbMarfis_en.Rmd;sections/isdb-marfis/isdbMarfis_fr.Rmd;sections/narwc/narwc_en.Rmd;sections/narwc/narwc_fr.Rmd;sections/nbw/nbw_en.Rmd;sections/nbw/nbw_fr.Rmd;sections/obis/obisCet_en.Rmd;sections/obis/obisCet_fr.Rmd;sections/obis/obisFish_en.Rmd;sections/obis/obisFish_fr.Rmd;sections/ocearch/ocearch_en.Rmd;sections/ocearch/ocearch_fr.Rmd;sections/pasBay/pasBay_en.Rmd;sections/pasBay/pasBay_fr.Rmd;sections/rockweed/rockweed_en.Rmd;sections/rockweed/rockweed_fr.Rmd;sections/rv/rv_en.Rmd;sections/rv/rv_fr.Rmd;sections/sardist/sardist_en.Rmd;sections/sardist/sardist_fr.Rmd;sections/sdm/sdm_en.Rmd;sections/sdm/sdm_fr.Rmd;sections/sturg/sturg_en.Rmd;sections/sturg/sturg_fr.Rmd;sections/whitehead/whitehead_en.Rmd,True,True,True,False,76,62,138,"---FILE: app/R/plotFunctions.R---
@@ -318,8 +318,8 @@ get_rr_color_map <- function(dataCol) {
 #
 # Outputs: ggplot object with the 4 plots.
 
-plot_cetaceans_4grid<-function(fin_whale_sf, harbour_porpoise_sf,
-                               humpback_whale_sf, sei_whale_sf, studyArea,
+plot_cetaceans_4grid<-function(finWhale_sf, harbourPorpoise_sf,
+                               humpbackWhale_sf, seiWhale_sf, studyArea,
                                landLayer, bufKm, bounds_sf) {
   # buf is in km, and now converted to degrees
   buf <- bufKm / 100
@@ -337,26 +337,26 @@ plot_cetaceans_4grid<-function(fin_whale_sf, harbour_porpoise_sf,
   
   land <- sf::st_crop(landLayer, bboxBuf)
   bound <- sf::st_crop(bounds_sf, bboxBuf)
-  fin_whale_sf <- sf::st_crop(fin_whale_sf, bboxBuf)
-  harbour_porpoise_sf <- sf::st_crop(harbour_porpoise_sf, bboxBuf)
-  humpback_whale_sf <- sf::st_crop(humpback_whale_sf, bboxBuf)
-  sei_whale_sf <- sf::st_crop(sei_whale_sf, bboxBuf)
+  finWhale_sf <- sf::st_crop(finWhale_sf, bboxBuf)
+  harbourPorpoise_sf <- sf::st_crop(harbourPorpoise_sf, bboxBuf)
+  humpbackWhale_sf <- sf::st_crop(humpbackWhale_sf, bboxBuf)
+  seiWhale_sf <- sf::st_crop(seiWhale_sf, bboxBuf)
   
   
   #Fin Whale
-  finWhalePlot <- whale_ggplot(fin_whale_sf, bound, land, studyArea,
+  finWhalePlot <- whale_ggplot(finWhale_sf, bound, land, studyArea,
                                ""Fin Whale"", bboxBuf)
   
   #Harbour Porpoise
-  harbourPorpoisePlot <- whale_ggplot(harbour_porpoise_sf, bound, land, studyArea,
+  harbourPorpoisePlot <- whale_ggplot(harbourPorpoise_sf, bound, land, studyArea,
                                       ""Harbour Porpoise"", bboxBuf)
   
   #humpback whale
-  humpbackWhalePlot <- whale_ggplot(humpback_whale_sf, bound, land, studyArea,
+  humpbackWhalePlot <- whale_ggplot(humpbackWhale_sf, bound, land, studyArea,
                                     ""Humpback Whale"", bboxBuf)
   
   #Sei Whale
-  seiWhalePlot <- whale_ggplot(sei_whale_sf, bound, land, studyArea,
+  seiWhalePlot <- whale_ggplot(seiWhale_sf, bound, land, studyArea,
                                ""Sei Whale"", bboxBuf)
   
   #Arrange all 4 cetaceans into grid
@@ -537,19 +537,20 @@ format_ggplot <- function(ggplotIn, bbox) {
                                       (0.7 * (bbox$xmax[[1]] - bbox$xmin[[1]])))
   
   ggplotOut <- ggplotIn +
-    annotation_custom(grid::textGrob(""DFO Internal Use Only"", rot=rotTheta,
-                                     gp=grid::gpar(fontsize=30, alpha=0.5, col=""grey70"", fontface=""bold"")),
+    annotation_custom(grid::textGrob(""DFO Internal Use Only"", rot = rotTheta,
+                                     gp = grid::gpar(fontsize = 30, alpha = 0.5,
+                                                   col = ""grey70"",
+                                                   fontface = ""bold"")),
                       xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
     annotation_scale(location = ""bl"") +
     theme_bw() +
     labs(x = """",
          y = """",
          col = """")  +
-    theme(axis.title.y = element_text(size = 13)) +
-    theme(axis.title.x = element_text(size = 13)) + 
     theme(axis.text.x = element_text(size = 14)) + 
     theme(axis.text.y = element_text(size = 14))
   
+  
   # crop to bbox if used:
   if (class(bbox) == ""bbox"") {
     ggplotOut <- ggplotOut + coord_sf(xlim = c(bbox[[""xmin""]], bbox[[""xmax""]]),
@@ -574,5 +575,12 @@ whale_ggplot <- function(whale_sf, bound, landLayer, studyArea, plotTitle, plotB
   
   outPlot <- format_ggplot(rawPlot, plotBbox)
   
+  #set outplot axis tick marks
+  axisSigFigs <- ceiling(log10(plotBbox$xmax - plotBbox$xmin))
+  digits <- ifelse(axisSigFigs < 0, -axisSigFigs, 1)
+  breakVec <- round(seq(plotBbox$xmin, plotBbox$xmax, length.out = 5),
+                    digits = digits)
+  outPlot <- outPlot + scale_x_continuous(breaks = breakVec) 
+  
   return(outPlot)
 }
\ No newline at end of file

---FILE: app/R/tableFunctions.R---
@@ -155,6 +155,7 @@ create_sar_tables <- function(data_sf, sarTable, uniqueCols = c(""geometry""), ext
 
   sarData <- dplyr::inner_join(allSpeciesData, sarTable, by=""Scientific Name"", suffix = c("".x"", """"))
   sarData <- dplyr::select(sarData, c(""Scientific Name"", ""Common Name"", ""SARA status"", ""COSEWIC status"", all_of(extraCols)))
+  names(sarData) <- c(""Scientific Name"", ""Common Name"", ""SARA Status"", ""COSEWIC Status"", all_of(extraCols))
 
   allSpeciesData$`Scientific Name` <- italicize_col(allSpeciesData$`Scientific Name`)
   sarData$`Scientific Name` <- italicize_col(sarData$`Scientific Name`)

---FILE: sections/blueWhaleHab/bwhab_en.Rmd---
@@ -56,15 +56,15 @@ polyText <- noquote(polyText)
 writeLines(polyText)
 ```
 
-```{r bw-region-plot, fig.height=4, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""EN""), 'Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging and migration. These areas identified in the report by Lesage et al. (2018) are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population.')}
+```{r bw-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""EN""), 'Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging and migration. These areas identified in the report by Lesage et al. (2018) are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population.')}
 if (!is.null(blueWhaleHab_rr$data_sf)){
   bwPlotList <- plot_rr_sf(regionMap, blueWhaleHab_rr$data_sf, blueWhaleHab_rr$attribute, getColorMap = TRUE)
   bwPlotList$polyMap
 }  
 ```
 
 
-```{r bw-area-plot, fig.height=4, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""EN""), ' Map of Blue Whale Important Habitat located within the search area (red outline))')}
+```{r bw-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""EN""), ' Map of Blue Whale Important Habitat located within the search area (red outline))')}
 if (!is.null(clipped$mapData)){
   plot_rr_sf(areaMap, clipped$mapData, blueWhaleHab_rr$attribute, colorMap = bwPlotList$colorMap)
 }

---FILE: sections/blueWhaleHab/bwhab_fr.Rmd---
@@ -55,14 +55,14 @@ polyText<-noquote(polyText)
 writeLines(polyText)
 ```
 
-```{r bw-region-plot, fig.height=4, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""FR""), 'Habitat important pour le rorqual bleu dans l’ouest de l’Atlantique-Nord. Zones délimitées par des polygones dans les eaux canadiennes qui sont importantes pour les rorquals bleus pour l’alimentation et le transit. Ces zones d’habitat désignées dans le rapport par Lesage et al. (2018) sont considérées comme importantes pour la survie et le rétablissement des rorquals bleus de la population de l’ouest de l’Atlantique Nord. Les rorquals bleus ont fort probablement besoin d’utiliser plusieurs de ces habitats importants pour répondre à leurs besoins biologiques. Par conséquent, les corridors d’accès et l’habitat qu’ils relient doivent être considérés comme tout aussi importants pour la population.')}
+```{r bw-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""FR""), 'Habitat important pour le rorqual bleu dans l’ouest de l’Atlantique-Nord. Zones délimitées par des polygones dans les eaux canadiennes qui sont importantes pour les rorquals bleus pour l’alimentation et le transit. Ces zones d’habitat désignées dans le rapport par Lesage et al. (2018) sont considérées comme importantes pour la survie et le rétablissement des rorquals bleus de la population de l’ouest de l’Atlantique Nord. Les rorquals bleus ont fort probablement besoin d’utiliser plusieurs de ces habitats importants pour répondre à leurs besoins biologiques. Par conséquent, les corridors d’accès et l’habitat qu’ils relient doivent être considérés comme tout aussi importants pour la population.')}
 if (!is.null(blueWhaleHab_rr$data_sf)){
   bwPlotList <- plot_rr_sf(regionMap, blueWhaleHab_rr$data_sf, blueWhaleHab_rr$attribute, getColorMap = TRUE)
   bwPlotList$polyMap
 }  
 ```
 
-```{r bw-area-plot, fig.height=4, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""FR""), 'La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour le rorqual bleu.')}
+```{r bw-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(blueWhaleHab_rr, ""FR""), 'La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour le rorqual bleu.')}
 if (!is.null(clipped$mapData)){
   plot_rr_sf(areaMap, clipped$mapData, blueWhaleHab_rr$attribute, colorMap = bwPlotList$colorMap)
 }

---FILE: sections/conservationSites/conservationSites_en.Rmd---
@@ -40,14 +40,14 @@ mpaCheckOuput <- if(!is.null(mpaClipped$studyData)){
 writeLines(mpaCheckOuput)
 ```
 
-```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(conservationSites_rr, ""EN""), 'Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. Boundaries of the proposed new sites are preliminary and subject to change following engagement and consultation.')}
+```{r mpa-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(conservationSites_rr, ""EN""), 'Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. Boundaries of the proposed new sites are preliminary and subject to change following engagement and consultation.')}
 if (!is.null(mpaClipped$regionData)){
   plot_rr_sf(regionMap, mpaClipped$regionData, conservationSites_rr$attribute, outlines=FALSE, colorMap = mpaCols,
                             alphaMap = mpaAlphas)
 }
 ```
 
-```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(conservationSites_rr, ""EN""), 'Map of the Draft Conservation Network Design in the search area defined by the user (red outline). Please see table below for names of each specific area. Boundaries of the proposed new sites are preliminary and subject to change following engagement and consultation.')}
+```{r mpa-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(conservationSites_rr, ""EN""), 'Map of the Draft Conservation Network Design in the search area defined by the user (red outline). Please see table below for names of each specific area. Boundaries of the proposed new sites are preliminary and subject to change following engagement and consultation.')}
 if(!is.null(mpaClipped$studyData)){
   mpaStudyLabels <- filter(st_centroid(mpaClipped$mapData), Id > 0) %>% dplyr::select(c(""Id""))
 

---FILE: sections/conservationSites/conservationSites_fr.Rmd---
@@ -55,14 +55,14 @@ mpaCheckOuput <- if(!is.null(mpaClipped$studyData)){
 writeLines(mpaCheckOuput)
 ```
 
-```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation. '}
+```{r mpa-region-plot, fig.height=7, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation. '}
 if (!is.null(mpaClipped$regionData)){
   plot_rr_sf(regionMap, mpaClipped$regionData, conservationSites_rr$attribute, outlines=FALSE, colorMap = mpaCols,
                             alphaMap = mpaAlphas)
 }
 ```
 
-```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline). Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation.'}
+```{r mpa-area-plot, fig.height=7, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline). Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation.'}
 if(!is.null(mpaClipped$studyData)){
   mpaStudyLabels <- filter(st_centroid(mpaClipped$mapData), Id > 0) %>% dplyr::select(c(""Id""))
 

---FILE: sections/crithab/crithab_en.Rmd---
@@ -71,7 +71,7 @@ if(critHabCheck){
 
 ```
 <br>
-```{r crithab-region-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""EN""), 'Map summarizing critical habitat of Species at Risk listed as Endangered or Threatened under the <i>Species at Risk Act</i> (SARA) in the Scotian Shelf Bioregion. Please see table above for complementary information. Critical habitat is defined under section 2 of SARA as: “the habitat that is necessary for the survival or recovery of a listed wildlife species and that is identified as the species’ critical habitat in the recovery strategy or in an action plan for the species.” Critical habitat is identified in a species’ Recovery Strategy or Action Plan, posted on the [SAR Public Registry](http://www.sararegistry.gc.ca). This is not the authoritative source or advice for Species at Risk data. Please access the Species at Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create an authoritative report.')}
+```{r crithab-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""EN""), 'Map summarizing critical habitat of Species at Risk listed as Endangered or Threatened under the <i>Species at Risk Act</i> (SARA) in the Scotian Shelf Bioregion. Please see table above for complementary information. Critical habitat is defined under section 2 of SARA as: “the habitat that is necessary for the survival or recovery of a listed wildlife species and that is identified as the species’ critical habitat in the recovery strategy or in an action plan for the species.” Critical habitat is identified in a species’ Recovery Strategy or Action Plan, posted on the [SAR Public Registry](http://www.sararegistry.gc.ca). This is not the authoritative source or advice for Species at Risk data. Please access the Species at Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create an authoritative report.')}
 if (!is.null(crithab_rr$data_sf)){
   critPlotList <- plot_rr_sf(regionMap, crithab_rr$data_sf,
                              crithab_rr$attribute, legendName = legendNameCrithab,
@@ -80,20 +80,20 @@ if (!is.null(crithab_rr$data_sf)){
 }  
 ```
 <br>
-```{r crithab-area-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""EN""), 'Map summarizing critical habitat of Species at Risk, listed as Endangered or Threatened under the <i>Species at Risk Act</i> (SARA), located within the search area (red outline)')}
+```{r crithab-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""EN""), 'Map summarizing critical habitat of Species at Risk, listed as Endangered or Threatened under the <i>Species at Risk Act</i> (SARA), located within the search area (red outline)')}
 if (!is.null(outputListCrithab$mapData)){
   plot_rr_sf(areaMap, outputListCrithab$mapData, crithab_rr$attribute,
              legendName = legendNameCrithab, outlines=FALSE, colorMap = critPlotList$colorMap)
 }  
 ```
 <br>
-```{r leatherback-region-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""EN""), 'Map summarizing draft critical habitat of Leatherback Sea Turtle, relative to the search area. Draft critical habitat for the species is based on information DFO published as an update to Science advice regarding important habitat for the Leatherback Sea Turtle: https://www.dfo-mpo.gc.ca/csas-sccs/Publications/ScR-RS/2020/2020_041-eng.html')}
+```{r leatherback-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""EN""), 'Map summarizing draft critical habitat of Leatherback Sea Turtle, relative to the search area. Draft critical habitat for the species is based on information DFO published as an update to Science advice regarding important habitat for the Leatherback Sea Turtle: https://www.dfo-mpo.gc.ca/csas-sccs/Publications/ScR-RS/2020/2020_041-eng.html')}
 if (!is.null(leatherback_rr$data_sf)){
   plot_rr_sf(regionMap, leatherback_rr$data_sf, leatherback_rr$attribute)
 }   
 ```
 <br>
-```{r leatherback-area-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""EN""), 'Map summarizing the draft critical habitat of Leatherback Sea Turtle located within the search area (red outline).')}
+```{r leatherback-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""EN""), 'Map summarizing the draft critical habitat of Leatherback Sea Turtle located within the search area (red outline).')}
 if (!is.null(outputListLB$mapData)){
   plot_rr_sf(areaMap, outputListLB$mapData, leatherback_rr$attribute)
 }

---FILE: sections/crithab/crithab_fr.Rmd---
@@ -69,7 +69,7 @@ if(critHabCheck){
 
 ```
 <br>
-```{r crithab-region-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""FR""), 'Cette carte résume l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP de la biorégion du plateau néo-écossais. Veuillez consulter le tableau ci-dessous pour l’information complémentaire. Selon la définition de l’article 2 de la LEP, l’habitat essentiel est en fait « l’habitat nécessaire à la survie ou au rétablissement d’une espèce sauvage inscrite, qui est désigné comme tel dans un programme de rétablissement ou un plan d’action élaboré à l’égard de l’espèce ». L’habitat essentiel est désigné dans un programme de rétablissement final ou un plan d’action publié dans le Registre public des espèces en péril (http://www.sararegistry.gc.ca). Il ne s’agit <b>pas</b> d’une source ni d’un conseil faisant autorité en ce qui concerne les données sur les espèces en péril. Veuillez accéder au SIG des espèces en péril (http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) pour créer un rapport faisant autorité.')}
+```{r crithab-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""FR""), 'Cette carte résume l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP de la biorégion du plateau néo-écossais. Veuillez consulter le tableau ci-dessous pour l’information complémentaire. Selon la définition de l’article 2 de la LEP, l’habitat essentiel est en fait « l’habitat nécessaire à la survie ou au rétablissement d’une espèce sauvage inscrite, qui est désigné comme tel dans un programme de rétablissement ou un plan d’action élaboré à l’égard de l’espèce ». L’habitat essentiel est désigné dans un programme de rétablissement final ou un plan d’action publié dans le Registre public des espèces en péril (http://www.sararegistry.gc.ca). Il ne s’agit <b>pas</b> d’une source ni d’un conseil faisant autorité en ce qui concerne les données sur les espèces en péril. Veuillez accéder au SIG des espèces en péril (http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) pour créer un rapport faisant autorité.')}
 if (!is.null(crithab_rr$data_sf)){
   critPlotList <- plot_rr_sf(regionMap, crithab_rr$data_sf, crithab_rr$attribute, 
                              legendName = legendNameCrithab, outlines=FALSE, 
@@ -78,20 +78,20 @@ if (!is.null(crithab_rr$data_sf)){
 }    
 ```
 <br>
-```{r crithab-area-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""FR""), 'Cette carte résume les zones où le polygone de recherche chevauche l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP')}
+```{r crithab-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(crithab_rr, ""FR""), 'Cette carte résume les zones où le polygone de recherche chevauche l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP')}
 if (!is.null(outputListCrithab$mapData)){
   plot_rr_sf(areaMap, outputListCrithab$mapData, crithab_rr$attribute, 
              legendName = legendNameCrithab, outlines=FALSE, colorMap = critPlotList$colorMap)
 }  
 ```
 <br>
-```{r letherback-region-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""FR""), 'Cette carte résume l’ébauche de l’habitat essentiel de la tortue luth de la biorégion du plateau néo-écossais, par rapport à la zone de recherche. ')}
+```{r letherback-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""FR""), 'Cette carte résume l’ébauche de l’habitat essentiel de la tortue luth de la biorégion du plateau néo-écossais, par rapport à la zone de recherche. ')}
 if (!is.null(leatherback_rr$data_sf)){
   plot_rr_sf(regionMap, leatherback_rr$data_sf, leatherback_rr$attribute)
 }   
 ```
 <br>
-```{r leatherback-area-plot, fig.height=6, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""FR""), 'Cette carte résume les zones où le polygone de recherche chevauche  l’ébauche de l’habitat essentiel de la tortue luth.')}
+```{r leatherback-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(leatherback_rr, ""FR""), 'Cette carte résume les zones où le polygone de recherche chevauche  l’ébauche de l’habitat essentiel de la tortue luth.')}
 if (!is.null(outputListLB$mapData)){
   plot_rr_sf(areaMap, outputListLB$mapData, leatherback_rr$attribute)
 } 

---FILE: sections/ebsa/ebsa_en.Rmd---
@@ -54,13 +54,13 @@ if (!is.null(EBSATable)){
 }
 ```
 
-```{r EBSA-region-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(ebsa_rr, ""EN""), 'Map showing Ecologically and Biologically Significant Areas (EBSA) relative to the search area defined by the user (red outline).')}
+```{r EBSA-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ebsa_rr, ""EN""), 'Map showing Ecologically and Biologically Significant Areas (EBSA) relative to the search area defined by the user (red outline).')}
 if (!is.null(EBSAoutput$regionData)){
   plot_rr_sf(regionMap, EBSAoutput$regionData, ebsa_rr$attribute)
 }
 ```
 
-```{r EBSA-area-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(ebsa_rr, ""EN""), 'Map showing Ecologically and Biologically Significant Areas (EBSA) in the search area (red outline).')}
+```{r EBSA-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ebsa_rr, ""EN""), 'Map showing Ecologically and Biologically Significant Areas (EBSA) in the search area (red outline).')}
 if(!is.null(EBSAoutput$studyData)){
   plot_rr_sf(areaMap, EBSAoutput$mapData, ebsa_rr$attribute)
 }

---FILE: sections/ebsa/ebsa_fr.Rmd---
@@ -58,13 +58,13 @@ if (!is.null(EBSATable)){
 ```
 
 
-```{r EBSA-region-plot, fig.height=8, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant les zones d’importance écologique et biologique (ZIEB) par rapport à la zone de recherche définie par l’utilisateur (entourée de rouge).'}
+```{r EBSA-region-plot, fig.height=7, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant les zones d’importance écologique et biologique (ZIEB) par rapport à la zone de recherche définie par l’utilisateur (entourée de rouge).'}
 if (!is.null(EBSAoutput$regionData)){
   plot_rr_sf(regionMap, EBSAoutput$regionData, ebsa_rr$attribute)
 }
 ```
 
-```{r EBSA-area-plot, fig.height=8, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant les zones d’importance écologique et biologique (ZIEB) dans la zone de recherche définie par l’utilisateur (entourée de rouge).'}
+```{r EBSA-area-plot, fig.height=7, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant les zones d’importance écologique et biologique (ZIEB) dans la zone de recherche définie par l’utilisateur (entourée de rouge).'}
 if(!is.null(EBSAoutput$studyData)){
   plot_rr_sf(areaMap, EBSAoutput$mapData, ebsa_rr$attribute)
 }

---FILE: sections/ilts/ilts_en.Rmd---
@@ -50,7 +50,7 @@ writeLines(noquote(iltsCheck))
 ```
 
 
-```{r ilts-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(ilts_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Blue lines indicate the location of each NEST trawl sample.')}
+```{r ilts-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ilts_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Blue lines indicate the location of each NEST trawl sample.')}
 
 if (!is.null(iltsClipped$studyData)) {
     plot_rr_sf(areaMap, iltsClipped$mapData, lwd = 1, colour = ""blue"")

---FILE: sections/ilts/ilts_fr.Rmd---
@@ -48,7 +48,7 @@ writeLines(noquote(iltsCheck))
 ```
 
 
-```{r ilts-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Blue lines indicate the location of each NEST trawl sample.'}
+```{r ilts-plot, fig.height=7, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Blue lines indicate the location of each NEST trawl sample.'}
 
 if (!is.null(iltsClipped$studyData)) {
     plot_rr_sf(areaMap, iltsClipped$mapData, lwd = 1, colour = ""blue"")

---FILE: sections/isdb-marfis/isdbMarfis_en.Rmd---
@@ -81,7 +81,7 @@ Report_marfis<-noquote(Report_marfis)
 writeLines(Report_marfis)
 ```
 
-```{r marfis-isdb-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(marfis_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.')}
+```{r marfis-isdb-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(marfis_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.')}
 if (!is.null(outputListI$studyData) & !is.null(outputListM$studyData)) {
   areaMap + geom_point(data = outputListI$mapPoints, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = outputListM$mapPoints, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 } else if (!is.null(outputListI$studyData)) {

---FILE: sections/isdb-marfis/isdbMarfis_fr.Rmd---
@@ -83,7 +83,7 @@ Report_marfis<-noquote(Report_marfis)
 writeLines(Report_marfis)
 ```
 
-```{r marfis-isdb-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(isdb_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) utilisée pour demander des renseignements agrégés provenant des dossiers d’observation du Système d’information sur les pêches des Maritimes (SIPMAR) et/ou de la Base de données des relevés de l’industrie (BDRI), qui sont présentés sous forme de points noirs, pour toutes les espèces. La règle des cinq n’a pas été appliquée.')}
+```{r marfis-isdb-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(isdb_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) utilisée pour demander des renseignements agrégés provenant des dossiers d’observation du Système d’information sur les pêches des Maritimes (SIPMAR) et/ou de la Base de données des relevés de l’industrie (BDRI), qui sont présentés sous forme de points noirs, pour toutes les espèces. La règle des cinq n’a pas été appliquée.')}
 if (!is.null(outputListI$studyData) & !is.null(outputListM$studyData)) {
   areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 } else if (!is.null(outputListI$studyData)) {

---FILE: sections/narwc/narwc_en.Rmd---
@@ -50,7 +50,7 @@ Report_narwc <- if (is.null(narwcClipped$studyData)) {
  }
 writeLines(Report_narwc)
 ```
-```{r narwc-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(narwc_rr, ""EN""), 'Map showing the search area defined by the user (red outline). Map of cetacean species listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), from the North Atlantic Right Whale Consortium (NARWC) located within the search area (red outline). <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: <https://www.narwc.org/sightings-database.html>')}
+```{r narwc-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(narwc_rr, ""EN""), 'Map showing the search area defined by the user (red outline). Map of cetacean species listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), from the North Atlantic Right Whale Consortium (NARWC) located within the search area (red outline). <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: <https://www.narwc.org/sightings-database.html>')}
 if (!is.null(narwcClipped$studyData)) {
   plot_rr_sf(areaMap, narwcClipped$mapData, attribute = narwc_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }

---FILE: sections/narwc/narwc_fr.Rmd---
@@ -52,7 +52,7 @@ Report_narwc <-  if (is.null(narwcClipped$studyData)) {
  }
 writeLines(Report_narwc)
 ```
-```{r narwc-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(narwc_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la Base de données des observations du North Atlantic Right Whale Consortium (NARWC) pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone</b> , puisque l’effort de relevé est biaisé vers le nord-est des États-Unis, et les données sur la présence d’espèces provenant des détections acoustiques ne sont pas incluses. Pour de plus amples renseignements, consultez le site : <https://www.narwc.org/sightings-database.html>')}
+```{r narwc-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(narwc_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la Base de données des observations du North Atlantic Right Whale Consortium (NARWC) pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone</b> , puisque l’effort de relevé est biaisé vers le nord-est des États-Unis, et les données sur la présence d’espèces provenant des détections acoustiques ne sont pas incluses. Pour de plus amples renseignements, consultez le site : <https://www.narwc.org/sightings-database.html>')}
 if (!is.null(narwcClipped$studyData)) {
    plot_rr_sf(areaMap, narwcClipped$mapData, attribute=narwc_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }

---FILE: sections/nbw/nbw_en.Rmd---
@@ -53,13 +53,13 @@ polyText <- if(is.null(clipped$studyData)){""Search area does not overlap with No
  writeLines(polyText)
 ```
 
-```{r nbw-region-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(nbw_rr, ""EN""), 'Proposed Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf. Northern Bottlenose Whales are present year-round in the inter-canyon areas, which function as foraging habitat and movement corridors. Note that the full extent of important habitat for Scotian Shelf Northern Bottlenose Whales remains unknown. Please see additional information in <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.')}
+```{r nbw-region-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(nbw_rr, ""EN""), 'Proposed Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf. Northern Bottlenose Whales are present year-round in the inter-canyon areas, which function as foraging habitat and movement corridors. Note that the full extent of important habitat for Scotian Shelf Northern Bottlenose Whales remains unknown. Please see additional information in <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.')}
 if (!is.null(nbw_rr$data_sf)){
   plot_rr_sf(regionMap, nbw_rr$data_sf, nbw_rr$attribute)
 }
 ```
 
-```{r nbw-area-plot, fig.height=4, fig.width=11, fig.cap=paste(write_caption_blurb(nbw_rr, ""EN""), 'This map summarizes areas where the search polygon overlaps with Northern Bottlenose Whale important habitat in inter-canyon areas on the eastern Scotian Shelf.')}
+```{r nbw-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(nbw_rr, ""EN""), 'This map summarizes areas where the search polygon overlaps with Northern Bottlenose Whale important habitat in inter-canyon areas on the eastern Scotian Shelf.')}
 if (!is.null(clipped$mapData)){
   plot_rr_sf(areaMap, clipped$mapData, nbw_rr$attribute)
 }

---FILE: sections/nbw/nbw_fr.Rmd---
@@ -52,13 +52,13 @@ polyText<-if(is.null(clipped$studyData)){""La zone de recherche ne chevauche pas
  writeLines(polyText)
 ```
 
-```{r nbw-region-plot, fig.height=8, fig.width=11,fig.cap=paste(write_caption_blurb(nbw_rr, ""FR""), 'Habitat important proposé pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais La baleine à bec commune est présente toute l’année dans les zones entre les canyons, qui servent d’habitat d’alimentation et de couloirs de déplacement. Veuillez prendre note que l’étendue de l’habitat important de la baleine à bec commune sur le plateau néo-écossais demeure inconnue. Veuillez consulter les renseignements complémentaires dans le document <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.')}
+```{r nbw-region-plot, fig.height=7, fig.width=11,fig.cap=paste(write_caption_blurb(nbw_rr, ""FR""), 'Habitat important proposé pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais La baleine à bec commune est présente toute l’année dans les zones entre les canyons, qui servent d’habitat d’alimentation et de couloirs de déplacement. Veuillez prendre note que l’étendue de l’habitat important de la baleine à bec commune sur le plateau néo-écossais demeure inconnue. Veuillez consulter les renseignements complémentaires dans le document <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.')}
 if (!is.null(nbw_rr$data_sf)){
   plot_rr_sf(regionMap, nbw_rr$data_sf, nbw_rr$attribute)
 }
 ```
 
-```{r nbw-area-plot, fig.height=4, fig.width=11,fig.cap=paste(write_caption_blurb(nbw_rr, ""FR""), 'La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais.')}
+```{r nbw-area-plot, fig.height=7, fig.width=11,fig.cap=paste(write_caption_blurb(nbw_rr, ""FR""), 'La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais.')}
 if (!is.null(clipped$mapData)){
   plot_rr_sf(areaMap, clipped$mapData, nbw_rr$attribute)
 }

---FILE: sections/obis/obisCet_en.Rmd---
@@ -53,7 +53,7 @@ Report_obis_cet <-  if (is.null(obisClipped$studyData)) {
 }
 writeLines(Report_obis_cet)
 ```
-```{r obis-cetecean-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(obisCet_rr, ""EN""), 'Map showing the search area defined by the user (red outline). Map of cetacean species listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), from the Ocean Biodiversity Information System (OBIS) located within the search area (red outline). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.')}
+```{r obis-cetecean-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisCet_rr, ""EN""), 'Map showing the search area defined by the user (red outline). Map of cetacean species listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), from the Ocean Biodiversity Information System (OBIS) located within the search area (red outline). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.')}
 if (!is.null(obisClipped$studyData)) {
   plot_rr_sf(areaMap, obisClipped$mapData, attribute = obisCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }

---FILE: sections/obis/obisCet_fr.Rmd---
@@ -50,7 +50,7 @@ Report_obis_cet <-  if (is.null(obisClipped$studyData)) {
 writeLines(Report_obis_cet)
 ```
 
-```{r obis-cetacean-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(obisCet_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du SIBO pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> . L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.')}
+```{r obis-cetacean-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisCet_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du SIBO pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> . L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.')}
 if (!is.null(obisClipped$studyData)) {
   plot_rr_sf(areaMap, obisClipped$mapData, attribute = obisCet_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }

---FILE: sections/obis/obisFish_en.Rmd---
@@ -46,7 +46,7 @@ Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
 
-```{r obis-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(obisFish_rr, ""EN""), 'Map showing the search area defined by the user (red outline) was used to query information from Ocean Biodiversity Information System (OBIS) observation records, for species contained within the search area and listed by the <i>Species at Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
+```{r obis-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisFish_rr, ""EN""), 'Map showing the search area defined by the user (red outline) was used to query information from Ocean Biodiversity Information System (OBIS) observation records, for species contained within the search area and listed by the <i>Species at Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. Observations displayed outside of the search area are visualized for context, but not included in the survey results listed below. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.')}
 if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }

---FILE: sections/obis/obisFish_fr.Rmd---
@@ -43,7 +43,7 @@ Report_obis <- if (is.null(outputList$studyData)) {
 Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
-```{r obis-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(obisFish_rr, ""FR""), ' Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) a été utilisée pour rechercher des informations dans les registres d’observation du SIBO sur les espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>')}
+```{r obis-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(obisFish_rr, ""FR""), ' Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) a été utilisée pour rechercher des informations dans les registres d’observation du SIBO sur les espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>')}
 if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }

---FILE: sections/ocearch/ocearch_en.Rmd---
@@ -51,7 +51,7 @@ Report_ocearch <- if (is.null(ocearchOutputList$studyData)) {
 Report_obis<-noquote(Report_ocearch)
 writeLines(Report_ocearch)
 ```
-```{r ocearch-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(ocearch_rr, ""EN""), 'OCEARCH track observations of White Sharks observed within the search area (red outline). Dataset set has not yet been completely error-checked. The absence of White Shark in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.')}
+```{r ocearch-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ocearch_rr, ""EN""), 'OCEARCH track observations of White Sharks observed within the search area (red outline). Dataset set has not yet been completely error-checked. The absence of White Shark in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.')}
 if (!is.null(ocearchOutputList$studyData)) {
   plot_rr_sf(areaMap, ocearchOutputList$mapPoints)
 }

---FILE: sections/ocearch/ocearch_fr.Rmd---
@@ -51,7 +51,7 @@ Report_ocearch <- if (is.null(ocearchOutputList$studyData)) {
 Report_obis<-noquote(Report_ocearch)
 writeLines(Report_ocearch)
 ```
-```{r ocearch-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(ocearch_rr, ""FR""), 'Map showing the search area defined by the user (red outline) was used to query information from OCEARCH Shark Tracker observation records, for White Shark. Dataset set has not yet been completely error-checked. The absence of a species in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.')}
+```{r ocearch-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(ocearch_rr, ""FR""), 'Map showing the search area defined by the user (red outline) was used to query information from OCEARCH Shark Tracker observation records, for White Shark. Dataset set has not yet been completely error-checked. The absence of a species in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.')}
 if (!is.null(ocearchOutputList$studyData)) {
   plot_rr_sf(areaMap, ocearchOutputList$mapPoints)
 }

---FILE: sections/pasBay/pasBay_en.Rmd---
@@ -50,7 +50,7 @@ pasBayCheck <- if (!is.null(pasBayClipped$studyData)) {
 writeLines(noquote(pasBayCheck))
 ```
 
-```{r pasBay-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(pasBay_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query information from the Passamaquoddy Bay Biodiversity Trawls.  Blue lines indicate the location of each trawl sample.')}
+```{r pasBay-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(pasBay_rr, ""EN""), 'Map showing the search area defined by the user (red outline) used to query information from the Passamaquoddy Bay Biodiversity Trawls.  Blue lines indicate the location of each trawl sample.')}
 
 if (!is.null(pasBayClipped$studyData)) {
     plot_rr_sf(areaMap, pasBayClipped$mapData, lwd = 0.7, colour = ""blue"")

---FILE: sections/pasBay/pasBay_fr.Rmd---
@@ -50,7 +50,7 @@ pasBayCheck <- if (!is.null(pasBayClipped$studyData)) {
 writeLines(noquote(pasBayCheck))
 ```
 
-```{r pasBay-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: None. Map showing the search area defined by the user (red outline) used to query information from the Passamaquoddy Bay Biodiversity Trawls.  Blue lines indicate the location of each trawl sample.'}
+```{r pasBay-plot, fig.height=7, fig.width=11, fig.cap= 'Quality Tier: High. Security level: None. Map showing the search area defined by the user (red outline) used to query information from the Passamaquoddy Bay Biodiversity Trawls.  Blue lines indicate the location of each trawl sample.'}
 
 if (!is.null(pasBayClipped$studyData)) {
     plot_rr_sf(areaMap, pasBayClipped$mapData, lwd = 0.7, colour = ""blue"")

---FILE: sections/rockweed/rockweed_en.Rmd---
@@ -39,7 +39,7 @@ polyText <- noquote(polyText)
 writeLines(polyText)
 ```
 
-```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(rockweed_rr, ""EN""), 'Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.')}
+```{r rockweed-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(rockweed_rr, ""EN""), 'Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.')}
 if(!is.null(clippedRW$studyData)){
   plot_rr_sf(areaMap, clippedRW$mapData, rockweed_rr$attribute, outlines = FALSE, legendName=""Rockweed"")
 }

---FILE: sections/rockweed/rockweed_fr.Rmd---
@@ -54,7 +54,7 @@ polyText<-if(is.null(clippedRW$studyData)){
  writeLines(polyText)
 ```
 
-```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(rockweed_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur : l’emplacement du projet ou de l’activité proposé est surligné en jaune (polygone d’entrée), entouré d’une zone exposée ou d’une zone tampon définie par l’utilisateur en bleu. La figure illustre le chevauchement entre la zone de recherche et les cartes satellitaires de la végétation intertidale et des polygones de présence de fucus.')}
+```{r rockweed-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(rockweed_rr, ""FR""), 'Carte montrant la zone de recherche définie par l’utilisateur : l’emplacement du projet ou de l’activité proposé est surligné en jaune (polygone d’entrée), entouré d’une zone exposée ou d’une zone tampon définie par l’utilisateur en bleu. La figure illustre le chevauchement entre la zone de recherche et les cartes satellitaires de la végétation intertidale et des polygones de présence de fucus.')}
 if(!is.null(clippedRW$studyData)){
   plot_rr_sf(areaMap, clippedRW$mapData, rockweed_rr$attribute, outlines=FALSE, legendName= ""Végétation Intertidale"")
 }

---FILE: sections/rv/rv_en.Rmd---
@@ -71,7 +71,7 @@ if (!is.null(surveyTypeDf) > 0) {
 
 ```
 
-```{r RV-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(rv_rr, ""EN""), ' Map of the Maritimes Research Vessel (RV) Trawl Survey data in relation to the search area (red outline). Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Arrows shown outside of the search area are visualized for context, but not included in the results below.')}
+```{r RV-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(rv_rr, ""EN""), ' Map of the Maritimes Research Vessel (RV) Trawl Survey data in relation to the search area (red outline). Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Arrows shown outside of the search area are visualized for context, but not included in the results below.')}
 if (!is.null(outputList$studyData)) {
 areaMap +
     geom_segment(aes(x = outputList$mapPoints$long,

---FILE: sections/rv/rv_fr.Rmd---
@@ -62,7 +62,7 @@ Report_RV<-noquote(Report_RV)
 writeLines(Report_RV)
 ```
 
-```{r RV-plot, fig.height=8, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge), utilisée pour demander des renseignements sur l’enquête sur le navire de recherche dans les Maritimes. Les lignes et les flèches noires indiquent l’emplacement et la direction de chaque exemple de chalut de fond à panneaux. La fréquence représente le nombre de chaluts où une espèce donnée a été échantillonnée, en comparaison au nombre total de chaluts dans la zone de recherche.'}
+```{r RV-plot, fig.height=7, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge), utilisée pour demander des renseignements sur l’enquête sur le navire de recherche dans les Maritimes. Les lignes et les flèches noires indiquent l’emplacement et la direction de chaque exemple de chalut de fond à panneaux. La fréquence représente le nombre de chaluts où une espèce donnée a été échantillonnée, en comparaison au nombre total de chaluts dans la zone de recherche.'}
 if (!is.null(outputList$studyData)) {
 areaMap + geom_segment(aes(x = Samples_bbox$long, y = Samples_bbox$lat, xend = Samples_bbox$ELONG, yend = endy <- Samples_bbox$ELAT),arrow=arrow(length = unit(0.2,""cm"")), size = 0.5)
 }

---FILE: sections/sardist/sardist_en.Rmd---
@@ -32,9 +32,10 @@ writeLines(noquote(sardist_rr$text$en))
 #### ***Area-specific SAR distribution search results***
 
 ```{r sardist-results, echo=FALSE, results='asis'}
-# not plotted
 outputListSardist <- master_intersect(sardist_rr$data_sf, mapDataList)
 distTable <- create_sar_tables(outputListSardist$studyData, listed_species, extraCols = c(""Species_Link""))$sarData
+names(distTable)[names(distTable) == 'Species_Link'] <- 'Species Link'
+
 summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""[SAR Distribution](#sardist-section)"",  distTable, ""Common Name"", ""Common Name"")
 
 ```

---FILE: sections/sardist/sardist_fr.Rmd---
@@ -35,6 +35,9 @@ writeLines(noquote(sardist_rr$text$fr))
 # not plotted
 outputListSardist <- master_intersect(sardist_rr$data_sf, mapDataList)
 distTable <- create_sar_tables(outputListSardist$studyData, listed_species, extraCols = c(""Species_Link""))$sarData
+names(distTable)[names(distTable) == 'Species_Link'] <- 'Species Link'
+
+
 summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""[SAR Distribution](#sardist-section)"",  distTable, ""Common Name"", ""Common Name"")
 ```
 

---FILE: sections/sdm/sdm_en.Rmd---
@@ -47,6 +47,7 @@ tableSDM <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
                         ""Humpback Whale"" = !is.null(clippedHump$studyData),
                         ""Sei Whale"" = !is.null(clippedSei$studyData),
                         check.names = FALSE)
+
 summarySDMTable <- data.frame(""Species"" = names(tableSDM), ""present"" = transpose(tableSDM)$V1)
 summaryHabTable <- add_to_hab_summary(summaryHabTable, ""SDM"", ""[SDM](#sdm-section)"", summarySDMTable, ""Species"", ""present"")
 
@@ -56,7 +57,7 @@ summaryHabTable <- add_to_hab_summary(summaryHabTable, ""SDM"", ""[SDM](#sdm-sectio
  knitr::kable(tableSDM, align=""cccc"", caption=paste(write_caption_blurb(finWhale_rr, ""EN""), ""Search results identifying if the search area overlaps (i.e., TRUE) or does not overlap (i.e., FALSE) with the Priority Area to Enhance Monitoring of several species of cetaceans (Fin Whale, Harbour Porpoise, Humpback Whale and Sei Whale).""), booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 ```
 
-```{r sdm-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(finWhale_rr, ""EN""), 'Maps of consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate). Yellow polygons (habitats with high suitability) represent areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in Gomez et al. (2020), these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure.')}
+```{r sdm-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(finWhale_rr, ""EN""), 'Maps of consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate). Yellow polygons (habitats with high suitability) represent areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in Gomez et al. (2020), these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure.')}
 plot_cetaceans_4grid(finWhale_rr$data_sf, harbourPorpoise_rr$data_sf, humpbackWhale_rr$data_sf, seiWhale_rr$data_sf, studyArea, land10m_sf, 50, bounds_sf)
 
 ```

---FILE: sections/sdm/sdm_fr.Rmd---
@@ -54,6 +54,6 @@ summaryHabTable <- add_to_hab_summary(summaryHabTable, ""SDM"", ""[SDM](#sdm-sectio
  knitr::kable(tableSDM, align=""cccc"", caption="". Niveau de qualité : Faible. Niveau de sécurité : Aucun. Résultats indiquant si la zone de recherche chevauche les zones prioritaires prévues pour améliorer la surveillance de plusieurs espèces de cétacés (rorqual commun, marsouin commun, rorqual à bosse et rorqual boréal). VRAI = le polygone chevauche la zone prioritaire; FAUX = le polygone ne chevauche PAS la zone prioritaire."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 ```
 
-```{r sdm-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(finWhale_rr, ""FR""), 'La carte montre les résultats consolidés du modèle de répartition des espèces (taux d’occurrence prévu relatif de 60 à 100 %). Les polygones jaunes (habitats très appropriés) doivent être interprétés comme des zones où les efforts de surveillance des cétacés peuvent être priorisés et dont les résultats peuvent aider à diriger les activités de relevés dans le futur. En raison des nombreuses raisons énumérées dans la section de discussion de Gomez et al. (2020), ces données de modélisation sur les cétacés ne représentent pas une répartition complète et actuelle des cétacés dans la région. Elles représentent des zones prioritaires où diriger les efforts de surveillance des cétacés. Leur utilisation dans les processus de planification de l’espace marin devrait être accompagnée d’approches complémentaires telles que le processus résumé dans la section ci-dessous. Le produit de données résumé dans la section ci-dessous (habitat important pour le rorqual bleu dans l’ouest de l’Atlantique Nord) représente un excellent cadre dans lequel utiliser correctement les extrants de cette figure.')}
+```{r sdm-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(finWhale_rr, ""FR""), 'La carte montre les résultats consolidés du modèle de répartition des espèces (taux d’occurrence prévu relatif de 60 à 100 %). Les polygones jaunes (habitats très appropriés) doivent être interprétés comme des zones où les efforts de surveillance des cétacés peuvent être priorisés et dont les résultats peuvent aider à diriger les activités de relevés dans le futur. En raison des nombreuses raisons énumérées dans la section de discussion de Gomez et al. (2020), ces données de modélisation sur les cétacés ne représentent pas une répartition complète et actuelle des cétacés dans la région. Elles représentent des zones prioritaires où diriger les efforts de surveillance des cétacés. Leur utilisation dans les processus de planification de l’espace marin devrait être accompagnée d’approches complémentaires telles que le processus résumé dans la section ci-dessous. Le produit de données résumé dans la section ci-dessous (habitat important pour le rorqual bleu dans l’ouest de l’Atlantique Nord) représente un excellent cadre dans lequel utiliser correctement les extrants de cette figure.')}
 plot_cetaceans_4grid(finWhale_rr$data_sf, harbourPorpoise_rr$data_sf, humpbackWhale_rr$data_sf, seiWhale_rr$data_sf, studyArea, land10m_sf, 50, bounds_sf)
 ```

---FILE: sections/sturg/sturg_en.Rmd---
@@ -49,7 +49,7 @@ sturgCheck <- if (is.null(sturgOutputList$studyData)) {
 writeLines(noquote(sturgCheck))
 ```
 
-```{r sturg-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""EN""), 'Survey sites illustrating Atlantic Sturgeon Foraging Areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy.')}
+```{r sturg-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""EN""), 'Survey sites illustrating Atlantic Sturgeon Foraging Areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy.')}
 if (!is.null(sturgOutputList$studyData)) {
   plot_rr_sf(areaMap, sturgOutputList$mapData, sturg_rr$attribute, outlines=FALSE,
              labelData=sturgOutputList$mapData, labelAttribute = ""siteId"")

---FILE: sections/sturg/sturg_fr.Rmd---
@@ -50,7 +50,7 @@ sturgCheck <- if (is.null(sturgOutputList$studyData)) {
 writeLines(noquote(sturgCheck))
 ```
 
-```{r sturg-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""FR""), 'Survey sites illustrating Atlantic Sturgeon Foraging Areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy.  ')}
+```{r sturg-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(sturg_rr, ""FR""), 'Survey sites illustrating Atlantic Sturgeon Foraging Areas sampled during 2020 in the Upper Bay of Fundy. Note that this map mostly represents survey sites. This map should not be interpreted as a comprehensive list of Atlantic Sturgeon foraging areas as additional locations are available, although not yet sampled, in the upper Bay of Fundy.  ')}
 if (!is.null(sturgOutputList$studyData)) {
   plot_rr_sf(areaMap, sturgOutputList$mapData, sturg_rr$attribute, outlines=FALSE,
              labelData=sturgOutputList$mapData, labelAttribute = ""siteId"")

---FILE: sections/whitehead/whitehead_en.Rmd---
@@ -56,7 +56,7 @@ Report_whitehead <-  if (is.null(whiteheadClipped$studyData)) {
  }
 writeLines(Report_whitehead)
 ```
-```{r whitehead-plot, fig.height=8, fig.width=11, fig.cap=paste(write_caption_blurb(whitehead_rr, ""EN""), 'Map showing the search area defined by the user (red outline). Map of cetacean species listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), from the Whitehead Lab located within the search area (red outline). Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>')}
+```{r whitehead-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(whitehead_rr, ""EN""), 'Map showing the search area defined by the user (red outline). Map of cetacean species listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), from the Whitehead Lab located within the search area (red outline). Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>')}
 if (!is.null(whiteheadClipped$studyData)) {
   plot_rr_sf(areaMap, whiteheadClipped$mapData, attribute = whitehead_rr$attribute, colorMap = whaleCol, shapeMap = whaleShape)
 }",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,4719195559648c0dff82878173750b7ccbde7d15,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-12T17:17:13Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-12T17:17:13Z,fix install packages line,.github/workflows/opendataCheck.yml,False,False,False,False,1,1,2,"---FILE: .github/workflows/opendataCheck.yml---
@@ -25,6 +25,6 @@ jobs:
       
       - name: Run opendata check
         run: |
-          install.packages(""ckanr"", ""here"", ""dplyr"")
+          install.packages(c(""ckanr"", ""here"", ""dplyr""))
           source(here::here(""dataprocessing/openDataGitScript.R""))
         shell: Rscript {0}
\ No newline at end of file",False,False,Dependency / Package,4
dfo-mar-odis,shinySpatialApp,bfe0b72b17b992189eb8f5779391dbbfd8cc2348,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-05T12:58:04Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-05T12:58:04Z,"fix typo in meta writer, sardist table funciton",app/R/textHelpers.R;app/Rmd/exec_summary.Rmd;app/Rmd/report_SARA_EN.Rmd,True,True,True,False,5,6,11,"---FILE: app/R/textHelpers.R---
@@ -6,8 +6,8 @@ write_meta <- function(rr, lang) {
       paste(""Contact:"", metadata$contact),
       ifelse(""url"" %in% names(metadata), paste(""URL:"", metadata$url$en), NA),
       paste(""Last retrieved on:"", metadata$accessedOnStr$en),
-      ifelse(""searchYears"" %in% names(metadata), paste(""Search Years:"", metadata$searchYears), NA),
-      paste(""Quality Tier:"", metadata$qualityTier$en),
+      ifelse(""searchYears"" %in% names(metadata), paste(""Search Year:"", metadata$searchYears), NA),
+      paste(""Quality tier:"", metadata$qualityTier$en),
       paste(""Security level:"", metadata$securityLevel$en), 
       paste(""Data use constraints:"", metadata$constraints$en),
       ifelse(""reference"" %in% names(metadata), paste(""Reference:"", metadata$reference$en), NA)

---FILE: app/Rmd/exec_summary.Rmd---
@@ -156,6 +156,8 @@ summarySarTable <- add_col_to_sar_summary(summarySarTable, ""OCEARCH"",
 # crithab, sardist
 critHabCheck <- !is.null(crithab_rr$data_sf) | !is.null(leatherback_rr$data_sf)
 distTable <- table_dist(sardist_rr$data_sf, ""EN"")
+distTable <- create_sar_tables(sardist_rr$data_sf, listed_species, extraCols = c(""Species_Link""))$sarData
+
 summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""SAR Distribution"",  distTable, ""Common Name"", ""Common Name"")
 
 if (critHabCheck) {

---FILE: app/Rmd/report_SARA_EN.Rmd---
@@ -51,10 +51,7 @@ Critical habitat presented in this section are available in the Government of Ca
 ```{r all-sar-load, echo=FALSE, results='asis'}
 # not plotted
 outputListSardist <- master_intersect(sardist_rr$data_sf, mapDataList)
-distTable <- create_sar_tables(sardist_rr$data_sf, listed_species, extraCols = c(""Species_Link""))$sarData
-summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""[SAR Distribution](#sardist-section)"",  distTable, ""Common Name"", ""Common Name"")
-
-distTable <- table_dist(outputListSardist$studyData, ""EN"")
+distTable <- create_sar_tables(outputListSardist$studyData, listed_species, extraCols = c(""Species_Link""))$sarData
 summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""[SAR Distribution](#sardist-section)"",  distTable, ""Common Name"", ""Common Name"")
 
 # plotted with colour",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,b5533666a0e1b397351534b12bc6ba5b1979fbc3,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-05T10:59:47Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-05T10:59:47Z,fix rownames on sardist table,app/R/tableFunctions.R;app/Rmd/report_SARA_EN.Rmd,True,True,True,False,5,5,10,"---FILE: app/R/tableFunctions.R---
@@ -376,11 +376,11 @@ table_dist <- function(clippedSardist_sf, lang) {
   }
 
   sf::st_geometry(distTable) <- NULL
-  row.names(distTable) <- NULL
   distTable <- unique(distTable)
   distTable$Scientific_Name <- italicize_col(distTable$Scientific)
   names(distTable) <- tableNames
-
+  row.names(distTable) <- NULL
+  
   return(distTable)
 }
 

---FILE: app/Rmd/report_SARA_EN.Rmd---
@@ -52,6 +52,9 @@ Critical habitat presented in this section are available in the Government of Ca
 # not plotted
 outputListSardist <- master_intersect(sardist_rr$data_sf, mapDataList)
 
+distTable <- table_dist(outputListSardist$studyData, ""EN"")
+summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""[SAR Distribution](#sardist-section)"",  distTable, ""Common Name"", ""Common Name"")
+
 # plotted with colour
 legendNameCrithab <- ""Common Name""
 outputListCrithab <- master_intersect(crithab_rr$data_sf, mapDataList)
@@ -61,9 +64,6 @@ outputListLB <- master_intersect(leatherback_rr$data_sf, mapDataList)
 
 critHabCheck <- !is.null(outputListCrithab$studyData) | !is.null(outputListLB$studyData)
 
-distTable <- table_dist(outputListSardist$studyData, ""EN"")
-summaryHabTable <- add_to_hab_summary(summaryHabTable, ""range"", ""[SAR Distribution](#sardist-section)"",  distTable, ""Common Name"", ""Common Name"")
-
 ```
 *
 ```{r sardist-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,732671dfdab7fa3593d3c2dea5af361840e14130,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-05T10:54:25Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-05T10:54:25Z,fix typo in ef table call,app/Rmd/report_fish_EN.Rmd,True,False,True,False,1,1,2,"---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -356,7 +356,7 @@ The following is information summarized from Gibson et al. (2011) and Bowlby et
 ```{r ef-results, include=FALSE, cache=FALSE}
 efOutputList <- master_intersect(ef_rr$data_sf, mapDataList)
 
-tableList <- create_table_ilts(efOutputList$studyData, listed_species, uniqueCols = c(""geometry"", ""year""))
+tableList <- create_table_ilts(efOutputList$studyData, listed_species, uniqueCols = c(""geometry"", ""Year""))
 efAllTable <- tableList$allSpecies
 efSarTable <- tableList$sarData
 ",False,True,Documentation / Formatting,4
dfo-mar-odis,shinySpatialApp,54547a6f25f17925e596d4ef426072ff8f307b72,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-04T18:22:27Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-04T18:22:27Z,fix rownames on sturgeon table,app/Rmd/report_fish_EN.Rmd;app/Rmd/report_fish_FR.Rmd,True,False,True,False,2,0,2,"---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -386,6 +386,7 @@ if (!is.null(sturgOutputList$studyData)) {
 if (!is.null(sturgOutputList$studyData)) {
   sturgTable <- dplyr::select(sturgOutputList$mapData, c(""siteId"", ""Site""))
   st_geometry(sturgTable) <- NULL
+  row.names(sturgTable) <- NULL
   names(sturgTable) <- c(""Site Id"", ""Site"")
   knitr::kable(sturgTable, align=""l"", caption=""Quality Tier: High Security level: none. Names of Survey sites for Atlantic Sturgeon Foraging Areas sampled during 2020.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }

---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -382,6 +382,7 @@ if (!is.null(sturgOutputList$studyData)) {
 if (!is.null(sturgOutputList$studyData)) {
   sturgTable <- dplyr::select(sturgOutputList$studyData, c(""siteId"", ""Site""))
   st_geometry(sturgTable) <- NULL
+  row.names(sturgTable) <- NULL
   names(sturgTable) <- c(""Site Id"", ""Site"")
   knitr::kable(sturgTable, align=""l"", caption=""Quality Tier: High Security level: none. Names of Survey sites for Atlantic Sturgeon Foraging Areas sampled during 2020.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,f8e1dcf032bb8b11988790f2f57b6453c760accd,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-02T11:46:30Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-02T11:46:30Z,"fix pasBay data typos, add pasbay to text",app/Rmd/exec_summary.Rmd;app/Rmd/report_fish_EN.Rmd;app/Rmd/report_fish_FR.Rmd;app/data/mybiblio.bib;dataprocessing/saveOpenData.R,True,False,True,False,153,30,183,"---FILE: app/Rmd/exec_summary.Rmd---
@@ -32,7 +32,7 @@ minYear <- 2010
 lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source) # check helpers.R for a list of packages
 copy_rdata_files() # make sure data files are up to date. 
 filesLoaded <- load_rdata(c(""CommonData"", ""sardist_rr"", ""crithab_rr"", ""leatherback_rr"", 
-                            ""rv_rr"", ""ilts_rr"", ""isdb_rr"", ""marfis_rr"", ""obisFish_rr"", ""ocearch_rr"", 
+                            ""rv_rr"", ""pasBay_rr"", ""ilts_rr"", ""isdb_rr"", ""marfis_rr"", ""obisFish_rr"", ""ocearch_rr"", 
                             ""wsdb_rr"", ""whitehead_rr"", ""obisCet_rr"", ""blueWhaleHab_rr"", 
                             ""nbw_rr"", ""narwc_rr"", ""rockweed_rr"", ""ebsa_rr"",
                             ""conservationSites_rr"", ""finWhale_rr"", ""harbourPorpoise_rr"",
@@ -111,6 +111,10 @@ summarySarTable <- add_col_to_sar_summary(summarySarTable, linkedSectionText, wh
 rvSarTable <- create_table_RV(rv_rr$data_sf, listed_species)$sarData
 summarySarTable <- add_col_to_sar_summary(summarySarTable, ""RV"", rvSarTable, ""Common Name"", ""Individuals"")
 
+# Pas bay
+pasBaySarTable <- create_table_ilts(pasBay_rr$data_sf, listed_species)$sarData
+summarySarTable <- add_col_to_sar_summary(summarySarTable, ""PBBT"", pasBaySarTable, ""Common Name"", ""Common Name"")
+
 # ILTS
 iltsSarTable <- create_table_ilts(ilts_rr$data_sf, listed_species)$sarData
 summarySarTable <- add_col_to_sar_summary(summarySarTable, ""ILTS"", iltsSarTable, ""Common Name"", ""Common Name"")

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -5,7 +5,7 @@ editor_options:
 ---
 
 ```{r fish-setup}
-filesLoaded <- load_rdata(c(""rv_rr"", ""ilts_rr"", ""isdb_rr"", ""marfis_rr"", ""ocearch_rr"", ""obisFish_rr""), ""MAR"", env = environment())
+filesLoaded <- load_rdata(c(""rv_rr"", ""pasBay_rr"", ""ilts_rr"", ""isdb_rr"", ""marfis_rr"", ""ocearch_rr"", ""obisFish_rr""), ""MAR"", env = environment())
 
 ```
 
@@ -16,7 +16,6 @@ This section describes outputs derived from a variety of data sources, internal
 
 ### **Maritimes Research Vessel (RV) Survey**{#RV-section}
 
-
 ```{r rv-meta, results='asis'}
 write_meta(rv_rr, ""EN"")
 ```
@@ -84,8 +83,58 @@ knitr::kable(rvAllTable, align=""l"", caption=""\\label{tab:rv_freq_table}Quality T
 }
 ```
 
+### **Passamaquoddy Bay Biodiversity Trawls (PBBT)**  {#pasBay-section}
+
+```{r pasBay-meta, results='asis'}
+write_meta(pasBay_rr, ""EN"")
+```
+
+Dataset description from the Open Data record [@OpenData_pasBay]:
+```{r pasBay-text, results='asis'}
+writeLines(noquote(pasBay_rr$text$en))
+```
+
+#### ***Area-specific search results for the Passamaquoddy Bay Biodiversity Trawls***
 
+```{r pasBay-results, include=FALSE, cache=FALSE}
+pasBayClipped <- master_intersect(pasBay_rr$data_sf, mapDataList)
 
+tableList <- create_table_ilts(pasBayClipped$studyData, listed_species)
+pasBayAllTable <- tableList$allSpecies
+pasBaySarTable <- tableList$sarData
+summarySarTable <- add_col_to_sar_summary(summarySarTable, ""[PBBT](#pasBay-section)"", pasBaySarTable, ""Common Name"", ""Common Name"")
+
+```
+
+```{r pasBay-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+pasBayCheck <- if (!is.null(pasBayClipped$studyData)) {
+    ""* There are relevant records in the Passamaquoddy Bay Biodiversity Trawls for this search area.""
+  } else {
+    ""* There are no relevant records in the Passamaquoddy Bay Biodiversity Trawls for this search area. ""
+  }
+writeLines(noquote(pasBayCheck))
+```
+
+```{r pasBay-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: None. Map showing the search area defined by the user (red outline) used to query information from the Passamaquoddy Bay Biodiversity Trawls.  Blue lines indicate the location of each trawl sample.'}
+
+if (!is.null(pasBayClipped$studyData)) {
+    plot_rr_sf(areaMap, pasBayClipped$mapData, lwd = 0.7, colour = ""blue"")
+}
+```
+<br>
+```{r pasBay-SAR-table}
+if (!is.null(pasBayClipped$studyData)) {
+  if (nrow(pasBaySarTable) > 0) {
+    knitr::kable(pasBaySarTable, align=""l"", caption=""\\label{tab:pasBay_SAR_table}Quality Tier: High. Security level: None. Passamaquoddy Bay Biodiversity Trawl observation records of species contained within the search area and listed by the Species At Risk Act (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+  }
+}
+```
+<br>
+```{r pasBay-all-table}
+if (!is.null(pasBayClipped$studyData)) {
+knitr::kable(pasBayAllTable, align=""l"", caption=""\\label{tab:pasBay_all_table}Quality Tier: High. Security level: none. Passamaquoddy Bay Biodiversity Trawl observation records of all species contained within the search area, summarized by species or species group. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
 
 
 ### **Inshore Lobster Trawl Survey (ILTS)**  {#ilts-section}
@@ -119,7 +168,7 @@ writeLines(noquote(iltsCheck))
 ```
 
 
-```{r ilts-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Black lines and arrows indicate the location and direction of each NEST trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area.'}
+```{r ilts-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Blue lines indicate the location of each trawl sample.'}
 
 if (!is.null(iltsClipped$studyData)) {
     plot_rr_sf(areaMap, iltsClipped$mapData, lwd = 1, colour = ""blue"")
@@ -136,7 +185,7 @@ if (!is.null(iltsClipped$studyData)) {
 <br>
 ```{r ilts-all-table}
 if (!is.null(iltsClipped$studyData)) {
-knitr::kable(iltsAllTable, align=""l"", caption=""\\label{tab:ilts_all_table}Quality Tier: High. Security level: none. Inshore Lobster Trawl Survey (ITLS) observation records of all species contained within the search area, summarized by species or species group. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(iltsAllTable, align=""l"", caption=""\\label{tab:ilts_all_table}Quality Tier: High. Security level: Protected B. Inshore Lobster Trawl Survey (ITLS) observation records of all species contained within the search area, summarized by species or species group. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
 

---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -36,6 +36,60 @@ knitr::kable(table_RV, align=""l"",
 ```
 
 
+### **Passamaquoddy Bay Biodiversity Trawls (PBBT)**  {#pasBay-section}
+
+```{r pasBay-meta, results='asis'}
+write_meta(pasBay_rr, ""EN"")
+```
+
+Dataset description from the Open Data record [@OpenData_pasBay]:
+```{r pasBay-text, results='asis'}
+writeLines(noquote(pasBay_rr$text$en))
+```
+
+#### ***Area-specific search results for the Passamaquoddy Bay Biodiversity Trawls***
+
+```{r pasBay-results, include=FALSE, cache=FALSE}
+pasBayClipped <- master_intersect(pasBay_rr$data_sf, mapDataList)
+
+tableList <- create_table_ilts(pasBayClipped$studyData, listed_species)
+pasBayAllTable <- tableList$allSpecies
+pasBaySarTable <- tableList$sarData
+summarySarTable <- add_col_to_sar_summary(summarySarTable, ""[PBBT](#pasBay-section)"", pasBaySarTable, ""Common Name"", ""Common Name"")
+
+```
+
+```{r pasBay-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+pasBayCheck <- if (!is.null(pasBayClipped$studyData)) {
+    ""* There are relevant records in the Passamaquoddy Bay Biodiversity Trawls for this search area.""
+  } else {
+    ""* There are no relevant records in the Passamaquoddy Bay Biodiversity Trawls for this search area. ""
+  }
+writeLines(noquote(pasBayCheck))
+```
+
+```{r pasBay-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: None. Map showing the search area defined by the user (red outline) used to query information from the Passamaquoddy Bay Biodiversity Trawls.  Blue lines indicate the location of each trawl sample.'}
+
+if (!is.null(pasBayClipped$studyData)) {
+    plot_rr_sf(areaMap, pasBayClipped$mapData, lwd = 0.7, colour = ""blue"")
+}
+```
+<br>
+```{r pasBay-SAR-table}
+if (!is.null(pasBayClipped$studyData)) {
+  if (nrow(pasBaySarTable) > 0) {
+    knitr::kable(pasBaySarTable, align=""l"", caption=""\\label{tab:pasBay_SAR_table}Quality Tier: High. Security level: None. Passamaquoddy Bay Biodiversity Trawl observation records of species contained within the search area and listed by the Species At Risk Act (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+  }
+}
+```
+<br>
+```{r pasBay-all-table}
+if (!is.null(pasBayClipped$studyData)) {
+knitr::kable(pasBayAllTable, align=""l"", caption=""\\label{tab:pasBay_all_table}Quality Tier: High. Security level: none. Passamaquoddy Bay Biodiversity Trawl observation records of all species contained within the search area, summarized by species or species group. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```
+
+
 ### **Inshore Lobster Trawl Survey (ILTS)**  {#ilts-section}
 
 ```{r ilts-meta, results='asis'}
@@ -66,7 +120,7 @@ writeLines(noquote(iltsCheck))
 ```
 
 
-```{r ilts-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Black lines and arrows indicate the location and direction of each NEST trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area.'}
+```{r ilts-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Blue lines indicate the location of each trawl sample.'}
 
 if (!is.null(iltsClipped$studyData)) {
     plot_rr_sf(areaMap, iltsClipped$mapData, lwd = 1, colour = ""blue"")
@@ -83,7 +137,7 @@ if (!is.null(iltsClipped$studyData)) {
 <br>
 ```{r ilts-all-table}
 if (!is.null(iltsClipped$studyData)) {
-knitr::kable(iltsAllTable, align=""l"", caption=""\\label{tab:ilts_all_table}Quality Tier: High. Security level: none. Inshore Lobster Trawl Survey (ITLS) observation records of all species contained within the search area, summarized by species or species group. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+knitr::kable(iltsAllTable, align=""l"", caption=""\\label{tab:ilts_all_table}Quality Tier: High. Security level: Protected B. Inshore Lobster Trawl Survey (ITLS) observation records of all species contained within the search area, summarized by species or species group. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. </b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
 

---FILE: app/data/mybiblio.bib---
@@ -65,34 +65,13 @@ @misc{OBIS
   howpublished = {Ocean Biodiversity Information System (OBIS). Intergovernmental Oceanographic Commission of UNESCO. www.obis.org. Accessed: 2021-01-21}
 }
 
-@misc{OpenData_SARrange,
-  author = {DFO},
-  title = {Fisheries and Oceans Canada Species at Risk Distribution (Range) [Dataset]},
-  year = {2019},
-  howpublished = {Retrieved from http://open.canada.ca/data/en/dataset/522d1b67-30d8-4a34-9b62-5da99b1035e6}
-}
-
-@misc{OpenData_SARcriticalhabitat,
-  author = {DFO},
-  title = {Critical Habitat of Species at Risk [Dataset]},
-  year = {2021},
-  howpublished = {Retrieved from https://open.canada.ca/data/en/dataset/db177a8c-5d7d-49eb-8290-31e6a45d786c}
-}
-
 @misc{OpenData_blue_imphabitat,
   author = {DFO},
   title = {Northern Bottlenose Whale Important Habitat [Dataset]},
   year = {2019},
   howpublished = {Retrieved from https://open.canada.ca/data/en/dataset/8fafd919-fcbe-43a3-a911-3d9461273441}
 }
 
-@misc{OpenData_nbw_imphabitat,
-  author = {DFO In Preparation.},
-  title = {Northern Bottlenose Whale Important Habitat [Dataset]},
-  year = {2021},
-  howpublished = {Retrieved from http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf}
-}
-
 @misc{OpenData_cetacean_imp,
   author = {DFO},
   title = {Identifying priority areas to enhance monitoring of cetaceans in the Northwest Atlantic Ocean [Dataset]},
@@ -114,6 +93,34 @@ @misc{OpenData_MAR_RV
   howpublished = {Retrieved from https://open.canada.ca/data/en/dataset/8ddcaeea-b806-4958-a79f-ba9ab645f53b}
 }
 
+@misc{OpenData_nbw_imphabitat,
+  author = {DFO In Preparation.},
+  title = {Northern Bottlenose Whale Important Habitat [Dataset]},
+  year = {2021},
+  howpublished = {Retrieved from http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf}
+}
+
+@misc{OpenData_pasBay,
+  author = {DFO.},
+  title = {Passamaquoddy Bay biodiversity trawl [Dataset]},
+  year = {2020},
+  howpublished = {Retrieved from https://open.canada.ca/data/en/dataset/2dfa19db-a8cf-4460-97b9-710c2b856276}
+}
+
+@misc{OpenData_SARrange,
+  author = {DFO},
+  title = {Fisheries and Oceans Canada Species at Risk Distribution (Range) [Dataset]},
+  year = {2019},
+  howpublished = {Retrieved from http://open.canada.ca/data/en/dataset/522d1b67-30d8-4a34-9b62-5da99b1035e6}
+}
+
+@misc{OpenData_SARcriticalhabitat,
+  author = {DFO},
+  title = {Critical Habitat of Species at Risk [Dataset]},
+  year = {2021},
+  howpublished = {Retrieved from https://open.canada.ca/data/en/dataset/db177a8c-5d7d-49eb-8290-31e6a45d786c}
+}
+
 @techreport{NARWCdatabase,
   author = {Kennedy, R.D.},
   title = {The North Atlantic Right Whale Consortium Database: A Guide for Users and Contributors},

---FILE: dataprocessing/saveOpenData.R---
@@ -314,11 +314,20 @@ catchData <- dplyr::select(catchData, c(""setno"", ""scientific_name"", ""common_name
 
 setDataResId <- ""4184b6d7-b711-430c-81ed-504c05657c16""
 setData <- download_extract_res_files(setDataResId)
+# manual fix of typo on open data....
+setData[(setData$setno == 2016.008),]$latitude_finish <- 45.09421
 
 pasBay <- left_join(catchData, setData, by = ""setno"")
 pasBay <- pasBay[!(is.na(pasBay$latitude_start)), ]
-pasBay <- dplyr::mutate(pasBay, wkt = paste(""LINESTRING ("", latitude_start, "" "", latitude_finish, "", "", longitude_start, "" "", longitude_finish, "")"", sep = """"))
+pasBay <- dplyr::mutate(pasBay, 
+                        wkt = paste(""LINESTRING ("", longitude_start, "" "", 
+                                    latitude_start, "", "", longitude_finish, "" "",
+                                    latitude_finish, "")"", sep = """"))
 pasBay$geometry <- st_as_sfc(pasBay$wkt, crs = 4326)
 pasBay <- dplyr::select(pasBay, c(""scientific_name"", ""common_name"", ""time_start"", ""geometry""))
-pasBay_rr$data_sf <- st_as_sf(pasBay)
+pasBay$common_name <- str_to_title(pasBay$common_name)
+names(pasBay) <-  c(""Scientific Name"", ""Common Name"", ""Start Time"", ""geometry"")
+pasBay_sf <- st_as_sf(pasBay)
+pasBay_sf <- sf::st_crop(pasBay_sf, region_sf)
+pasBay_rr$data_sf <- pasBay_sf
 save(pasBay_rr, file = file.path(fileSavePath, ""Open/pasBay_rr.RData""))",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,92795b4c8168320731d7681b8458417c1fb9ad2b,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-01T16:59:23Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-11-01T16:59:23Z,fix preprocessing for passamaquoddy data,dataprocessing/saveOpenData.R,False,True,True,False,9,6,15,"---FILE: dataprocessing/saveOpenData.R---
@@ -309,13 +309,16 @@ pasBay_rr$metadata$qualityTier <- highQuality
 
 catchDataResId <- ""5f55acd2-fe48-4624-a357-fe7babe2604b""
 catchData <- download_extract_res_files(catchDataResId)
-
-sampDataResId <- ""b0ac9aa1-b3e2-4d9c-a637-da97dbf2db13""
-sampData <- download_extract_res_files(sampDataResId)
+catchData <- read.csv(here::here(""../../../temp/new_catch_data.csv""))
+catchData <- dplyr::select(catchData, c(""setno"", ""scientific_name"", ""common_name""))
 
 setDataResId <- ""4184b6d7-b711-430c-81ed-504c05657c16""
 setData <- download_extract_res_files(setDataResId)
 
-dictDataResId <- ""0227602a-cb40-4585-94d7-524756dd39f0""
-dictData <- download_extract_res_files(dictDataResId)
-
+pasBay <- left_join(catchData, setData, by = ""setno"")
+pasBay <- pasBay[!(is.na(pasBay$latitude_start)), ]
+pasBay <- dplyr::mutate(pasBay, wkt = paste(""LINESTRING ("", latitude_start, "" "", latitude_finish, "", "", longitude_start, "" "", longitude_finish, "")"", sep = """"))
+pasBay$geometry <- st_as_sfc(pasBay$wkt, crs = 4326)
+pasBay <- dplyr::select(pasBay, c(""scientific_name"", ""common_name"", ""time_start"", ""geometry""))
+pasBay_rr$data_sf <- st_as_sf(pasBay)
+save(pasBay_rr, file = file.path(fileSavePath, ""Open/pasBay_rr.RData""))",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,6aa23741a2b2479eaf613af3fde9d3288e23627b,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-29T18:04:06Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-29T18:04:06Z,fix merge conflict,dataprocessing/openDataHelpers.R;dataprocessing/saveOpenData.R,False,True,True,False,42,11,53,"---FILE: dataprocessing/openDataHelpers.R---
@@ -153,20 +153,31 @@ download_extract_validate_sf <- function(zipUrl, region_sf = NULL, gdbLayer = NU
 download_extract_res_files <- function(resId, csvFileList = NULL) {
   res <- resource_show(resId)
   zipUrl <- res$url
-  
   tempDir <- here::here(""dataprocessing/temp"")
-  temp <- here::here(""dataprocessing/temp/temp.zip"")
   
-  download.file(zipUrl, temp)
-  utils::unzip(temp, exdir = tempDir)
-
-  outFiles <-lapply(csvFileList, function(x, dir) {
-    list.files(dir, recursive=TRUE, pattern = x, 
-               include.dirs = TRUE, full.names = TRUE)
-    }, dir=tempDir)
   
-  dfList <- lapply(outFiles, read.csv)
+  if (res$format == ""CSV"") {
+    temp <- here::here(""dataprocessing/temp/csvFile.csv"")
+    download.file(zipUrl, temp)
+    dfList <- read.csv(temp)
+    
+  } else {
+    
+    temp <- here::here(""dataprocessing/temp/temp.zip"")
+    
+    download.file(zipUrl, temp)
+    utils::unzip(temp, exdir = tempDir)
+    
+    outFiles <-lapply(csvFileList, function(x, dir) {
+      list.files(dir, recursive=TRUE, pattern = x, 
+                 include.dirs = TRUE, full.names = TRUE)
+    }, dir=tempDir)
+    
+    dfList <- lapply(outFiles, read.csv)
+    
+  }
   
+
   # cleanup
   tempFiles <- list.files(tempDir, include.dirs = T, full.names = T, recursive = T)
   unlink(tempFiles, recursive = TRUE) 

---FILE: dataprocessing/saveOpenData.R---
@@ -267,7 +267,7 @@ rockweed_rr <- list(""title"" = ""Satellite-based Maps of Intertidal Vegetation and
 save(rockweed_rr, file = file.path(fileSavePath, ""Open/rockweed_rr.RData""))
 
 
-#-----------------------RV SURVEY---------------------
+#----------------------RV SURVEY---------------------
 rvPkgId <- ""8ddcaeea-b806-4958-a79f-ba9ab645f53b""
 
 rv_rr <- get_opendata_rr(rvPkgId, NULL, region_sf = region_sf)
@@ -299,3 +299,23 @@ rv_rr$data_sf <- rv_sf
 rv_rr$metadata$searchYears <- ""2010-2020""
 save(rv_rr, file = file.path(fileSavePath, ""Open/rv_rr.RData""))
 
+
+#----------------------Passamaquoddy Bay Biodiversity Trawls---------------------
+pasBayPkgId <- ""2dfa19db-a8cf-4460-97b9-710c2b856276""
+
+pasBay_rr <- get_opendata_rr(pasBayPkgId, NULL, region_sf = region_sf)
+pasBay_rr$metadata$contact <- email_format(""Andrew.Cooper@dfo-mpo.gc.ca"")
+pasBay_rr$metadata$qualityTier <- highQuality
+
+catchDataResId <- ""5f55acd2-fe48-4624-a357-fe7babe2604b""
+catchData <- download_extract_res_files(catchDataResId)
+
+sampDataResId <- ""b0ac9aa1-b3e2-4d9c-a637-da97dbf2db13""
+sampData <- download_extract_res_files(sampDataResId)
+
+setDataResId <- ""4184b6d7-b711-430c-81ed-504c05657c16""
+setData <- download_extract_res_files(setDataResId)
+
+dictDataResId <- ""0227602a-cb40-4585-94d7-524756dd39f0""
+dictData <- download_extract_res_files(dictDataResId)
+",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,e1dc0383157985cc3770e26ad9510ff69a60f01b,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-28T11:41:15Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-28T11:41:15Z,fixes to ilts report,app/R/intersectFunctions.R;app/R/plotFunctions.R;app/R/tableFunctions.R;app/Rmd/report_fish_EN.Rmd;dataprocessing/saveOpenData.R;dataprocessing/saveProtectedData.R;dataprocessing/saveSecureData.R,True,True,True,False,66,18,84,"---FILE: app/R/intersectFunctions.R---
@@ -26,6 +26,7 @@ master_intersect <- function(data_sf, mapDataList, getRegion=FALSE, ...) {
   # check that data_sf is an accepted format:
   if (!inherits(sf::st_geometry(data_sf), c(""sfc_POINT"", 
                                             ""sfc_POLYGON"", 
+                                            ""sfc_LINESTRING"",
                                             ""sfc_MULTIPOLYGON"",
                                             ""sfc_GEOMETRY"")))
   {

---FILE: app/R/plotFunctions.R---
@@ -12,14 +12,18 @@
 # Created by Quentin Stoyel, September 2, 2021 for reproducible reporting project
 
 plot_rr_sf <- function(baseMap, data_sf, ...) {
-  if (inherits(sf::st_geometry(data_sf), ""sfc_POINT"")) {
+  if (inherits(sf::st_geometry(data_sf), c(""sfc_POINT""))) {
     
     outPlot <- plot_points(baseMap, data_sf, ...)
     
   } else if (inherits(sf::st_geometry(data_sf), c(""sfc_POLYGON"", ""sfc_MULTIPOLYGON"", ""sfc_GEOMETRY""))) {
     
     outPlot <- plot_polygons(baseMap, data_sf, ...)
     
+  } else if (inherits(sf::st_geometry(data_sf), ""sfc_LINESTRING"")) {
+    
+    outPlot <- plot_lines(baseMap, data_sf, ...)
+    
   }
   
   else {
@@ -226,6 +230,51 @@ plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute,
   }
 }
 
+
+
+# Function for plotting linestring data for the reproducible report.
+#
+# Inputs:
+# 1. baseMap = map object, either areaMap or regionMap
+# 2. data_sf: sf data to be plotted 
+#    (ideally, pre-clipped to map area with the master_intersect function, using bboxMap, or regionBox)
+# 
+# Created by Quentin Stoyel, October 28, 2021 for reproducible reporting project
+
+plot_lines <- function(baseMap, data_sf, ...) {
+  
+  # extract scaleBar layer to ensure it plots over polygons/study area box
+  scaleBarLayer = get_scale_bar_layer(baseMap)
+  studyBoxLayer = get_study_box_layer(baseMap)
+  watermarkLayer = get_watermark_layer(baseMap)
+  
+  # axis limits based on baseMap
+  axLim = ggplot2::coord_sf(xlim=baseMap$coordinates$limits$x, 
+                            ylim=baseMap$coordinates$limits$y, expand=FALSE) 
+  
+  # just plot raw data (no colors, shapes, etc)
+  dataLayer <- geom_sf(data = data_sf, ...) 
+
+  
+  pointMap <- baseMap +
+    dataLayer +
+    axLim +
+    watermarkLayer +
+    studyBoxLayer +
+    scaleBarLayer
+  
+  return(pointMap) 
+}
+
+
+
+
+
+
+
+
+
+
 # helper function to generate colormap when not specified.  
 # RR color scheme is used for first 8 colors, after which the viridis 
 # pallette is used. 

---FILE: app/R/tableFunctions.R---
@@ -149,6 +149,10 @@ create_table_ilts <- function(data_sf, sarTable) {
   allSpeciesData <- allSpeciesData[order(allSpeciesData$Records, decreasing = TRUE),]
   allSpeciesData <- dplyr::select(allSpeciesData, c(""Scientific Name"", ""Common Name"", ""Frequency""))
   
+  skateRow <- filter(sarTable, COMMONNAME == ""WINTER SKATE"")
+  skateRow$`Scientific Name` <- ""Leucoraja ocellata	(Uncertain)""
+  skateRow$`Common Name` <- ""Winter Skate (possible Little Skate)""
+  sarTable <- rbind(sarTable, skateRow)
   sarData <- dplyr::inner_join(allSpeciesData, sarTable, by=""Scientific Name"", suffix = c("".x"", """"))
   sarData <- dplyr::select(sarData, c(""Scientific Name"", ""Common Name"", ""SARA status"", ""COSEWIC status"", ""Frequency""))
   

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -124,12 +124,7 @@ writeLines(noquote(iltsCheck))
 ```{r ilts-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query information from the Lobster Trawl Survey. Black lines and arrows indicate the location and direction of each NEST trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area.'}
 
 if (!is.null(iltsClipped$studyData)) {
-areaMap +
-    geom_segment(aes(x = iltsClipped$mapPoints$long, 
-                     y = iltsClipped$mapPoints$lat, 
-                     xend = iltsClipped$mapPoints$ELONG, 
-                     yend = iltsClipped$mapPoints$ELAT), 
-                 arrow=arrow(length = unit(0.15,""cm"")), size = 0.5)
+    plot_rr_sf(areaMap, iltsClipped$mapData, lwd = 1, colour = ""blue"")
 }
 ```
 <br>

---FILE: dataprocessing/saveOpenData.R---
@@ -4,8 +4,7 @@ source(here::here(""app/R/dataFunctions.R""))
 fileSavePath <- here::here(""app/data/MAR"")
 fileLoadPath <- ""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\IN\\MSP\\Data""
 
-filesLoaded <- load_rdata(c(""CommonData""), ""MAR"", env = environment())
-loadResult <- load_rdata(c(""ebsa_rr"", ""crithab_rr"", ""sardist_rr"", ""nbw_rr"", 
+loadResult <- load_rdata(c(""CommonData"", ""ebsa_rr"", ""crithab_rr"", ""sardist_rr"", ""nbw_rr"", 
                            ""blueWhaleHab_rr"", ""obisCet_rr"", ""obisFish_rr"",
                            ""finWhale_rr"", ""seiWhale_rr"", ""humpbackWhale_rr"",
                            ""rockweed_rr"", ""harbourPorpoise_rr"", ""nbw_rr"",

---FILE: dataprocessing/saveProtectedData.R---
@@ -6,10 +6,7 @@ fileSavePath <- ""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\IN\\MSP\\Da
 fileSavePath <- here::here(""app/data/MAR"")
 fileLoadPath <- ""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\IN\\MSP\\Data""
 
-load(here::here(""app/data/CommonData.RData""))
-loadResult <- load_rdata(c(""isdb_rr"", ""marfis_rr""),  ""MAR"")
-
-region_sf <- st_read(here::here(""app/studyAreaTest/geoms_slc_MarBioRegion.geojson""))
+loadResult <- load_rdata(c(""CommonData"", ""isdb_rr"", ""marfis_rr""),  ""MAR"")
 
 highQuality <- list(""en"" = ""High"", ""fr"" = ""Élevée"")
 mediumQuality <- list(""en"" = ""Medium"", ""fr"" = ""Moyenne"")
@@ -78,12 +75,16 @@ ilts <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/InshoreLobste
 # set = start, haul = end
 iltsSpeciesCode <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/InshoreLobsterTrawlSurvey/SPECIESCODES.csv""), stringsAsFactors = FALSE)
 ilts <- dplyr::left_join(ilts, iltsSpeciesCode, by = ""SPECIES_CODE"")
-ilts_sf <- sf::st_as_sf(ilts, coords = c(""SET_LONG"", ""SET_LAT""), crs = 4326)
+ilts <- dplyr::mutate(ilts, wkt = paste(""LINESTRING ("", SET_LONG, "" "", SET_LAT, "", "", HAUL_LONG, "" "", HAUL_LAT, "")"", sep = """"))
+ilts$geometry <- st_as_sfc(ilts$wkt, crs = 4326)
+ilts <- dplyr::select(ilts, c(""HAUL_DATE"", ""COMMON.x"", ""SCIENTIFIC"", ""geometry""))
+ilts_sf <- st_as_sf(ilts)
 
-ilts_sf <- dplyr::select(ilts_sf, c(""HAUL_DATE"", ""COMMON.x"", ""SCIENTIFIC"", ""HAUL_LONG"", ""HAUL_LAT""))
 ilts_sf$COMMON.x <- str_to_title(ilts_sf$COMMON.x)
 ilts_sf$SCIENTIFIC <- str_to_sentence(ilts_sf$SCIENTIFIC)
-names(ilts_sf) <- c(""Date"", ""Common Name"", ""Scientific Name"", ""ELONG"", ""ELAT"", ""geometry"")
+ilts_sf$SCIENTIFIC[ilts_sf$COMMON.x == ""Skate - Little Or Winter - Unspec.""] <- ""Leucoraja ocellata	(Uncertain)""
+ilts_sf$COMMON.x[ilts_sf$COMMON.x == ""Skate - Little Or Winter - Unspec.""] <- ""Winter Skate (possible Little Skate)""
+names(ilts_sf) <- c(""Date"", ""Common Name"", ""Scientific Name"", ""geometry"")
 
 ilts_sf <- sf::st_crop(ilts_sf, region_sf)
 

---FILE: dataprocessing/saveSecureData.R---
@@ -6,8 +6,7 @@ region_sf <- st_read(here::here(""app/studyAreaTest/geoms_slc_MarBioRegion.geojso
 fileSavePath <- here::here(""app/data/MAR"")
 fileLoadPath <- ""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\IN\\MSP\\Data""
 
-load(here::here(""app/data/CommonData.RData""))
-loadResult <- load_rdata(c(""conservationSites_rr"", ""wsdb_rr"", ""whitehead_rr"",
+loadResult <- load_rdata(c(""CommonData"", ""conservationSites_rr"", ""wsdb_rr"", ""whitehead_rr"",
                            ""narwc_rr"", ""leatherback_rr"", ""ocearch_rr""),  ""MAR"")
 
 ",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,aa11e74663e413d529bc35e789cf9dbbdea0171c,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-26T16:47:34Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-26T16:47:34Z,fix typos for PR,app/Rmd/intro_FR.Rmd;app/Rmd/report_planning_EN.Rmd;app/Rmd/report_planning_FR.Rmd,True,False,True,False,6,12,18,"---FILE: app/Rmd/intro_FR.Rmd---
@@ -40,12 +40,11 @@ studyArea <- sf::st_read(""{{path_to_geoms}}"")
 # studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_test.geojson"")) #Offshore
 # studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_coastal_test.geojson"")) #coastal
 # studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_no_land.geojson"")) #no land
-region <- st_read(here::here(""app/studyAreaTest/geoms_slc_MarBioRegion.geojson""))
 site <- sf::st_centroid(studyArea)
 ```
 
 ```{r parameters-for-area_map.r, echo=FALSE, include=FALSE, cache=FALSE}
-mapDataList <- maps_setup(studyArea, site, region, land50k_sf, land10m_sf, bounds_sf)
+mapDataList <- maps_setup(studyArea, site, region_sf, land50k_sf, land10m_sf, bounds_sf)
 list2env(mapDataList, envir = environment())
 ```
 

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -8,9 +8,7 @@ filesLoaded <- load_rdata(c(""ebsa_rr"", ""conservationSites_rr""), ""MAR"", env = env
 
 This section describes information relevant to spatial planning from a variety of sources. Area-specific outputs are provided in sub-sections labeled according to the data source. Descriptions of the source data and appropriate references and contacts are provided at the beginning of each sub-section.
 
-<!-- ### **Ecologically and Biologically Significant Areas (EBSA)** -->
-
-### **`r ebsa_rr$title$en` **
+### **Ecologically and Biologically Significant Areas (EBSA)**
 
 ```{r EBSA-meta, results='asis'}
 write_meta(ebsa_rr, ""EN"")

---FILE: app/Rmd/report_planning_FR.Rmd---
@@ -6,9 +6,7 @@ filesLoaded <- load_rdata(c(""ebsa_rr"", ""conservationSites_rr""), ""MAR"", env = env
 ## **ZONES DÉSIGNÉES POUR LA PLANIFICATION SPATIALE**  
 
 
-<!-- **Zones d’importance écologique et biologique (ZIEB)**  -->
-
-### **`r ebsa_rr$title$fr` **
+### **Zones d’importance écologique et biologique (ZIEB)**  
 
 ```{r EBSA-meta, results='asis'}
 write_meta(ebsa_rr, ""FR"")
@@ -23,18 +21,17 @@ writeLines(noquote(ebsa_rr$text$fr))
 
 #### ***Résultats de la recherche des ZIEB par zone***  
 
-*
 ```{r EBSA-results, echo=FALSE, results='asis'}
 #function for overlap
 EBSAoutput <- master_intersect(ebsa_rr$data_sf, mapDataList, getRegion=TRUE)
 ```
-
+ 
 ```{r EBSA-check, echo=FALSE, results='asis'}
 #function for overlap
 Query_output_EBSA<-if(is.null(EBSAoutput$studyData)){
-  ""La zone de recherche ne chevauche pas les zones d’importance écologique et biologique (ZIEB).""
+    ""* La zone de recherche ne chevauche pas les zones d’importance écologique et biologique (ZIEB).""
   } else {
-    ""La zone de recherche chevauche les zones d’importance écologique et biologique (ZIEB).""
+    ""* La zone de recherche chevauche les zones d’importance écologique et biologique (ZIEB).""
   }
 Query_output_EBSA2<-noquote(Query_output_EBSA)
 ",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,b920ca287f45aa984b499cd1a5adf3dd9ea65436,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-26T14:53:34Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-26T14:53:34Z,"add documentation, fix bugs to rr generation process",app/R/textHelpers.R;app/Rmd/report_cetaceans_EN.Rmd;dataprocessing/openDataHelpers.R;dataprocessing/saveOpenData.R;dataprocessing/saveProtectedData.R;dataprocessing/saveSecureData.R,True,True,True,False,217,151,368,"---FILE: app/R/textHelpers.R---
@@ -1,26 +1,27 @@
 write_meta <- function(rr, lang) {
+  metadata <- rr$metadata
   outText <- """"
   if (lang == ""EN""){
     outText <- c(
-      paste(""Contact:"", rr$contact),
-      ifelse(""url"" %in% names(rr), paste(""URL:"", rr$url$en), NA),
-      paste(""Last retrieved on:"", rr$accessedOnStr$en),
-      ifelse(""searchYears"" %in% names(rr), paste(""Search Years:"", rr$searchYears), NA),
-      paste(""Quality Tier:"", rr$qualityTier$en),
-      paste(""Security level:"", rr$securityLevel$en), 
-      paste(""Data use constraints:"", rr$constraints$en),
-      ifelse(""reference"" %in% names(rr), paste(""Reference:"", rr$reference$en), NA)
+      paste(""Contact:"", metadata$contact),
+      ifelse(""url"" %in% names(metadata), paste(""URL:"", metadata$url$en), NA),
+      paste(""Last retrieved on:"", metadata$accessedOnStr$en),
+      ifelse(""searchYears"" %in% names(metadata), paste(""Search Years:"", metadata$searchYears), NA),
+      paste(""Quality Tier:"", metadata$qualityTier$en),
+      paste(""Security level:"", metadata$securityLevel$en), 
+      paste(""Data use constraints:"", metadata$constraints$en),
+      ifelse(""reference"" %in% names(metadata), paste(""Reference:"", metadata$reference$en), NA)
     )
   } else if (lang == ""FR"") {
     outText <- c(
-      paste(""Personne-ressource:"", rr$contact),
-      ifelse(""url"" %in% names(rr), paste(""LIEN:"", rr$url$fr), NA),
-      paste(""Consulté le:"", rr$accessedOnStr$fr),
-      ifelse(""searchYears"" %in% names(rr), paste(""Année de recherche:"", rr$searchYears), NA),
-      paste(""Niveau de qualité:"", rr$qualityTier$fr),
-      paste(""Niveau de sécurité:"", rr$securityLevel$fr), 
-      paste(""Contraintes d'usage:"", rr$constraints$fr),
-      ifelse(""reference"" %in% names(rr), paste(""Reference:"", rr$reference$fr), NA)
+      paste(""Personne-ressource:"", metadata$contact),
+      ifelse(""url"" %in% names(metadata), paste(""LIEN:"", metadata$url$fr), NA),
+      paste(""Consulté le:"", metadata$accessedOnStr$fr),
+      ifelse(""searchYears"" %in% names(metadata), paste(""Année de recherche:"", metadata$searchYears), NA),
+      paste(""Niveau de qualité:"", metadata$qualityTier$fr),
+      paste(""Niveau de sécurité:"", metadata$securityLevel$fr), 
+      paste(""Contraintes d'usage:"", metadata$constraints$fr),
+      ifelse(""reference"" %in% names(metadata), paste(""Reference:"", metadata$reference$fr), NA)
     )
   }
   outText <- outText[!is.na(outText)]

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -145,8 +145,6 @@ if (!is.null(narwcClipped$studyData)) {
 } else {
  summarySarTable <- add_col_to_sar_summary(summarySarTable, linkedSectionText, NULL, ""specIndex"", linkedSectionText)
 }
-
-
 ```
 *
 ```{r narwc-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}

---FILE: dataprocessing/openDataHelpers.R---
@@ -6,6 +6,18 @@ source(here::here(""app/R/helpers.R""))
 ckanr_setup(url=""https://open.canada.ca/data"")
 
 
+
+# --------------get opendata rr-----------------
+# Function to retrieve opendata record and return an rr object.
+#
+# Inputs:
+# 1. pkgId: Id string of the open data package to retrieve, used to rab metadata and text
+# 2. resId: Id string of the specific open data resource containing the spatial data
+# 3. Additional parameters passed to get_opendata_sf
+# 4. checkDate: optional parameter to check if opendata resource has been updated
+#
+# Outputs:
+# 1 .out_rr: output rr object containing spatial data and metadata
 get_opendata_rr <- function(pkgId, resId, region_sf=NULL, gdbLayer=NULL, tifFile=NULL, checkDate=NULL) {
   opendataPKG <- package_show(pkgId)
   
@@ -33,7 +45,6 @@ get_opendata_rr <- function(pkgId, resId, region_sf=NULL, gdbLayer=NULL, tifFile
     data_sf <- NULL
   }
   
-  
   url <- list(""en"" = paste(""<https://open.canada.ca/data/en/dataset/"", pkgId, "">"", sep =""""), 
               ""fr"" = paste(""<https://open.canada.ca/data/fr/dataset/"", pkgId, "">"", sep =""""))  
   securityLevel <- list(""en"" = ""None"", ""fr""= ""Aucun"")
@@ -47,24 +58,47 @@ get_opendata_rr <- function(pkgId, resId, region_sf=NULL, gdbLayer=NULL, tifFile
   
   out_rr <- list(""title"" = pkgTitle,
                  ""text"" = pkgText,
-                 ""url"" = url,
                  ""attribute"" = ""NONE"",
-                 ""accessedOnStr"" = accessedDate,
-                 ""accessedDate"" = today(),
-                 ""contact"" = contactInfo,
-                 ""constraints"" = constraints,
-                 ""securityLevel"" = securityLevel,
-                 ""data_sf"" = data_sf)
+                 ""data_sf"" = data_sf,
+                 ""metadata"" = list(""contact"" = contactInfo,
+                                   ""url"" = url,
+                                   ""accessedOnStr"" = accessedDate,
+                                   ""accessedDate"" = today(),
+                                   ""constraints"" = constraints,
+                                   ""securityLevel"" = securityLevel
+                   
+                 ) # end metadata
+             ) # end rr
   return(out_rr)
 }
 
 
+# --------------get opendata sf-----------------
+# Function to retrieve opendata spatial data and return an sf object.
+#
+# Inputs:
+# 1. resId: Id string of the specific open data resource containing the spatial data
+# 2. Additional parameters passed to get_opendata_sf, typically from get_opendata_rr
+#
+# Outputs:
+# 1 .out_sf: output sf object containing spatial data
 get_opendata_sf <- function(resId, ...) {
   res <- resource_show(resId)
   out_sf <- download_extract_validate_sf(res$url, ...)
   return(out_sf)
 }
 
+
+# --------------download_extract_validate_sf-----------------
+# Function that downloads a zip file, extracts it, loads an sf and cleans the sf
+#
+# Inputs:
+# 1. zipUrl: Id string of the specific open data resource containing the spatial data
+# 2. region_sf: Sf object to crop the output sf too
+# 2. Additional parameters: used to specify spatial data file type
+#
+# Outputs:
+# 1 .out_sf: output sf object containing spatial data
 download_extract_validate_sf <- function(zipUrl, region_sf = NULL, gdbLayer = NULL, tifFile = NULL) {
   tempDir <- here::here(""dataprocessing/temp"")
   temp <- here::here(""dataprocessing/temp/temp.zip"")
@@ -80,9 +114,8 @@ download_extract_validate_sf <- function(zipUrl, region_sf = NULL, gdbLayer = NU
   if (length(shpFile) > 0) {
     out_sf <- st_read(shpFile, stringsAsFactors = FALSE)
   } else if (length(gdbDir) > 0) {
-    out_gdb <- st_read(gdbDir, stringsAsFactors = FALSE, layer = gdbLayer)
-    out_sf <- out_gdb
-    out_sf$geometry <- st_geometry(out_gdb)
+    out_sf <- st_read(gdbDir, stringsAsFactors = FALSE, layer = gdbLayer)
+    out_sf$geometry <- st_geometry(out_sf)
   } else if (length(tifRasterFile) > 0) {
     tifRaster <- raster(tifRasterFile)
     out_sf <- stars::st_as_stars(tifRaster) %>% sf::st_as_sf()
@@ -107,6 +140,16 @@ download_extract_validate_sf <- function(zipUrl, region_sf = NULL, gdbLayer = NU
   return(out_sf)
 }
 
+
+# --------------download_extract_res_file-----------------
+# Function that downloads a zip file of csvs, extracts it and reads the csv.
+#
+# Inputs:
+# 1. resId: Id string of the specific open data resource containing the data
+# 2. csvFileList: names of the csv file to extract from the zip file
+#
+# Outputs:
+# 1  dfList: list of dfs, one for each csv file in csvFileList
 download_extract_res_files <- function(resId, csvFileList = NULL) {
   res <- resource_show(resId)
   zipUrl <- res$url
@@ -132,6 +175,15 @@ download_extract_res_files <- function(resId, csvFileList = NULL) {
 }
 
 
+
+# --------------get_check_date-----------------
+# Helper function that extracts the date of an rr object in the environment.
+#
+# Input:
+# 1. varName: string name of an rr object loaded in the global environment
+#
+# Outputs:
+# 1 checkDate: date the rr object was accessed, or NULL if the object was not found
 get_check_date <- function(varName) {
   checkDate <- NULL
   if (varName %in% ls(globalenv())) {
@@ -142,15 +194,22 @@ get_check_date <- function(varName) {
 }
 
 
+# --------------lang_list-----------------
+# Helper function that converts a string into a bilinugual list
 lang_list <- function(inValue) {
   return(list(""en"" = inValue, ""fr"" = inValue))
 }
 
+
+# --------------email_format-----------------
+# Helper function that converts a string email address into a linked one for use in rmd
 email_format <- function(emailStr) {
   return(paste(""["", emailStr, ""](mailto:"", emailStr, ""){.email}"", sep=""""))
 }
 
 
+# --------------save_open_data-----------------
+# Wrapper function to peform all the steps required to save an open data object.
 save_open_data <- function(pkgId, resId, variableName, qualityTier, savePath,
                            disableCheckDate = TRUE, contactEmail = NULL, searchYears=NULL,
                            reference = NULL, ...) {
@@ -162,15 +221,15 @@ save_open_data <- function(pkgId, resId, variableName, qualityTier, savePath,
   temp_rr <- get_opendata_rr(pkgId, resId, checkDate = fnCheckDate, ...)
   if(!is.null(temp_rr)) {
     if (!is.null(contactEmail)){
-      temp_rr$contact = contactEmail
+      temp_rr$metadata$contact = contactEmail
     }
     if (!is.null(reference)){
-      temp_rr$reference = reference
+      temp_rr$metadata$reference = reference
     }
     if (!is.null(searchYears)){
-      temp_rr$searchYears = searchYears
+      temp_rr$metadata$searchYears = searchYears
     }
-    temp_rr$qualityTier <- qualityTier
+    temp_rr$metadata$qualityTier <- qualityTier
     assign(variableName, temp_rr)
     save(list = variableName, file = file.path(savePath, paste(""Open/"", variableName, "".RData"", sep="""")))
     dataSaved <- TRUE
@@ -179,7 +238,8 @@ save_open_data <- function(pkgId, resId, variableName, qualityTier, savePath,
 }
 
 
-
+# --------------RV_to_sf-----------------
+# Converts the three types of RV data files into a single coherent sf object.
 RV_to_sf <- function(gscat, gsinf, gsspec, minYear){
   gscat <- gscat %>% tidyr::unite(""MISSION_SET"", MISSION:SETNO, remove = TRUE)
   gscat <- gscat %>% rename(CODE = SPEC)
@@ -193,11 +253,7 @@ RV_to_sf <- function(gscat, gsinf, gsspec, minYear){
   gsspec <- gsspec %>% transmute(gsspec, COMM = stringr::str_to_sentence(COMM))
   gsspec <- gsspec %>% rename(""Common Name""= COMM, ""Scientific Name"" = SPEC)
   
-  if (nrow(gsinf) > 0){
-    out_sf <- sf::st_as_sf(gsinf, coords = c(""SLONG"", ""SLAT""), crs = 4326)
-  } else {
-    out_sf <- gsinf
-  }
+  out_sf <- sf::st_as_sf(gsinf, coords = c(""SLONG"", ""SLAT""), crs = 4326)
   
   out_sf <- left_join(out_sf, gscat, by = ""MISSION_SET"")
   out_sf <- left_join(out_sf, gsspec, by = ""CODE"")

---FILE: dataprocessing/saveOpenData.R---
@@ -63,14 +63,16 @@ if(!is.null(OpenEBSA_rr)) {
   EBSA_rr <- OpenEBSA_rr
   EBSA_rr$data_sf$Report_URL <- str_replace(EBSA_rr$data_sf$Report_URL,
                                             "".pdf"", "".html"")
-  EBSA_rr$qualityTier <- highQuality
-  EBSA_rr$contact <- email_format(""carissa.philippe\\@dfo-mpo.gc.ca"")
+  EBSA_rr$metadata$qualityTier <- highQuality
+  EBSA_rr$metadata$contact <- email_format(""carissa.philippe\\@dfo-mpo.gc.ca"")
   save(EBSA_rr, file = file.path(fileSavePath, ""Open/EBSA_rr.RData""))
 }
 
 
 # -----------SAR DIST--------------
-
+# Creating the sardist rr object takes a LOT (>10gb) of ram which may cause errors
+# it is useful to run in a clean rstudio session and if needed, to manually 
+# step through the functions.
 sardistPkgId <- ""e0fabad5-9379-4077-87b9-5705f28c490b""
 sardistResId <- ""d16d8405-dddf-491b-8faf-8cc7a9f3a537""
 
@@ -92,8 +94,8 @@ openCrithab_rr <- get_opendata_rr(crithabPkgId, crithabResId,
                                   checkDate = critHabCheckDate)
 if(!is.null(openCrithab_rr)) {
   crithab_rr <- openCrithab_rr
-  crithab_rr$qualityTier <- highQuality
-  crithab_rr$contact <- email_format(""info@dfo-mpo.gc.ca"")
+  crithab_rr$metadata$qualityTier <- highQuality
+  crithab_rr$metadata$contact <- email_format(""info@dfo-mpo.gc.ca"")
   crithab_rr$attribute <- ""Common_Nam""
   crithab_rr$data_sf$Common_Nam <- crithab_rr$data_sf$Common_Name_EN
   save(crithab_rr, file = file.path(fileSavePath, ""Open/crithab_rr.RData""))
@@ -157,10 +159,10 @@ if(!is.null(openBwhab_rr)) {
   bwTemp_sf <- sf::st_crop(bwTemp_sf, region_sf)
   bwhab_rr$data_sf <- bwTemp_sf
   
-  bwhab_rr$contact <- email_format(""gddaiss-dmsaisb\\@dfo-mpo.gc.ca"")
-  bwhab_rr$qualityTier <- highQuality
+  bwhab_rr$metadata$contact <- email_format(""gddaiss-dmsaisb\\@dfo-mpo.gc.ca"")
+  bwhab_rr$metadata$qualityTier <- highQuality
   bwhab_rr$attribute <- ""Activity""
-  bwhab_rr$reference <- lang_list(""<https://waves-vagues.dfo-mpo.gc.ca/Library/40687776.pdf>"")
+  bwhab_rr$metadata$reference <- lang_list(""<https://waves-vagues.dfo-mpo.gc.ca/Library/40687776.pdf>"")
   
   save(bwhab_rr, file = file.path(fileSavePath, ""Open/bwhab_rr.RData""))
 }
@@ -196,17 +198,18 @@ obisFish_sf <- st_as_sf(obisFish, coords = c(""decimalLongitude"", ""decimalLatitud
 obisFish_sf <- sf::st_crop(obisFish_sf, region_sf)
 
 obisFish_rr <- list(""title"" = ""OBIS observations"",
-                   ""contact"" = email_format(""helpdesk@obis.org""), 
-                   ""url"" = lang_list(""<https://obis.org/>""),
-                   ""accessedOnStr"" = list(""en"" =""January 27 2021 by Gregory Puncher from OBIS"", 
-                                          ""fr"" = ""27 janvier 2021 par Gregory Puncher du SIBO"") ,
-                   ""accessDate"" = as.Date(""2021-01-27""),
-                   ""data_sf"" = obisFish_sf,
-                   ""searchYears"" = ""2010-2020"",
-                   ""attribute"" = ""Legend"",
-                   ""securityLevel"" = noneList,
-                   ""qualityTier"" = mediumQuality,
-                   ""constraints"" = noneList
+                    ""data_sf"" = obisFish_sf,
+                    ""attribute"" = ""Legend"",
+                    ""metadata"" = list(""contact"" = email_format(""helpdesk@obis.org""), 
+                                      ""url"" = lang_list(""<https://obis.org/>""),
+                                      ""accessedOnStr"" = list(""en"" =""January 27 2021 by Gregory Puncher from OBIS"", 
+                                                             ""fr"" = ""27 janvier 2021 par Gregory Puncher du SIBO"") ,
+                                      ""accessDate"" = as.Date(""2021-01-27""),
+                                      ""searchYears"" = ""2010-2020"",
+                                      ""securityLevel"" = noneList,
+                                      ""qualityTier"" = mediumQuality,
+                                      ""constraints"" = noneList
+                    )
 )
 save(obisFish_rr, file = file.path(fileSavePath, ""Open/obisFish_rr.RData""))
 
@@ -219,24 +222,25 @@ obisCet_sf <- sf::st_crop(obisCet_sf, region_sf)
 
 
 obisCet_rr <- list(""title"" = ""OBIS observations (cetaceans)"",
-                   ""contact"" = email_format(""helpdesk@obis.org""), 
-                   ""url"" = lang_list(""<https://obis.org/>""),
-                   ""accessedOnStr"" = list(""en"" =""January 27 2021 by Gregory Puncher from OBIS"", 
-                                          ""fr"" = ""27 janvier 2021 par Gregory Puncher du SIBO"") ,
-                   ""accessDate"" = as.Date(""2021-01-27""),
                    ""data_sf"" = obisCet_sf,
-                   ""searchYears"" = ""2010-2020"",
                    ""attribute"" = ""Legend"",
-                   ""securityLevel"" = noneList,
-                   ""qualityTier"" = mediumQuality,
-                   ""constraints"" = noneList
+                   ""metadata"" = list(""contact"" = email_format(""helpdesk@obis.org""), 
+                                     ""url"" = lang_list(""<https://obis.org/>""),
+                                     ""accessedOnStr"" = list(""en"" =""January 27 2021 by Gregory Puncher from OBIS"", 
+                                                            ""fr"" = ""27 janvier 2021 par Gregory Puncher du SIBO"") ,
+                                     ""accessDate"" = as.Date(""2021-01-27""),
+                                     ""searchYears"" = ""2010-2020"",
+                                     ""securityLevel"" = noneList,
+                                     ""qualityTier"" = mediumQuality,
+                                     ""constraints"" = noneList
+                   )
 )
 save(obisCet_rr, file = file.path(fileSavePath, ""Open/obisCet_rr.RData""))
 
 
 # ---------------------ROCKWEED------------------------------
 # Rockweed
-rockweed_sf <- st_read(""../Data/NaturalResources/Species/Rockweed/MAR_rockweed_presence_validated.shp"", stringsAsFactors = FALSE)
+rockweed_sf <- st_read(file.path(fileLoadPath, ""NaturalResources/Species/Rockweed/MAR_rockweed_presence_validated.shp""), stringsAsFactors = FALSE)
 rockweed_sf <- st_transform(rockweed_sf, 4326) # Project to WGS84
 rockweed_sf <- st_make_valid(rockweed_sf)
 # set status column
@@ -249,14 +253,16 @@ rockweed_sf <- sf::st_crop(rockweed_sf, region_sf)
 
 
 rockweed_rr <- list(""title"" = ""Satellite-based Maps of Intertidal Vegetation and Rockweed presence polygons"",
-                    ""contact"" = email_format(""Gordana.Lazin@dfo-mpo.gc.ca""), 
-                    ""accessedOnStr"" = list(""en"" =""February 17 2021"", ""fr"" = ""17 février 2021"") ,
-                    ""accessDate"" = as.Date(""2021-02-17""),
                     ""data_sf"" = rockweed_sf,
                     ""attribute"" = ""status"",
-                    ""securityLevel"" = noneList,
-                    ""qualityTier"" = mediumQuality,
-                    ""constraints"" = internalUse
+                    ""metadata"" = list(""contact"" = email_format(""Gordana.Lazin@dfo-mpo.gc.ca""), 
+                                      ""accessedOnStr"" = list(""en"" =""February 17 2021"", 
+                                                             ""fr"" = ""17 février 2021"") ,
+                                      ""accessDate"" = as.Date(""2021-02-17""),
+                                      ""securityLevel"" = noneList,
+                                      ""qualityTier"" = mediumQuality,
+                                      ""constraints"" = internalUse
+                    )
 )
 save(rockweed_rr, file = file.path(fileSavePath, ""Open/rockweed_rr.RData""))
 
@@ -265,8 +271,8 @@ save(rockweed_rr, file = file.path(fileSavePath, ""Open/rockweed_rr.RData""))
 RVPkgId <- ""8ddcaeea-b806-4958-a79f-ba9ab645f53b""
 
 RV_rr <- get_opendata_rr(RVPkgId, NULL, region_sf = region_sf)
-RV_rr$contact <- email_format(""DFO.MAR-PED-Data-Request-Demande-de-donnes-DEP-MAR.MPO@dfo-mpo.gc.ca"")
-RV_rr$qualityTier <- highQuality
+RV_rr$metadata$contact <- email_format(""DFO.MAR-PED-Data-Request-Demande-de-donnes-DEP-MAR.MPO@dfo-mpo.gc.ca"")
+RV_rr$metadata$qualityTier <- highQuality
 
 rvCsvList <- c(""GSCAT.csv"", ""GSINF.csv"", ""GSSPECIES.csv"")
 minYear <- 2010
@@ -290,6 +296,6 @@ fall_sf <- RV_to_sf(fallDfs[[1]], fallDfs[[2]], fallDfs[[3]], minYear)
 rv_sf <- rbind(fourVSW_sf, spring_sf, summer_sf, fall_sf)
 rv_sf <- sf::st_crop(rv_sf, region_sf)
 RV_rr$data_sf <- rv_sf
-RV_rr$searchYears <- ""2010-2020""
+RV_rr$metadata$searchYears <- ""2010-2020""
 save(RV_rr, file = file.path(fileSavePath, ""Open/RV_rr.RData""))
 

---FILE: dataprocessing/saveProtectedData.R---
@@ -24,13 +24,13 @@ internalUse <- list(""en"" = ""DFO INTERNAL USE ONLY"", ""fr"" = ""DFO INTERNAL USE ONL
 # Load the ISDB and MARFIS species tables
 load(file.path(fileLoadPath, ""mar.wrangling/MARFIS.SPECIES.RData""))
 load(file.path(fileLoadPath, ""mar.wrangling/ISDB.ISSPECIESCODES.RData""))
-SPECIES <- dplyr::select(SPECIES, 
-                         one_of(c(""SPECIES_CODE"", ""SPECIES_NAME"")))
+SPECIES <- dplyr::select(SPECIES, one_of(c(""SPECIES_CODE"", ""SPECIES_NAME"")))
 ISSPECIESCODES <- dplyr::select(ISSPECIESCODES, 
                                 one_of(c(""SPECCD_ID"", ""COMMON"", ""SCIENTIFIC"")))
 
-ISSPECIESCODES <- ISSPECIESCODES %>% transmute(ISSPECIESCODES, SCIENTIFIC=str_to_sentence(SCIENTIFIC))
-ISSPECIESCODES <- ISSPECIESCODES %>% transmute(ISSPECIESCODES, COMMON=str_to_sentence(COMMON))
+ISSPECIESCODES <- mutate(ISSPECIESCODES, 
+                         SCIENTIFIC = str_to_sentence(SCIENTIFIC),
+                         COMMON=str_to_sentence(COMMON))
 ISSPECIESCODES <- ISSPECIESCODES %>% rename(""Common Name"" = COMMON,
                                             ""Scientific Name"" = SCIENTIFIC)
 MARFISSPECIESCODES <- SPECIES %>% rename(""COMMONNAME"" = SPECIES_NAME)
@@ -42,15 +42,15 @@ isdb_sf <- na.omit(isdb_sf) # remove NA values (some in SPECCID).  this is a bit
 isdb_sf <- sf::st_crop(isdb_sf, region_sf)
 
 isdb_rr <- list(""title"" = ""Industry Survey Database (ISDB)"",
-                       ""contact"" = email_format(""Claire.Mussells@dfo-mpo.gc.ca""), 
-                       ""accessedOnStr"" = list(""en"" =""2019"", ""fr"" = ""2019"") ,
-                       ""accessDate"" = as.Date(""2019-01-01""),
-                       ""data_sf"" = isdb_sf,
-                       ""attribute"" = ""NONE"",
-                       ""searchYears"" = ""2010-2020"",
-                       ""securityLevel"" = protectedBList,
-                       ""qualityTier"" = mediumQuality,
-                       ""constraints"" = internalUse
+                ""data_sf"" = isdb_sf,
+                ""attribute"" = ""NONE"",
+                ""metadata"" = list(""contact"" = email_format(""Claire.Mussells@dfo-mpo.gc.ca""), 
+                                  ""accessedOnStr"" = list(""en"" =""2019"", ""fr"" = ""2019"") ,
+                                  ""accessDate"" = as.Date(""2019-01-01""),
+                                  ""searchYears"" = ""2010-2020"",
+                                  ""securityLevel"" = protectedBList,
+                                  ""qualityTier"" = mediumQuality,
+                                  ""constraints"" = internalUse)
 )
 save(isdb_rr, ISSPECIESCODES, file = file.path(fileSavePath, ""Protected/isdb_rr.RData""))
 
@@ -59,15 +59,15 @@ load(file.path(fileLoadPath, ""mar.wrangling/marfis.RData""))
 marfis_sf <- sf::st_crop(marfis_sf, region_sf)
 
 marfis_rr <- list(""title"" = ""Maritime Fishery Information System (MARFIS)"",
-                ""contact"" = email_format(""XMARComData@dfo-mpo.gc.ca""), 
-                ""accessedOnStr"" = list(""en"" =""2019"", ""fr"" = ""2019"") ,
-                ""accessDate"" = as.Date(""2019-01-01""),
-                ""data_sf"" = marfis_sf,
-                ""attribute"" = ""NONE"",
-                ""searchYears"" = ""2010-2020"",
-                ""securityLevel"" = protectedBList,
-                ""qualityTier"" = mediumQuality,
-                ""constraints"" = internalUse
+                  ""data_sf"" = marfis_sf,
+                  ""attribute"" = ""NONE"",
+                  ""metadata"" = list(""contact"" = email_format(""XMARComData@dfo-mpo.gc.ca""),
+                                    ""accessedOnStr"" = list(""en"" = ""2019"", ""fr"" = ""2019"") ,
+                                    ""accessDate"" = as.Date(""2019-01-01""),
+                                    ""searchYears"" = ""2010-2020"",
+                                    ""securityLevel"" = protectedBList,
+                                    ""qualityTier"" = mediumQuality,
+                                    ""constraints"" = internalUse)
 )
 save(marfis_rr, MARFISSPECIESCODES, file = file.path(fileSavePath, ""Protected/marfis_rr.RData""))
 

---FILE: dataprocessing/saveSecureData.R---
@@ -1,4 +1,3 @@
-
 source(here::here(""dataprocessing/openDataHelpers.R""))
 source(here::here(""app/R/dataFunctions.R""))
 
@@ -28,17 +27,18 @@ conservationSites_sf$Legend <- as.character(conservationSites_sf$Legend)
 conservationSites_sf[conservationSites_sf$Id == 18, ""Legend"" ] <- ""Bras d'Or Lake -sites to be determined""
 
 conservationSites_rr <- list(""title"" = ""Draft Conservation Network Design"",
-                             ""contact"" = ""Marty King ([Marty.King@dfo-mpo.gc.ca](mailto:Marty.King@dfo-mpo.gc.ca){.email})"", 
-                             ""accessedOnStr"" = list(""en"" =""October 2021"", ""fr"" = ""octobre, 2021"") ,
-                             ""accessDate"" = as.Date(""2021-10-01""),
                              ""data_sf"" = conservationSites_sf,
                              ""attribute"" = ""Legend"",
-                             ""securityLevel"" = noneList,
-                             ""qualityTier"" = highQuality,
-                             ""constraints"" = internalUse
+                             ""metadata"" = list(""contact"" = ""Marty King ([Marty.King@dfo-mpo.gc.ca](mailto:Marty.King@dfo-mpo.gc.ca){.email})"", 
+                                               ""accessedOnStr"" = list(""en"" =""October 2021"", ""fr"" = ""octobre, 2021"") ,
+                                               ""accessDate"" = as.Date(""2021-10-01""),
+                                               ""securityLevel"" = noneList,
+                                               ""qualityTier"" = highQuality,
+                                               ""constraints"" = internalUse
+                             )
 )
-save(conservationSites_rr, file = file.path(fileSavePath, ""Secure/conservationSites_rr.RData""))
 
+save(conservationSites_rr, file = file.path(fileSavePath, ""Secure/conservationSites_rr.RData""))
 
 #------------------CETACEANS-------------------
 
@@ -55,16 +55,17 @@ wsdb_sf <- st_as_sf(wsdb, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
 wsdb_sf <- sf::st_crop(wsdb_sf, region_sf)
 
 wsdb_rr <- list(""title"" = ""Whale Sightings Database"",
-                ""contact"" = ""<XMARWhaleSightings@dfo-mpo.gc.ca>"", 
-                ""url"" = lang_list(""<http://www.inter.dfo-mpo.gc.ca/Maritimes/SABS/popec/sara/Database>""),
-                ""accessedOnStr"" = list(""en"" =""October 27, 2020 by Shelley Lang"", ""fr"" = ""27 octobre 2020 par Shelley Lang  "") ,
-                ""accessDate"" = as.Date(""2020-10-27""),
                 ""data_sf"" = wsdb_sf,
-                ""searchYears"" = ""2010-2020"",
                 ""attribute"" = ""Legend"",
-                ""securityLevel"" = noneList,
-                ""qualityTier"" = lowQuality,
-                ""constraints"" = internalUse
+                ""metadata"" = list(""contact"" = ""<XMARWhaleSightings@dfo-mpo.gc.ca>"", 
+                                  ""url"" = lang_list(""<http://www.inter.dfo-mpo.gc.ca/Maritimes/SABS/popec/sara/Database>""),
+                                  ""accessedOnStr"" = list(""en"" =""October 27, 2020 by Shelley Lang"", ""fr"" = ""27 octobre 2020 par Shelley Lang  "") ,
+                                  ""accessDate"" = as.Date(""2020-10-27""),
+                                  ""searchYears"" = ""2010-2020"",
+                                  ""securityLevel"" = noneList,
+                                  ""qualityTier"" = lowQuality,
+                                  ""constraints"" = internalUse
+                )
 )
 save(wsdb_rr, file = file.path(fileSavePath, ""Secure/wsdb_rr.RData""))
 
@@ -83,23 +84,24 @@ whitehead_sf <- st_as_sf(whitehead, coords = c(""Long"", ""Lat""), crs = 4326)
 whitehead_sf <- sf::st_crop(whitehead_sf, region_sf)
 
 whitehead_rr <- list(""title"" = ""Whitehead lab (Dalhousie University)"",
-                ""contact"" = ""<XMARWhaleSightings@dfo-mpo.gc.ca>"", 
-                ""url"" = lang_list(""<https://whiteheadlab.weebly.com/contact.html>""),
-                ""accessedOnStr"" = list(""en"" =""January 12 2021  by Laura Feyrer"", ""fr"" = ""12 janvier 2021 par Laura Feyrer  "") ,
-                ""accessDate"" = as.Date(""2021-01-12""),
-                ""data_sf"" = whitehead_sf,
-                ""searchYears"" = ""2010-2019"",
-                ""attribute"" = ""Legend"",
-                ""securityLevel"" = noneList,
-                ""qualityTier"" = highQuality,
-                ""constraints"" = internalUse
+                     ""data_sf"" = whitehead_sf,
+                     ""attribute"" = ""Legend"",
+                     ""metadata"" = list(""contact"" = ""<XMARWhaleSightings@dfo-mpo.gc.ca>"", 
+                                       ""url"" = lang_list(""<https://whiteheadlab.weebly.com/contact.html>""),
+                                       ""accessedOnStr"" = list(""en"" =""January 12 2021  by Laura Feyrer"", ""fr"" = ""12 janvier 2021 par Laura Feyrer  "") ,
+                                       ""accessDate"" = as.Date(""2021-01-12""),
+                                       ""searchYears"" = ""2010-2019"",
+                                       ""securityLevel"" = noneList,
+                                       ""qualityTier"" = highQuality,
+                                       ""constraints"" = internalUse
+                     )
 )
 save(whitehead_rr, file = file.path(fileSavePath, ""Secure/whitehead_rr.RData""))
 
 # ----------------------NARWC-------------------------
 # North Atlantic Right Whale Consortium (narwc)
 narwc <- read.csv(file.path(fileLoadPath, ""NaturalResources/Species/Cetaceans/NARWC/NARWC_09-18-2020.csv""), stringsAsFactors = FALSE)
-narwcspecies <-  read.csv(""../Data/NaturalResources/Species/Cetaceans/NARWC/NARWCSpeciesNames.csv"", stringsAsFactors = FALSE)
+narwcspecies <-  read.csv(file.path(fileLoadPath, ""NaturalResources/Species/Cetaceans/NARWC/NARWCSpeciesNames.csv""), stringsAsFactors = FALSE)
 narwcspecies <- narwcspecies %>% rename(""Scientific Name""= ScientificName)
 narwc <- merge(narwc, narwcspecies, by='SPECNAME')
 narwc <- narwc %>% dplyr::filter(YEAR >= 2010)
@@ -109,16 +111,17 @@ narwc_sf <- st_as_sf(narwc, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
 narwc_sf <- sf::st_crop(narwc_sf, region_sf)
 
 narwc_rr <- list(""title"" = ""North Atlantic Right Whale consortium"",
-                 ""contact"" = ""<hpettis@neaq.org>"", 
-                 ""url"" = lang_list(""<https://www.narwc.org/sightings-database.html>""),
-                 ""accessedOnStr"" = list(""en"" =""September 18 2020"", ""fr"" = ""18 septembre 2020"") ,
-                 ""accessDate"" = as.Date(""2020-09-18""),
                  ""data_sf"" = narwc_sf,
-                 ""searchYears"" = ""2010-2019"",
                  ""attribute"" = ""Legend"",
-                 ""securityLevel"" = noneList,
-                 ""qualityTier"" = highQuality,
-                 ""constraints"" = internalUse
+                 ""metadata"" = list(""contact"" = ""<hpettis@neaq.org>"", 
+                                   ""url"" = lang_list(""<https://www.narwc.org/sightings-database.html>""),
+                                   ""accessedOnStr"" = list(""en"" =""September 18 2020"", ""fr"" = ""18 septembre 2020"") ,
+                                   ""accessDate"" = as.Date(""2020-09-18""),
+                                   ""searchYears"" = ""2010-2019"",
+                                   ""securityLevel"" = noneList,
+                                   ""qualityTier"" = highQuality,
+                                   ""constraints"" = internalUse
+                                   )
 )
 save(narwc_rr, file = file.path(fileSavePath, ""Secure/narwc_rr.RData""))
 
@@ -132,15 +135,16 @@ leatherback_sf <- sf::st_crop(leatherback_sf, region_sf)
 
 
 leatherback_rr <- list(""title"" = "" Leatherback Sea Turtle draft critical habitat"",
-                 ""contact"" = email_format(""info@dfo-mpo.gc.ca""), 
-                 ""url"" = lang_list(""<https://www.narwc.org/sightings-database.html>""),
-                 ""accessedOnStr"" = list(""en"" =""February 25 2021"", ""fr"" = ""25 février 2021"") ,
-                 ""accessDate"" = as.Date(""2021-02-25""),
-                 ""data_sf"" = leatherback_sf,
-                 ""attribute"" = ""NONE"",
-                 ""securityLevel"" = noneList,
-                 ""qualityTier"" = highQuality,
-                 ""constraints"" = internalUse
+                       ""data_sf"" = leatherback_sf,
+                       ""attribute"" = ""NONE"",
+                       ""metadata"" = list(""contact"" = email_format(""info@dfo-mpo.gc.ca""),
+                                         ""url"" = lang_list(""<https://www.narwc.org/sightings-database.html>""),
+                                         ""accessedOnStr"" = list(""en"" =""February 25 2021"", ""fr"" = ""25 février 2021"") ,
+                                         ""accessDate"" = as.Date(""2021-02-25""),
+                                         ""securityLevel"" = noneList,
+                                         ""qualityTier"" = highQuality,
+                                         ""constraints"" = internalUse
+                       )
 )
 save(leatherback_rr, file = file.path(fileSavePath, ""Secure/leatherback_rr.RData""))
 
@@ -156,15 +160,16 @@ ocearch_sf <- st_as_sf(ocearch, coords = c(""long"", ""lat""), crs = 4326)
 ocearch_sf <- sf::st_crop(ocearch_sf, region_sf)
 
 ocearch_rr <- list(""title"" = ""OCEARCH Shark Tracker"",
-                   ""contact"" = paste(""Bryan Franks ("", email_format(""bfranks@ju.edu""),  "") via Sean Butler ("", email_format(""sean.butler@dfo-mpo.gc.ca""), "")"", sep=""""), 
-                   ""url"" = lang_list(""<https://www.ocearch.org/tracker/>""),
-                   ""accessedOnStr"" = list(""en"" =""July 22 2021 by Sean Butler"", ""fr"" = ""22 juillet 2021 par Sean Butler"") ,
-                   ""accessDate"" = as.Date(""2021-07-22""),
                    ""data_sf"" = ocearch_sf,
-                   ""searchYears"" = ""2013-2020"",
                    ""attribute"" = ""NONE"",
-                   ""securityLevel"" = noneList,
-                   ""qualityTier"" = highQuality,
-                   ""constraints"" = internalUse
+                   ""metadata"" = list(""contact"" = paste(""Bryan Franks ("", email_format(""bfranks@ju.edu""),  "") via Sean Butler ("", email_format(""sean.butler@dfo-mpo.gc.ca""), "")"", sep=""""), 
+                                     ""url"" = lang_list(""<https://www.ocearch.org/tracker/>""),
+                                     ""accessedOnStr"" = list(""en"" =""July 22 2021 by Sean Butler"", ""fr"" = ""22 juillet 2021 par Sean Butler"") ,
+                                     ""accessDate"" = as.Date(""2021-07-22""),
+                                     ""searchYears"" = ""2013-2020"",
+                                     ""securityLevel"" = noneList,
+                                     ""qualityTier"" = highQuality,
+                                     ""constraints"" = internalUse
+                   )
 )
 save(ocearch_rr, file = file.path(fileSavePath, ""Secure/ocearch_rr.RData""))",True,True,Documentation / Formatting,7
dfo-mar-odis,shinySpatialApp,f81fd15d5021ab2d1712e5400a7bf140e5a26ac9,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-25T16:44:17Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-25T16:44:17Z,"fix unit tests, fix backslash bug in copy rdata fn",app/R/dataFunctions.R;tests/testthat/help_functions_for_tests.R;tests/testthat/setup_testenv.R;tests/testthat/test_functions.R,False,True,True,False,20,25,45,"---FILE: app/R/dataFunctions.R---
@@ -1,14 +1,18 @@
 
 copy_rdata_files <- function() {
   
-  rDataDir <- ""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\IN\\MSP\\Data\\Rdata\\data\\""
+  rDataDir <- ""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\IN\\MSP\\Data\\Rdata\\data""
+  rStrDir <- gsub(""\\\\"", ""\\\\\\\\"", rDataDir) # backslash escaping nonsense
   
   localDataDir <- here::here(""app/data"")
+  localStrDir <- gsub(""\\\\"", ""\\\\\\\\"", localDataDir) # backslash escaping nonsense
+  
   
   remoteInfo <- file.info(list.files(rDataDir, recursive = TRUE, full.names = TRUE))
-  remoteInfo[""filenames""] <- list.files(rDataDir, recursive = TRUE, include.dirs = TRUE)
+  remoteInfo[""filenames""] <- sub(rStrDir, """", rownames(remoteInfo))
+  
   localInfo <- file.info(list.files(localDataDir, recursive = TRUE, full.names = TRUE))
-  localInfo[""filenames""] <- list.files(localDataDir, recursive = TRUE, include.dirs = TRUE)
+  localInfo[""filenames""] <- sub(localStrDir, """", rownames(localInfo))
   
   missingList <- !(remoteInfo$filenames %in% localInfo$filenames) 
   if (any(missingList)) {

---FILE: tests/testthat/help_functions_for_tests.R---
@@ -46,8 +46,8 @@ render_check_delete <- function(sectionPath, deleteFile=TRUE) {
 load_test_data <- function() {
   catch_all_output({
     # check if globalenv data is loaded, if not load it:
-    if (!exists(""bioregion_sf"")) {
-      load(here::here(""app/data/testData.RData""), envir = globalenv())
+    if (!exists(""region_sf"")) {
+      filesLoaded <- load_rdata(c(""CommonData""), ""MAR"", env = globalenv())
     }
     if (!exists(""add_buffer"")) {
       lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", 
@@ -61,9 +61,8 @@ load_test_data <- function() {
     
     studyArea <- st_read(sample(studyAreaOpts, 1))
     site <- sf::st_centroid(studyArea)
-    region <- st_read(here::here(""app/studyAreaTest/geoms_slc_MarBioRegion.geojson""))
-    
-    mapDataList <- maps_setup(studyArea, site, region, land50k_sf, land10m_sf, bounds_sf)
+
+    mapDataList <- maps_setup(studyArea, site, region_sf, land50k_sf, land10m_sf, bounds_sf)
     list2env(mapDataList, envir = environment())
   })
   

---FILE: tests/testthat/setup_testenv.R---
@@ -8,16 +8,6 @@ rm(list=ls(envir = globalenv()), envir = globalenv())
 source(here::here(""tests/testthat/help_functions_for_tests.R""))
 message(""Generate and load test data set"")
 catch_all_output({
-  
-  dataFilesExist <- all(file.exists(c(here::here(""app/data/OpenData.RData""),
-                                  here::here(""app/data/OpenData_sardist.RData""),
-                                  here::here(""app/data/SecureData.RData""))))
-  if (dataFilesExist) {
-    source(here::here(""dataprocessing/MakeTestData.R""))
-    gen_all_test_data()
-  }  
-  
-  load(here::here(""app/data/testData.RData""), envir = globalenv())
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"",
                     full.names = TRUE), source, local=globalenv())
 })

---FILE: tests/testthat/test_functions.R---
@@ -28,18 +28,20 @@ test_that(""area plot list"", {
 test_that(""master intersect"", {
   list2env(load_test_data(), envir = environment())
   # test with points
-  testBbox <- sf::st_bbox(whitehead_sf)
+  filesLoaded <- load_rdata(c(""whitehead_rr"", ""crithab_rr""), ""MAR"", env = globalenv())
+  
+  testBbox <- sf::st_bbox(whitehead_rr$data_sf)
   mapDataList$studyArea <- testBbox
   mapDataList$bboxMap <- testBbox
-  outputList <- master_intersect(whitehead_sf, mapDataList, getRegion = TRUE)
-  expect_equal(nrow(outputList$regionData), nrow(whitehead_sf))
+  outputList <- master_intersect(whitehead_rr$data_sf, mapDataList, getRegion = TRUE)
+  expect_equal(nrow(outputList$regionData), nrow(whitehead_rr$data_sf))
   
   # test with polygons
-  testBbox <- sf::st_bbox(ClippedCritHab_sf)
+  testBbox <- sf::st_bbox(crithab_rr$data_sf)
   mapDataList$studyArea <- testBbox
   mapDataList$bboxMap <- testBbox
-  outputList <- master_intersect(ClippedCritHab_sf, mapDataList, getRegion = TRUE)
-  expect_equal(nrow(outputList$regionData), nrow(ClippedCritHab_sf))
+  outputList <- master_intersect(crithab_rr$data_sf, mapDataList, getRegion = TRUE)
+  expect_equal(nrow(outputList$regionData), nrow(crithab_rr$data_sf))
   
   # test null intersect (no data in the Gulf of Guinea):
   testBbox[""xmin""] <- 0
@@ -49,7 +51,7 @@ test_that(""master intersect"", {
   mapDataList$region <- testBbox
   mapDataList$bboxMap <- testBbox
   mapDataList$studyArea <- testBbox
-  outputList <- master_intersect(whitehead_sf, mapDataList, getRegion = TRUE)
+  outputList <- master_intersect(whitehead_rr$data_sf, mapDataList, getRegion = TRUE)
   expect_null(c(outputList$regionData, outputList$studyData, outputList$mapData, outputList$mapPoints))
 })
 ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,a16721be387a81b92134407035db11400b390137,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-14T16:28:46Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-14T16:28:46Z,minor fixes to mpa plot colours and captions,app/R/tableFunctions.R;app/Rmd/report_planning_EN.Rmd;app/Rmd/report_planning_FR.Rmd;dataprocessing/SaveDataSets_asRdata.R,True,True,True,False,36,35,71,"---FILE: app/R/tableFunctions.R---
@@ -411,7 +411,7 @@ mpa_table <- function(mpa_sf, lang=""EN"") {
   mpa_sf <- dplyr::arrange(mpa_sf, Id)
   # &nbsp; is a non breaking space which is needed to escape the hyphens in kable in shiny AND rmd
   mpa_sf$Id <- gsub(0, ""&nbsp;-&nbsp;"", mpa_sf$Id)
-  mpaTable <- dplyr::select(mpa_sf, c(""Id"", ""NAME"", ""STATUS"", ""AreaKM2""))
+  mpaTable <- dplyr::select(mpa_sf, c(""Id"", ""NAME"", ""Legend"", ""AreaKM2""))
   mpaTable$AreaKM2 <- as.integer(mpaTable$AreaKM2)
   mpaTable$geometry <- NULL
 

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -64,8 +64,8 @@ writeLines(noquote(mpa_rr$text))
 #### ***Area-specific Draft Conservation Network Design search results ***
 
 ```{r MPA-load-data, results='asis'}
-mpaCols <- c(""darkorchid"", ""lawngreen"", ""dodgerblue2"", ""cyan3"")
-mpaAlphas <- c(0.5, 0.5, 0.5, 0.5)
+mpaCols <- c(""dodgerblue3"", ""red"", ""darkorchid"", ""lawngreen"",  ""cyan3"")
+mpaAlphas <- c(0.5, 0.5, 0.5, 0.5, 0.5)
 names(mpaCols) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
 names(mpaAlphas) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
 
@@ -87,15 +87,14 @@ mpaCheckOuput <- if(!is.null(mpaClipped$studyData)){
 writeLines(mpaCheckOuput)
 ```
 
-```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. '}
+```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation. '}
 if (!is.null(mpaClipped$regionData)){
-  mpaLabels <- filter(st_centroid(mpaClipped$regionData), Id > 0) %>% dplyr::select(c(""Id""))
-  plot_rr_sf(regionMap, mpaClipped$regionData, mpa_rr$attribute, colorMap = mpaCols,
-                            labelData = mpaLabels, labelAttribute = ""Id"", alphaMap = mpaAlphas)
+  plot_rr_sf(regionMap, mpaClipped$regionData, mpa_rr$attribute, outlines=FALSE, colorMap = mpaCols,
+                            alphaMap = mpaAlphas)
 }
 ```
 
-```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline).'}
+```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline). Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation.'}
 if(!is.null(mpaClipped$studyData)){
   mpaStudyLabels <- filter(st_centroid(mpaClipped$mapData), Id > 0) %>% dplyr::select(c(""Id""))
 

---FILE: app/Rmd/report_planning_FR.Rmd---
@@ -67,8 +67,8 @@ writeLines(noquote(mpa_rr$text))
 #### ***Area-specific Draft Conservation Network Design search results ***
 
 ```{r MPA-load-data, results='asis'}
-mpaCols <- c(""darkorchid"", ""lawngreen"", ""dodgerblue2"", ""cyan3"")
-mpaAlphas <- c(0.5, 0.5, 0.5, 0.5)
+mpaCols <- c(""dodgerblue3"", ""red"", ""darkorchid"", ""lawngreen"",  ""cyan3"")
+mpaAlphas <- c(0.5, 0.5, 0.5, 0.5, 0.5)
 names(mpaCols) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
 names(mpaAlphas) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
 
@@ -90,15 +90,14 @@ mpaCheckOuput <- if(!is.null(mpaClipped$studyData)){
 writeLines(mpaCheckOuput)
 ```
 
-```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. '}
+```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation. '}
 if (!is.null(mpaClipped$regionData)){
-  mpaLabels <- filter(st_centroid(mpaClipped$regionData), Id > 0) %>% dplyr::select(c(""Id""))
-  plot_rr_sf(regionMap, mpaClipped$regionData, mpa_rr$attribute, colorMap = mpaCols,
-                            labelData = mpaLabels, labelAttribute = ""Id"", alphaMap = mpaAlphas)
+  plot_rr_sf(regionMap, mpaClipped$regionData, mpa_rr$attribute, outlines=FALSE, colorMap = mpaCols,
+                            alphaMap = mpaAlphas)
 }
 ```
 
-```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline).'}
+```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline). Boundaries of the proposed new sites are preliminary and subject to change following engagementa and consultation.'}
 if(!is.null(mpaClipped$studyData)){
   mpaStudyLabels <- filter(st_centroid(mpaClipped$mapData), Id > 0) %>% dplyr::select(c(""Id""))
 

---FILE: dataprocessing/SaveDataSets_asRdata.R---
@@ -173,25 +173,6 @@ sardist_sf <- st_make_valid(sardist_sf)
 save(sardist_sf, file = ""../Data/Rdata/OpenData_sardist.RData"")
 
 
-# Marine Protected Areas
-mpa_raw <- st_read(""../Data/Management/MPAN-Draft/MPAN_DraftDesign_Maritimes/MPAN_DraftDesign_Maritimes.shp"", stringsAsFactors = FALSE)
-mpa_sf <- st_transform(mpa_raw, crs = 4326)
-mpa_sf <- st_make_valid(mpa_sf)
-mpa_rr <- list(""title"" = ""Draft Conservation Network Design: existing and potential future marine protected areas (MPAs) and other spatial conservation areas"",
-               ""contact"" = ""Marty King ([Marty.King@dfo-mpo.gc.ca](mailto:Marty.King@dfo-mpo.gc.ca){.email})"", 
-               ""attribute"" = ""STATUS"",
-               ""accessedOn"" = "" October 2021"" ,
-               ""data_sf"" = mpa_sf,
-               ""securityLevel"" = ""None"",
-               ""qualityTier"" = ""High"",
-               ""constraints"" = ""DFO INTERNAL USE ONLY"",
-               ""text"" = ""A key milestone and focal point for the planning process is the Draft Conservation Network Design, which is a map of both existing and potential future marine protected areas (MPAs) and other spatial conservation areas that would contribute to the long-term conservation of marine biodiversity in the bioregion. The Draft Design was originally drafted in 2017 following an extensive spatial conservation analysis led by Fisheries and Oceans Canada (DFO). While some discussion on the Draft Design has been ongoing with our provincial and First Nations partners since that time, events such as the COVID-19 pandemic have limited the scope and pace of the overall engagement process.  \n\n
-Marine Planning and Conservation at DFO has initiated a two-phased engagement process on the Draft Design to inform the completion of a Conservation Network Plan for the Scotian Shelf-Bay of Fundy bioregion. During Phase 1, DFO will be undertaking targeted discussions with federal and provincial departments, First Nations and Indigenous groups, and key stakeholders, such as the fishing industry. The primary purpose of Phase 1 is to provide those with previous involvement in the process with an opportunity to review and provide written feedback on the Draft Design by December 31, 2021. In 2022, the Draft Design will be revised based on the feedback received. Phase 2 is planned for early 2023 and will include a broader public engagement process. The Marine Conservation Network Plan will be completed by 2024 and will be updated periodically as new information becomes available.  \n\n
-It is important to note that Marine Conservation Network Plan will be aligned with a future Marine Spatial Plan for the Scotian Shelf-Bay of Fundy bioregion. The overall intent is to ensure an effective balance among ecological, socio-economic and cultural objectives in the use, management and conservation of our marine environment and spaces. DFO and its partners will be providing further information on the bioregional Marine Spatial Planning (MSP) process in the near future.
-"")
-
-
-
 sardist_sf <- st_make_valid(sardist_sf)
 
 save(sardist_sf, file = ""../Data/Rdata/OpenData_sardist.RData"")
@@ -273,7 +254,29 @@ ocearch <- read.csv(textConnection(lines), quote = '""""')
 ocearch <- dplyr::select(ocearch, c(""Date"", ""long"", ""lat"", ""ID""))
 ocearch_sf <- st_as_sf(ocearch, coords = c(""long"", ""lat""), crs = 4326)
 
+# Marine Protected Areas
+mpa_raw <- st_read(""../Data/Management/MPAN-Draft/MPAN_DraftDesign_Maritimes/MPAN_DraftDesign_Maritimes.shp"", stringsAsFactors = FALSE)
+mpa_sf <- st_transform(mpa_raw, crs = 4326)
+mpa_sf <- st_make_valid(mpa_sf)
+mpa_rr <- list(""title"" = ""Draft Conservation Network Design: existing and potential future marine protected areas (MPAs) and other spatial conservation areas"",
+               ""contact"" = ""Marty King ([Marty.King@dfo-mpo.gc.ca](mailto:Marty.King@dfo-mpo.gc.ca){.email})"", 
+               ""accessedOn"" = "" October 2021"" ,
+               ""data_sf"" = mpa_sf,
+               ""securityLevel"" = ""None"",
+               ""qualityTier"" = ""High"",
+               ""constraints"" = ""DFO INTERNAL USE ONLY"",
+               ""text"" = ""A key milestone and focal point for the planning process is the Draft Conservation Network Design, which is a map of both existing and potential future marine protected areas (MPAs) and other spatial conservation areas that would contribute to the long-term conservation of marine biodiversity in the bioregion. The Draft Design was originally drafted in 2017 following an extensive spatial conservation analysis led by Fisheries and Oceans Canada (DFO). While some discussion on the Draft Design has been ongoing with our provincial and First Nations partners since that time, events such as the COVID-19 pandemic have limited the scope and pace of the overall engagement process.  \n\n
+Marine Planning and Conservation at DFO has initiated a two-phased engagement process on the Draft Design to inform the completion of a Conservation Network Plan for the Scotian Shelf-Bay of Fundy bioregion. During Phase 1, DFO will be undertaking targeted discussions with federal and provincial departments, First Nations and Indigenous groups, and key stakeholders, such as the fishing industry. The primary purpose of Phase 1 is to provide those with previous involvement in the process with an opportunity to review and provide written feedback on the Draft Design by December 31, 2021. In 2022, the Draft Design will be revised based on the feedback received. Phase 2 is planned for early 2023 and will include a broader public engagement process. The Marine Conservation Network Plan will be completed by 2024 and will be updated periodically as new information becomes available.  \n\n
+It is important to note that Marine Conservation Network Plan will be aligned with a future Marine Spatial Plan for the Scotian Shelf-Bay of Fundy bioregion. The overall intent is to ensure an effective balance among ecological, socio-economic and cultural objectives in the use, management and conservation of our marine environment and spaces. DFO and its partners will be providing further information on the bioregional Marine Spatial Planning (MSP) process in the near future.
+"")
+
+mpa_rr$data_sf$Legend <- as.factor(mpa_rr$data_sf$STATUS)
+levels(mpa_rr$data_sf$Legend) <- list(""Existing Network Site""=""Existing"", ""Other Network Sites""=""Proposed"", ""Area of Interest for Oceans Act MPA""=""Proposed AOI"", ""Proposed Conservation Area Under the Fisheries Act""=""Proposed SBA"")
+mpa_rr$data_sf$Legend <- as.character(mpa_rr$data_sf$Legend)
+mpa_rr$data_sf[mpa_rr$data_sf$Id == 18, ""Legend"" ] <- ""Bras d'Or Lake -sites to be determined""
+mpa_rr$attribute <- ""Legend""
+
 # Save all objects to a single .Rdata file
-save(isdb_sf,ISSPECIESCODES,leatherback_sf, Legend, marfis_sf,MARFISSPECIESCODES, narwc_sf, whitehead_sf, wsdb_sf, ocearch_sf,
+save(isdb_sf,ISSPECIESCODES,leatherback_sf, Legend, marfis_sf, MARFISSPECIESCODES, narwc_sf, whitehead_sf, wsdb_sf, ocearch_sf, mpa_rr, 
      file = ""../Data/Rdata/SecureData.Rdata"")
 ########################################################-
\ No newline at end of file",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,28d4787aacf93b3aae8a5ab2f0ccf9df8c1e255f,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-12T18:42:17Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-12T18:42:17Z,"unit tests fixed, mpa section ready",dataprocessing/MakeTestData.R,False,True,True,False,5,1,6,"---FILE: dataprocessing/MakeTestData.R---
@@ -190,6 +190,8 @@ gen_all_test_data <- function() {
   rr_names <- c(""mpa_rr"")
   
   exclude_list <- c(""bounds_sf"", ""land10m_sf"", ""land50k_sf"")
+  excludeSf_list <- list(bounds_sf, land10m_sf, land50k_sf)
+  names(excludeSf_list) <- exclude_list
   
   sfToGen <- sf_names[!(sf_names %in% exclude_list)]
   testSf_list <- lapply(sfToGen, gen_test_sf, env = genTestDataEnv)
@@ -199,5 +201,7 @@ gen_all_test_data <- function() {
   names(testRr_list) <- rr_names
   
   out_file <- here::here(""app/data/testData.Rdata"") 
-  save(list=c(sf_names, rr_names, exclude_list) , file=out_file)
+  outList <- c(testSf_list, testRr_list, excludeSf_list)
+  list2env(outList, envir = genTestDataEnv)
+  save(list=names(outList) , file=out_file, envir = genTestDataEnv)
 }",True,False,Documentation / Formatting,3
dfo-mar-odis,shinySpatialApp,e7443d2acc27a1b1be2ecc61e89864dae3695692,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-12T18:24:52Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-12T18:24:52Z,fix unit tests in progress,app/R/plotFunctions.R;app/R/tableFunctions.R;app/Rmd/report_planning_EN.Rmd;app/Rmd/report_planning_FR.Rmd;dataprocessing/MakeTestData.R;tests/testthat/teardown_testenv.R,True,True,True,False,133,40,173,"---FILE: app/R/plotFunctions.R---
@@ -84,7 +84,7 @@ plot_points <- function(baseMap, data_sf, attribute=NULL, legendName="""", colorMa
   shapeLayer <- NULL
   
   if (is.null(attribute)) {
-    # just plot raw data (no colors)
+    # just plot raw data (no colors, shapes, etc)
     dataLayer <- geom_sf(data = data_sf, size = 2, shape = 20) 
     legendLayer <- NULL
   } else {
@@ -148,7 +148,7 @@ plot_points <- function(baseMap, data_sf, attribute=NULL, legendName="""", colorMa
 
 plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute,
                           outlines=TRUE, colorMap=NULL, getColorMap=FALSE,
-                          labelData=NULL, labelAttribute=NULL) {
+                          labelData=NULL, alphaMap=NULL, labelAttribute=NULL) {
   
   scaleBarLayer = get_scale_bar_layer(baseMap)
   studyBoxLayer = get_study_box_layer(baseMap)
@@ -165,43 +165,50 @@ plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute,
   # Case 1: all polygons are one color, no legend,
   # case 2: polygons are colored based on the ""attribute"" column, legend is included
   polyLabels <- NULL
+  polyAlpha <- NULL
+  polyOutline <- NULL
+  polyFill <- NULL
+  
   
   if (toupper(attribute) == ""NONE"") { # Case 1: plotting all polygons in one color
     
     polyPlot <- geom_sf(data=polyData, fill=""#56B4E9"", col=clr)
-    polyFill <- NULL
-    polyOutline <- NULL
-    
     
   } else { # Case 2: plotting polygons in different colors based on ""attribute"" column in the data
     polyData[[attribute]] = as.factor(polyData[[attribute]])
     
+    polyAes <- aes(fill = !!sym(attribute))
+    
+    if (!is.null(alphaMap)) {
+      alphaMap <- alphaMap[names(alphaMap) %in% polyData[[attribute]]]
+      polyAes <- modifyList(polyAes, aes(alpha = !!sym(attribute)))
+      polyAlpha <- scale_alpha_manual(values=alphaMap)
+    }
+    
     if (is.null(colorMap)){
       colorMap <- get_rr_color_map(polyData[[attribute]])
     } else {
       colorMap <- colorMap[names(colorMap) %in% polyData[[attribute]]]
     }
-
     polyFill <- scale_fill_manual(values=colorMap, name=legendName)
     
     if (outlines) {
-      polyOutline <- NULL
-      polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute)), colour=clr)
-      
+      polyPlot <- geom_sf(data=polyData, polyAes, colour=clr)
     }
     else {
-      polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute), col=!!sym(attribute)))
+      polyAes <- modifyList(polyAes, aes(col=!!sym(attribute)))
+      polyPlot <- geom_sf(data=polyData, polyAes)
       polyOutline <- scale_color_manual(values=colorMap, guide=""none"")  
     }
   }
   
   if(!is.null(labelData)) {
     polyLabels <- geom_sf_label(data = labelData, aes(label = !!sym(labelAttribute)))
   }
-  
     
   polyMap <- baseMap +
       polyPlot +
+      polyAlpha +
       polyFill +
       polyOutline +
       polyLabels +

---FILE: app/R/tableFunctions.R---
@@ -425,7 +425,7 @@ mpa_table <- function(mpa_sf, lang=""EN"") {
   }
   mpaTable <- distinct(mpaTable)
   return(mpaTable)
-
+}
   
 # ---------add_col_to_whale_summary-------
 # Adds a column with number of records to the cetacean summary table

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -59,14 +59,16 @@ if(!is.null(EBSAoutput$studyData)){
 write_meta(mpa_rr)
 writeLines(noquote(mpa_rr$text))
 
-mpaCols <- c(""darkorchid"", ""lawngreen"", ""dodgerblue2"", ""cyan3"")
-names(mpaCols) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
-
 ```
 
 #### ***Area-specific Draft Conservation Network Design search results ***
 
 ```{r MPA-load-data, results='asis'}
+mpaCols <- c(""darkorchid"", ""lawngreen"", ""dodgerblue2"", ""cyan3"")
+mpaAlphas <- c(0.5, 0.5, 0.5, 0.5)
+names(mpaCols) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
+names(mpaAlphas) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
+
 mpaClipped <- master_intersect(mpa_rr$data_sf,  mapDataList, getRegion=TRUE)
 
 if(!is.null(mpaClipped$studyData)) {
@@ -89,16 +91,16 @@ writeLines(mpaCheckOuput)
 if (!is.null(mpaClipped$regionData)){
   mpaLabels <- filter(st_centroid(mpaClipped$regionData), Id > 0) %>% dplyr::select(c(""Id""))
   plot_rr_sf(regionMap, mpaClipped$regionData, mpa_rr$attribute, colorMap = mpaCols,
-                            labelData = mpaLabels, labelAttribute = ""Id"")
+                            labelData = mpaLabels, labelAttribute = ""Id"", alphaMap = mpaAlphas)
 }
 ```
 
 ```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline).'}
 if(!is.null(mpaClipped$studyData)){
-  mpaStudyLabels <- filter(st_centroid(mpaClipped$studyData), Id > 0) %>% dplyr::select(c(""Id""))
+  mpaStudyLabels <- filter(st_centroid(mpaClipped$mapData), Id > 0) %>% dplyr::select(c(""Id""))
 
-  plot_rr_sf(areaMap, mpaClipped$studyData, mpa_rr$attribute, colorMap = mpaCols,
-             labelData = mpaStudyLabels, labelAttribute = ""Id"")
+  plot_rr_sf(areaMap, mpaClipped$mapData, mpa_rr$attribute, colorMap = mpaCols,
+             labelData = mpaStudyLabels, labelAttribute = ""Id"", alphaMap = mpaAlphas)
 }
 ```
 

---FILE: app/Rmd/report_planning_FR.Rmd---
@@ -53,3 +53,62 @@ if(!is.null(EBSAoutput$studyData)){
   plot_rr_sf(areaMap, EBSAoutput$mapData, ""NONE"")
 }
 ```
+
+
+### **`r mpa_rr$title`** {#MPA-section}
+
+
+```{r MPA-section, results='asis'}
+write_meta(mpa_rr)
+writeLines(noquote(mpa_rr$text))
+
+```
+
+#### ***Area-specific Draft Conservation Network Design search results ***
+
+```{r MPA-load-data, results='asis'}
+mpaCols <- c(""darkorchid"", ""lawngreen"", ""dodgerblue2"", ""cyan3"")
+mpaAlphas <- c(0.5, 0.5, 0.5, 0.5)
+names(mpaCols) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
+names(mpaAlphas) <- levels(as.factor(mpa_rr$data_sf[[mpa_rr$attribute]]))
+
+mpaClipped <- master_intersect(mpa_rr$data_sf,  mapDataList, getRegion=TRUE)
+
+if(!is.null(mpaClipped$studyData)) {
+  mpaTable <- mpa_table(mpaClipped$studyData)
+} else {
+  mpaTable <- NULL
+}
+
+#function for overlap
+mpaCheckOuput <- if(!is.null(mpaClipped$studyData)){
+    ""* There are relevant records of areas that are part of the Draft Conservation Network Design in the search area.""
+  } else {
+    ""* There are no relevant records of areas that are part of the Draft Conservation Network Design in the search area.""
+  }
+
+writeLines(mpaCheckOuput)
+```
+
+```{r mpa-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none.Map of the Draft Conservation Network Design for the Scotian Shelf-Bay of Fundy Bioregion. '}
+if (!is.null(mpaClipped$regionData)){
+  mpaLabels <- filter(st_centroid(mpaClipped$regionData), Id > 0) %>% dplyr::select(c(""Id""))
+  plot_rr_sf(regionMap, mpaClipped$regionData, mpa_rr$attribute, colorMap = mpaCols,
+                            labelData = mpaLabels, labelAttribute = ""Id"", alphaMap = mpaAlphas)
+}
+```
+
+```{r mpa-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map of the Draft Conservation Network Design in the search area defined by the user (red outline).'}
+if(!is.null(mpaClipped$studyData)){
+  mpaStudyLabels <- filter(st_centroid(mpaClipped$mapData), Id > 0) %>% dplyr::select(c(""Id""))
+
+  plot_rr_sf(areaMap, mpaClipped$mapData, mpa_rr$attribute, colorMap = mpaCols,
+             labelData = mpaStudyLabels, labelAttribute = ""Id"", alphaMap = mpaAlphas)
+}
+```
+
+```{r mpa-table, echo=FALSE, results='asis', caption=""MPA table""}
+if (!is.null(mpaTable)) {
+  knitr::kable(mpaTable, align=""l"", caption=""Quality Tier: High Security level: none. Area and names of Marine Protected Areas located within study area..</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
+}
+```

---FILE: dataprocessing/MakeTestData.R---
@@ -103,18 +103,44 @@ gen_test_poly_sf <- function(real_sf, n_poly=10) {
 }
 
 
+##### - gen_test_rr ##################################
+# This function generates a version of the input sf with a random geometry column
+# The length and type of geometry in the final column are dependent on the initial sf
+#
+# Inputs:
+# 1. real_rr_str: string naming rr object to be reduced/turned into test data
+#
+# Outputs:
+# 1. test_rr: reduced sf filled with test data
+
+gen_test_rr <- function(real_rr_str, env = NULL) {
+  message(real_rr_str)
+  test_rr <- get(real_rr_str, envir = env)
+  test_rr$data_sf <- gen_test_sf(test_rr$data_sf, env = env)
+  return(test_rr)
+}
+
 ##### - gen_test_sf ##################################
 # This function generates a version of the input sf with a random geometry column
 # The length and type of geometry in the final column are dependent on the initial sf
 #
 # Inputs:
-# 1. real_sf: sf object to be reduced/turned into test data
+# 1. real_sf_str: string name of sf object to be reduced/turned into test data
 #
 # Outputs:
 # 1. test_sf: reduced sf filled with test data
 
-gen_test_sf <- function(real_sf) {
+gen_test_sf <- function(real_sf_str, env=NULL) {
   # Geometry type
+  if (is.character(real_sf_str)){
+    message(real_sf_str)
+    real_sf <- get(real_sf_str, envir = env)
+  } else {
+    real_sf <- real_sf_str
+  }
+  if (!inherits(real_sf, ""sf"")){
+    return(real_sf)
+  }
   point_factor <- sf::st_geometry_type(sf::st_point())
   # set number of samples based on length of sf
   num_samples <- 500
@@ -125,7 +151,7 @@ gen_test_sf <- function(real_sf) {
   if (nrow_real_sf < 100) {
     num_samples <- nrow_real_sf
   }
-
+  
   # get test_sf of either points or polys based on type of real_sf
   test_sf <- real_sf
   if (sf::st_geometry_type(real_sf, FALSE) == point_factor) {
@@ -146,17 +172,13 @@ gen_test_sf <- function(real_sf) {
 # Outputs:
 #  None.  Data is saved to a file in the data directory.
 gen_all_test_data <- function() {
-  load(here::here(""app/data/OpenData.RData""))
-  load(here::here(""app/data/OpenData_sardist.RData""))
-  load(here::here(""app/data/SecureData.RData""))
-
-  sf_list <- list(NBNW_ImpHab_sf, bioregion_sf, BlueWhale_ImpHab_sf, bounds_sf, ClippedCritHab_sf, EBSA_sf,
-                  fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, land10m_sf, land50k_sf, 
-                  listed_cetacean_species, listed_fish_invert_species, listed_other_species, 
-                  listed_species, obis_cet_sf, obis_fish_sf, rockweed_sf, 
-                  RVCatch_sf, RVGSSPECIES, sei_whale_sf, sardist_sf, isdb_sf, ISSPECIESCODES, 
-                  leatherback_sf, Legend, marfis_sf, MARFISSPECIESCODES, narwc_sf, whitehead_sf,
-                  wsdb_sf, ocearch_sf)
+  
+  genTestDataEnv <- environment()
+  
+  load(here::here(""app/data/OpenData.RData""), envir = genTestDataEnv)
+  load(here::here(""app/data/OpenData_sardist.RData""), envir = genTestDataEnv)
+  load(here::here(""app/data/SecureData.RData""), envir = genTestDataEnv)
+  
   sf_names <- c(""NBNW_ImpHab_sf"", ""bioregion_sf"", ""BlueWhale_ImpHab_sf"", ""bounds_sf"", ""ClippedCritHab_sf"", ""EBSA_sf"",
                 ""fin_whale_sf"", ""harbour_porpoise_sf"", ""humpback_whale_sf"", ""land10m_sf"", ""land50k_sf"", 
                 ""listed_cetacean_species"", ""listed_fish_invert_species"", ""listed_other_species"", 
@@ -165,14 +187,17 @@ gen_all_test_data <- function() {
                 ""leatherback_sf"", ""Legend"", ""marfis_sf"", ""MARFISSPECIESCODES"", ""narwc_sf"", ""whitehead_sf"",
                 ""wsdb_sf"", ""ocearch_sf"")
   
+  rr_names <- c(""mpa_rr"")
+  
   exclude_list <- c(""bounds_sf"", ""land10m_sf"", ""land50k_sf"")
   
-  for (i in 1:length(sf_list)) {
-    if (!(sf_names[i] %in% exclude_list) && (""sf"" %in% class(sf_list[[i]]))) {
-      assign(sf_names[i], gen_test_sf(sf_list[[i]])) 
-    }
-  }
+  sfToGen <- sf_names[!(sf_names %in% exclude_list)]
+  testSf_list <- lapply(sfToGen, gen_test_sf, env = genTestDataEnv)
+  names(testSf_list) <- sfToGen
+  
+  testRr_list <- lapply(rr_names, gen_test_rr, env = genTestDataEnv)
+  names(testRr_list) <- rr_names
   
   out_file <- here::here(""app/data/testData.Rdata"") 
-  save(list=sf_names, file=out_file)
+  save(list=c(sf_names, rr_names, exclude_list) , file=out_file)
 }

---FILE: tests/testthat/teardown_testenv.R---
@@ -7,4 +7,4 @@ if (file.exists(envDataFn)) {
   # if file exists reload starting data, and remove the file.
   load(envDataFn, envir = globalenv())
   file.remove(envDataFn)
-}
\ No newline at end of file
+}",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,0bd9abdf2bfc856df55aa56c4359f879ab79026b,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-06T17:14:13Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-10-06T17:14:13Z,fix unit tests to include summary tables,tests/testthat/help_functions_for_tests.R,False,True,True,False,1,1,2,"---FILE: tests/testthat/help_functions_for_tests.R---
@@ -72,7 +72,7 @@ load_test_data <- function() {
                   ""absentCode"" = ""A"",
                   ""presentCode"" = ""P"",
                   ""summarySarTable"" = data.frame(""Species"" = listed_species$`Common Name`),
-                  ""summarySarTablesummaryHabTable"" <- data.frame(""Species"" = listed_species$`Common Name`, ""Obs""=NA, ""range"" = NA, ""SDM"" = NA, ""IH"" = NA, ""CH"" = NA),
+                  ""summaryHabTable"" = data.frame(""Species"" = listed_species$`Common Name`, ""Obs""=NA, ""range"" = NA, ""SDM"" = NA, ""IH"" = NA, ""CH"" = NA),
                   ""site"" = site,
                   ""studyBox_geom"" = studyBox_geom, 
                   ""areaMap"" = areaMap, ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,116148b0b18a00d9fc27bcf8f1f236f193b133e3,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-29T14:20:44Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-29T14:20:44Z,fix ocearch summary row,app/Rmd/intro_EN.Rmd;app/Rmd/report_fish_EN.Rmd,True,False,True,False,7,7,14,"---FILE: app/Rmd/intro_EN.Rmd---
@@ -33,7 +33,8 @@ copy_rdata_files() # make sure data files are up to date.
 load(here::here(""app/data/OpenData.RData""))
 load(here::here(""app/data/OpenData_sardist.RData""))
 load(here::here(""app/data/SecureData.RData""))
-
+listed_species <- listed_species[!c(listed_species$`COSEWIC status` == ""No Status"" & listed_species$`SARA status` == ""No Status""), ]
+row.names(listed_species) <- NULL
 #load(""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting\\data\\SecureData.Rdata"")
 
 ```
@@ -62,8 +63,8 @@ presentCode <- ""P""
 
 <!-- # ```{r child = c('../Rmd/report_cetaceans_EN.Rmd', 'report_fish_EN.Rmd', 'report_habitat_EN.Rmd', 'report_planning_EN.Rmd', 'report_SARA_EN.Rmd')} -->
 <!-- # ``` -->
-```{r child = '../Rmd/report_fish_EN.Rmd'}
-```
+<!--```{r child = '../Rmd/report_cetaceans_EN.Rmd'}
+```-->
 
 <!-- END  -->
 

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -71,7 +71,6 @@ if (!is.null(outputList$studyData)) {
   if (nrow(rvSarTable) > 0) {
     knitr::kable(rvSarTable, align=""l"", caption=""\\label{tab:rv_SAR_table} Quality Tier: High. Security level: none. Maritimes Research Vessel (RV) Survey observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or species assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
   }
-  
 }
 ```
 <br>
@@ -245,10 +244,10 @@ OCEARCH is a data-centric organization built to help scientists collect previous
 ocearchOutputList <- master_intersect(ocearch_sf, mapDataList)
 
  if (!is.null(ocearchOutputList$studyData)) {
-   ocearchSummaryRow <- list(""Common Name"" = ""White Shark"")
-   summarySarTable <- add_col_to_sar_summary(summarySarTable, ""OCEARCH"", ocearchSummaryRow, ""Common Name"", ""Common Name"")
+   ocearchSummaryRow <- data.frame(""CommonName"" = c(""White Shark""))
+   summarySarTable <- add_col_to_sar_summary(summarySarTable, ""OCEARCH"", ocearchSummaryRow, ""CommonName"", ""CommonName"")
  } else {
-   summarySarTable <- add_col_to_sar_summary(summarySarTable, ""OCEARCH"", NULL, ""Common Name"", ""Common Name"")
+   summarySarTable <- add_col_to_sar_summary(summarySarTable, ""OCEARCH"", NULL, ""CommonName"", ""CommonName"")
  }
 
 ```",False,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,3c5a156dfa0a5f3de876a1a8763c3c8f4c57356f,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-28T16:30:51Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-28T16:30:51Z,fix rockweed preprocessing script,dataprocessing/SaveDataSets_asRdata.R,False,True,True,False,5,5,10,"---FILE: dataprocessing/SaveDataSets_asRdata.R---
@@ -41,11 +41,11 @@ rockweed_sf <- st_read(""../Data/NaturalResources/Species/Rockweed/MAR_rockweed_p
 rockweed_sf <- st_transform(rockweed_sf, 4326) # Project to WGS84
 rockweed_sf <- st_make_valid(rockweed_sf)
 # set status column
-poly_sf$status = """"
-poly_sf$status[which(poly_sf$RWP==1)] = ""Present""
-poly_sf$status[which(poly_sf$RWP==2)] = ""Likely Present""
-poly_sf$status[which(poly_sf$RWP==5)] = ""Unknown""
-poly_sf$status[which(poly_sf$RWP==0)] = ""Not Present""
+rockweed_sf$status = """"
+rockweed_sf$status[which(rockweed_sf$RWP==1)] = ""Present""
+rockweed_sf$status[which(rockweed_sf$RWP==2)] = ""Likely Present""
+rockweed_sf$status[which(rockweed_sf$RWP==5)] = ""Unknown""
+rockweed_sf$status[which(rockweed_sf$RWP==0)] = ""Not Present""
 
 
 # Table of SARA listed species",True,False,Implementation / Logic,3
dfo-mar-odis,shinySpatialApp,1502e5a48cc0f11ad95ea86423bea2aa51005590,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-22T11:38:40Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-22T11:38:40Z,fix column headers,app/R/tableFunctions.R,False,True,True,False,2,2,4,"---FILE: app/R/tableFunctions.R---
@@ -302,11 +302,11 @@ table_crit <- function(CCH_sf, LB_sf) {
   if (!is.null(CCH_sf)){
     critTable <- dplyr::select(CCH_sf, c(""Common_Nam"", ""Population"", ""Waterbody"", ""SARA_Statu""))
     critTable$geometry <- NULL
-    names(critTable) <- c(""`Common Name`"", ""Population"", ""Area"", ""`SARA status`"")
+    names(critTable) <- c(""Common Name"", ""Population"", ""Area"", ""SARA status"")
   } else {
     # only set names after init to preserve spaces etc.
     critTable <- data.frame(""a""=NA, ""b""=NA, ""c""=NA, ""d""=NA) 
-    names(critTable) <- c(""`Common Name`"", ""Population"", ""Area"", ""`SARA status`"")
+    names(critTable) <- c(""Common Name"", ""Population"", ""Area"", ""SARA status"")
     
   }
   ",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,a305587a0d4b52d33e12b6befc7074740ff00375,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-17T13:55:14Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-17T13:55:14Z,fix critTable where crithab is null and leatherback is not null,app/R/tableFunctions.R,False,True,True,False,7,3,10,"---FILE: app/R/tableFunctions.R---
@@ -277,9 +277,13 @@ table_dist <- function(sardist_sf) {
 #SAR critical habitat
 table_crit <- function(CCH_sf, LB_sf) {
   
-  critTable <- dplyr::select(CCH_sf, c(""Common_Nam"", ""Population"", ""Waterbody"", ""SARA_Statu""))
-  critTable$geometry <- NULL
-  names(critTable) <- c(""CommonName"", ""Population"", ""Area"", ""SARA_status"")
+  if (!is.null(CCH_sf)){
+    critTable <- dplyr::select(CCH_sf, c(""Common_Nam"", ""Population"", ""Waterbody"", ""SARA_Statu""))
+    critTable$geometry <- NULL
+    names(critTable) <- c(""CommonName"", ""Population"", ""Area"", ""SARA_status"")
+  } else {
+    critTable <- data.frame(""CommonName""=NA, ""Population""=NA, ""Area""=NA, ""SARA_status""=NA)
+  }
   
   if (!is.null(LB_sf)){
     leatherbackRow <- data.frame(""Leatherback Sea Turtle"", NA, paste(LB_sf$AreaName, collapse=', ' ), ""Endangered"" )",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,d3021b7af47299eb65b43e028188cea3c36a4b8d,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-15T13:37:58Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-15T13:37:58Z,"speed up cetaceans plot, fix stuy/study typos",app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/report_cetaceans_FR.Rmd;app/Rmd/report_planning_EN.Rmd;app/Rmd/report_planning_FR.Rmd,True,False,True,False,15,13,28,"---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -176,25 +176,27 @@ Important usage considerations: model predictions in this section should not be
 
 #### ***Area-specific SDM cetacean search results***
 ```{r sdm, include=FALSE, cache=FALSE}
-clippedFin <- master_intersect(fin_whale_sf, mapDataList)
-clippedHp <- master_intersect(harbour_porpoise_sf, mapDataList)
-clippedHump <- master_intersect(humpback_whale_sf , mapDataList)
-clippedSei <- master_intersect(sei_whale_sf, mapDataList)
+
+clippedFin <- master_intersect(fin_whale_sf, mapDataList, getRegion = TRUE)
+clippedHp <- master_intersect(harbour_porpoise_sf, mapDataList, getRegion = TRUE)
+clippedHump <- master_intersect(humpback_whale_sf , mapDataList, getRegion = TRUE)
+clippedSei <- master_intersect(sei_whale_sf, mapDataList, getRegion = TRUE)
 
 table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
                         ""Habour Porpoise"" = !is.null(clippedHp$studyData),
                         ""Humpback Whale"" = !is.null(clippedHump$studyData),
                         ""Sei Whale"" = !is.null(clippedSei$studyData),
                         check.names = FALSE)
-
 ```
 
 ```{r sdm-table}
  knitr::kable(table_sdm, align=""cccc"", caption=""Quality Tier: Low. Security level: none. Results showing if the search area overlap with predicted Priority Areas to Enhance Monitoring of several species of cetaceans (Fin Whale, Harbour Porpoise, Humpback Whale and Sei Whale). TRUE = polygon does overlap with priority area; FALSE = polygon does NOT overlap with priority area."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 ```
 
 ```{r sdm-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map shows consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate). Yellow polygons (habitats with high suitability) are to be interpreted as areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in Gomez et al. (2020), these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. They represent priority areas to direct cetacean monitoring efforts. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the Western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure.'}
-plot_cetaceans_4grid(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea, land10m_sf, 50, bounds_sf)
+plot_cetaceans_4grid(clippedFin$regionData, clippedHp$regionData, clippedHump$regionData, clippedSei$regionData, studyArea, land10m_sf, 50, bounds_sf)
+
+
 ```
 
 ### **Blue Whale Important Habitat**

---FILE: app/Rmd/report_cetaceans_FR.Rmd---
@@ -172,10 +172,10 @@ Considérations importantes relatives à l’utilisation : les prévisions modé
 #### ***Résultats de la recherche du MRE pour les cétacés, par zone***
 ```{r sdm, include=FALSE, cache=FALSE}
 
-clippedFin <- master_intersect(fin_whale_sf, mapDataList)
-clippedHp <- master_intersect(harbour_porpoise_sf, mapDataList)
-clippedHump <- master_intersect(humpback_whale_sf , mapDataList)
-clippedSei <- master_intersect(sei_whale_sf, mapDataList)
+clippedFin <- master_intersect(fin_whale_sf, mapDataList, getRegion = TRUE)
+clippedHp <- master_intersect(harbour_porpoise_sf, mapDataList, getRegion = TRUE)
+clippedHump <- master_intersect(humpback_whale_sf , mapDataList, getRegion = TRUE)
+clippedSei <- master_intersect(sei_whale_sf, mapDataList, getRegion = TRUE)
 
 table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
                         ""Habour Porpoise"" = !is.null(clippedHp$studyData),
@@ -189,7 +189,7 @@ table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
 ```
 
 ```{r sdm-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Faible. Niveau de sécurité : Aucun. La carte montre les résultats consolidés du modèle de répartition des espèces (taux d’occurrence prévu relatif de 60 à 100 %). Les polygones jaunes (habitats très appropriés) doivent être interprétés comme des zones où les efforts de surveillance des cétacés peuvent être priorisés et dont les résultats peuvent aider à diriger les activités de relevés dans le futur. En raison des nombreuses raisons énumérées dans la section de discussion de Gomez et al. (2020), ces données de modélisation sur les cétacés ne représentent pas une répartition complète et actuelle des cétacés dans la région. Elles représentent des zones prioritaires où diriger les efforts de surveillance des cétacés. Leur utilisation dans les processus de planification de l’espace marin devrait être accompagnée d’approches complémentaires telles que le processus résumé dans la section ci-dessous. Le produit de données résumé dans la section ci-dessous (habitat important pour le rorqual bleu dans l’ouest de l’Atlantique Nord) représente un excellent cadre dans lequel utiliser correctement les extrants de cette figure.'}
-plot_cetaceans_4grid(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea, land10m_sf, 50, bounds_sf)
+plot_cetaceans_4grid(clippedFin$regionData, clippedHp$regionData, clippedHump$regionData, clippedSei$regionData, studyArea, land10m_sf, 50, bounds_sf)
 ```
 
 ### **Habitat important pour le rorqual bleu**  

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -29,7 +29,7 @@ attribute <- ""NONE""
 *
 ```{r EBSA-check, echo=FALSE, results='asis'}
 #function for overlap
-Query_output_EBSA<-if(is.null(EBSAoutput$stuyData)){
+Query_output_EBSA<-if(is.null(EBSAoutput$studyData)){
     ""The search area does not overlap with identified Ecologically and Biologically Significant Areas (EBSA).""
   } else {
     ""The search area overlaps with identified Ecologically and Biologically Significant Areas (EBSA).""

---FILE: app/Rmd/report_planning_FR.Rmd---
@@ -28,7 +28,7 @@ attribute <- ""NONE""
 
 ```{r EBSA-check, echo=FALSE, results='asis'}
 #function for overlap
-Query_output_EBSA<-if(is.null(EBSAoutput$stuyData)){
+Query_output_EBSA<-if(is.null(EBSAoutput$studyData)){
   ""La zone de recherche ne chevauche pas les zones d’importance écologique et biologique (ZIEB).""
   } else {
     ""La zone de recherche chevauche les zones d’importance écologique et biologique (ZIEB).""",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,1f31c1849aeaff3d14dd7b2c192cfbb3f715e24d,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-15T12:43:15Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-15T12:43:15Z,fix paths duplicate renderings in reportRender,app/R/renderReport.R;app/Rmd/intro_EN.Rmd;app/Rmd/intro_FR.Rmd;app/Rmd/report_habitat_FR.Rmd;app/server.R;tests/testthat/setup_testenv.R,True,True,True,False,33,20,53,"---FILE: app/R/renderReport.R---
@@ -36,9 +36,14 @@ renderReport <- function(input, geoms, outFileName = NULL, dirOut = ""output"",
   }
   
   # nasty trick (due to current rmarkdown behavior) to name final file properly 
-  if (!is.null(outFileName) & outFileName != """") {
-    outFileName <- rep(outFileName, 10)
-  } else outFileName <- rep(""report_SMR"", 10)
+  #if (!is.null(outFileName) & outFileName != """") {
+  #  outFileName <- rep(outFileName, 10)
+  #} else outFileName <- rep(""report_SMR"", 10)
+  
+  if (is.null(outFileName) | outFileName == """") {
+    outFileName <- ""report_SMR""
+  }
+  
   
   # loop over language 
   for (i in seq_len(numLang)) {
@@ -67,14 +72,13 @@ renderReport <- function(input, geoms, outFileName = NULL, dirOut = ""output"",
       add_appendix = add_sections(s_appendix, dirIn, dirOut)
     )  
     writeLines(whisker::whisker.render(template, whiskerData), rmdOut)
-
     # First rendering
     ok[i] <- tryCatch({
         rmarkdown::render(rmdOut,
          output_dir = dirOut,
          output_file = langOutFile,
-         quiet = FALSE)
-      TRUE
+         quiet = TRUE)
+      FALSE # flag to show report in app.  
       }, 
       error = function(x) FALSE
     )
@@ -89,17 +93,15 @@ renderReport <- function(input, geoms, outFileName = NULL, dirOut = ""output"",
   if (all(ok)) {
     # this is done to generate an html preview (see ""report"" tab)
     htmlName <- switch_ext(basename(inFile), ""html"") 
-    htmlOut <- switch_ext(rmdOut, ""html"") 
+    htmlOut <- paste(dirOut, ""/"", langOutFile, "".html"", sep="""")
     # do not render again if html has already been generated
     if (file.exists(htmlOut)) {
-      file.copy(htmlOut, glue(""www/{htmlName}""))
+      file.copy(htmlOut, glue(here::here(""app"", ""www/{htmlName}"")))
+      msg <- ""Successfully rendered.""
     } else {
-      rmarkdown::render(rmdOut,
-        output_format = ""html_document"",
-        output_dir = ""www"",
-        quiet = TRUE)
+      msg <- ""Issue while rendering""
+      rmdOut <- htmlName <- NULL
     }
-    msg <- ""Successfully rendered.""
   } else {
     msg <- ""Issue while rendering""
     rmdOut <- htmlName <- NULL

---FILE: app/Rmd/intro_EN.Rmd---
@@ -75,7 +75,7 @@ This document summarizes regional data available at the time of report creation,
 This document is developed as a reproducible reporting tool, supported by the R markdown language and generated by an R-Shiny application interface hosted on the DFO network. Report summaries and outputs are based on data extracted from a user-provided search area (a focal polygon of interest) with a user-defined buffer (Figure 1). Instructions for use of the R-Shiny interface are provided in the technical manual. Due to the potential sensitivity of some data and information, access to the data in the application has to be granted, and the report is intended for internal use only.
 
 ````{r area-map-plot, fig.height=8, fig.width=11, fig.cap='Map showing the search area defined by the user (outlined in red) to query information and automatically generate this report. '}
-areaMap
+mapDataList$areaMap
 # areaMap can be plotted once and then reused for other plots
 ```
 

---FILE: app/Rmd/intro_FR.Rmd---
@@ -21,7 +21,7 @@ a:hover {color: #006080;}
 </style>
 
 ```{r setup-and-libraries, echo=FALSE, include=FALSE, cache=FALSE}
-knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, fig.align=""left"")
+knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.align = ""left"")
 ```
 
 ```{r load-data-and-functions, echo=FALSE, include=FALSE, cache=FALSE}
@@ -72,7 +72,7 @@ Ce document résume les données régionales, y compris les renseignements sur l
 Le présent document est conçu comme un outil de rapport reproductible, appuyé par le langage de balisage R et généré par une interface d’application R-Shiny hébergée sur le réseau du MPO. Les résumés et les résultats des rapports sont basés sur des données extraites d’une zone de recherche fournie par l’utilisateur (un polygone d’intérêt focal) avec un tampon défini par l’utilisateur (figure x). Les instructions d’utilisation de l’interface R-Shiny sont fournies dans le manuel technique. En raison du caractère sensible potentiel de certaines données et informations, l’accès aux données de l’application doit être accordé, et le rapport est destiné à un usage interne uniquement.  
 
 ````{r area-map-plot, fig.height=8, fig.width=11, fig.cap='Carte montrant la zone de recherche définie par l’utilisateur (entourée en rouge) pour rechercher des informations et générer automatiquement ce rapport. '}
-areaMap
+mapDataList$areaMap
 # areaMap can be plotted once and then reused for other plots
 ```
 

---FILE: app/Rmd/report_habitat_FR.Rmd---
@@ -23,7 +23,15 @@ Remarques sur les données :
 ```{r overlap-rockweed, echo=FALSE, results='asis'}
 # define polygon dataset and attribute to plot
 poly_sf <- rockweed_sf
-attribute <- ""RWP""
+attribute <- ""status""
+
+
+# set status column
+poly_sf$status = """"
+poly_sf$status[which(poly_sf$RWP==1)] = ""Present""
+poly_sf$status[which(poly_sf$RWP==2)] = ""Likely Present""
+poly_sf$status[which(poly_sf$RWP==5)] = ""Unknown""
+poly_sf$status[which(poly_sf$RWP==0)] = ""Not Present""
 
 # intersect polyData with 3 polygons (region, map area, and study box)
 clipped <- master_intersect(poly_sf, mapDataList)
@@ -43,7 +51,7 @@ polyText<-if(is.null(clipped$studyData)){
 
 ```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur : l’emplacement du projet ou de l’activité proposé est surligné en jaune (polygone d’entrée), entouré d’une zone exposée ou d’une zone tampon définie par l’utilisateur en bleu. La figure illustre le chevauchement entre la zone de recherche et les cartes satellitaires de la végétation intertidale et des polygones de présence de fucus.'}
 if(!is.null(clipped$studyData)){
-  print(plot_rr_sf(areaMap, clipped$mapData, attribute, outlines=FALSE))
+  print(plot_rr_sf(areaMap, clipped$mapData, attribute, outlines=FALSE, legendName= ""Végétation Intertidale""))
 }
 ```
 

---FILE: app/server.R---
@@ -175,7 +175,9 @@ server <- function(input, output, session) {
       chk <- renderReport(
           input = reactiveValuesToList(input),
           geoms = geoms$final,
-          outFileName = input$report_name
+          outFileName =  input$report_name,
+          dirIn = here::here(""app/Rmd""),
+          dirOut = here::here(""app/output"")
         )
       if (chk$ok) {
         output$render_success <- info_valid(chk$msg, chk$ok)

---FILE: tests/testthat/setup_testenv.R---
@@ -22,4 +22,5 @@ catch_all_output({
                     full.names = TRUE), source, local=globalenv())
 })
 
-message(""Test data generation complete"")
\ No newline at end of file
+message(""Test data generation complete"")
+",True,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,d1c23516953b6e1f12d1e49b86ae9897c283de4a,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-10T13:22:03Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-10T13:22:03Z,fix unit tests for new master intersect,app/Rmd/report_fish_FR.Rmd;tests/testthat/setup_testenv.R;tests/testthat/test_functions.R,True,False,True,False,15,10,25,"---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -97,14 +97,14 @@ Samples_bboxI <- outputListI$mapPoints
 Samples_bboxM <- outputListM$mapPoints
 
 if (!is.null(outputListI$studyData)) {
-  tableList <- create_table_ISDB(outputListI[[1]], listed_species,
+  tableList <- create_table_ISDB(outputListI$studyData, listed_species,
                                  speciesTable = ISSPECIESCODES)
   table_isdb1 <- tableList[[1]]
   table_isdb2 <- tableList[[2]]
 }
 
 if (!is.null(outputListM$studyData)) {
-  tableList <- create_table_MARFIS(outputListM[[1]], listed_species, speciesTable = MARFISSPECIESCODES)
+  tableList <- create_table_MARFIS(outputListM$studyData, listed_species, speciesTable = MARFISSPECIESCODES)
   table_mar1 <- tableList[[1]]
   table_mar2 <- tableList[[2]]
 }

---FILE: tests/testthat/setup_testenv.R---
@@ -6,11 +6,16 @@ save.image(file=here::here('tests/preTestEnv.RData'))
 rm(list=ls(envir = globalenv()), envir = globalenv())
 
 source(here::here(""tests/testthat/help_functions_for_tests.R""))
-message(""Generate new test data set"")
+message(""Generate and load test data set"")
 catch_all_output({
-  # generate a new testData file
-  source(here::here(""dataprocessing/MakeTestData.R""))
-  gen_all_test_data()
+  
+  dataFilesExist <- all(file.exists(c(here::here(""app/data/OpenData.RData""),
+                                  here::here(""app/data/OpenData_sardist.RData""),
+                                  here::here(""app/data/SecureData.RData""))))
+  if (dataFilesExist) {
+    source(here::here(""dataprocessing/MakeTestData.R""))
+    gen_all_test_data()
+  }  
   
   load(here::here(""app/data/testData.RData""), envir = globalenv())
   lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"",

---FILE: tests/testthat/test_functions.R---
@@ -31,14 +31,14 @@ test_that(""master intersect"", {
   testBbox <- sf::st_bbox(whitehead_sf)
   mapDataList$studyArea <- testBbox
   mapDataList$bboxMap <- testBbox
-  outputList <- master_intersect(whitehead_sf, mapDataList)
+  outputList <- master_intersect(whitehead_sf, mapDataList, getRegion = TRUE)
   expect_equal(nrow(outputList$regionData), nrow(whitehead_sf))
   
   # test with polygons
   testBbox <- sf::st_bbox(ClippedCritHab_sf)
   mapDataList$studyArea <- testBbox
   mapDataList$bboxMap <- testBbox
-  outputList <- master_intersect(ClippedCritHab_sf, mapDataList)
+  outputList <- master_intersect(ClippedCritHab_sf, mapDataList, getRegion = TRUE)
   expect_equal(nrow(outputList$regionData), nrow(ClippedCritHab_sf))
   
   # test null intersect (no data in the Gulf of Guinea):
@@ -47,9 +47,9 @@ test_that(""master intersect"", {
   testBbox[""ymin""] <- 0
   testBbox[""ymax""] <- 1
   mapDataList$region <- testBbox
-  mapDataList$mapBbox <- testBbox
+  mapDataList$bboxMap <- testBbox
   mapDataList$studyArea <- testBbox
-  outputList <- master_intersect(whitehead_sf, mapDataList)
+  outputList <- master_intersect(whitehead_sf, mapDataList, getRegion = TRUE)
   expect_null(c(outputList$regionData, outputList$studyData, outputList$mapData, outputList$mapPoints))
 })
 ",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,46731c19bbea9cf6fa1a725fd6930a332224d1d1,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-10T12:54:09Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-10T12:54:09Z,fix table headers,app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/report_cetaceans_FR.Rmd;app/Rmd/report_habitat_EN.Rmd;app/Rmd/report_habitat_FR.Rmd,True,False,True,False,7,2,9,"---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -184,7 +184,8 @@ clippedSei <- master_intersect(sei_whale_sf, mapDataList)
 table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
                         ""Habour Porpoise"" = !is.null(clippedHp$studyData),
                         ""Humpback Whale"" = !is.null(clippedHump$studyData),
-                        ""Sei Whale"" = !is.null(clippedSei$studyData))
+                        ""Sei Whale"" = !is.null(clippedSei$studyData),
+                        check.names = FALSE)
 
 ```
 

---FILE: app/Rmd/report_cetaceans_FR.Rmd---
@@ -180,7 +180,8 @@ clippedSei <- master_intersect(sei_whale_sf, mapDataList)
 table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
                         ""Habour Porpoise"" = !is.null(clippedHp$studyData),
                         ""Humpback Whale"" = !is.null(clippedHump$studyData),
-                        ""Sei Whale"" = !is.null(clippedSei$studyData))
+                        ""Sei Whale"" = !is.null(clippedSei$studyData), 
+                        check.names = FALSE)
 
 ```
 ```{r sdm-table}

---FILE: app/Rmd/report_habitat_EN.Rmd---
@@ -52,6 +52,7 @@ if(!is.null(clipped$studyData)){print(
 ```{r table-rockweed, echo=FALSE, cache=FALSE, include = FALSE}
 if(!is.null(clipped$studyData)){
   rwTable <- rockweedStats(clipped$studyData, studyArea)}
+  names(rwTable) <- c(""Category"", ""Number of Polygons"", ""Area km2"")
 ```
 
 ```{r rockweed-table}

---FILE: app/Rmd/report_habitat_FR.Rmd---
@@ -46,6 +46,8 @@ if(!is.null(clipped$studyData)){print(
 ```{r table-rockweed, echo=FALSE, cache=FALSE, include = FALSE}
 if(!is.null(clipped$studyData)){
   rwTable <- rockweedStats(clipped$studyData, studyArea)}
+  names(rwTable) <- c(""Catégorie"", ""Nombre de polygones"", ""Superficie km2"")
+
 ```
 
 ```{r rockweed-table}",False,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,bdd00fe84c27f764b434b816eefd3f418a6a1a4f,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-09T18:48:52Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-09T18:48:52Z,"fix watermark, allow rendering with either planning or habitat",app/R/area_maps.R;app/R/helpers.R;app/R/plot_polygons.R;app/R/renderReport.R;app/Rmd/report_fish_EN.Rmd;app/Rmd/report_habitat_EN.Rmd;app/Rmd/report_habitat_FR.Rmd;app/Rmd/report_planning_EN.Rmd;app/data/mybiblio.bib;renv.lock;tests/testthat/test_functions.R,True,True,True,False,61,349,410,"---FILE: app/R/area_maps.R---
@@ -104,7 +104,7 @@ area_map <- function(studyArea, site, landLayer, bufKm, CANborder, studyBoxGeom)
   outPlot <- ggplot() + 
     geom_sf(data = site, fill = ""yellow"", col = ""black"", size = 0.6) +
     geom_sf(data = bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1) + # creates US boundary line, 200 nm limit
-    geom_sf(data = land, fill = c(""lightgrey""), col = ""lightgrey"", size = 0.7) +
+    geom_sf(data = land, fill = c(""lightgrey""), col = ""black"", size = 0.3) +
     eval(studyBoxGeom) 
   
   outPlot <- format_ggplot(outPlot, bboxBuf)
@@ -142,7 +142,7 @@ region_map <- function(regionBbox, studyArea, landLayer, CANborder) {
   # configure the plot
   rawPlot <- ggplot() +
     geom_sf(data = bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1) + # creates US boundary line, 200 nm limit
-    geom_sf(data = land, fill = c(""lightgrey""), col = ""lightgrey"", size = 0.7) +
+    geom_sf(data = land, fill = c(""lightgrey""), col = ""black"", size = 0.3) +
     geom_sf(data = studyArea, fill = NA, col = ""red"", size = 1)
   
   outPlot <- format_ggplot(rawPlot, regionBbox)
@@ -158,13 +158,13 @@ region_map <- function(regionBbox, studyArea, landLayer, CANborder) {
 
 format_ggplot <- function(ggplotIn, bbox) {
   
-  
+  # convert to degrees, 0.7 is bad lat/long correction factor.  
   rotTheta <- (360 /(2* pi)) * atan((bbox$ymax[[1]] - bbox$ymin[[1]]) / 
-                 (bbox$xmax[[1]] - bbox$xmin[[1]]))
+                 (0.7 * (bbox$xmax[[1]] - bbox$xmin[[1]])))
   
   ggplotOut <- ggplotIn +
     annotation_custom(grid::textGrob(""DFO Internal Use Only"", rot=rotTheta,
-                                     gp=grid::gpar(fontsize=30, alpha=0.5, col=""grey"", fontface=""bold"")),
+                                     gp=grid::gpar(fontsize=30, alpha=0.5, col=""grey70"", fontface=""bold"")),
                       xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +
     annotation_scale(location = ""bl"") +
     theme_bw()+

---FILE: app/R/helpers.R---
@@ -21,8 +21,6 @@ library(stars) # transform features and assign or modify coordinate reference sy
 library(ggspatial) #required for mapping
 #next lines are necessary for the generation of the water mark on plots
 #install.packages(""remotes"")
-#remotes::install_github(""terminological/standard-print-output"")
-library(standardPrintOutput) # required for watermarks on maps
 
 ## R messages 
 msgInfo <- function(..., appendLF = TRUE) {

---FILE: app/R/plot_polygons.R---
@@ -14,14 +14,14 @@
 # 
 # Created by Quentin Stoyel, September 2, 2021 for reproducible reporting project
 
-plot_rr_sf <- function(baseMap, data_sf, attribute=NULL, legendName="""", legendColours=NULL) {
+plot_rr_sf <- function(baseMap, data_sf, attribute=NULL, ...) {
   if (inherits(sf::st_geometry(data_sf), ""sfc_POINT"")) {
     
-    outPlot <- plot_points(baseMap, data_sf, attribute=attribute, legendName=legendName, legendColours=legendColours)
+    outPlot <- plot_points(baseMap, data_sf, attribute=attribute, ...)
     
   } else if (inherits(sf::st_geometry(data_sf), c(""sfc_POLYGON"", ""sfc_MULTIPOLYGON"", ""sfc_GEOMETRY""))) {
     
-    outPlot <- plot_polygons(baseMap, data_sf, attribute=attribute, legendName=legendName)
+    outPlot <- plot_polygons(baseMap, data_sf, attribute=attribute, ...)
     
   }
   
@@ -42,7 +42,7 @@ get_scale_bar_layer <- function(inPlot) {
 
 # helper function, extracts the watermark layer from either the areaMap or regionMap
 get_watermark_layer <- function(inPlot) {
-  watermarkLayer <- lapply(inPlot$layers, function(inLayer) if(""GeomScaleBar"" %in% class(inLayer$geom)) inLayer else NULL)
+  watermarkLayer <- lapply(inPlot$layers, function(inLayer) if(""GeomCustomAnn"" %in% class(inLayer$geom)) inLayer else NULL)
   watermarkLayer <- watermarkLayer[!sapply(watermarkLayer, is.null)]
   return(watermarkLayer)
 }
@@ -78,6 +78,7 @@ plot_points <- function(baseMap, data_sf, attribute=NULL, legendName="""", legendC
   # extract scaleBar layer to ensure it plots over polygons/study area box
   scaleBarLayer = get_scale_bar_layer(baseMap)
   studyBoxLayer = get_study_box_layer(baseMap)
+  watermarkLayer = get_watermark_layer(baseMap)
   
   # axis limits based on baseMap
   axLim = ggplot2::coord_sf(xlim=baseMap$coordinates$limits$x, 
@@ -98,6 +99,7 @@ plot_points <- function(baseMap, data_sf, attribute=NULL, legendName="""", legendC
     dataLayer +
     legendLayer +
     axLim +
+    watermarkLayer +
     studyBoxLayer +
     scaleBarLayer
   
@@ -128,10 +130,11 @@ plot_points <- function(baseMap, data_sf, attribute=NULL, legendName="""", legendC
 # Created by Gordana Lazin, July 2, 2021 for reproducible reporting project
 
 
-plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute) {
+plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute, outlines=TRUE) {
   
   scaleBarLayer = get_scale_bar_layer(baseMap)
   studyBoxLayer = get_study_box_layer(baseMap)
+  watermarkLayer = get_watermark_layer(baseMap)
   
   clr = ""black"" #color for outlining polygons
   
@@ -147,7 +150,7 @@ plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute) {
     polyData$Rockweed[which(polyData$RWP==0)] = ""Not Present""
     
     attribute = ""Rockweed""
-    clr = NA
+    clr = ""red""# NA
   }
   
   # axis limits to the plot
@@ -167,11 +170,22 @@ plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute) {
     
     polyPlot <- geom_sf(data=polyData, fill=""#56B4E9"", col=clr)
     polyFill <- NULL
+    polyOutline <- NULL
+    
     
   } else { # Case 2: plotting polygons in different colors based on ""attribute"" column in the data
     
-    polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute)), colour=clr)
-    polyFill <- scale_fill_manual(values=legendColor, name=legendName) 
+    polyFill <- scale_fill_manual(values=legendColor, name=legendName)
+    if (outlines) {
+      polyOutline <- NULL
+      polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute)))
+      
+    }
+    else {
+      polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute), col=!!sym(attribute)))
+      polyOutline <- scale_color_manual(values=legendColor, guide=FALSE)  
+    }
+    
     
   }
  
@@ -180,8 +194,10 @@ plot_polygons <- function(baseMap, polyData, attribute, legendName=attribute) {
     polyMap <- baseMap +
       polyPlot +
       polyFill +
-      studyBoxLayer +
+      polyOutline +
       axLim +
+      watermarkLayer +
+      studyBoxLayer +
       scaleBarLayer
     
     return(polyMap)

---FILE: app/R/renderReport.R---
@@ -49,8 +49,8 @@ renderReport <- function(input, geoms, outFileName = NULL, dirOut = ""output"",
       s_main <- main_parts(input$main_sections, langs[i])
     } 
     if (!is.null(input$extra_sections)) {
-      s_ebsa <- ebsa_part(any(input$extra_sections == 1), langs[i])
-      s_appendix <- appendix_part(any(input$extra_sections == 2), langs[i])
+      s_ebsa <- planning_part(any(input$extra_sections == 1), langs[i])
+      s_appendix <- habitat_part(any(input$extra_sections == 2), langs[i])
     }
     
     # fill out .Rmd file in outDir before rendering
@@ -113,24 +113,32 @@ add_sections <- function(fileNames = NULL, dirIn, dirOut) {
   } else fileNames
 }
 
-main_parts <- function(sectionNum, lang = c(""EN"", ""FR"")) {
-  lang <- match.arg(lang)
+main_parts <- function(sectionNum, langChoice = c(""EN"", ""FR"")) {
+  langChoice <- match.arg(langChoice)
   sectionName <- c(
     ""report_SARA"",
     ""report_fish"",
     ""report_cetaceans""
   )[as.numeric(sectionNum)]
-  paste0(sectionName, ""_"", lang, "".Rmd"")
+  paste0(sectionName, ""_"", langChoice, "".Rmd"")
 }
 
-ebsa_part <- function(includSection, lang = c(""EN"", ""FR"")) {
-  lang <- match.arg(lang)
-  ifelse(includSection, glue(""report_planning_{lang}.Rmd""), NULL)
+planning_part <- function(includSection, langChoice = c(""EN"", ""FR"")) {
+  langChoice <- match.arg(langChoice)
+  if (includSection) {
+    return(glue(""report_planning_{langChoice}.Rmd""))
+  } else {
+    return(NULL)
+  }
 }
 
-appendix_part <- function(includSection, lang = c(""EN"", ""FR"")) {
-  lang <- match.arg(lang)
-  ifelse(includSection, glue(""report_habitat_{lang}.Rmd""), NULL)
+habitat_part <- function(includSection, langChoice = c(""EN"", ""FR"")) {
+  langChoice <- match.arg(langChoice)
+  if (includSection) {
+    return(glue(""report_habitat_{langChoice}.Rmd""))
+  } else {
+    return(NULL)
+  }
 }
 
 save_geom <- function(geoms, dirOut = ""output"", geomFileName =""geoms_slc.geojson"") {

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -18,7 +18,7 @@ Security level: none
 Dataset description from the Open Data record [@OpenData_MAR_RV]: The Fisheries and Oceans Canada ecosystem Research Vessel (RV) surveys are conducted annually (since 1970) and are a source of integrated ecosystem monitoring data. These survey data are the primary data source for monitoring trends in species distribution, abundance, and biological condition within the region, and also provide data to the Atlantic Zonal Monitoring Program (AZMP) for monitoring hydrographic conditions, along with zooplankton and phytoplankton. The surveys follow a stratified random sampling design, and include sampling using a bottom otter trawl, CTD rosette and vertical plankton tows. Data from the bottom trawl catch are used to monitor the distribution and abundance of fish and invertebrates throughout the Scotian Shelf, Bay of Fundy and Georges Bank. 
 
 ```{r table-RV-read, echo=FALSE, cache=FALSE, include = FALSE}
-table_RV <- read.csv(""../data/misc/table_RV_EN.csv"")
+table_RV <- read.csv(here::here(""app/data/misc/table_RV_EN.csv""))
 table_RV<- table_RV %>% dplyr::rename(""Season/Months""=Season.Months,""Description of Geographic Range""=Description.of.Geographic.Range)
 ```
 ```{r RV-table-setup}

---FILE: app/Rmd/report_habitat_EN.Rmd---
@@ -1,3 +1,8 @@
+---
+output: html_document
+editor_options: 
+  chunk_output_type: console
+---
 ## **HABITAT INFORMATION**
 
 ### **Intertidal Vegetation and Rockweed**
@@ -31,8 +36,8 @@ clipped <- master_intersect(poly_sf, mapDataList)
 ```
 *
 ```{r overlap-rockweed-output, echo=FALSE, results='asis'}
- 
-polyText <- if(is.null(clipped$studyData)){""There are no relevant records of predicted intertidal vegetation for this search area.""
+polyText <- if(is.null(clipped$studyData)){
+  ""There are no relevant records of predicted intertidal vegetation for this search area.""
 } else {""There are relevant records of predicted intertidal vegetation for this search area.""}
 
  polyText <- noquote(polyText)
@@ -41,7 +46,7 @@ polyText <- if(is.null(clipped$studyData)){""There are no relevant records of pre
 
 ```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.'}
 if(!is.null(clipped$studyData)){print(
-  plot_rr_sf(areaMap, clipped$mapData, attribute))}
+  plot_rr_sf(areaMap, clipped$mapData, attribute, outlines = FALSE))}
 ```
 
 ```{r table-rockweed, echo=FALSE, cache=FALSE, include = FALSE}

---FILE: app/Rmd/report_habitat_FR.Rmd---
@@ -40,7 +40,7 @@ polyText<-if(is.null(clipped$studyData)){""Il n’existe aucun registre pertinent
 
 ```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur : l’emplacement du projet ou de l’activité proposé est surligné en jaune (polygone d’entrée), entouré d’une zone exposée ou d’une zone tampon définie par l’utilisateur en bleu. La figure illustre le chevauchement entre la zone de recherche et les cartes satellitaires de la végétation intertidale et des polygones de présence de fucus.'}
 if(!is.null(clipped$studyData)){print(
-  plot_rr_sf(areaMap, clipped$mapData, attribute))}
+  plot_rr_sf(areaMap, clipped$mapData, attribute, outlines=FALSE))}
 ```
 
 ```{r table-rockweed, echo=FALSE, cache=FALSE, include = FALSE}

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -18,7 +18,6 @@ Dataset description from the Open Data record [@OpenData_ebsa]: Ecologically and
 
 #### ***Area-specific EBSA search results***
 
--   
 
 ```{r EBSA-results, echo=FALSE, results='asis'}
 #function for overlap
@@ -27,7 +26,7 @@ EBSAoutput <- master_intersect(EBSA_sf, mapDataList)
 # define polygon dataset and attribute to plot
 attribute <- ""NONE""
 ```
-
+*
 ```{r EBSA-check, echo=FALSE, results='asis'}
 #function for overlap
 Query_output_EBSA<-if(is.null(EBSAoutput$stuyData)){

---FILE: app/data/mybiblio.bib---
@@ -319,12 +319,4 @@ @Manual{Mardatawrangling
   url = {https://github.com/Maritimes/Mar.datawrangling}
 }
 
-@Manual{standardPrintOutput,
-  title = {standardPrintOutput: Standard Graph and Table Utilities},
-  author = {N/A},
-  year = {2021},
-  note = {R package version 0.0.0.9000},
-  url = {https://rdrr.io/github/terminological/standard-print-output/}
-}
-
 

---FILE: renv.lock---
@@ -23,13 +23,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""030aaec5bc6553f35347cbb1e70b1a17""
     },
-    ""DiagrammeR"": {
-      ""Package"": ""DiagrammeR"",
-      ""Version"": ""1.0.6.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""3cb13b97961593b4a1ed0c8e37df9d9b""
-    },
     ""KernSmooth"": {
       ""Package"": ""KernSmooth"",
       ""Version"": ""2.23-17"",
@@ -89,13 +82,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""08588806cba69f04797dab50627428ed""
     },
-    ""MatrixModels"": {
-      ""Package"": ""MatrixModels"",
-      ""Version"": ""0.4-1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""d57ac35220b39c591388ab3a080f9cbe""
-    },
     ""PBSmapping"": {
       ""Package"": ""PBSmapping"",
       ""Version"": ""2.73.0"",
@@ -124,41 +110,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""dbb5e436998a7eba5a9d682060533338""
     },
-    ""RcppArmadillo"": {
-      ""Package"": ""RcppArmadillo"",
-      ""Version"": ""0.10.2.1.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""a2de53472129933a29975e7cfa3ffe28""
-    },
-    ""RcppEigen"": {
-      ""Package"": ""RcppEigen"",
-      ""Version"": ""0.3.3.9.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""ddfa72a87fdf4c80466a20818be91d00""
-    },
-    ""Rttf2pt1"": {
-      ""Package"": ""Rttf2pt1"",
-      ""Version"": ""1.3.8"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""8c4137a9ab70de4787d57758f8190617""
-    },
-    ""SparseM"": {
-      ""Package"": ""SparseM"",
-      ""Version"": ""1.81"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""2042cd9759cc89a453c4aefef0ce9aae""
-    },
-    ""XML"": {
-      ""Package"": ""XML"",
-      ""Version"": ""3.99-0.5"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""408d42d1359f2a84d377c1f7f0568624""
-    },
     ""abind"": {
       ""Package"": ""abind"",
       ""Version"": ""1.4-5"",
@@ -208,13 +159,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""1bf627f1f77313e345f71e779b658578""
     },
-    ""boot"": {
-      ""Package"": ""boot"",
-      ""Version"": ""1.3-25"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""bd51734a754b6c2baf28b2d1ebc11e91""
-    },
     ""brew"": {
       ""Package"": ""brew"",
       ""Version"": ""1.0-6"",
@@ -257,20 +201,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""461aa75a11ce2400245190ef5d3995df""
     },
-    ""car"": {
-      ""Package"": ""car"",
-      ""Version"": ""3.0-10"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""12d8cdaf73c30b8c8cb7a22591a3f57d""
-    },
-    ""carData"": {
-      ""Package"": ""carData"",
-      ""Version"": ""3.0-4"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""7ff5c94cec207b3fd9774cfaa5157738""
-    },
     ""cellranger"": {
       ""Package"": ""cellranger"",
       ""Version"": ""1.1.0"",
@@ -320,27 +250,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""0f22be39ec1d141fd03683c06f3a6e67""
     },
-    ""conquer"": {
-      ""Package"": ""conquer"",
-      ""Version"": ""1.0.2"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""a31720f692920e635ecef0481d478247""
-    },
-    ""corrplot"": {
-      ""Package"": ""corrplot"",
-      ""Version"": ""0.84"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""b55c32ae818a84109a51f172290c95f2""
-    },
-    ""cowplot"": {
-      ""Package"": ""cowplot"",
-      ""Version"": ""1.1.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""b418e8423699d11c7f2087c2bfd07da2""
-    },
     ""cpp11"": {
       ""Package"": ""cpp11"",
       ""Version"": ""0.2.6"",
@@ -404,13 +313,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""a0cbe758a531d054b537d16dff4d58a1""
     },
-    ""downloader"": {
-      ""Package"": ""downloader"",
-      ""Version"": ""0.4"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""f4f2a915e0dedbdf016a83b63477349f""
-    },
     ""dplyr"": {
       ""Package"": ""dplyr"",
       ""Version"": ""1.0.5"",
@@ -439,20 +341,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""ec8ca05cffcc70569eaaad8469d2a3a7""
     },
-    ""extrafont"": {
-      ""Package"": ""extrafont"",
-      ""Version"": ""0.17"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""7f2f50e8f998a4bea4b04650fc4f2ca8""
-    },
-    ""extrafontdb"": {
-      ""Package"": ""extrafontdb"",
-      ""Version"": ""1.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""a861555ddec7451c653b40e713166c6f""
-    },
     ""fansi"": {
       ""Package"": ""fansi"",
       ""Version"": ""0.4.2"",
@@ -516,34 +404,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""3eb6477d01eb5bbdc03f7d5f70f2733e""
     },
-    ""ggpubr"": {
-      ""Package"": ""ggpubr"",
-      ""Version"": ""0.4.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""77089557d374c69db7cb77e65f0d6ab0""
-    },
-    ""ggrepel"": {
-      ""Package"": ""ggrepel"",
-      ""Version"": ""0.9.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""08ab869f37e6a7741a64ab9069bcb67d""
-    },
-    ""ggsci"": {
-      ""Package"": ""ggsci"",
-      ""Version"": ""2.9"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""81ccb8213ed592598210afd10c3a5936""
-    },
-    ""ggsignif"": {
-      ""Package"": ""ggsignif"",
-      ""Version"": ""0.6.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""6770aac2203800889cccd6aee7f206a7""
-    },
     ""ggspatial"": {
       ""Package"": ""ggspatial"",
       ""Version"": ""1.1.5"",
@@ -628,27 +488,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""a525aba14184fec243f9eaec62fbed43""
     },
-    ""huxtable"": {
-      ""Package"": ""huxtable"",
-      ""Version"": ""5.2.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""be37eec356a71f62f209dd04d94122ed""
-    },
-    ""igraph"": {
-      ""Package"": ""igraph"",
-      ""Version"": ""1.2.6"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""7b1f856410253d56ea67ad808f7cdff6""
-    },
-    ""influenceR"": {
-      ""Package"": ""influenceR"",
-      ""Version"": ""0.1.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""611f9a55ad32ccfa17ccbd77be7a2804""
-    },
     ""isoband"": {
       ""Package"": ""isoband"",
       ""Version"": ""0.2.4"",
@@ -768,13 +607,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""3471fb65971f1a7b2d4ae7848cf2db8d""
     },
-    ""lme4"": {
-      ""Package"": ""lme4"",
-      ""Version"": ""1.1-26"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""5f2466f5127e0ce67e44bb381387eeca""
-    },
     ""lubridate"": {
       ""Package"": ""lubridate"",
       ""Version"": ""1.7.9.2"",
@@ -789,13 +621,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""cf96b08482dfbed1b7ab7d0ba4395077""
     },
-    ""magick"": {
-      ""Package"": ""magick"",
-      ""Version"": ""2.6.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""ffc87958461a1d2a5ec4b36035b87b94""
-    },
     ""magrittr"": {
       ""Package"": ""magrittr"",
       ""Version"": ""2.0.1"",
@@ -838,20 +663,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""61e4a10781dd00d7d81dd06ca9b94e95""
     },
-    ""matrixStats"": {
-      ""Package"": ""matrixStats"",
-      ""Version"": ""0.58.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""c318d148056e5bb8d7de79b0876f9ae6""
-    },
-    ""memoise"": {
-      ""Package"": ""memoise"",
-      ""Version"": ""2.0.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""a0bc51650201a56d00a4798523cc91b3""
-    },
     ""mgcv"": {
       ""Package"": ""mgcv"",
       ""Version"": ""1.8-31"",
@@ -873,13 +684,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""fec5f52652d60615fdb3957b3d74324a""
     },
-    ""minqa"": {
-      ""Package"": ""minqa"",
-      ""Version"": ""1.2.4"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""eaee7d2a6f3ed4491df868611cb064cc""
-    },
     ""modelr"": {
       ""Package"": ""modelr"",
       ""Version"": ""0.1.8"",
@@ -901,48 +705,13 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""662f52871983ff3e3ef042c62de126df""
     },
-    ""nloptr"": {
-      ""Package"": ""nloptr"",
-      ""Version"": ""1.2.2.2"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""2737faeee353704efec5afa1e943dd64""
-    },
-    ""nnet"": {
-      ""Package"": ""nnet"",
-      ""Version"": ""7.3-14"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""0d87e50e11394a7151a28873637d799a""
-    },
-    ""numDeriv"": {
-      ""Package"": ""numDeriv"",
-      ""Version"": ""2016.8-1.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""df58958f293b166e4ab885ebcad90e02""
-    },
     ""openssl"": {
       ""Package"": ""openssl"",
       ""Version"": ""1.4.3"",
       ""Source"": ""Repository"",
       ""Repository"": ""CRAN"",
       ""Hash"": ""a399e4773075fc2375b71f45fca186c4""
     },
-    ""openxlsx"": {
-      ""Package"": ""openxlsx"",
-      ""Version"": ""4.2.3"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""2253a430965e222d11a2f9277cd34c2e""
-    },
-    ""pbkrtest"": {
-      ""Package"": ""pbkrtest"",
-      ""Version"": ""0.5-0.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""e4c9df9e478e08a32c27a406ce8fba90""
-    },
     ""pillar"": {
       ""Package"": ""pillar"",
       ""Version"": ""1.5.1"",
@@ -978,13 +747,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""03b7076c234cb3331288919983326c55""
     },
-    ""polynom"": {
-      ""Package"": ""polynom"",
-      ""Version"": ""1.4-0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""c396592ecfe9e75cee1013533efafe34""
-    },
     ""praise"": {
       ""Package"": ""praise"",
       ""Version"": ""1.0.0"",
@@ -1041,20 +803,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""97def703420c8ab10d8f0e6c72101e02""
     },
-    ""quantreg"": {
-      ""Package"": ""quantreg"",
-      ""Version"": ""5.85"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""d41a5849071941c6c269b57324515398""
-    },
-    ""rJava"": {
-      ""Package"": ""rJava"",
-      ""Version"": ""1.0-4"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""0cd1ee479ba887170411af6d81705003""
-    },
     ""rappdirs"": {
       ""Package"": ""rappdirs"",
       ""Version"": ""0.3.3"",
@@ -1132,13 +880,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""94a44c3f0d49ceb80c385610696873ca""
     },
-    ""rio"": {
-      ""Package"": ""rio"",
-      ""Version"": ""0.5.16"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""4a9aecbe83639be364de13ffe0671bcf""
-    },
     ""rjson"": {
       ""Package"": ""rjson"",
       ""Version"": ""0.2.20"",
@@ -1174,13 +915,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""249d8cd1e74a8f6a26194a91b47f21d1""
     },
-    ""rstatix"": {
-      ""Package"": ""rstatix"",
-      ""Version"": ""0.7.0"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""aa020f8efde649badd0b2b5456e942fe""
-    },
     ""rstudioapi"": {
       ""Package"": ""rstudioapi"",
       ""Version"": ""0.13"",
@@ -1258,39 +992,13 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""dfd843ee98246cf932823acf613b05dd""
     },
-    ""standardPrintOutput"": {
-      ""Package"": ""standardPrintOutput"",
-      ""Version"": ""0.0.0.9000"",
-      ""Source"": ""GitHub"",
-      ""RemoteType"": ""github"",
-      ""RemoteHost"": ""api.github.com"",
-      ""RemoteRepo"": ""standard-print-output"",
-      ""RemoteUsername"": ""terminological"",
-      ""RemoteRef"": ""HEAD"",
-      ""RemoteSha"": ""a913b4ec60c6604ccdc22ee913e184a1ea801ec0"",
-      ""Hash"": ""8407ee89c2972ade1aa83f20f2cc491b""
-    },
-    ""staplr"": {
-      ""Package"": ""staplr"",
-      ""Version"": ""3.1.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""496962330b511d7941648c9b5e060e1e""
-    },
     ""stars"": {
       ""Package"": ""stars"",
       ""Version"": ""0.5-1"",
       ""Source"": ""Repository"",
       ""Repository"": ""CRAN"",
       ""Hash"": ""a59e20ffc0b402904e58d2f9e4d06c37""
     },
-    ""statmod"": {
-      ""Package"": ""statmod"",
-      ""Version"": ""1.4.35"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""53c27113461e8abbe2dc7125e22b2a39""
-    },
     ""stringi"": {
       ""Package"": ""stringi"",
       ""Version"": ""1.5.3"",
@@ -1410,13 +1118,6 @@
       ""Repository"": ""CRAN"",
       ""Hash"": ""ce4f6271baa94776db692f1cb2055bee""
     },
-    ""visNetwork"": {
-      ""Package"": ""visNetwork"",
-      ""Version"": ""2.0.9"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""12545f2acf49d1d346d075580122d89c""
-    },
     ""waldo"": {
       ""Package"": ""waldo"",
       ""Version"": ""0.2.5"",
@@ -1472,13 +1173,6 @@
       ""Source"": ""Repository"",
       ""Repository"": ""CRAN"",
       ""Hash"": ""2826c5d9efb0a88f657c7a679c7106db""
-    },
-    ""zip"": {
-      ""Package"": ""zip"",
-      ""Version"": ""2.1.1"",
-      ""Source"": ""Repository"",
-      ""Repository"": ""CRAN"",
-      ""Hash"": ""3bc8405c637d988801ec5ea88372d0c2""
     }
   }
 }

---FILE: tests/testthat/test_functions.R---
@@ -6,7 +6,7 @@ context(""Function Tests"")
 test_that(""default plot"", {
   list2env(load_test_data(), envir = environment())
   emptyPlot <- ggplot2::ggplot()
-  testPlot <- format_ggplot(emptyPlot)
+  testPlot <- format_ggplot(emptyPlot, regionBox)
   expect_equal(length(testPlot$data), 0)
 })
 ",True,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,e57fdaf81db2b9259b9d931c2abe2767128fcf1e,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-08T11:49:30Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-08T11:49:30Z,fixes before merging to odis,app/R/fn_intersect_operations.R;app/R/plot_polygons.R;app/Rmd/intro_EN.Rmd;app/Rmd/report_SARA_EN.Rmd;app/Rmd/report_SARA_FR.Rmd;app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/report_cetaceans_FR.Rmd;app/Rmd/report_fish_EN.Rmd;app/Rmd/report_fish_FR.Rmd;app/Rmd/report_planning_EN.Rmd;app/Rmd/report_planning_FR.Rmd,True,True,True,False,119,136,255,"---FILE: app/R/fn_intersect_operations.R---
@@ -342,7 +342,7 @@ create_table_OBIS <- function(data_sf, ...) {
 # Outputs: returns the datatable with new fields
 # for coordinates
 sfcoords_as_cols <- function(data_sf, names = c(""long"",""lat"")) {
-  stopifnot(inherits(data_sf,""sf"") && inherits(sf::st_geometry(data_sf),""sfc_POINT""))
+  stopifnot(inherits(data_sf, ""sf"") && inherits(sf::st_geometry(data_sf),""sfc_POINT""))
   ret <- sf::st_coordinates(data_sf)
   ret <- tibble::as_tibble(ret)
   stopifnot(length(names) == ncol(ret))
@@ -358,21 +358,12 @@ sfcoords_as_cols <- function(data_sf, names = c(""long"",""lat"")) {
 ########## Species At Risk distribution and Critical Habitat data ##########
 #
 # #SAR distribution
-table_dist <- function(sardist_sf, studyArea) {
-  #table_dist <- function(sardist_sf, studyArea, listed_species) {
-  intersect_dist <- sf::st_intersection(sardist_sf, studyArea)
-  intersect_dist$Common_Nam[intersect_dist$Common_Nam == ""Sowerby`s Beaked Whale""] <- ""Sowerby's Beaked Whale""
-  dist_table <-  intersect_dist %>% dplyr::select(Scientific, Common_Nam, Population, SARA_Statu, Species_Li)
-  #dist_table <- dist_table %>% dplyr::rename(""Scientific_Name""=Scientific)
-  #dist_table <- merge(dist_table, listed_species, by='Scientific_Name')
-  #dist_table <- dist_table %>% dplyr::select(Common_Nam, Scientific, Population, Waterbody, Schedule.status, COSEWIC.status, Wild_Species)
+table_dist <- function(sardist_sf) {
+  sardist_sf$Common_Nam[sardist_sf$Common_Nam == ""Sowerby`s Beaked Whale""] <- ""Sowerby's Beaked Whale""
+  dist_table <-  sardist_sf %>% dplyr::select(Scientific, Common_Nam, Population, SARA_Statu, Species_Li)
   sf::st_geometry(dist_table) <- NULL
-  #dist_table <- dist_table %>% dplyr::rename(""SARA status""=Schedule.status,
-  # ""COSEWIC listing""=COSEWIC.status,
-  # ""Wild Species listing""=Wild_Species,
-  # ""Common Name""=Common_Name,
-  # ""Scientific Name""=Scientific_Name)
   row.names(dist_table) <- NULL
+  names(dist_table) <- c(""Scientific Name"", ""Common Name"", ""Population"", ""SARA Status"", ""Species Link"")
   return(dist_table)
 }
 
@@ -404,38 +395,6 @@ table_crit <- function(ClippedCritHab_sf, studyArea, leatherback_sf) {
   return(crit_table)
 }
 
-# little helper function for sdm_table function below
-does_sf_intersect <- function(data_sf, studyArea) {
-  intersectResult <- sf::st_intersection(data_sf, studyArea)
-  nIntersectRows <- as.numeric(nrow(intersectResult))
-  intersectBool <- if(nIntersectRows < 1){
-    FALSE
-  } else {
-    TRUE
-  }
-  return(intersectBool)
-}
-
-# #Species Distribution Models (SDM): Priority Areas to Enhance Monitoring of Cetaceans
-sdm_table <- function(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea) {
-  
-  finIntersect <- does_sf_intersect(fin_whale_sf, studyArea)
-  harbourIntersect <- does_sf_intersect(harbour_porpoise_sf, studyArea)
-  humpbackIntersect <- does_sf_intersect(humpback_whale_sf, studyArea)
-  seiIntersect <- does_sf_intersect(sei_whale_sf, studyArea)
-  
-  table_sdm <- data.frame(Fin_Whale = """", Habour_Porpoise = """", Humpback_Whale = """", Sei_Whale = """")
-  table_sdm[1,1] <- finIntersect
-  table_sdm[1,2] <- harbourIntersect
-  table_sdm[1,3] <- humpbackIntersect
-  table_sdm[1,4] <- seiIntersect
-  table_sdm <- table_sdm %>% dplyr::rename(""Fin Whale"" = Fin_Whale,
-                                          ""Habour Porpoise"" = Habour_Porpoise,
-                                          ""Humpback Whale"" = Humpback_Whale,
-                                          ""Sei Whale"" = Sei_Whale)
-  return(table_sdm)
-
-}
 
 ########## Spatial Planning Section ##########
 

---FILE: app/R/plot_polygons.R---
@@ -19,7 +19,7 @@ plot_rr_sf <- function(baseMap, data_sf, attribute=NULL, legendName="""", legendCo
     
     outPlot <- plot_points(baseMap, data_sf, attribute=attribute, legendName=legendName, legendColours=legendColours)
     
-  } else if (inherits(sf::st_geometry(data_sf), c(""sfc_POLYGON"", ""sfc_MULTIPOLYGON""))) {
+  } else if (inherits(sf::st_geometry(data_sf), c(""sfc_POLYGON"", ""sfc_MULTIPOLYGON"", ""sfc_GEOMETRY""))) {
     
     outPlot <- plot_polygons(baseMap, data_sf, attribute=attribute, legendName=legendName)
     

---FILE: app/Rmd/intro_EN.Rmd---
@@ -32,17 +32,17 @@ knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, fig.align=""lef
 minYear <- 2010
 lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE),source) # check helpers.R for a list of packages
 copy_rdata_files() # make sure data files are up to date. 
-load(here::here(""app/data/testData.RData""))
-#load(here::here(""app/data/OpenData.RData""))
-#load(here::here(""app/data/OpenData_sardist.RData""))
-#load(here::here(""app/data/SecureData.RData""))
+#load(here::here(""app/data/testData.RData""))
+load(here::here(""app/data/OpenData.RData""))
+load(here::here(""app/data/OpenData_sardist.RData""))
+load(here::here(""app/data/SecureData.RData""))
 #load(""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting\\data\\SecureData.Rdata"")
 
 ```
 
 ```{r  Load-Search-Area, echo=FALSE, include=FALSE, cache=FALSE}
-studyArea <- sf::st_read(""{{path_to_geoms}}"")
-# studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson""))
+#studyArea <- sf::st_read(""{{path_to_geoms}}"")
+studyArea <- sf::st_read(here::here(""app/output/geoms_slc.geojson""))
 # Uncomment the following to test fixed polygon:
 # studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_test.geojson"")) #Offshore
 # studyArea <- st_read(here::here(""app/studyAreaTest/geoms_slc_coastal_test.geojson"")) #coastal
@@ -59,8 +59,8 @@ list2env(mapDataList, envir = environment())
 
 <!-- # ```{r child = c('../Rmd/report_cetaceans_EN.Rmd', 'report_fish_EN.Rmd', 'report_habitat_EN.Rmd', 'report_planning_EN.Rmd', 'report_SARA_EN.Rmd')} -->
 <!-- # ``` -->
-<!-- ```{r child = '../Rmd/report_fish_EN.Rmd'}
- ``` -->
+<!--```{r child = '../Rmd/report_cetaceans_EN.Rmd'}
+```-->
 
 <!-- END  -->
 

---FILE: app/Rmd/report_SARA_EN.Rmd---
@@ -35,14 +35,15 @@ Critical habitat presented in this section are available in the Government of Ca
 #### ***Area-specific SAR distribution and critical habitat search results***
 
 ```{r sardist-load, echo=FALSE, results='asis'}
-#if(sardist_sf > 1){
-dist_table <- table_dist(sardist_sf, studyArea)
-#} else {NULL}
+outputListSardist <- master_intersect(sardist_sf, mapDataList)
+
+if (!is.null(outputListSardist$studyData)){
+  dist_table <- table_dist(outputListSardist$studyData)
+}
 ```
 *
 ```{r dist-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Dist_overlap_result <- nrow(dist_table)
-Query_output_dist <- if(Dist_overlap_result < 1){
+Query_output_dist <- if(is.null(outputListSardist$studyData)){
   ""The search area does not overlap with Species at Risk distribution range.""
 } else {
   ""The search area overlaps with Species at Risk distribution range.""
@@ -65,14 +66,14 @@ crit_table <- table_crit(ClippedCritHab_sf, studyArea, leatherback_sf)
 ```
 <br>
 ```{r  dist-table, echo=FALSE, results='asis'}
-Dist_query_output_table<-if(Dist_overlap_result < 1){
+Dist_query_output_table<-if(is.null(outputListSardist$studyData)){
   """"
 } else {
 
   knitr::kable(dist_table[!duplicated(dist_table),], align=""l"", caption= ""Quality Tier: High. Security level: none. Species At Risk listed as Endangered, Threatened or Special Concern under the <i>Species At Risk Act</i> for which the search polygon overlaps with their distribution (range). This is not the authoritative source or advice for Species At Risk data. Please access the Species At Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create anthe authoritative SARA report."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 
 }
-if(Dist_overlap_result > 1){Dist_query_output_table}
+if(!is.null(outputListSardist$studyData)){Dist_query_output_table}
 ```
 
 ```{r crit-table, echo=FALSE, results='asis'}
@@ -124,6 +125,6 @@ if (!is.null(clipped$regionData)){
 <br>
 ```{r leatherback-area-plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with draft critical habitat of Leatherback Sea Turtle', fig.height=6, fig.width=11}
 if (!is.null(clipped$mapData)){
-  plot_rr_sf(areaMap,  studyBox_geom, clipped$mapData, attribute)
+  plot_rr_sf(areaMap, clipped$mapData, attribute)
 }  
 ```

---FILE: app/Rmd/report_SARA_FR.Rmd---
@@ -35,14 +35,15 @@ Les habitats essentiels présentés dans cette section sont disponibles sur le p
 #### ***Répartition des espèces en péril et résultats des recherches sur l’habitat essentiel propres à une zone***
 
 ```{r sardist-load, echo=FALSE, results='asis'}
-#if(sardist_sf > 1){
-dist_table <- table_dist(sardist_sf, studyArea)
-#} else {NULL}
+outputListSardist <- master_intersect(sardist_sf, mapDataList)
+
+if (!is.null(outputListSardist$studyData)){
+  dist_table <- table_dist(outputListSardist$studyData)
+}
 ```
 *
 ```{r dist-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Dist_overlap_result <- nrow(dist_table)
-Query_output_dist <- if(Dist_overlap_result < 1){
+Query_output_dist <- if(is.null(outputListSardist$studyData)){
   ""La zone de recherche ne chevauche pas l’aire de répartition des espèces en péril.""
 } else {
   ""La zone de recherche chevauche l’aire de répartition des espèces en péril.""
@@ -64,12 +65,15 @@ crit_table <- table_crit(ClippedCritHab_sf, studyArea, leatherback_sf)
  writeLines(Query_output_crit)
 ```
 
-```{r dist-table, echo=FALSE, results='asis'}
-Dist_query_output_table <- if(Dist_overlap_result < 1){
+```{r  dist-table, echo=FALSE, results='asis'}
+Dist_query_output_table<-if(is.null(outputListSardist$studyData)){
   """"
 } else {
+
+  knitr::kable(dist_table[!duplicated(dist_table),], align=""l"", caption= ""Quality Tier: High. Security level: none. Species At Risk listed as Endangered, Threatened or Special Concern under the <i>Species At Risk Act</i> for which the search polygon overlaps with their distribution (range). This is not the authoritative source or advice for Species At Risk data. Please access the Species At Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create anthe authoritative SARA report."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
+
 }
-if(Dist_overlap_result > 1){Dist_query_output_table}
+if(!is.null(outputListSardist$studyData)){Dist_query_output_table}
 ```
 
 ```{r crithab-table, echo=FALSE, results='asis'}

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -50,21 +50,21 @@ Please note the following important disclaimers and caveats associated with sigh
 ```{r wsdb, include=FALSE, cache=FALSE}
 outputList <- master_intersect(wsdb_sf, mapDataList)
 
-if (!is.null(outputList)) {
+if (!is.null(outputList$mapData)) {
   wsdb_points <- sfcoords_as_cols(outputList$mapData)
 }
 ```
 *
 ```{r wsdb-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_wsdb <- if (is.null(outputList)) {
+Report_wsdb <- if (is.null(outputList$studyData)) {
    ""There are no relevant records in the WSDB for this search area.""
  } else {
    ""There are relevant records in the WSDB for this search area.""
  }
 writeLines(Report_wsdb)
 ```
 ```{r wsdb-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whale Sightings Database (WSDB) (including sightings of groups of animals), for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, wsdb_points, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -87,15 +87,15 @@ outputList <- master_intersect(whitehead_sf, mapDataList)
 ```
 *
 ```{r whitehead-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_whitehead <-  if (is.null(outputList)) {
+Report_whitehead <-  if (is.null(outputList$studyData)) {
    ""There are no relevant records in the Whitehead Lab database for this search area.""
  } else {
    ""There are relevant records in the Whitehead Lab database for this search area.""
  }
 writeLines(Report_whitehead)
 ```
 ```{r whitehead-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whitehead Lab, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -117,15 +117,15 @@ outputList <- master_intersect(narwc_sf, mapDataList)
 ```
 *
 ```{r narwc-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_narwc <- if (is.null(outputList)) {
+Report_narwc <- if (is.null(outputList$studyData)) {
    ""There are no relevant records in the NARWC database for this search area.""
  } else {
    ""There are relevant records in the NARWC database for this search area.""
  }
 writeLines(Report_narwc)
 ```
 ```{r narwc-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the North Atlantic Right Whale Consortium (NARWC) Sightings Database, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: <https://www.narwc.org/sightings-database.html>'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -148,15 +148,15 @@ outputList <- master_intersect(obis_cet_sf, mapDataList)
 ```
 *
 ```{r obis-cetecean-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_obis_cet <-  if (is.null(outputList)) {
+Report_obis_cet <-  if (is.null(outputList$studyData)) {
   ""There are no relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area.""
 } else {
   ""There are relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area.""
 }
 writeLines(Report_obis_cet)
 ```
 ```{r obis-cetecean-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -176,7 +176,16 @@ Important usage considerations: model predictions in this section should not be
 
 #### ***Area-specific SDM cetacean search results***
 ```{r sdm, include=FALSE, cache=FALSE}
-table_sdm <- sdm_table(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea)
+clippedFin <- master_intersect(fin_whale_sf, mapDataList)
+clippedHp <- master_intersect(harbour_porpoise_sf, mapDataList)
+clippedHump <- master_intersect(humpback_whale_sf , mapDataList)
+clippedSei <- master_intersect(sei_whale_sf, mapDataList)
+
+table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
+                        ""Habour Porpoise"" = !is.null(clippedHp$studyData),
+                        ""Humpback Whale"" = !is.null(clippedHump$studyData),
+                        ""Sei Whale"" = !is.null(clippedSei$studyData))
+
 ```
 
 ```{r sdm-table}

---FILE: app/Rmd/report_cetaceans_FR.Rmd---
@@ -47,7 +47,7 @@ outputList <- master_intersect(wsdb_sf, mapDataList)
 ```
 *
 ```{r wsdb-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_wsdb <- if (is.null(outputList)) {
+Report_wsdb <- if (is.null(outputList$studyData)) {
    ""There are no relevant records in the WSDB for this search area.""
  } else {
    ""There are relevant records in the WSDB for this search area.""
@@ -56,7 +56,7 @@ Report_wsdb <- if (is.null(outputList)) {
 ```
 
 ```{r wsdb-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Faible. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la base de données sur les observations de baleines (BDOB) (y compris les observations de groupes d’animaux), pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la Loi sur les espèces en péril (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -80,7 +80,7 @@ outputList <- master_intersect(whitehead_sf, mapDataList)
 ```
 *
 ```{r whitehead-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_whitehead <-  if (is.null(outputList)) {
+Report_whitehead <-  if (is.null(outputList$studyData)) {
    ""Il n’existe aucun registre pertinent dans la base de données du laboratoire Whitehead pour cette zone de recherche.""
  } else {
    ""Il existe des registres pertinents dans la base de données du laboratoire Whitehead pour cette zone de recherche.""
@@ -89,7 +89,7 @@ writeLines(Report_whitehead)
 ```
 
 ```{r whitehead-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du laboratoire Whitehead pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la Loi sur les espèces en péril (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC)s. Les efforts sur le terrain ont surtout été menés dans la zone de protection marine de Gully et les canyons adjacents le long de la limite est du plateau néo-écossais, par beau temps (par exemple, consulter Whitehead 2013 pour voir une carte des efforts entre 1988 et 2011), bien que certaines données des relevés le long de la limite du plateau au large de la Nouvelle-Écosse et de Terre-Neuve-et-Labrador soient incluses. <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> L’absence peut être liée à un effort d’enquête faible ou nul. Cette carte n’inclut pas non plus les détections acoustiques. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Pour de plus amples renseignements, consultez le site :<https://whiteheadlab.weebly.com/contact.html>'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -112,15 +112,15 @@ outputList <- master_intersect(narwc_sf, mapDataList)
 ```
 *
 ```{r narwc-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_narwc <-  if (is.null(outputList)) {
+Report_narwc <-  if (is.null(outputList$studyData)) {
    ""Il n’existe aucun registre pertinent dans la base de données du NARWC pour cette zone de recherche.""
  } else {
    ""Il existe des registres pertinents dans la base de données du NARWC pour cette zone de recherche.""
  }
 writeLines(Report_narwc)
 ```
 ```{r narwc-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la Base de données des observations du North Atlantic Right Whale Consortium (NARWC) pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone</b> , puisque l’effort de relevé est biaisé vers le nord-est des États-Unis, et les données sur la présence d’espèces provenant des détections acoustiques ne sont pas incluses. Pour de plus amples renseignements, consultez le site : <https://www.narwc.org/sightings-database.html>'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
    plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -142,7 +142,7 @@ outputList <- master_intersect(obis_cet_sf, mapDataList)
 ```
 *
 ```{r obis-result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_obis_cet <-  if (is.null(outputList)) {
+Report_obis_cet <-  if (is.null(outputList$studyData)) {
   ""Il n’existe aucun registre pertinent pour les cétacés dans le système d’information sur la biodiversité des océans (SIBO) pour cette zone de recherche.""
 } else {
   ""Il existe des registres pertinents pour les cétacés dans le système d’information sur la biodiversité des océans (SIBO) pour cette zone de recherche.""
@@ -151,7 +151,7 @@ writeLines(Report_obis_cet)
 ```
 
 ```{r obis-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du SIBO pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> . L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData, attribute=""Legend"", legendColours = whale_col)
 }
 ```
@@ -172,7 +172,16 @@ Considérations importantes relatives à l’utilisation : les prévisions modé
 #### ***Résultats de la recherche du MRE pour les cétacés, par zone***
 ```{r sdm, include=FALSE, cache=FALSE}
 
-table_sdm <- sdm_table(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea)
+clippedFin <- master_intersect(fin_whale_sf, mapDataList)
+clippedHp <- master_intersect(harbour_porpoise_sf, mapDataList)
+clippedHump <- master_intersect(humpback_whale_sf , mapDataList)
+clippedSei <- master_intersect(sei_whale_sf, mapDataList)
+
+table_sdm <- data.frame(""Fin Whale"" = !is.null(clippedFin$studyData),
+                        ""Habour Porpoise"" = !is.null(clippedHp$studyData),
+                        ""Humpback Whale"" = !is.null(clippedHump$studyData),
+                        ""Sei Whale"" = !is.null(clippedSei$studyData))
+
 ```
 ```{r sdm-table}
  knitr::kable(table_sdm, align=""cccc"", caption="". Niveau de qualité : Faible. Niveau de sécurité : Aucun. Résultats indiquant si la zone de recherche chevauche les zones prioritaires prévues pour améliorer la surveillance de plusieurs espèces de cétacés (rorqual commun, marsouin commun, rorqual à bosse et rorqual boréal). VRAI = le polygone chevauche la zone prioritaire; FAUX = le polygone ne chevauche PAS la zone prioritaire."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -33,15 +33,15 @@ knitr::kable(table_RV, align=""l"",
 
 Samples_bbox <- outputList$mapPoints
 
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   tableList <- create_table_RV(outputList$studyData, listed_species, speciesTable = RVGSSPECIES)
   table_rv1 <- tableList[[1]]
   table_rv2 <- tableList[[2]]
 }
 ```
 *
 ```{r RV-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_RV <- if (is.null(outputList)) {
+Report_RV <- if (is.null(outputList$studyData)) {
     ""There are no relevant records in the Maritimes Research Vessel (RV) Survey for this search area.""
   } else {
     ""There are relevant records in the Maritimes Research Vessel (RV) Survey for this search area.""
@@ -51,7 +51,7 @@ writeLines(Report_RV)
 ```
 
 ```{r RV-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline) used to query information from the Maritimes Research Vessel (RV) Trawl Survey. Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   
 areaMap +
     geom_segment(aes(x = Samples_bbox$long, 
@@ -62,13 +62,13 @@ areaMap +
 ```
 <br>
 ```{r RV-SAR-table}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
  knitr::kable(table_rv2, align=""l"", caption=""\\label{tab:rv_SAR_table} Quality Tier: High. Security level: none. Maritimes Research Vessel (RV) Survey observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or species assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
 <br>
 ```{r RV-freq-table}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
 knitr::kable(table_rv1, align=""l"", caption=""\\label{tab:rv_freq_table}Quality Tier: High. Security level: none. Maritimes Research Vessel (RV) Survey observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
@@ -105,33 +105,33 @@ outputListM <- master_intersect(marfis_sf, mapDataList, Year = minYear)
 Samples_bboxI <- outputListI$mapPoints
 Samples_bboxM <- outputListM$mapPoints
 
-if (!is.null(outputListI)) {
+if (!is.null(outputListI$studyData)) {
   tableList <- create_table_ISDB(outputListI$studyData, listed_species,
                                  speciesTable = ISSPECIESCODES)
   table_isdb1 <- tableList[[1]]
   table_isdb2 <- tableList[[2]]
 }
 
-if (!is.null(outputListM)) {
+if (!is.null(outputListM$studyData)) {
   tableList <- create_table_MARFIS(outputListM$studyData, listed_species, speciesTable = MARFISSPECIESCODES)
   table_mar1 <- tableList[[1]]
   table_mar2 <- tableList[[2]]
 }
 ```
 *
 ```{r isdb-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_isdb <- if (is.null(outputListI)) {
+Report_isdb <- if (is.null(outputListI$studyData)) {
     ""There are no relevant records in the Industry Survey Database (ISDB) for this search area.""
   } else {
     ""There are relevant records in the Industry Survey Database (ISDB) for this search area.""
   }
-Report_isdb<-noquote(Report_isdb)
+Report_isdb <- noquote(Report_isdb)
 writeLines(Report_isdb)
 ```
 
 *
 ```{r marfis-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_marfis <- if (is.null(outputListM)) {
+Report_marfis <- if (is.null(outputListM$studyData)) {
     ""There are no relevant records in the Maritimes Fishery Information System (MARFIS) for this search area.""
   } else {
     ""There are relevant records in the Maritimes Fishery Information System (MARFIS) for this search area.""
@@ -141,31 +141,31 @@ writeLines(Report_marfis)
 ```
 
 ```{r marfis-isdb-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.'}
-if (!is.null(outputListI) & !is.null(outputListM)) {
+if (!is.null(outputListI$studyData) & !is.null(outputListM$studyData)) {
   areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListI)) {
+} else if (!is.null(outputListI$studyData)) {
     areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListM)) {
+} else if (!is.null(outputListM$studyData)) {
         areaMap + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 }
 ```
 ```{r isdb-SAR-table}
-if (!is.null(outputListI)) {
+if (!is.null(outputListI$studyData)) {
 knitr::kable(table_isdb2, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 ```{r isdb-all-table}
-if (!is.null(outputListI)) {
+if (!is.null(outputListI$studyData)) {
   knitr::kable(table_isdb1, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 
 ```{r marfis-SAR-table}
-if (!is.null(outputListM)) {
+if (!is.null(outputListM$studyData)) {
   knitr::kable(table_mar2, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 ```{r marfis-all-table}
-if (!is.null(outputListM)) {
+if (!is.null(outputListM$studyData)) {
   knitr::kable(table_mar1, caption=""Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")  %>% column_spec(1, width=""15cm"")
 } %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
@@ -184,14 +184,14 @@ OBIS is a global, open-access data and information clearing-house on marine biod
 ```{r obis-results, include=FALSE, cache=FALSE}
 outputList <- master_intersect(obis_fish_sf, mapDataList, Year = minYear)
 
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   tableList <- create_table_OBIS(outputList$studyData)
   table_obis1 <- tableList[[1]]
 }
 ```
 *
 ```{r obis-check, echo=FALSE, results='asis',}
-Report_obis <- if (is.null(outputList)) {
+Report_obis <- if (is.null(outputList$studyData)) {
   ""There are no relevant records in the Ocean Biodiversity Information System (OBIS) for this search area.""
 } else {
   ""There are relevant records in the Ocean Biodiversity Information System (OBIS) for this search area.""
@@ -200,12 +200,12 @@ Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
 ```{r obis-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline) was used to query information from Ocean Biodiversity Information System (OBIS) observation records, for species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }
 ```
 ```{r obis-table, echo=FALSE, results='asis', caption=""Priority species with observations contained in the OBIS database within the search polygon area.""}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   knitr::kable(table_obis1, align=""l"", caption=""Quality Tier: Medium. Security level: none. Ocean Biodiversity Information System (OBIS) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
@@ -232,7 +232,7 @@ ocearchOutputList <- master_intersect(ocearch_sf, mapDataList)
 
 
 ```{r ocearch-check, echo=FALSE, results='asis',}
-Report_ocearch <- if (is.null(ocearchOutputList)) {
+Report_ocearch <- if (is.null(ocearchOutputList$studyData)) {
   ""There are no relevant White Shark records in the OCEARCH Shark Tracker for this search area.""
 } else {
   numRecords <- length(ocearchOutputList$studyData$geometry)
@@ -243,7 +243,7 @@ Report_obis<-noquote(Report_ocearch)
 writeLines(Report_ocearch)
 ```
 ```{r ocearch-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline) was used to query information from OCEARCH Shark Tracker observation records, for White Shark. Dataset set has not yet been completely error-checked. The absence of a species in this figure should be interpreted as an absence of tracking data, not necessarily as an absence of the species in the area.'}
-if (!is.null(ocearchOutputList)) {
+if (!is.null(ocearchOutputList$studyData)) {
   plot_rr_sf(areaMap, ocearchOutputList$mapPoints)
 }
 ```

---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -30,15 +30,15 @@ knitr::kable(table_RV, align=""l"",
 
 Samples_bbox <- outputList$mapPoints
 
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   tableList <- create_table_RV(outputList$studyData, listed_species, speciesTable = RVGSSPECIES)
   table_rv1 <- tableList[[1]]
   table_rv2 <- tableList[[2]]
 }
 ```
 *
 ```{r RV-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_RV <- if (is.null(outputList)) {
+Report_RV <- if (is.null(outputList$studyData)) {
     ""Il n’existe aucun registre pertinent des enquêtes sur les navires de recherche dans les Maritimes pour cette zone de recherche.""
   } else {
     ""Il existe des registres pertinents des enquêtes sur les navires de recherche dans les Maritimes pour cette zone de recherche.""
@@ -48,19 +48,19 @@ writeLines(Report_RV)
 ```
 
 ```{r RV-plot, fig.height=8, fig.width=11, fig.cap= 'Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge), utilisée pour demander des renseignements sur l’enquête sur le navire de recherche dans les Maritimes. Les lignes et les flèches noires indiquent l’emplacement et la direction de chaque exemple de chalut de fond à panneaux. La fréquence représente le nombre de chaluts où une espèce donnée a été échantillonnée, en comparaison au nombre total de chaluts dans la zone de recherche.'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
 areaMap + geom_segment(aes(x = Samples_bbox$long, y = Samples_bbox$lat, xend = Samples_bbox$ELONG, yend = endy <- Samples_bbox$ELAT),arrow=arrow(length = unit(0.2,""cm"")), size = 0.5)
 }
 ```
 <br>
 ```{r RV-SAR-table}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
  knitr::kable(table_rv2, align=""l"", caption=""\\label{tab:rv_SAR_table} Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Registres d’observation de l’enquête sur les navires de recherche dans les Maritimes des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
 <br>
 ```{r RV-freq-table}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
 knitr::kable(table_rv1, align=""l"", caption=""\\label{tab:rv_freq_table}QNiveau de qualité : Élevée. Niveau de sécurité : Aucun. Registres d’observation de l’enquête sur les navires de recherche dans les Maritimes de <u>toutes les espèces</u> contenues dans la zone de recherche, résumées par espèce ou groupe d’espèces. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```
@@ -96,22 +96,22 @@ outputListM <- master_intersect(marfis_sf, mapDataList, Year = minYear)
 Samples_bboxI <- outputListI$mapPoints
 Samples_bboxM <- outputListM$mapPoints
 
-if (!is.null(outputListI)) {
+if (!is.null(outputListI$studyData)) {
   tableList <- create_table_ISDB(outputListI[[1]], listed_species,
                                  speciesTable = ISSPECIESCODES)
   table_isdb1 <- tableList[[1]]
   table_isdb2 <- tableList[[2]]
 }
 
-if (!is.null(outputListM)) {
+if (!is.null(outputListM$studyData)) {
   tableList <- create_table_MARFIS(outputListM[[1]], listed_species, speciesTable = MARFISSPECIESCODES)
   table_mar1 <- tableList[[1]]
   table_mar2 <- tableList[[2]]
 }
 ```
 *
 ```{r isdb-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_isdb <- if (is.null(outputListI)) {
+Report_isdb <- if (is.null(outputListI$studyData)) {
     ""Il n’y a aucun registre pertinent dans la base de données des relevés de l’industrie (BDRI) pour cette zone de recherche.""
   } else {
     ""Il y a des registres pertinents dans la base de données des relevés de l’industrie (BDRI) pour cette zone de recherche.""
@@ -122,7 +122,7 @@ writeLines(Report_isdb)
 
 *
 ```{r marfis-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_marfis <- if (is.null(outputListM)) {
+Report_marfis <- if (is.null(outputListM$studyData)) {
     ""Il n’y a aucun registre pertinent dans le Système d’information sur les pêches des Maritimes (SIPMAR) pour cette zone de recherche.""
   } else {
     ""Il y a des registres pertinents dans le Système d’information sur les pêches des Maritimes (SIPMAR) pour cette zone de recherche.""
@@ -132,31 +132,32 @@ writeLines(Report_marfis)
 ```
 
 ```{r marfis-isdb-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) utilisée pour demander des renseignements agrégés provenant des dossiers d’observation du Système d’information sur les pêches des Maritimes (SIPMAR) et/ou de la Base de données des relevés de l’industrie (BDRI), qui sont présentés sous forme de points noirs, pour toutes les espèces. La règle des cinq n’a pas été appliquée.'}
-if (!is.null(outputListI) & !is.null(outputListM)) {
+if (!is.null(outputListI$studyData) & !is.null(outputListM$studyData)) {
+  
   areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListI)) {
+} else if (!is.null(outputListI$studyData)) {
     areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
-} else if (!is.null(outputListM)) {
+} else if (!is.null(outputListM$studyData)) {
         areaMap + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 }
 ```
 ```{r isdb-SAR-table}
-if (!is.null(outputListI)) {
+if (!is.null(outputListI$studyData)) {
 knitr::kable(table_isdb2, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation de la base de données des relevés de l’industrie des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>TSi une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 ```{r isdb-all-table}
-if (!is.null(outputListI)) {
+if (!is.null(outputListI$studyData)) {
   knitr::kable(table_isdb1, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation de la base de données des relevés de l’industrie de <u>toutes les espèces</u> contenues dans la zone de recherche, résumées par espèce ou groupe d’espèces. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 
 ```{r marfis-SAR-table}
-if (!is.null(outputListM)) {
+if (!is.null(outputListM$studyData)) {
   knitr::kable(table_mar2, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation du Système d’information sur les pêches des Maritimes des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 ```{r marfis-all-table}
-if (!is.null(outputListM)) {
+if (!is.null(outputListM$studyData)) {
   knitr::kable(table_mar1, caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation du Système d’information sur les pêches des Maritimes de <u>toutes les espèces</u> contenues dans la zone de recherche, résumées par espèce ou groupe d’espèces. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")  %>% column_spec(1, width=""15cm"")
 } %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
@@ -175,14 +176,14 @@ Le SIBO est un centre mondial de données et d’information en libre accès sur
 ```{r obis-results, include=FALSE, cache=FALSE}
 outputList <- master_intersect(obis_fish_sf, mapDataList, Year = minYear)
 
-if (!is.null(outputList)) {
-  tableList <- create_table_OBIS(outputList[[1]])
+if (!is.null(outputList$studyData)) {
+  tableList <- create_table_OBIS(outputList$studyData)
   table_obis1 <- tableList[[1]]
 }
 ```
 *
 ```{r obis-check, echo=FALSE, results='asis',}
-Report_obis <- if (is.null(outputList)) {
+Report_obis <- if (is.null(outputList$studyData)) {
   ""Il n’y a aucun registre pertinent dans le système d’information sur la biodiversité des océans (SIB)O pour cette zone de recherche.""
 } else {
   ""Il y a des registres pertinents dans le système d’information sur la biodiversité des océans (SIB)O pour cette zone de recherche.""
@@ -191,13 +192,13 @@ Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
 ```{r obis-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) a été utilisée pour rechercher des informations dans les registres d’observation du SIBO sur les espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>'}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   plot_rr_sf(areaMap, outputList$mapData)
 }
 ```
 
 ```{r obis-table, echo=FALSE, results='asis', caption=""Les espèces prioritaires avec des observations contenues dans la base de données du SIBO, dans la zone de recherche.""}
-if (!is.null(outputList)) {
+if (!is.null(outputList$studyData)) {
   knitr::kable(table_obis1, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Registres d’observation du système d’information sur la biodiversité des océans (SIBO) des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }
 ```

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -30,7 +30,7 @@ attribute <- ""NONE""
 
 ```{r EBSA-check, echo=FALSE, results='asis'}
 #function for overlap
-Query_output_EBSA<-if(is.null(EBSAoutput)){
+Query_output_EBSA<-if(is.null(EBSAoutput$stuyData)){
     ""The search area does not overlap with identified Ecologically and Biologically Significant Areas (EBSA).""
   } else {
     ""The search area overlaps with identified Ecologically and Biologically Significant Areas (EBSA).""

---FILE: app/Rmd/report_planning_FR.Rmd---
@@ -28,7 +28,7 @@ attribute <- ""NONE""
 
 ```{r EBSA-check, echo=FALSE, results='asis'}
 #function for overlap
-Query_output_EBSA<-if(is.null(EBSAoutput)){
+Query_output_EBSA<-if(is.null(EBSAoutput$stuyData)){
   ""La zone de recherche ne chevauche pas les zones d’importance écologique et biologique (ZIEB).""
   } else {
     ""La zone de recherche chevauche les zones d’importance écologique et biologique (ZIEB).""",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,8ab8b6f88f7f550f51629b3ed842e22c159e7434,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-03T14:19:41Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-09-03T14:19:41Z,fix readme typo,README.md,False,False,False,False,1,1,2,"---FILE: README.md---
@@ -33,7 +33,7 @@ After adding a new package, commit the updated renv.lock file to source control.
 After making sure that you have the necessary permissions to access the data, run:
 
 ``` r
-source(here::here(""dataprocessing/CopyRData.R""))
+source(here::here(""app/R/CopyRData.R""))
 copy_rdata_files()
 ```
 ",False,False,Documentation / Formatting,7
dfo-mar-odis,shinySpatialApp,81b99e58d719c9616dd77770e793fa07e207f19f,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-18T13:19:14Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-18T13:19:14Z,"fix last chunk tag, add master_intersect to french chunks",app/R/fn_intersect_operations.R;app/Rmd/report_SARA_EN.Rmd;app/Rmd/report_fish_FR.Rmd;app/Rmd/report_habitat_EN.Rmd,True,True,True,False,25,26,51,"---FILE: app/R/fn_intersect_operations.R---
@@ -483,15 +483,15 @@ EBSA_overlap <- function(EBSA_sf, studyArea) {
 # # EBSA report
 EBSA_report <- function(EBSA_sf, studyArea) {
 
-  EBSA_intersect <- sf::st_intersection(EBSA_sf,studyArea)
-  EBSA_result<-as.numeric(nrow(EBSA_intersect))
-  Query_output_EBSA_report<-if(EBSA_result < 1){
+  EBSA_intersect <- sf::st_intersection(EBSA_sf, studyArea)
+  EBSA_result <- as.numeric(nrow(EBSA_intersect))
+  Query_output_EBSA_report <- if(EBSA_result < 1){
     """"
   } else {
     paste(""Report: "", EBSA_intersect$Report)
   }
 
-  Query_output_EBSA_report2<-unique(noquote(Query_output_EBSA_report))
+  Query_output_EBSA_report2 <- unique(noquote(Query_output_EBSA_report))
 
   writeLines(Query_output_EBSA_report2, sep=""\n"")
 
@@ -508,7 +508,7 @@ EBSA_reporturl <- function(EBSA_sf, studyArea) {
     paste(""Report URL:"",intersect$Report_URL)
   }
 
-  Query_output_EBSA_reporturl2<-unique(noquote(Query_output_EBSA_reporturl))
+  Query_output_EBSA_reporturl2 <- unique(noquote(Query_output_EBSA_reporturl))
 
   writeLines(Query_output_EBSA_reporturl2, sep=""\n"")
 

---FILE: app/Rmd/report_SARA_EN.Rmd---
@@ -68,7 +68,7 @@ crit_table <- table_crit(ClippedCritHab_sf, studyArea, leatherback_sf)
 Dist_query_output_table<-if(Dist_overlap_result < 1){
   """"
 } else {
-  dist_table
+  
 }
 if(Dist_overlap_result > 1){Dist_query_output_table}
 ```

---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -25,8 +25,8 @@ knitr::kable(table_RV, align=""l"",
 #### ***Résultats des enquêtes sur les navires de recherche dans les Maritimes, par zone***
 
 ```{r RV-results, include=FALSE, cache=FALSE}
-outputList <- master_intersect(RVCatch_sf, region, studyArea, speciestable = RVGSSPECIES,
-                               mapBbox = bboxMap, Year = minYear)
+  outputList <- master_intersect(RVCatch_sf, region, studyArea, mapBbox = bboxMap, Year = minYear)
+
 
 Samples_bbox <- outputList$mapPoints
 
@@ -90,9 +90,9 @@ Niveau de sécurité : Protégé B
 Le Système d’information sur les pêches des Maritimes (SIPMAR) est une base de données du MPO, gérée par la Direction des politiques et des études économiques. Le SIPMAR contient des renseignements sur les prises et les efforts, les quotas et les permis pour la région des Maritimes. Les renseignements consignés pour toutes les pêches commerciales qui se déroulent dans cette région sont associés à ces données. Si un navire commercial de la région des Maritimes fait des débarquements dans une autre région du MPO ou à l’extérieur des eaux canadiennes, l’information n’est pas incluse dans la base de données du SIPMAR, peu importe si le navire provient de la région des Maritimes. La majorité des renseignements sur les prises sont liés au déchargement commercial (p. ex. les programmes de contrôle à quai). Les renseignements déclarés dans le SIPMAR ne sont pas considérés comme spatialement ou temporellement synoptiques et, par conséquent, il est fortement recommandé d’intégrer des renseignements supplémentaires sur la présence et/ou l’utilisation de l’habitat (c.-à-d. frai, migration, alimentation) provenant d’études à plus grande échelle. Les données sur les rejets et les registres de données sur les espèces en péril sont également plus limitées, car les dossiers sur les prises ne comportent pas tous les coordonnées géographiques (latitude et longitude) associées ou des renseignements sur l’effort de pêche. Cependant, en général, tous les dossiers sont associés à une division de l’OPANO et à une zone unitaire de l’OPANO, même si aucune coordonnée n’a été fournie. Les données de production (moins de quatre ans) sont considérées comme préliminaires et peuvent être modifiées sans préavis. Des changements aux données archivées (plus de quatre ans) peuvent également se produire, mais ils sont généralement limités. Le travail de contrôle et d’assurance de la qualité est en cours dans la base de données du SIPMAR, mais les erreurs ne sont pas toutes corrigées. Si vous avez des erreurs à signaler, des questions ou des demandes de correction de données, vous pouvez les envoyer à notre boîte de réception de la qualité des données : CDDDataQuality@dfo-mpo.gc.ca. Cette information sur le SIPMAR a été fournie par Colin.O’Neil@dfo-mpo.gc.ca (juillet 2020, Direction des politiques et des études économiques). Si vous souhaitez inclure des données d’observateurs dans une publication, n’oubliez pas de les agréger (https://github.com/Maritimes/Mar.utils/blob/master/R/assess_privacy.r).
 
 #### ***Résultats de recherche du SIPMAR et de la BDRI par zone***
-```{r, include=FALSE, cache=FALSE}
-outputListI <- main_intersect(isdb_sf, studyArea, Bbox = bboxMap, Year = minYear)
-outputListM <- main_intersect(marfis_sf, studyArea, Bbox = bboxMap, Year = minYear)
+```{r marfis-isdb-results, include=FALSE, cache=FALSE}
+outputListI <- master_intersect(isdb_sf, region, studyArea, mapBbox = bboxMap, Year = minYear)
+outputListM <- master_intersect(marfis_sf, region, studyArea, mapBbox = bboxMap, Year = minYear)
 Samples_bboxI <- outputListI[[3]]
 Samples_bboxM <- outputListM[[3]]
 
@@ -110,7 +110,7 @@ if (!is.null(outputListM)) {
 }
 ```
 *
-```{r, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+```{r isdb-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
 Report_isdb <- if (is.null(outputListI)) {
     ""Il n’y a aucun registre pertinent dans la base de données des relevés de l’industrie (BDRI) pour cette zone de recherche.""
   } else {
@@ -121,7 +121,7 @@ writeLines(Report_isdb)
 ```
 
 *
-```{r, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+```{r marfis-check, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
 Report_marfis <- if (is.null(outputListM)) {
     ""Il n’y a aucun registre pertinent dans le Système d’information sur les pêches des Maritimes (SIPMAR) pour cette zone de recherche.""
   } else {
@@ -131,7 +131,7 @@ Report_marfis<-noquote(Report_marfis)
 writeLines(Report_marfis)
 ```
 
-```{r, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) utilisée pour demander des renseignements agrégés provenant des dossiers d’observation du Système d’information sur les pêches des Maritimes (SIPMAR) et/ou de la Base de données des relevés de l’industrie (BDRI), qui sont présentés sous forme de points noirs, pour toutes les espèces. La règle des cinq n’a pas été appliquée.'}
+```{r marfis-isdb-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) utilisée pour demander des renseignements agrégés provenant des dossiers d’observation du Système d’information sur les pêches des Maritimes (SIPMAR) et/ou de la Base de données des relevés de l’industrie (BDRI), qui sont présentés sous forme de points noirs, pour toutes les espèces. La règle des cinq n’a pas été appliquée.'}
 if (!is.null(outputListI) & !is.null(outputListM)) {
   areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 } else if (!is.null(outputListI)) {
@@ -140,22 +140,22 @@ if (!is.null(outputListI) & !is.null(outputListM)) {
         areaMap + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 }
 ```
-```{r}
+```{r isdb-SAR-table}
 if (!is.null(outputListI)) {
 knitr::kable(table_isdb2, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation de la base de données des relevés de l’industrie des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>TSi une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
-```{r}
+```{r isdb-all-table}
 if (!is.null(outputListI)) {
   knitr::kable(table_isdb1, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation de la base de données des relevés de l’industrie de <u>toutes les espèces</u> contenues dans la zone de recherche, résumées par espèce ou groupe d’espèces. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 
-```{r}
+```{r marfis-SAR-table}
 if (!is.null(outputListM)) {
   knitr::kable(table_mar2, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation du Système d’information sur les pêches des Maritimes des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")} %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
-```{r}
+```{r marfis-all-table}
 if (!is.null(outputListM)) {
   knitr::kable(table_mar1, caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Protégé B. Registres d’observation du Système d’information sur les pêches des Maritimes de <u>toutes les espèces</u> contenues dans la zone de recherche, résumées par espèce ou groupe d’espèces. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""")  %>% column_spec(1, width=""15cm"")
 } %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
@@ -172,8 +172,8 @@ Le SIBO est un centre mondial de données et d’information en libre accès sur
 
 #### ***Résultats de recherche du SIBO sur les poissons et les invertébrés par zone***
 
-```{r, include=FALSE, cache=FALSE}
-outputList <- main_intersect(obis_fish_sf, studyArea, Bbox = bboxMap, Year = minYear)
+```{r obis-results, include=FALSE, cache=FALSE}
+outputList <- master_intersect(obis_fish_sf, studyArea, Bbox = bboxMap, Year = minYear)
 Samples_bbox <- outputList[[3]]
 
 if (!is.null(outputList)) {
@@ -182,7 +182,7 @@ if (!is.null(outputList)) {
 }
 ```
 *
-```{r, echo=FALSE, results='asis',}
+```{r obis-check, echo=FALSE, results='asis',}
 Report_obis <- if (is.null(outputList)) {
   ""Il n’y a aucun registre pertinent dans le système d’information sur la biodiversité des océans (SIB)O pour cette zone de recherche.""
 } else {
@@ -191,14 +191,14 @@ Report_obis <- if (is.null(outputList)) {
 Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
-```{r, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) a été utilisée pour rechercher des informations dans les registres d’observation du SIBO sur les espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>'}
+```{r obis-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge) a été utilisée pour rechercher des informations dans les registres d’observation du SIBO sur les espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte. <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>'}
 if (!is.null(outputList)) {
   areaMap +
     geom_point(data = Samples_bbox, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 }
 ```
-```{r echo=FALSE, results='asis', caption=""
-Les espèces prioritaires avec des observations contenues dans la base de données du SIBO, dans la zone de recherche.""}
+
+```{r obis-table, echo=FALSE, results='asis', caption=""Les espèces prioritaires avec des observations contenues dans la base de données du SIBO, dans la zone de recherche.""}
 if (!is.null(outputList)) {
   knitr::kable(table_obis1, align=""l"", caption=""Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Registres d’observation du système d’information sur la biodiversité des océans (SIBO) des espèces contenues dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente du présent tableau, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b>"", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 }

---FILE: app/Rmd/report_habitat_EN.Rmd---
@@ -51,8 +51,7 @@ if(!is.null(clipped$studyData)){
 
 ```{r rockweed-table}
 if(!is.null(clipped$studyData)){
-knitr::kable(rwTable,align=""l"",
-             caption = ""Number of vegetation polygons and surface area occupied by each category for the study area. Total intertidal vegetations is a sum of all categories."", booktabs = T, escape = F, linesep = """") %>%
+knitr::kable(rwTable,align=""l"", caption = ""Number of vegetation polygons and surface area occupied by each category for the study area. Total intertidal vegetations is a sum of all categories."", booktabs = T, escape = F, linesep = """") %>%
   kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 } 
 ```",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,e7a3cbaceeb6a4d03f06c9c815e259758f479543,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-13T16:28:04Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-13T16:28:04Z,fix chunk label figure captions,app/Rmd/intro_EN.Rmd;app/Rmd/intro_FR.Rmd;app/Rmd/report_SARA_EN.Rmd;app/Rmd/report_SARA_FR.Rmd;app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/report_cetaceans_FR.Rmd;app/Rmd/report_fish_EN.Rmd;app/Rmd/report_fish_FR.Rmd;app/Rmd/report_habitat_EN.Rmd;app/Rmd/report_habitat_FR.Rmd;app/Rmd/report_planning_EN.Rmd;app/Rmd/report_planning_FR.Rmd;tests/testthat/test_functions.R,True,False,True,False,39,38,77,"---FILE: app/Rmd/intro_EN.Rmd---
@@ -90,7 +90,7 @@ This document summarizes regional data available at the time of report creation,
 
 This document is developed as a reproducible reporting tool, supported by the R markdown language and generated by an R-Shiny application interface hosted on the DFO network. Report summaries and outputs are based on data extracted from a user-provided search area (a focal polygon of interest) with a user-defined buffer (Figure 1). Instructions for use of the R-Shiny interface are provided in the technical manual. Due to the potential sensitivity of some data and information, access to the data in the application has to be granted, and the report is intended for internal use only.
 
-````{r area map plot, fig.height=8, fig.width=11, fig.cap='Map showing the search area defined by the user (outlined in red) to query information and automatically generate this report. '}
+````{r area-map-plot, fig.height=8, fig.width=11, fig.cap='Map showing the search area defined by the user (outlined in red) to query information and automatically generate this report. '}
 areaMap
 # areaMap can be plotted once and then reused for other plots
 ```

---FILE: app/Rmd/intro_FR.Rmd---
@@ -89,7 +89,7 @@ Ce document résume les données régionales, y compris les renseignements sur l
 
 Le présent document est conçu comme un outil de rapport reproductible, appuyé par le langage de balisage R et généré par une interface d’application R-Shiny hébergée sur le réseau du MPO. Les résumés et les résultats des rapports sont basés sur des données extraites d’une zone de recherche fournie par l’utilisateur (un polygone d’intérêt focal) avec un tampon défini par l’utilisateur (figure x). Les instructions d’utilisation de l’interface R-Shiny sont fournies dans le manuel technique. En raison du caractère sensible potentiel de certaines données et informations, l’accès aux données de l’application doit être accordé, et le rapport est destiné à un usage interne uniquement.  
 
-````{r area map plot, fig.height=8, fig.width=11, fig.cap='Carte montrant la zone de recherche définie par l’utilisateur (entourée en rouge) pour rechercher des informations et générer automatiquement ce rapport. '}
+````{r area-map-plot, fig.height=8, fig.width=11, fig.cap='Carte montrant la zone de recherche définie par l’utilisateur (entourée en rouge) pour rechercher des informations et générer automatiquement ce rapport. '}
 areaMap
 # areaMap can be plotted once and then reused for other plots
 ```

---FILE: app/Rmd/report_SARA_EN.Rmd---
@@ -93,13 +93,13 @@ legend_name <- ""Common Name""
 clipped <- master_intersect(poly_sf, region, studyArea, bboxMap)
 ```
 
-```{r crithab region plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes critical habitat of Species At Risk listed as Endangered or Threatened under the <i>Species At Risk Act</i> (SARA) in the Scotian Shelf Bioregion. Please see table above for complimentary information. Critical habitat is defined under section 2 of SARA as: “the habitat that is necessary for the survival or recovery of a listed wildlife species and that is identified as the species’ critical habitat in the recovery strategy or in an action plan for the species.” Critical Habitat is identified in a species’ recovery strategy or action plan, posted on the [SAR Public Registry](http://www.sararegistry.gc.ca). This is not the authoritative source or advice for Species At Risk data. Please access the Species At Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create an authoritative report.', fig.height=6, fig.width=11}
+```{r crithab-region-plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes critical habitat of Species At Risk listed as Endangered or Threatened under the <i>Species At Risk Act</i> (SARA) in the Scotian Shelf Bioregion. Please see table above for complimentary information. Critical habitat is defined under section 2 of SARA as: “the habitat that is necessary for the survival or recovery of a listed wildlife species and that is identified as the species’ critical habitat in the recovery strategy or in an action plan for the species.” Critical Habitat is identified in a species’ recovery strategy or action plan, posted on the [SAR Public Registry](http://www.sararegistry.gc.ca). This is not the authoritative source or advice for Species At Risk data. Please access the Species At Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create an authoritative report.', fig.height=6, fig.width=11}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap, regionBox, studyBox_geom, clipped$regionData, attribute, legendName = legend_name)
 }  
 ```
 <br>
-```{r crithab area plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with critical habitat of Species At Risk listed as Endangered or Threatened under the <i>Species At Risk Act</i> (SARA)', fig.height=6, fig.width=11}
+```{r crithab-area-plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with critical habitat of Species At Risk listed as Endangered or Threatened under the <i>Species At Risk Act</i> (SARA)', fig.height=6, fig.width=11}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData, attribute, legendName = legend_name)
 }  
@@ -114,13 +114,13 @@ attribute <- ""NONE""
 clipped <- master_intersect(poly_sf, region, studyArea, bboxMap)
 ```
 
-```{r leatherback region plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes draft critical habitat of Leatherback Sea Turtle in the Scotian Shelf Bioregion, relative to the search area.', fig.height=6, fig.width=11}
+```{r leatherback-region-plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes draft critical habitat of Leatherback Sea Turtle in the Scotian Shelf Bioregion, relative to the search area.', fig.height=6, fig.width=11}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap, regionBox, studyBox_geom, clipped$regionData, attribute)
 }   
 ```
 <br>
-```{r leatherback area plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with draft critical habitat of Leatherback Sea Turtle', fig.height=6, fig.width=11}
+```{r leatherback-area-plot, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with draft critical habitat of Leatherback Sea Turtle', fig.height=6, fig.width=11}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData,attribute)
 }  

---FILE: app/Rmd/report_SARA_FR.Rmd---
@@ -92,13 +92,13 @@ legendName <- ""Common Name""
 clipped <- master_intersect(poly_sf, region, studyArea, bboxMap)
 ```
 
-```{r crithab region plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP de la biorégion du plateau néo-écossais. Veuillez consulter le tableau ci-dessous pour l’information complémentaire. Selon la définition de l’article 2 de la LEP, l’habitat essentiel est en fait « l’habitat nécessaire à la survie ou au rétablissement d’une espèce sauvage inscrite, qui est désigné comme tel dans un programme de rétablissement ou un plan d’action élaboré à l’égard de l’espèce ». L’habitat essentiel est désigné dans un programme de rétablissement final ou un plan d’action publié dans le Registre public des espèces en péril (http://www.sararegistry.gc.ca). Il ne s’agit <b>pas</b> d’une source ni d’un conseil faisant autorité en ce qui concerne les données sur les espèces en péril. Veuillez accéder au SIG des espèces en péril (http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) pour créer un rapport faisant autorité.', fig.height=6, fig.width=11}
+```{r crithab-region-plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP de la biorégion du plateau néo-écossais. Veuillez consulter le tableau ci-dessous pour l’information complémentaire. Selon la définition de l’article 2 de la LEP, l’habitat essentiel est en fait « l’habitat nécessaire à la survie ou au rétablissement d’une espèce sauvage inscrite, qui est désigné comme tel dans un programme de rétablissement ou un plan d’action élaboré à l’égard de l’espèce ». L’habitat essentiel est désigné dans un programme de rétablissement final ou un plan d’action publié dans le Registre public des espèces en péril (http://www.sararegistry.gc.ca). Il ne s’agit <b>pas</b> d’une source ni d’un conseil faisant autorité en ce qui concerne les données sur les espèces en péril. Veuillez accéder au SIG des espèces en péril (http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) pour créer un rapport faisant autorité.', fig.height=6, fig.width=11}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap, regionBox, studyBox_geom, clipped$regionData, attribute, legendName = legendName)
 }  
 ```
 
-```{r crithab area plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume les zones où le polygone de recherche chevauche l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP', fig.height=6, fig.width=11}
+```{r crithab-area-plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume les zones où le polygone de recherche chevauche l’habitat essentiel des espèces en péril inscrites comme en voie de disparition ou menacées en vertu de la LEP', fig.height=6, fig.width=11}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData, attribute)
 }  
@@ -113,13 +113,13 @@ attribute <- ""NONE""
 clipped <- master_intersect(poly_sf, region, studyArea, bboxMap)
 ```
 
-```{r letherback region plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume l’ébauche de l’habitat essentiel de la tortue luth de la biorégion du plateau néo-écossais, par rapport à la zone de recherche. ', fig.height=6, fig.width=11}
+```{r letherback-region-plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume l’ébauche de l’habitat essentiel de la tortue luth de la biorégion du plateau néo-écossais, par rapport à la zone de recherche. ', fig.height=6, fig.width=11}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap, regionBox, studyBox_geom, clipped$regionData, attribute)
 }   
 ```
 
-```{r leatherback area plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume les zones où le polygone de recherche chevauche  l’ébauche de l’habitat essentiel de la tortue luth.', fig.height=6, fig.width=11}
+```{r leatherback-area-plot, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Cette carte résume les zones où le polygone de recherche chevauche  l’ébauche de l’habitat essentiel de la tortue luth.', fig.height=6, fig.width=11}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData, attribute)
 }  

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -57,7 +57,7 @@ Report_wsdb <- if (is.null(outputList)) {
  }
 writeLines(Report_wsdb)
 ```
-```{r wsdb plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whale Sightings Database (WSDB) (including sightings of groups of animals), for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
+```{r wsdb-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whale Sightings Database (WSDB) (including sightings of groups of animals), for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
 if (!is.null(outputList)) {
   areaMap +
     geom_point(data = wsdb_points, aes(x = long, y = lat, color=Legend), size = 2, shape = 20) +
@@ -94,7 +94,7 @@ Report_whitehead <-  if (is.null(outputList)) {
  }
 writeLines(Report_whitehead)
 ```
-```{r whitehead plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whitehead Lab, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>'}
+```{r whitehead-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whitehead Lab, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>'}
 if (!is.null(outputList)) {
   areaMap+
     geom_point(data = whitehead_points, aes(x = long, y = lat, color=Legend),
@@ -133,7 +133,7 @@ Report_narwc <- if (is.null(outputList)) {
  }
 writeLines(Report_narwc)
 ```
-```{r narwc plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the North Atlantic Right Whale Consortium (NARWC) Sightings Database, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: <https://www.narwc.org/sightings-database.html>'}
+```{r narwc-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the North Atlantic Right Whale Consortium (NARWC) Sightings Database, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: <https://www.narwc.org/sightings-database.html>'}
 if (!is.null(outputList)) {
   areaMap+
     geom_point(data = narwc_points, aes(x = long, y = lat, color = Legend),
@@ -171,7 +171,7 @@ Report_obis_cet <-  if (is.null(outputList)) {
 }
 writeLines(Report_obis_cet)
 ```
-```{r obis cetecean plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
+```{r obis-cetecean-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
 if (!is.null(outputList)) {
   areaMap+
     geom_point(data = obis_cet_points, aes(x = long, y = lat, color = Legend),
@@ -206,7 +206,7 @@ table_sdm <- sdm_table(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei
  knitr::kable(table_sdm, align=""cccc"", caption=""Quality Tier: Low. Security level: none. Results showing if the search area overlap with predicted Priority Areas to Enhance Monitoring of several species of cetaceans (Fin Whale, Harbour Porpoise, Humpback Whale and Sei Whale). TRUE = polygon does overlap with priority area; FALSE = polygon does NOT overlap with priority area."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 ```
 
-```{r sdm plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map shows consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate). Yellow polygons (habitats with high suitability) are to be interpreted as areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in Gomez et al. (2020), these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. They represent priority areas to direct cetacean monitoring efforts. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the Western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure.'}
+```{r sdm-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map shows consolidated Species Distribution Modelling outputs (60-100% relative predicted occurrence rate). Yellow polygons (habitats with high suitability) are to be interpreted as areas where cetacean monitoring efforts may be prioritized, and results can help direct future survey efforts. Due to the many reasons listed in the discussion section in Gomez et al. (2020), these cetacean modelling outputs do not represent a complete and current distribution of cetaceans in the region. They represent priority areas to direct cetacean monitoring efforts. Their use in marine spatial planning processes should be accompanied by complementary approaches such as the process summarized in the section below. The data product summarized in the section below (Blue Whale Important Habitat in the Western North Atlantic) represents an excellent framework in which to properly use the outputs of this figure.'}
 plot_cetaceans_4grid(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea, land10m_sf, 200, bounds_sf)
 ```
 
@@ -241,14 +241,14 @@ polyText <- if(is.null(clipped$studyData)){""Search area does not overlap with Bl
  writeLines(polyText)
 ```
 
-```{r bw region plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging and migration. These areas identified in the report by Lesage et al. (2018) are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population.'}
+```{r bw-region-plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Blue Whale Important Habitat in the Western North Atlantic. Polygons delimit areas in Canadian waters that are important to Blue Whales for foraging and migration. These areas identified in the report by Lesage et al. (2018) are considered important for the survival and recovery of Blue Whales from the western North Atlantic population. Blue Whales most likely need to use several of these important habitats to fulfill their biological needs. As a result, access corridors and habitat they connect need to be considered equally important for the population.'}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap, regionBox, studyBox_geom, clipped$regionData, attribute)
 }  
 ```
 
 
-```{r bw area plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with Blue Whale Important Habitat.'}
+```{r bw-area-plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with Blue Whale Important Habitat.'}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData,attribute)
 }
@@ -290,13 +290,13 @@ polyText <- if(is.null(clipped$studyData)){""Search area does not overlap with No
  writeLines(polyText)
 ```
 
-```{r nbw region plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Proposed Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf. Northern Bottlenose Whales are present year-round in the inter-canyon areas, which function as foraging habitat and movement corridors. Note that the full extent of important habitat for Scotian Shelf Northern Bottlenose Whales remains unknown. Please see additional information in <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.'}
+```{r nbw-region-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Proposed Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf. Northern Bottlenose Whales are present year-round in the inter-canyon areas, which function as foraging habitat and movement corridors. Note that the full extent of important habitat for Scotian Shelf Northern Bottlenose Whales remains unknown. Please see additional information in <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.'}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap,regionBox,studyBox_geom, clipped$regionData,attribute)
 }
 ```
 
-```{r nbw area plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with Northern Bottlenose Whale important habitat in inter-canyon areas on the eastern Scotian Shelf.'}
+```{r nbw-area-plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with Northern Bottlenose Whale important habitat in inter-canyon areas on the eastern Scotian Shelf.'}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData,attribute)
 }

---FILE: app/Rmd/report_cetaceans_FR.Rmd---
@@ -59,7 +59,7 @@ Report_wsdb <- if (is.null(outputList)) {
  writeLines(Report_wsdb)
 ```
 
-```{r wsdb plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Faible. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la base de données sur les observations de baleines (BDOB) (y compris les observations de groupes d’animaux), pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la Loi sur les espèces en péril (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.'}
+```{r wsdb-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Faible. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la base de données sur les observations de baleines (BDOB) (y compris les observations de groupes d’animaux), pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la Loi sur les espèces en péril (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.'}
 if (!is.null(outputList)) {
   areaMap + geom_point(data = wsdb_points, aes(x = long, y = lat, color=Legend), size = 2, shape = 20) +
     ggplot2::scale_colour_manual(values=whale_col)
@@ -96,7 +96,7 @@ Report_whitehead <-  if (is.null(outputList)) {
 writeLines(Report_whitehead)
 ```
 
-```{r whitehead plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du laboratoire Whitehead pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la Loi sur les espèces en péril (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC)s. Les efforts sur le terrain ont surtout été menés dans la zone de protection marine de Gully et les canyons adjacents le long de la limite est du plateau néo-écossais, par beau temps (par exemple, consulter Whitehead 2013 pour voir une carte des efforts entre 1988 et 2011), bien que certaines données des relevés le long de la limite du plateau au large de la Nouvelle-Écosse et de Terre-Neuve-et-Labrador soient incluses. <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> L’absence peut être liée à un effort d’enquête faible ou nul. Cette carte n’inclut pas non plus les détections acoustiques. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Pour de plus amples renseignements, consultez le site :<https://whiteheadlab.weebly.com/contact.html>'}
+```{r whitehead-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du laboratoire Whitehead pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la Loi sur les espèces en péril (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC)s. Les efforts sur le terrain ont surtout été menés dans la zone de protection marine de Gully et les canyons adjacents le long de la limite est du plateau néo-écossais, par beau temps (par exemple, consulter Whitehead 2013 pour voir une carte des efforts entre 1988 et 2011), bien que certaines données des relevés le long de la limite du plateau au large de la Nouvelle-Écosse et de Terre-Neuve-et-Labrador soient incluses. <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> L’absence peut être liée à un effort d’enquête faible ou nul. Cette carte n’inclut pas non plus les détections acoustiques. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Pour de plus amples renseignements, consultez le site :<https://whiteheadlab.weebly.com/contact.html>'}
 if (!is.null(outputList)) {
   areaMap + geom_point(data = whitehead_points, aes(x = long, y = lat, color=Legend), size = 2, shape = 20) + ggplot2::scale_colour_manual(values=whale_col)
 }
@@ -131,7 +131,7 @@ Report_narwc <-  if (is.null(outputList)) {
  }
 writeLines(Report_narwc)
 ```
-```{r narwc plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la Base de données des observations du North Atlantic Right Whale Consortium (NARWC) pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone</b> , puisque l’effort de relevé est biaisé vers le nord-est des États-Unis, et les données sur la présence d’espèces provenant des détections acoustiques ne sont pas incluses. Pour de plus amples renseignements, consultez le site : <https://www.narwc.org/sightings-database.html>'}
+```{r narwc-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés de la Base de données des observations du North Atlantic Right Whale Consortium (NARWC) pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone</b> , puisque l’effort de relevé est biaisé vers le nord-est des États-Unis, et les données sur la présence d’espèces provenant des détections acoustiques ne sont pas incluses. Pour de plus amples renseignements, consultez le site : <https://www.narwc.org/sightings-database.html>'}
 if (!is.null(outputList)) {
   areaMap + geom_point(data = narwc_points, aes(x = long, y = lat, color = Legend), size = 2, shape = 20) + ggplot2::scale_colour_manual(values=whale_col)
 }
@@ -165,7 +165,7 @@ Report_obis_cet <-  if (is.null(outputList)) {
 writeLines(Report_obis_cet)
 ```
 
-```{r obis plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du SIBO pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> . L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.'}
+```{r obis-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Moyenne. Niveau de sécurité : Aucun. Carte montrant la zone de recherche définie par l’utilisateur (entourée de rouge). La carte affiche des renseignements tirés du SIBO pour les espèces de cétacés dans la zone de recherche et inscrites en vertu de la <i>Loi sur les espèces en péril</i> (LEP) ou évaluées par le Comité sur la situation des espèces en péril au Canada (COSEPAC). <b>Si une espèce est absente de cette carte, cette absence devrait être interprétée comme une absence de déclaration de l’espèce, et pas nécessairement comme l’absence de l’espèce dans cette zone.</b> . L’absence peut être liée à un effort d’enquête faible ou nul. L’information sur les observations sous-représente la présence de cétacés, en particulier les espèces qui vivent en eau profonde (p. ex., les baleines à bec) et qui passent peu de temps à la surface. Cette carte n’inclut pas non plus les détections acoustiques. Les observations sur terre indiquent que les données d’observation n’ont pas encore été complètement vérifiées ou que des animaux ont été observés depuis la côte.'}
 if (!is.null(outputList)) {
   areaMap + geom_point(data = obis_cet_points, aes(x = long, y = lat, color = Legend), size = 2, shape = 20) + ggplot2::scale_colour_manual(values=whale_col)
 }
@@ -197,7 +197,7 @@ table_sdm <- sdm_table(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei
  knitr::kable(table_sdm, align=""cccc"", caption="". Niveau de qualité : Faible. Niveau de sécurité : Aucun. Résultats indiquant si la zone de recherche chevauche les zones prioritaires prévues pour améliorer la surveillance de plusieurs espèces de cétacés (rorqual commun, marsouin commun, rorqual à bosse et rorqual boréal). VRAI = le polygone chevauche la zone prioritaire; FAUX = le polygone ne chevauche PAS la zone prioritaire."", booktabs = T, escape = F, linesep="""") %>% kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
 ```
 
-```{r sdm plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Faible. Niveau de sécurité : Aucun. La carte montre les résultats consolidés du modèle de répartition des espèces (taux d’occurrence prévu relatif de 60 à 100 %). Les polygones jaunes (habitats très appropriés) doivent être interprétés comme des zones où les efforts de surveillance des cétacés peuvent être priorisés et dont les résultats peuvent aider à diriger les activités de relevés dans le futur. En raison des nombreuses raisons énumérées dans la section de discussion de Gomez et al. (2020), ces données de modélisation sur les cétacés ne représentent pas une répartition complète et actuelle des cétacés dans la région. Elles représentent des zones prioritaires où diriger les efforts de surveillance des cétacés. Leur utilisation dans les processus de planification de l’espace marin devrait être accompagnée d’approches complémentaires telles que le processus résumé dans la section ci-dessous. Le produit de données résumé dans la section ci-dessous (habitat important pour le rorqual bleu dans l’ouest de l’Atlantique Nord) représente un excellent cadre dans lequel utiliser correctement les extrants de cette figure.'}
+```{r sdm-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Faible. Niveau de sécurité : Aucun. La carte montre les résultats consolidés du modèle de répartition des espèces (taux d’occurrence prévu relatif de 60 à 100 %). Les polygones jaunes (habitats très appropriés) doivent être interprétés comme des zones où les efforts de surveillance des cétacés peuvent être priorisés et dont les résultats peuvent aider à diriger les activités de relevés dans le futur. En raison des nombreuses raisons énumérées dans la section de discussion de Gomez et al. (2020), ces données de modélisation sur les cétacés ne représentent pas une répartition complète et actuelle des cétacés dans la région. Elles représentent des zones prioritaires où diriger les efforts de surveillance des cétacés. Leur utilisation dans les processus de planification de l’espace marin devrait être accompagnée d’approches complémentaires telles que le processus résumé dans la section ci-dessous. Le produit de données résumé dans la section ci-dessous (habitat important pour le rorqual bleu dans l’ouest de l’Atlantique Nord) représente un excellent cadre dans lequel utiliser correctement les extrants de cette figure.'}
 plot_cetaceans_4grid(fin_whale_sf, harbour_porpoise_sf, humpback_whale_sf, sei_whale_sf, studyArea, land10m_sf, 200, bounds_sf)
 ```
 
@@ -231,13 +231,13 @@ polyText<-if(is.null(clipped$studyData)){""La zone de recherche ne chevauche pas
  writeLines(polyText)
 ```
 
-```{r bw region plot, fig.height=4, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Habitat important pour le rorqual bleu dans l’ouest de l’Atlantique-Nord. Zones délimitées par des polygones dans les eaux canadiennes qui sont importantes pour les rorquals bleus pour l’alimentation et le transit. Ces zones d’habitat désignées dans le rapport par Lesage et al. (2018) sont considérées comme importantes pour la survie et le rétablissement des rorquals bleus de la population de l’ouest de l’Atlantique Nord. Les rorquals bleus ont fort probablement besoin d’utiliser plusieurs de ces habitats importants pour répondre à leurs besoins biologiques. Par conséquent, les corridors d’accès et l’habitat qu’ils relient doivent être considérés comme tout aussi importants pour la population.'}
+```{r bw region-plot, fig.height=4, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Habitat important pour le rorqual bleu dans l’ouest de l’Atlantique-Nord. Zones délimitées par des polygones dans les eaux canadiennes qui sont importantes pour les rorquals bleus pour l’alimentation et le transit. Ces zones d’habitat désignées dans le rapport par Lesage et al. (2018) sont considérées comme importantes pour la survie et le rétablissement des rorquals bleus de la population de l’ouest de l’Atlantique Nord. Les rorquals bleus ont fort probablement besoin d’utiliser plusieurs de ces habitats importants pour répondre à leurs besoins biologiques. Par conséquent, les corridors d’accès et l’habitat qu’ils relient doivent être considérés comme tout aussi importants pour la population.'}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap,regionBox,studyBox_geom, clipped$regionData,attribute)
 }  
 ```
 
-```{r bw area plot, fig.height=4, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour le rorqual bleu.'}
+```{r bw-area-plot, fig.height=4, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour le rorqual bleu.'}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData,attribute)
 }
@@ -277,13 +277,13 @@ polyText<-if(is.null(clipped$studyData)){""La zone de recherche ne chevauche pas
  writeLines(polyText)
 ```
 
-```{r nbw region plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Habitat important proposé pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais La baleine à bec commune est présente toute l’année dans les zones entre les canyons, qui servent d’habitat d’alimentation et de couloirs de déplacement. Veuillez prendre note que l’étendue de l’habitat important de la baleine à bec commune sur le plateau néo-écossais demeure inconnue. Veuillez consulter les renseignements complémentaires dans le document <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.'}
+```{r nbw-region-plot, fig.height=8, fig.width=11, fig.cap='Niveau de qualité : Élevée. Niveau de sécurité : Aucun. Habitat important proposé pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais La baleine à bec commune est présente toute l’année dans les zones entre les canyons, qui servent d’habitat d’alimentation et de couloirs de déplacement. Veuillez prendre note que l’étendue de l’habitat important de la baleine à bec commune sur le plateau néo-écossais demeure inconnue. Veuillez consulter les renseignements complémentaires dans le document <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.'}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap,regionBox,studyBox_geom, clipped$regionData,attribute)
 }
 ```
 
-```{r nbw area plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: noneNiveau de qualité : Élevée. Niveau de sécurité : Aucun. La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais.'}
+```{r nbw-area-plot, fig.height=4, fig.width=11, fig.cap='Quality Tier: High. Security level: noneNiveau de qualité : Élevée. Niveau de sécurité : Aucun. La carte résume les zones dans lesquelles le polygone de recherche chevauche l’habitat important pour la baleine à bec commune dans les zones situées entre les canyons de l’est du plateau néo-écossais.'}
 if (!is.null(clipped$mapData)){
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData,attribute)
 }

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -45,7 +45,7 @@ Report_RV<-noquote(Report_RV)
 writeLines(Report_RV)
 ```
 
-```{r RV plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline) used to query information from the Maritimes Research Vessel (RV) Trawl Survey. Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area'}
+```{r RV- plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline) used to query information from the Maritimes Research Vessel (RV) Trawl Survey. Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area'}
 if (!is.null(outputList)) {
 areaMap + geom_segment(aes(x = Samples_bbox$long, y = Samples_bbox$lat, xend = Samples_bbox$ELONG, yend = endy <- Samples_bbox$ELAT),arrow=arrow(length = unit(0.2,""cm"")), size = 0.5)
 }
@@ -130,7 +130,7 @@ Report_marfis<-noquote(Report_marfis)
 writeLines(Report_marfis)
 ```
 
-```{r marfis isdb plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.'}
+```{r marfis-isdb-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: Protected B. Map showing the search area defined by the user (red outline) used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.'}
 if (!is.null(outputListI) & !is.null(outputListM)) {
   areaMap + geom_point(data = Samples_bboxI, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"") + geom_point(data = Samples_bboxM, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")
 } else if (!is.null(outputListI)) {
@@ -190,7 +190,7 @@ Report_obis <- if (is.null(outputList)) {
 Report_obis<-noquote(Report_obis)
 writeLines(Report_obis)
 ```
-```{r obis plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline) was used to query information from Ocean Biodiversity Information System (OBIS) observation records, for species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.'}
+```{r obis-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline) was used to query information from Ocean Biodiversity Information System (OBIS) observation records, for species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore. The absence of a species in this figure should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.'}
 if (!is.null(outputList)) {
   areaMap +
     geom_point(data = Samples_bbox, aes(x = long, y = lat), size = 2, shape = 16, col = ""black"")

---FILE: app/Rmd/report_fish_FR.Rmd---
@@ -47,7 +47,7 @@ Report_RV<-noquote(Report_RV)
 writeLines(Report_RV)
 ```
 
-```{r RV plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline) used to query information from the Maritimes Research Vessel (RV) Trawl Survey. Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area'}
+```{r RV-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline) used to query information from the Maritimes Research Vessel (RV) Trawl Survey. Black lines and arrows indicate the location and direction of each bottom otter trawl sample. Frequency represents number of trawls in which a given species was sampled, relative to the total number of trawls within the search area'}
 if (!is.null(outputList)) {
 areaMap + geom_segment(aes(x = Samples_bbox$long, y = Samples_bbox$lat, xend = Samples_bbox$ELONG, yend = endy <- Samples_bbox$ELAT),arrow=arrow(length = unit(0.2,""cm"")), size = 0.5)
 }

---FILE: app/Rmd/report_habitat_EN.Rmd---
@@ -39,7 +39,7 @@ polyText <- if(is.null(clipped$studyData)){""There are no relevant records of pre
  writeLines(polyText)
 ```
 
-```{r rockweed plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.'}
+```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.'}
 if(!is.null(clipped$studyData)){print(
   plot_polygons(areaMap, bboxMap, studyBox_geom, clipped$mapData, attribute))}
 ```

---FILE: app/Rmd/report_habitat_FR.Rmd---
@@ -32,7 +32,7 @@ rockweed_result <- as.numeric(nrow(rockweed_intersect))
  writeLines(Query_output_rockweed)
 ```
 
-```{r rockweed plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.'}
+```{r rockweed-plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Figure shows overlap between the search area and satellite-based maps of intertidal vegetation and rockweed presence polygons.'}
 plot_rockweed <- function(rockweed_sf, areaMap, bboxMap) {
   
   # crop rockweed layer to the map area to speed up plotting

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -42,7 +42,7 @@ EBSA_location(EBSA_sf, studyArea)
 #function for bioregion
 EBSA_bioregion(EBSA_sf, studyArea)
 ```
-```{r overlap EBSA and plot, echo=FALSE, results='asis'}
+```{r overlap-EBSA-plot, echo=FALSE, results='asis'}
 # define polygon dataset and attribute to plot
 poly_sf <- EBSA_sf
 attribute <- ""NONE""
@@ -51,13 +51,13 @@ attribute <- ""NONE""
 clipped <- master_intersect(poly_sf, region, studyArea, bboxMap)
 ```
 
-```{r EBSA region plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA) relative to the search area defined by the user (red outline).'}
+```{r EBSA-region-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA) relative to the search area defined by the user (red outline).'}
 if (!is.null(clipped$regionData)){
   plot_polygons(regionMap, regionBox, studyBox_geom, clipped$regionData, attribute)
 }
 ```
 
-```{r EBSA area plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA) in the search area defined by the user (red outline).'}
+```{r EBSA-area-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA) in the search area defined by the user (red outline).'}
 if(!is.null(clipped$studyData)){print(
   plot_polygons(areaMap,bboxMap,studyBox_geom, clipped$mapData,attribute))}
 ```

---FILE: app/Rmd/report_planning_FR.Rmd---
@@ -19,6 +19,6 @@ Description de l’ensemble de données (tirée du dossier des données ouvertes
 
 **under-development**
 
-```{r EBSA plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA; pink) relative to the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue.'}
+```{r EBSA-plot, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA; pink) relative to the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue.'}
 #plot_EBSA(EBSA_sf, studyArea, land10m_sf, 300)
 ```

---FILE: tests/testthat/test_functions.R---
@@ -1,4 +1,5 @@
 library(testthat)
+library(here)
 context(""Function Tests"")
 
 ",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,52d0f0ce9cc32fcb68ca8a71cabd212893d0dee7,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T18:19:57Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T18:19:57Z,"fix duplicate chunk names, add spacing to functions",app/R/area_maps.R;app/R/fn_intersect_operations.R;app/Rmd/report_cetaceans_EN.Rmd,True,True,True,False,29,29,58,"---FILE: app/R/area_maps.R---
@@ -46,9 +46,9 @@ area_map <- function(studyArea, site, landLayer, bufKm, CANborder, studyBoxGeom)
   
   # configure the plot
   outPlot <- ggplot() + 
-    geom_sf(data=site, fill=""yellow"", col=""black"", size=0.6) +
-    geom_sf(data=bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1)+ # creates US boundary line, 200 nm limit
-    geom_sf(data=land, fill=c(""lightgrey""), col=""black"", size=0.7) +
+    geom_sf(data = site, fill = ""yellow"", col = ""black"", size = 0.6) +
+    geom_sf(data = bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1) + # creates US boundary line, 200 nm limit
+    geom_sf(data = land, fill = c(""lightgrey""), col = ""black"", size = 0.7) +
     eval(studyBoxGeom) 
   
   outPlot <- format_ggplot(outPlot, bboxBuf)
@@ -78,16 +78,16 @@ area_map <- function(studyArea, site, landLayer, bufKm, CANborder, studyBoxGeom)
 region_map <- function(regionBbox, studyArea, landLayer, CANborder) {
   
   # subset land to plot area to speed up plotting
-  land <- sf::st_crop(landLayer,regionBbox)
+  land <- sf::st_crop(landLayer, regionBbox)
   
   # subset US-Canad boundary to plot area to speed up plotting
-  bound <- sf::st_crop(CANborder,regionBbox)
+  bound <- sf::st_crop(CANborder, regionBbox)
   
   # configure the plot
   rawPlot <- ggplot() +
-    geom_sf(data=bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1) + # creates US boundary line, 200 nm limit
-    geom_sf(data=land,fill=c(""lightgrey""), col=""black"", size=0.7) +
-    geom_sf(data=studyArea, fill=NA, col=""red"", size=1)
+    geom_sf(data = bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1) + # creates US boundary line, 200 nm limit
+    geom_sf(data = land, fill = c(""lightgrey""), col = ""black"", size = 0.7) +
+    geom_sf(data = studyArea, fill = NA, col = ""red"", size = 1)
   
   outPlot <- format_ggplot(rawPlot, regionBbox)
   
@@ -103,11 +103,11 @@ region_map <- function(regionBbox, studyArea, landLayer, CANborder) {
 format_ggplot <- function(ggplotIn, bbox = FALSE) {
   
   ggplotOut <- ggplotIn + watermark(show = TRUE, lab = ""DFO Internal Use Only"")+
-    annotation_scale(location=""bl"")+
+    annotation_scale(location = ""bl"")+
     theme_bw()+
-    labs(x=expression(paste(""Longitude "", degree, ""W"", sep="""")),
-         y=expression(paste(""Latitude "", degree, ""N"", sep="""")),
-         col="""")  +
+    labs(x = expression(paste(""Longitude "", degree, ""W"", sep = """")),
+         y = expression(paste(""Latitude "", degree, ""N"", sep = """")),
+         col = """")  +
     theme(axis.title.y = element_text(size = 13))+
     theme(axis.title.x = element_text(size = 13))
   

---FILE: app/R/fn_intersect_operations.R---
@@ -172,7 +172,7 @@ poly_intersect <- function(datafile, region, studyArea, mapBbox, ...) {
 create_table_RV <- function(datafile, listed_table, speciestable, ...) {
 
   # calculate the number of unique sample locations
-  Samples_study_no <- dim(unique(datafile[,c(""geometry"")]))[1]
+  Samples_study_no <- dim(unique(datafile[, c(""geometry"")]))[1]
   # calculate a table of all species caught and
   # the total number of individuals caught.
   # Join to the species lookup table to get
@@ -186,22 +186,22 @@ create_table_RV <- function(datafile, listed_table, speciestable, ...) {
     x = list(Records = datafile$CODE),
     by = list(CODE = datafile$CODE),
     FUN = length)
-  datatable1 <- merge(individuals,datatable1, by = 'CODE')
+  datatable1 <- merge(individuals, datatable1, by = 'CODE')
 
   data1 <- merge(datafile,speciestable, by = 'CODE')
-  datatable1 <- merge(datatable1,speciestable, by = 'CODE')
+  datatable1 <- merge(datatable1, speciestable, by = 'CODE')
 
   # Merge the datafile with the listed_species table
   # and create a frequency table of all listed species
   # caught
-  data1 <- merge(data1,listed_table, by = 'Scientific Name')
+  data1 <- merge(data1, listed_table, by = 'Scientific Name')
   datatable2 <- aggregate(
     x = list(Records = data1$'Scientific Name'),
     by = list('Scientific Name' = data1$'Scientific Name'),
     length)
   # merge the frequency table with listed_table to get
   # the SARA and COSEWIC listings for each species
-  datatable2 <- merge(datatable2,listed_table, by = 'Scientific Name')
+  datatable2 <- merge(datatable2, listed_table, by = 'Scientific Name')
   # add a field for the number of samples
   datatable1$Samples <- Samples_study_no
   # combine the number of species records with number of samples
@@ -210,12 +210,12 @@ create_table_RV <- function(datafile, listed_table, speciestable, ...) {
                                             sep = ""/"", remove = FALSE)
 
   datatable1 <- dplyr::select(datatable1, ""Scientific Name"", ""Common Name"",
-                              Individuals,Frequency)
-  datatable2 <- merge(datatable2,datatable1, by = 'Scientific Name')
-  datatable2 <- dplyr::select(datatable2, ""Scientific Name"", Individuals,Frequency)
-  datatable2 <- merge(datatable2,listed_table, by = 'Scientific Name')
+                              Individuals, Frequency)
+  datatable2 <- merge(datatable2, datatable1, by = 'Scientific Name')
+  datatable2 <- dplyr::select(datatable2, ""Scientific Name"", Individuals, Frequency)
+  datatable2 <- merge(datatable2, listed_table, by = 'Scientific Name')
   datatable2 <- dplyr::select(datatable2, ""Scientific Name"", ""Common Name"",
-                              ""SARA status"",""COSEWIC status"",Individuals,Frequency)
+                              ""SARA status"", ""COSEWIC status"", Individuals, Frequency)
 
   # order the tables by number of individuals caught (decreasing)
   datatable1 <- datatable1[with(datatable1, order(-Individuals)), ]
@@ -248,22 +248,22 @@ create_table_MARFIS <- function(datafile, listed_table, speciestable, ...) {
     x = list(Records = datafile$SPECIES_CODE),
     by = list(SPECIES_CODE = datafile$SPECIES_CODE),
     FUN = length)
-  datatable1 <- merge(datatable1,speciestable, by = 'SPECIES_CODE')
+  datatable1 <- merge(datatable1, speciestable, by = 'SPECIES_CODE')
   datatable1 <- datatable1 %>% rename(""Common Name""= COMMONNAME)
-  data1 <- merge(datafile,speciestable, by = 'SPECIES_CODE')
+  data1 <- merge(datafile, speciestable, by = 'SPECIES_CODE')
   data1$Common_Name_MARFIS <- data1$COMMONNAME
 
   # Merge the datafile with the listed_species table
   # and create a frequency table of all listed species
   # caught
-  data1 <- merge(data1,listed_table, by = 'Common_Name_MARFIS')
+  data1 <- merge(data1, listed_table, by = 'Common_Name_MARFIS')
   # data1 <- data1 %>% rename(""SCIENTIFICNAME"" = Scientific_Name)
 
   datatable2 <- aggregate(
     x = list(Records = data1$'Scientific Name'),
     by = list('Scientific Name' = data1$'Scientific Name'),
     length)
-  datatable2 <- merge(datatable2,listed_table, by = 'Scientific Name')
+  datatable2 <- merge(datatable2, listed_table, by = 'Scientific Name')
 
 
 

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -157,15 +157,15 @@ An OBIS search [@OBIS] was conducted to find additional relevant records for cet
 
 #### ***Area-specific OBIS cetacean search results***
 
-```{r obis, include=FALSE, cache=FALSE}
+```{r obis cetecean, include=FALSE, cache=FALSE}
 outputList <- point_intersect(obis_cet_sf, studyArea, mapBbox = bboxMap)
 
 if (!is.null(outputList)) {
   obis_cet_points <- sfcoords_as_cols(outputList$mapData)
 }
 ```
 *
-```{r obis result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+```{r obis cetecean result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
 Report_obis_cet <-  if (is.null(outputList)) {
   ""There are no relevant records of cetaceans in the Ocean Biodiversity Information System (OBIS) for this search area.""
 } else {
@@ -174,7 +174,7 @@ Report_obis_cet <-  if (is.null(outputList)) {
 writeLines(Report_obis_cet)
 ```
 
-```{r obis plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
+```{r obis cetecean plot, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
 if (!is.null(outputList)) {
   areaMap+
     geom_point(data = obis_cet_points, aes(x = long, y = lat, color = Legend),",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,3a70e1c23a3d938d01c6ac293e603fc3c78516bd,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T13:05:53Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T13:05:53Z,clean up test functions and fix description comments,tests/testthat/help_functions_for_tests.R;tests/testthat/setup_testenv.R;tests/testthat/test_render.R,False,True,True,False,26,7,33,"---FILE: tests/testthat/help_functions_for_tests.R---
@@ -1,6 +1,7 @@
 # ----- RENDER CHECK DELETE -----
 # This function is used to ensure that an rmarkdown file can be run without error.
-# It will attempt to render the file, check if an output file was generated, and if so, delete the output file
+# It will attempt to render the file, check if an output file was generated, 
+# and if so, delete the output file
 #
 # Inputs:
 # 1. Section path: path to the Rmarkdown file.
@@ -36,9 +37,9 @@ render_check_delete <- function(sectionPath, deleteFile=TRUE) {
 # This function is used to load necessary data into the environment for testing.
 # Very similar to the initial chunks used in the first r markdown script.
 #
-# Inputs: test environment where output should be saved
+# Inputs: None
 #
-# Outputs: None
+# Outputs: list of variables to be loaded into the environment with list2env
 #
 # Developed by Quentin Stoyel, Summer 2021
 
@@ -50,7 +51,8 @@ load_test_data <- function() {
       load(here::here(""app/data/testData.RData""), envir = globalenv())
     }
     if (!exists(""add_buffer"")) {
-      lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source, local=globalenv())
+      lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", 
+                        full.names = TRUE), source, local=globalenv())
     }
     
     # select random sample area from test sample areas
@@ -86,6 +88,21 @@ load_test_data <- function() {
   }
 
 
+
+# ----- Catch all output -----
+# Helper function that can suppress all warnings, messages and output
+# Used to hide some the rmarkdown outputs when running tests as well as 
+# some of the expected warnings.
+#
+# Inputs: codeChunk, all code to be run. Use function to wrap code that requires
+#         output suppression.
+#
+# Outputs: None
+#
+# Developed by Quentin Stoyel, Summer 2021
+
+
+
 catch_all_output <- function(codeChunk) {
   suppressWarnings({
     utils::capture.output({

---FILE: tests/testthat/setup_testenv.R---
@@ -5,10 +5,11 @@ message(""Generate new test data set"")
 catch_all_output({
   # generate a new testData file
   source(here::here(""dataprocessing/MakeTestData.R""))
-  #gen_all_test_data()
+  gen_all_test_data()
   
   load(here::here(""app/data/testData.RData""), envir = globalenv())
-  lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE), source, local=globalenv())
+  lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"",
+                    full.names = TRUE), source, local=globalenv())
 })
 
 message(""Test data generation complete"")
\ No newline at end of file

---FILE: tests/testthat/test_render.R---
@@ -11,7 +11,8 @@ test_that(""render Intro"", {
   out_file <- here::here(""tests/temp/rmd_intro"")
  
   chk <- renderReport(
-    input = readRDS(here::here(""tests/testthat/input"")), # sample input from application, with no sections.
+    # use sample input from application, with no sections:
+    input = readRDS(here::here(""tests/testthat/input"")),
     geoms = studyArea,
     outFileName = out_file,
     dirIn = here::here(""app/Rmd""),",True,False,Documentation / Formatting,3
dfo-mar-odis,shinySpatialApp,6c447a49b921865db44922cfd66746e0f31c6244,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T12:52:00Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T12:52:00Z,readd plot_polygons after bug fix,app/R/plot_polygons.R,False,True,True,False,81,0,81,"---FILE: app/R/plot_polygons.R---
@@ -0,0 +1,81 @@
+
+# Function for plotting polygons for the reproducible report.
+#
+# Inputs:
+# 1. baseMap = map object, either areaMap or regionMap
+# 2. mapBbox: bbox object, representing bounding box of the map, bboxMap (for the areaMap) or regionBox (for regionMap)  
+# 3. studyBox_geom: geometry polygon with the area of interest (defined through shiny app and in the intro)
+# 4. polyData: polygon data to be plotted 
+#    (pre-clipped to map area with the poly_intersect function, using bboxMap, or regionBox)
+# 5. attribute: attribute in the polygon data to be plotted (column name as a string, e.g. ""Activity"", or ""Rockweed""; 
+#               this attribute name will appear in the legend. For single color polygons use attribute=""NONE"".
+# 6. legendName: string, sets the name of the legend for cases where the attribute is not appropriate. Defaults to
+#                the attribute.  
+#    
+# 
+# Examples of use:
+#
+#   To plot on region map: plot_polygons(regionMap, regionBox, studyBox_geom, data$regionPoly, attribute=""NONE"")
+#                          (only parameters to change are data$regionPoly and attribute)
+#
+#   To plot area map: plot_polygons(areaMap, bboxMap, studyBox_geom, data$regionPoly, attribute=""NONE"")
+#                          (only parameters to change are data$regionPoly and attribute)
+#
+# Created by Gordana Lazin, July 2, 2021 for reproducible reporting project
+
+
+plot_polygons <- function(baseMap, mapBbox, studyBox_geom, polyData, attribute, legendName=attribute) {
+  
+  clr = ""black"" #color for outlining polygons
+  
+  # this is part specific for rockweed, I included it in plotting for now
+  # Otherwise, it can be included in intersect function, or in pre-processing
+  if (attribute == ""RWP"") {
+    
+    # replace codes with words
+    polyData$Rockweed = """"
+    polyData$Rockweed[which(polyData$RWP==1)] = ""1-Present""
+    polyData$Rockweed[which(polyData$RWP==2)] = ""2-Likely Present""
+    polyData$Rockweed[which(polyData$RWP==5)] = ""5-Unknown""
+    polyData$Rockweed[which(polyData$RWP==0)] = ""Not Present""
+    
+    attribute = ""Rockweed""
+    clr = NA
+  }
+  
+  # axis limits to the plot
+  axLim = ggplot2::coord_sf(xlim=c(mapBbox[""xmin""], mapBbox[""xmax""]), 
+                            ylim=c(mapBbox[""ymin""], mapBbox[""ymax""]), expand=FALSE)
+  
+  # color-blind options for the legend
+  legendColor=c(""#009E73"", ""#E69F00"", ""#0072B2"", ""#CC79A7"", ""#F0E442"", 
+                ""#D55E00"", ""#56B4E9"",""#999999"", ""black"")
+  
+  
+  # there are two types of plots: 
+  # Case 1: all polygons are one color, no legend,
+  # case 2: polygons are colored based on the ""attribute"" column, legend is included
+  
+  if (toupper(attribute) == ""NONE"") { # Case 1: plotting all polygons in one color
+    
+    polyPlot <- geom_sf(data=polyData, fill=""#56B4E9"", col=clr)
+    polyFill <- NULL
+    
+  } else { # Case 2: plotting polygons in different colors based on ""attribute"" column in the data
+    
+    polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute)), colour=clr)
+    polyFill <- scale_fill_manual(values=legendColor, name=legendName) 
+    
+  }
+ 
+  # this is how general plotting function should look like
+    
+    polyMap <- baseMap +
+      polyPlot +
+      polyFill +
+      studyBox_geom +
+      axLim
+    
+    return(polyMap)
+  
+}
\ No newline at end of file",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,1cb94cf92d5f85ca4e47ce151784519f239909aa,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T12:51:06Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-08-11T12:51:06Z,fix plot_polygons bug,app/R/plot_polygons.R;app/R/plot_polygons.r,False,True,True,False,0,161,161,"---FILE: app/R/plot_polygons.R---
@@ -1,80 +0,0 @@
-
-# Function for plotting polygons for the reproducible report.
-#
-# Inputs:
-# 1. baseMap = map object, either areaMap or regionMap
-# 2. mapBox: bbox object, representing bounding box of the map, bboxMap (for the areaMap) or regionBox (for regionMap)  
-# 3. studyBox_geom: geometry polygon with the area of interest (defined through shiny app and in the intro)
-# 4. polyData: polygon data to be plotted 
-#    (pre-clipped to map area with the poly_intersect function, using bboxMap, or regionBox)
-# 5. attribute: attribute in the polygon data to be plotted (column name as a string, e.g. ""Activity"", or ""Rockweed""; 
-#               this attribute name will appear in the legend. For single color polygons use attribute=""NONE"".
-# 6. legendName: string, sets the name of the legend for cases where the attribute is not appropriate. Defaults to
-#                the attribute.  
-#    
-# 
-# Examples of use:
-#
-#   To plot on region map: plot_polygons(regionMap,regionBox,studyBox_geom, data$regionPoly,attribute=""NONE"")
-#                          (only parameters to change are data$regionPoly and attribute)
-#
-#   To plot area map: plot_polygons(areaMap,bboxMap,studyBox_geom, data$regionPoly,attribute=""NONE"")
-#                          (only parameters to change are data$regionPoly and attribute)
-#
-# Created by Gordana Lazin, July 2, 2021 for reproducible reporting project
-
-
-plot_polygons <- function(baseMap, mapBox, studyBox_geom, polyData, attribute, legendName=attribute){
-  
-  clr=""black"" #color for outlining polygons
-  
-  # this is part specific for rockweed, I included it in plotting for now
-  # Otherwise, it can be included in intersect function, or in pre-processing
-  if (attribute == ""RWP"") {
-    
-    # replace codes with words
-    polyData$Rockweed=""""
-    polyData$Rockweed[which(polyData$RWP==1)]=""1-Present""
-    polyData$Rockweed[which(polyData$RWP==2)]=""2-Likely Present""
-    polyData$Rockweed[which(polyData$RWP==5)]=""5-Unknown""
-    polyData$Rockweed[which(polyData$RWP==0)]=""Not Present""
-    
-    attribute=""Rockweed""
-    clr=NA
-  }
-  
-  # axis limits to the plot
-  axLim=ggplot2::coord_sf(xlim=c(mapBox[""xmin""], mapBox[""xmax""]),ylim=c(mapBox[""ymin""], mapBox[""ymax""]),expand=FALSE)
-  
-  # color-blind options for the legend
-  legendColor=c(""#009E73"", ""#E69F00"", ""#0072B2"", ""#CC79A7"",""#F0E442"",""#D55E00"",""#56B4E9"",""#999999"", ""black"")
-  
-  
-  # there are two types of plots: 
-  # Case 1: all polygons are one color, no legend,
-  # case 2: polygons are colored based on the ""attribute"" column, legend is included
-  
-  if (toupper(attribute)==""NONE""){ # Case 1: plotting all polygons in one color
-    
-    polyPlot <-geom_sf(data=polyData,fill=""#56B4E9"",col=clr)
-    polyFill=NULL
-    
-  }else{ # Case 2: plotting polygons in different colors based on ""attribute"" column in the data
-    
-    polyPlot<-geom_sf(data=polyData, aes(fill=!!sym(attribute)), colour=clr)
-    polyFill <-scale_fill_manual(values=legendColor, name=legendName) 
-    
-  }
-  
- 
-  # this is how general plotting function should look like
-    
-    polyMap <- baseMap+
-      polyPlot +
-      polyFill +
-      studyBox_geom +
-      axLim
-    
-    return(polyMap)
-  
-}
\ No newline at end of file

---FILE: app/R/plot_polygons.r---
@@ -1,81 +0,0 @@
-
-# Function for plotting polygons for the reproducible report.
-#
-# Inputs:
-# 1. baseMap = map object, either areaMap or regionMap
-# 2. mapBbox: bbox object, representing bounding box of the map, bboxMap (for the areaMap) or regionBox (for regionMap)  
-# 3. studyBox_geom: geometry polygon with the area of interest (defined through shiny app and in the intro)
-# 4. polyData: polygon data to be plotted 
-#    (pre-clipped to map area with the poly_intersect function, using bboxMap, or regionBox)
-# 5. attribute: attribute in the polygon data to be plotted (column name as a string, e.g. ""Activity"", or ""Rockweed""; 
-#               this attribute name will appear in the legend. For single color polygons use attribute=""NONE"".
-# 6. legendName: string, sets the name of the legend for cases where the attribute is not appropriate. Defaults to
-#                the attribute.  
-#    
-# 
-# Examples of use:
-#
-#   To plot on region map: plot_polygons(regionMap, regionBox, studyBox_geom, data$regionPoly, attribute=""NONE"")
-#                          (only parameters to change are data$regionPoly and attribute)
-#
-#   To plot area map: plot_polygons(areaMap, bboxMap, studyBox_geom, data$regionPoly, attribute=""NONE"")
-#                          (only parameters to change are data$regionPoly and attribute)
-#
-# Created by Gordana Lazin, July 2, 2021 for reproducible reporting project
-
-
-plot_polygons <- function(baseMap, mapBbox, studyBox_geom, polyData, attribute, legendName=attribute) {
-  
-  clr = ""black"" #color for outlining polygons
-  
-  # this is part specific for rockweed, I included it in plotting for now
-  # Otherwise, it can be included in intersect function, or in pre-processing
-  if (attribute == ""RWP"") {
-    
-    # replace codes with words
-    polyData$Rockweed = """"
-    polyData$Rockweed[which(polyData$RWP==1)] = ""1-Present""
-    polyData$Rockweed[which(polyData$RWP==2)] = ""2-Likely Present""
-    polyData$Rockweed[which(polyData$RWP==5)] = ""5-Unknown""
-    polyData$Rockweed[which(polyData$RWP==0)] = ""Not Present""
-    
-    attribute = ""Rockweed""
-    clr = NA
-  }
-  
-  # axis limits to the plot
-  axLim = ggplot2::coord_sf(xlim=c(mapBbox[""xmin""], mapBbox[""xmax""]), 
-                            ylim=c(mapBbox[""ymin""], mapBbox[""ymax""]), expand=FALSE)
-  
-  # color-blind options for the legend
-  legendColor=c(""#009E73"", ""#E69F00"", ""#0072B2"", ""#CC79A7"", ""#F0E442"", 
-                ""#D55E00"", ""#56B4E9"",""#999999"", ""black"")
-  
-  
-  # there are two types of plots: 
-  # Case 1: all polygons are one color, no legend,
-  # case 2: polygons are colored based on the ""attribute"" column, legend is included
-  
-  if (toupper(attribute) == ""NONE"") { # Case 1: plotting all polygons in one color
-    
-    polyPlot <- geom_sf(data=polyData, fill=""#56B4E9"", col=clr)
-    polyFill <- NULL
-    
-  } else { # Case 2: plotting polygons in different colors based on ""attribute"" column in the data
-    
-    polyPlot <- geom_sf(data=polyData, aes(fill=!!sym(attribute)), colour=clr)
-    polyFill <- scale_fill_manual(values=legendColor, name=legendName) 
-    
-  }
- 
-  # this is how general plotting function should look like
-    
-    polyMap <- baseMap +
-      polyPlot +
-      polyFill +
-      studyBox_geom +
-      axLim
-    
-    return(polyMap)
-  
-}
\ No newline at end of file",True,False,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,5eb76557ac854cb35a179da1a4147f966763fd16,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-07-23T13:25:03Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-07-23T13:25:03Z,Quentin set up Renvironment to avoid issues with different versions of packages!,.Rprofile;renv.lock,False,False,False,False,1415,0,1415,"---FILE: .Rprofile---
@@ -0,0 +1 @@
+source(""renv/activate.R"")

---FILE: renv.lock---
@@ -0,0 +1,1414 @@
+{
+  ""R"": {
+    ""Version"": ""4.0.2"",
+    ""Repositories"": [
+      {
+        ""Name"": ""CRAN"",
+        ""URL"": ""https://cran.rstudio.com""
+      }
+    ]
+  },
+  ""Packages"": {
+    ""BH"": {
+      ""Package"": ""BH"",
+      ""Version"": ""1.75.0-0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e4c04affc2cac20c8fec18385cd14691""
+    },
+    ""DBI"": {
+      ""Package"": ""DBI"",
+      ""Version"": ""1.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""030aaec5bc6553f35347cbb1e70b1a17""
+    },
+    ""DiagrammeR"": {
+      ""Package"": ""DiagrammeR"",
+      ""Version"": ""1.0.6.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3cb13b97961593b4a1ed0c8e37df9d9b""
+    },
+    ""KernSmooth"": {
+      ""Package"": ""KernSmooth"",
+      ""Version"": ""2.23-17"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bbff70c8c0357b5b88238c83f680fcd3""
+    },
+    ""MASS"": {
+      ""Package"": ""MASS"",
+      ""Version"": ""7.3-53.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4ef21dd0348b9abb7f8bd1d77e4cd0c3""
+    },
+    ""Mar.data"": {
+      ""Package"": ""Mar.data"",
+      ""Version"": ""2020.11.23"",
+      ""Source"": ""GitHub"",
+      ""RemoteType"": ""github"",
+      ""RemoteHost"": ""api.github.com"",
+      ""RemoteRepo"": ""Mar.data"",
+      ""RemoteUsername"": ""Maritimes"",
+      ""RemoteRef"": ""HEAD"",
+      ""RemoteSha"": ""978b18f8f67acc74d14149b0a3287feead46a3a4"",
+      ""Hash"": ""cb6df22f30b4e3cc2eccd657fe6c3d5f""
+    },
+    ""Mar.datawrangling"": {
+      ""Package"": ""Mar.datawrangling"",
+      ""Version"": ""2021.02.05"",
+      ""Source"": ""GitHub"",
+      ""Remotes"": ""Maritimes/Mar.utils, Maritimes/Mar.data"",
+      ""RemoteType"": ""github"",
+      ""RemoteHost"": ""api.github.com"",
+      ""RemoteRepo"": ""Mar.datawrangling"",
+      ""RemoteUsername"": ""Maritimes"",
+      ""RemoteRef"": ""HEAD"",
+      ""RemoteSha"": ""9dee59442b98bf213960134490f929dff67e39d2"",
+      ""Hash"": ""3de7815e34e4ed0345a80da07acd6416""
+    },
+    ""Mar.utils"": {
+      ""Package"": ""Mar.utils"",
+      ""Version"": ""2021.02.05"",
+      ""Source"": ""GitHub"",
+      ""Remotes"": ""Maritimes/Mar.data"",
+      ""RemoteType"": ""github"",
+      ""RemoteHost"": ""api.github.com"",
+      ""RemoteRepo"": ""Mar.utils"",
+      ""RemoteUsername"": ""Maritimes"",
+      ""RemoteRef"": ""HEAD"",
+      ""RemoteSha"": ""56ea3917069186227631162ab288dacc72722f39"",
+      ""Hash"": ""ceb4c224e91831a893a2c29641887580""
+    },
+    ""Matrix"": {
+      ""Package"": ""Matrix"",
+      ""Version"": ""1.2-18"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""08588806cba69f04797dab50627428ed""
+    },
+    ""MatrixModels"": {
+      ""Package"": ""MatrixModels"",
+      ""Version"": ""0.4-1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d57ac35220b39c591388ab3a080f9cbe""
+    },
+    ""PBSmapping"": {
+      ""Package"": ""PBSmapping"",
+      ""Version"": ""2.73.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""55cb7d9bb97ea2b503ac63d2a2ea8c2f""
+    },
+    ""R6"": {
+      ""Package"": ""R6"",
+      ""Version"": ""2.5.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b203113193e70978a696b2809525649d""
+    },
+    ""RColorBrewer"": {
+      ""Package"": ""RColorBrewer"",
+      ""Version"": ""1.1-2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e031418365a7f7a766181ab5a41a5716""
+    },
+    ""Rcpp"": {
+      ""Package"": ""Rcpp"",
+      ""Version"": ""1.0.6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""dbb5e436998a7eba5a9d682060533338""
+    },
+    ""RcppArmadillo"": {
+      ""Package"": ""RcppArmadillo"",
+      ""Version"": ""0.10.2.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a2de53472129933a29975e7cfa3ffe28""
+    },
+    ""RcppEigen"": {
+      ""Package"": ""RcppEigen"",
+      ""Version"": ""0.3.3.9.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ddfa72a87fdf4c80466a20818be91d00""
+    },
+    ""Rttf2pt1"": {
+      ""Package"": ""Rttf2pt1"",
+      ""Version"": ""1.3.8"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""8c4137a9ab70de4787d57758f8190617""
+    },
+    ""SparseM"": {
+      ""Package"": ""SparseM"",
+      ""Version"": ""1.81"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2042cd9759cc89a453c4aefef0ce9aae""
+    },
+    ""XML"": {
+      ""Package"": ""XML"",
+      ""Version"": ""3.99-0.5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""408d42d1359f2a84d377c1f7f0568624""
+    },
+    ""abind"": {
+      ""Package"": ""abind"",
+      ""Version"": ""1.4-5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4f57884290cc75ab22f4af9e9d4ca862""
+    },
+    ""askpass"": {
+      ""Package"": ""askpass"",
+      ""Version"": ""1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e8a22846fff485f0be3770c2da758713""
+    },
+    ""assertthat"": {
+      ""Package"": ""assertthat"",
+      ""Version"": ""0.2.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""50c838a310445e954bc13f26f26a6ecf""
+    },
+    ""backports"": {
+      ""Package"": ""backports"",
+      ""Version"": ""1.2.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""644043219fc24e190c2f620c1a380a69""
+    },
+    ""base64enc"": {
+      ""Package"": ""base64enc"",
+      ""Version"": ""0.1-3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""543776ae6848fde2f48ff3816d0628bc""
+    },
+    ""blob"": {
+      ""Package"": ""blob"",
+      ""Version"": ""1.2.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""9addc7e2c5954eca5719928131fed98c""
+    },
+    ""bookdown"": {
+      ""Package"": ""bookdown"",
+      ""Version"": ""0.21"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""1bf627f1f77313e345f71e779b658578""
+    },
+    ""boot"": {
+      ""Package"": ""boot"",
+      ""Version"": ""1.3-25"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bd51734a754b6c2baf28b2d1ebc11e91""
+    },
+    ""brew"": {
+      ""Package"": ""brew"",
+      ""Version"": ""1.0-6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""92a5f887f9ae3035ac7afde22ba73ee9""
+    },
+    ""broom"": {
+      ""Package"": ""broom"",
+      ""Version"": ""0.7.5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d5ab8846336cfb2e3c17e5a806eb3045""
+    },
+    ""bslib"": {
+      ""Package"": ""bslib"",
+      ""Version"": ""0.2.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4830a372b241d78ed6f53731ee3023ac""
+    },
+    ""cachem"": {
+      ""Package"": ""cachem"",
+      ""Version"": ""1.0.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2703a46dcabfb902f10060b2bca9f708""
+    },
+    ""callr"": {
+      ""Package"": ""callr"",
+      ""Version"": ""3.7.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""461aa75a11ce2400245190ef5d3995df""
+    },
+    ""car"": {
+      ""Package"": ""car"",
+      ""Version"": ""3.0-10"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""12d8cdaf73c30b8c8cb7a22591a3f57d""
+    },
+    ""carData"": {
+      ""Package"": ""carData"",
+      ""Version"": ""3.0-4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""7ff5c94cec207b3fd9774cfaa5157738""
+    },
+    ""cellranger"": {
+      ""Package"": ""cellranger"",
+      ""Version"": ""1.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""f61dbaec772ccd2e17705c1e872e9e7c""
+    },
+    ""class"": {
+      ""Package"": ""class"",
+      ""Version"": ""7.3-17"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""9267f5dab59a4ef44229858a142bded1""
+    },
+    ""classInt"": {
+      ""Package"": ""classInt"",
+      ""Version"": ""0.4-3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""17bdfa3c51df4a6c82484d13b11fb380""
+    },
+    ""cli"": {
+      ""Package"": ""cli"",
+      ""Version"": ""2.3.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3e3f28efcadfda442cd18651fbcbbecf""
+    },
+    ""clipr"": {
+      ""Package"": ""clipr"",
+      ""Version"": ""0.7.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ebaa97ac99cc2daf04e77eecc7b781d7""
+    },
+    ""colorspace"": {
+      ""Package"": ""colorspace"",
+      ""Version"": ""2.0-0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""abea3384649ef37f60ef51ce002f3547""
+    },
+    ""commonmark"": {
+      ""Package"": ""commonmark"",
+      ""Version"": ""1.7"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""0f22be39ec1d141fd03683c06f3a6e67""
+    },
+    ""conquer"": {
+      ""Package"": ""conquer"",
+      ""Version"": ""1.0.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a31720f692920e635ecef0481d478247""
+    },
+    ""corrplot"": {
+      ""Package"": ""corrplot"",
+      ""Version"": ""0.84"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b55c32ae818a84109a51f172290c95f2""
+    },
+    ""cowplot"": {
+      ""Package"": ""cowplot"",
+      ""Version"": ""1.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b418e8423699d11c7f2087c2bfd07da2""
+    },
+    ""cpp11"": {
+      ""Package"": ""cpp11"",
+      ""Version"": ""0.2.6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""f08909ebdad90b19d8d3930da4220564""
+    },
+    ""crayon"": {
+      ""Package"": ""crayon"",
+      ""Version"": ""1.4.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e75525c55c70e5f4f78c9960a4b402e9""
+    },
+    ""crosstalk"": {
+      ""Package"": ""crosstalk"",
+      ""Version"": ""1.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2b06f9e415a62b6762e4b8098d2aecbc""
+    },
+    ""curl"": {
+      ""Package"": ""curl"",
+      ""Version"": ""4.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2b7d10581cc730804e9ed178c8374bd6""
+    },
+    ""data.table"": {
+      ""Package"": ""data.table"",
+      ""Version"": ""1.14.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d1b8b1a821ee564a3515fa6c6d5c52dc""
+    },
+    ""dbplyr"": {
+      ""Package"": ""dbplyr"",
+      ""Version"": ""2.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""f30247ffeeebe8d9842dc68fe63e043b""
+    },
+    ""digest"": {
+      ""Package"": ""digest"",
+      ""Version"": ""0.6.27"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a0cbe758a531d054b537d16dff4d58a1""
+    },
+    ""downloader"": {
+      ""Package"": ""downloader"",
+      ""Version"": ""0.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""f4f2a915e0dedbdf016a83b63477349f""
+    },
+    ""dplyr"": {
+      ""Package"": ""dplyr"",
+      ""Version"": ""1.0.5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d0d76c11ec807eb3f000eba4e3eb0f68""
+    },
+    ""e1071"": {
+      ""Package"": ""e1071"",
+      ""Version"": ""1.7-4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""7e9462e3e3e565f51fbec181dfcab890""
+    },
+    ""ellipsis"": {
+      ""Package"": ""ellipsis"",
+      ""Version"": ""0.3.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""fd2844b3a43ae2d27e70ece2df1b4e2a""
+    },
+    ""evaluate"": {
+      ""Package"": ""evaluate"",
+      ""Version"": ""0.14"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ec8ca05cffcc70569eaaad8469d2a3a7""
+    },
+    ""extrafont"": {
+      ""Package"": ""extrafont"",
+      ""Version"": ""0.17"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""7f2f50e8f998a4bea4b04650fc4f2ca8""
+    },
+    ""extrafontdb"": {
+      ""Package"": ""extrafontdb"",
+      ""Version"": ""1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a861555ddec7451c653b40e713166c6f""
+    },
+    ""fansi"": {
+      ""Package"": ""fansi"",
+      ""Version"": ""0.4.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""fea074fb67fe4c25d47ad09087da847d""
+    },
+    ""farver"": {
+      ""Package"": ""farver"",
+      ""Version"": ""2.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c98eb5133d9cb9e1622b8691487f11bb""
+    },
+    ""fastmap"": {
+      ""Package"": ""fastmap"",
+      ""Version"": ""1.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""77bd60a6157420d4ffa93b27cf6a58b8""
+    },
+    ""forcats"": {
+      ""Package"": ""forcats"",
+      ""Version"": ""0.5.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""81c3244cab67468aac4c60550832655d""
+    },
+    ""foreign"": {
+      ""Package"": ""foreign"",
+      ""Version"": ""0.8-81"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""74628ea7a3be5ee8a7b5bb0a8e84882e""
+    },
+    ""fs"": {
+      ""Package"": ""fs"",
+      ""Version"": ""1.5.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""44594a07a42e5f91fac9f93fda6d0109""
+    },
+    ""generics"": {
+      ""Package"": ""generics"",
+      ""Version"": ""0.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4d243a9c10b00589889fe32314ffd902""
+    },
+    ""geosphere"": {
+      ""Package"": ""geosphere"",
+      ""Version"": ""1.5-10"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""eee36211f74e4dbc80eae9d504b58f0b""
+    },
+    ""ggplot2"": {
+      ""Package"": ""ggplot2"",
+      ""Version"": ""3.3.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3eb6477d01eb5bbdc03f7d5f70f2733e""
+    },
+    ""ggpubr"": {
+      ""Package"": ""ggpubr"",
+      ""Version"": ""0.4.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""77089557d374c69db7cb77e65f0d6ab0""
+    },
+    ""ggrepel"": {
+      ""Package"": ""ggrepel"",
+      ""Version"": ""0.9.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""08ab869f37e6a7741a64ab9069bcb67d""
+    },
+    ""ggsci"": {
+      ""Package"": ""ggsci"",
+      ""Version"": ""2.9"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""81ccb8213ed592598210afd10c3a5936""
+    },
+    ""ggsignif"": {
+      ""Package"": ""ggsignif"",
+      ""Version"": ""0.6.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6770aac2203800889cccd6aee7f206a7""
+    },
+    ""ggspatial"": {
+      ""Package"": ""ggspatial"",
+      ""Version"": ""1.1.5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a04dadf9f113eaa67c179ec7011034e7""
+    },
+    ""glue"": {
+      ""Package"": ""glue"",
+      ""Version"": ""1.4.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6efd734b14c6471cfe443345f3e35e29""
+    },
+    ""gridExtra"": {
+      ""Package"": ""gridExtra"",
+      ""Version"": ""2.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""7d7f283939f563670a697165b2cf5560""
+    },
+    ""gtable"": {
+      ""Package"": ""gtable"",
+      ""Version"": ""0.3.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ac5c6baf7822ce8732b343f14c072c4d""
+    },
+    ""haven"": {
+      ""Package"": ""haven"",
+      ""Version"": ""2.3.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""221d0ad75dfa03ebf17b1a4cc5c31dfc""
+    },
+    ""highr"": {
+      ""Package"": ""highr"",
+      ""Version"": ""0.8"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4dc5bb88961e347a0f4d8aad597cbfac""
+    },
+    ""hms"": {
+      ""Package"": ""hms"",
+      ""Version"": ""1.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bf552cdd96f5969873afdac7311c7d0d""
+    },
+    ""htmltools"": {
+      ""Package"": ""htmltools"",
+      ""Version"": ""0.5.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""af2c2531e55df5cf230c4b5444fc973c""
+    },
+    ""htmlwidgets"": {
+      ""Package"": ""htmlwidgets"",
+      ""Version"": ""1.5.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6fdaa86d0700f8b3e92ee3c445a5a10d""
+    },
+    ""httpuv"": {
+      ""Package"": ""httpuv"",
+      ""Version"": ""1.5.5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b9d5d39be2150cf86538b8488334b8f8""
+    },
+    ""httr"": {
+      ""Package"": ""httr"",
+      ""Version"": ""1.4.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a525aba14184fec243f9eaec62fbed43""
+    },
+    ""huxtable"": {
+      ""Package"": ""huxtable"",
+      ""Version"": ""5.2.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""be37eec356a71f62f209dd04d94122ed""
+    },
+    ""igraph"": {
+      ""Package"": ""igraph"",
+      ""Version"": ""1.2.6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""7b1f856410253d56ea67ad808f7cdff6""
+    },
+    ""influenceR"": {
+      ""Package"": ""influenceR"",
+      ""Version"": ""0.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""611f9a55ad32ccfa17ccbd77be7a2804""
+    },
+    ""isoband"": {
+      ""Package"": ""isoband"",
+      ""Version"": ""0.2.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b2008df40fb297e3fef135c7e8eeec1a""
+    },
+    ""jpeg"": {
+      ""Package"": ""jpeg"",
+      ""Version"": ""0.1-8.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bc316c003aba520fc73d70ad53b5fc36""
+    },
+    ""jquerylib"": {
+      ""Package"": ""jquerylib"",
+      ""Version"": ""0.1.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""5ff50b36f7f0832f8421745af333e73c""
+    },
+    ""jsonlite"": {
+      ""Package"": ""jsonlite"",
+      ""Version"": ""1.7.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""98138e0994d41508c7a6b84a0600cfcb""
+    },
+    ""kableExtra"": {
+      ""Package"": ""kableExtra"",
+      ""Version"": ""1.3.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""49b625e6aabe4c5f091f5850aba8ff78""
+    },
+    ""knitr"": {
+      ""Package"": ""knitr"",
+      ""Version"": ""1.31"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c3994c036d19fc22c5e2a209c8298bfb""
+    },
+    ""labeling"": {
+      ""Package"": ""labeling"",
+      ""Version"": ""0.4.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3d5108641f47470611a32d0bdf357a72""
+    },
+    ""later"": {
+      ""Package"": ""later"",
+      ""Version"": ""1.1.0.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d0a62b247165aabf397fded504660d8a""
+    },
+    ""lattice"": {
+      ""Package"": ""lattice"",
+      ""Version"": ""0.20-41"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""fbd9285028b0263d76d18c95ae51a53d""
+    },
+    ""lazyeval"": {
+      ""Package"": ""lazyeval"",
+      ""Version"": ""0.2.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d908914ae53b04d4c0c0fd72ecc35370""
+    },
+    ""leafem"": {
+      ""Package"": ""leafem"",
+      ""Version"": ""0.1.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""18b3d2513d60498a319425d07a7e7afa""
+    },
+    ""leaflet"": {
+      ""Package"": ""leaflet"",
+      ""Version"": ""2.0.4.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e3d73becdeb92754d27172d278cbf61d""
+    },
+    ""leaflet.extras"": {
+      ""Package"": ""leaflet.extras"",
+      ""Version"": ""1.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""8dbfc2c4d7ca2660971caf1153ca95c2""
+    },
+    ""leaflet.providers"": {
+      ""Package"": ""leaflet.providers"",
+      ""Version"": ""1.9.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d3082a7beac4a1aeb96100ff06265d7e""
+    },
+    ""leafpm"": {
+      ""Package"": ""leafpm"",
+      ""Version"": ""0.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""12c6f3299c29d5ae1230ed63d1c81c1e""
+    },
+    ""leafpop"": {
+      ""Package"": ""leafpop"",
+      ""Version"": ""0.0.6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""62e4b96689f42b8674c3bbcfeef2b689""
+    },
+    ""lifecycle"": {
+      ""Package"": ""lifecycle"",
+      ""Version"": ""1.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3471fb65971f1a7b2d4ae7848cf2db8d""
+    },
+    ""lme4"": {
+      ""Package"": ""lme4"",
+      ""Version"": ""1.1-26"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""5f2466f5127e0ce67e44bb381387eeca""
+    },
+    ""lubridate"": {
+      ""Package"": ""lubridate"",
+      ""Version"": ""1.7.9.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""5b5b02f621d39a499def7923a5aee746""
+    },
+    ""lwgeom"": {
+      ""Package"": ""lwgeom"",
+      ""Version"": ""0.2-5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""cf96b08482dfbed1b7ab7d0ba4395077""
+    },
+    ""magick"": {
+      ""Package"": ""magick"",
+      ""Version"": ""2.6.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ffc87958461a1d2a5ec4b36035b87b94""
+    },
+    ""magrittr"": {
+      ""Package"": ""magrittr"",
+      ""Version"": ""2.0.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""41287f1ac7d28a92f0a286ed507928d3""
+    },
+    ""mapedit"": {
+      ""Package"": ""mapedit"",
+      ""Version"": ""0.6.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""398b8cbf8d03283f0a1015ff0a1b4a4d""
+    },
+    ""maps"": {
+      ""Package"": ""maps"",
+      ""Version"": ""3.3.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""392212982257ea03c37b63547dc871b4""
+    },
+    ""maptools"": {
+      ""Package"": ""maptools"",
+      ""Version"": ""1.1-1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""beef5712326b384b1e87ba10c01e18f5""
+    },
+    ""mapview"": {
+      ""Package"": ""mapview"",
+      ""Version"": ""2.9.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""8ae7dbd287c2c5f3ca8582c3d575c577""
+    },
+    ""markdown"": {
+      ""Package"": ""markdown"",
+      ""Version"": ""1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""61e4a10781dd00d7d81dd06ca9b94e95""
+    },
+    ""matrixStats"": {
+      ""Package"": ""matrixStats"",
+      ""Version"": ""0.58.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c318d148056e5bb8d7de79b0876f9ae6""
+    },
+    ""memoise"": {
+      ""Package"": ""memoise"",
+      ""Version"": ""2.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a0bc51650201a56d00a4798523cc91b3""
+    },
+    ""mgcv"": {
+      ""Package"": ""mgcv"",
+      ""Version"": ""1.8-31"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4bb7e0c4f3557583e1e8d3c9ffb8ba5c""
+    },
+    ""mime"": {
+      ""Package"": ""mime"",
+      ""Version"": ""0.10"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""26fa77e707223e1ce042b2b5d09993dc""
+    },
+    ""miniUI"": {
+      ""Package"": ""miniUI"",
+      ""Version"": ""0.1.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""fec5f52652d60615fdb3957b3d74324a""
+    },
+    ""minqa"": {
+      ""Package"": ""minqa"",
+      ""Version"": ""1.2.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""eaee7d2a6f3ed4491df868611cb064cc""
+    },
+    ""modelr"": {
+      ""Package"": ""modelr"",
+      ""Version"": ""0.1.8"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""9fd59716311ee82cba83dc2826fc5577""
+    },
+    ""munsell"": {
+      ""Package"": ""munsell"",
+      ""Version"": ""0.5.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6dfe8bf774944bd5595785e3229d8771""
+    },
+    ""nlme"": {
+      ""Package"": ""nlme"",
+      ""Version"": ""3.1-148"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""662f52871983ff3e3ef042c62de126df""
+    },
+    ""nloptr"": {
+      ""Package"": ""nloptr"",
+      ""Version"": ""1.2.2.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2737faeee353704efec5afa1e943dd64""
+    },
+    ""nnet"": {
+      ""Package"": ""nnet"",
+      ""Version"": ""7.3-14"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""0d87e50e11394a7151a28873637d799a""
+    },
+    ""numDeriv"": {
+      ""Package"": ""numDeriv"",
+      ""Version"": ""2016.8-1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""df58958f293b166e4ab885ebcad90e02""
+    },
+    ""openssl"": {
+      ""Package"": ""openssl"",
+      ""Version"": ""1.4.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a399e4773075fc2375b71f45fca186c4""
+    },
+    ""openxlsx"": {
+      ""Package"": ""openxlsx"",
+      ""Version"": ""4.2.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2253a430965e222d11a2f9277cd34c2e""
+    },
+    ""pbkrtest"": {
+      ""Package"": ""pbkrtest"",
+      ""Version"": ""0.5-0.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e4c9df9e478e08a32c27a406ce8fba90""
+    },
+    ""pillar"": {
+      ""Package"": ""pillar"",
+      ""Version"": ""1.5.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""24622aa4a0d3de3463c34513edca99b2""
+    },
+    ""pkgconfig"": {
+      ""Package"": ""pkgconfig"",
+      ""Version"": ""2.0.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""01f28d4278f15c76cddbea05899c5d6f""
+    },
+    ""plyr"": {
+      ""Package"": ""plyr"",
+      ""Version"": ""1.8.6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ec0e5ab4e5f851f6ef32cd1d1984957f""
+    },
+    ""png"": {
+      ""Package"": ""png"",
+      ""Version"": ""0.1-7"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""03b7076c234cb3331288919983326c55""
+    },
+    ""polynom"": {
+      ""Package"": ""polynom"",
+      ""Version"": ""1.4-0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c396592ecfe9e75cee1013533efafe34""
+    },
+    ""prettymapr"": {
+      ""Package"": ""prettymapr"",
+      ""Version"": ""0.2.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""670de2201dfef54ca3d43ae91d3f8df5""
+    },
+    ""prettyunits"": {
+      ""Package"": ""prettyunits"",
+      ""Version"": ""1.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""95ef9167b75dde9d2ccc3c7528393e7e""
+    },
+    ""processx"": {
+      ""Package"": ""processx"",
+      ""Version"": ""3.5.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""5ee87b05936a4aa9d8d026eb1a51314b""
+    },
+    ""progress"": {
+      ""Package"": ""progress"",
+      ""Version"": ""1.2.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""14dc9f7a3c91ebb14ec5bb9208a07061""
+    },
+    ""promises"": {
+      ""Package"": ""promises"",
+      ""Version"": ""1.2.0.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4ab2c43adb4d4699cf3690acd378d75d""
+    },
+    ""ps"": {
+      ""Package"": ""ps"",
+      ""Version"": ""1.6.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""32620e2001c1dce1af49c49dccbb9420""
+    },
+    ""purrr"": {
+      ""Package"": ""purrr"",
+      ""Version"": ""0.3.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""97def703420c8ab10d8f0e6c72101e02""
+    },
+    ""quantreg"": {
+      ""Package"": ""quantreg"",
+      ""Version"": ""5.85"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d41a5849071941c6c269b57324515398""
+    },
+    ""rJava"": {
+      ""Package"": ""rJava"",
+      ""Version"": ""0.9-13"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""cfcca6464c6d145e28924800b5bd7f44""
+    },
+    ""rappdirs"": {
+      ""Package"": ""rappdirs"",
+      ""Version"": ""0.3.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""5e3c5dc0b071b21fa128676560dbe94d""
+    },
+    ""raster"": {
+      ""Package"": ""raster"",
+      ""Version"": ""3.4-5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a3ded548110163cf499d63c3932dd499""
+    },
+    ""readr"": {
+      ""Package"": ""readr"",
+      ""Version"": ""1.4.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2639976851f71f330264a9c9c3d43a61""
+    },
+    ""readxl"": {
+      ""Package"": ""readxl"",
+      ""Version"": ""1.3.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""63537c483c2dbec8d9e3183b3735254a""
+    },
+    ""rematch"": {
+      ""Package"": ""rematch"",
+      ""Version"": ""1.0.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c66b930d20bb6d858cd18e1cebcfae5c""
+    },
+    ""renv"": {
+      ""Package"": ""renv"",
+      ""Version"": ""0.14.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""30e5eba91b67f7f4d75d31de14bbfbdc""
+    },
+    ""reprex"": {
+      ""Package"": ""reprex"",
+      ""Version"": ""1.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""cb4d6f77f163b8d685833f2a59e7cb4c""
+    },
+    ""reshape2"": {
+      ""Package"": ""reshape2"",
+      ""Version"": ""1.4.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bb5996d0bd962d214a11140d77589917""
+    },
+    ""rgdal"": {
+      ""Package"": ""rgdal"",
+      ""Version"": ""1.5-23"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bb6f643247d35c947e9f113567e2bf7a""
+    },
+    ""rgeos"": {
+      ""Package"": ""rgeos"",
+      ""Version"": ""0.5-5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""94a44c3f0d49ceb80c385610696873ca""
+    },
+    ""rio"": {
+      ""Package"": ""rio"",
+      ""Version"": ""0.5.16"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4a9aecbe83639be364de13ffe0671bcf""
+    },
+    ""rjson"": {
+      ""Package"": ""rjson"",
+      ""Version"": ""0.2.20"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""7d597f982ee6263716b6a2f28efd29fa""
+    },
+    ""rlang"": {
+      ""Package"": ""rlang"",
+      ""Version"": ""0.4.10"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""599df23c40a4fce9c7b4764f28c37857""
+    },
+    ""rmarkdown"": {
+      ""Package"": ""rmarkdown"",
+      ""Version"": ""2.7"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""edbf4cb1aefae783fd8d3a008ae51943""
+    },
+    ""rosm"": {
+      ""Package"": ""rosm"",
+      ""Version"": ""0.2.5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2d44e9bbfe7aff5acb7583482be4096d""
+    },
+    ""rstatix"": {
+      ""Package"": ""rstatix"",
+      ""Version"": ""0.7.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""aa020f8efde649badd0b2b5456e942fe""
+    },
+    ""rstudioapi"": {
+      ""Package"": ""rstudioapi"",
+      ""Version"": ""0.13"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""06c85365a03fdaf699966cc1d3cf53ea""
+    },
+    ""rvest"": {
+      ""Package"": ""rvest"",
+      ""Version"": ""1.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""74b905b0076e1de6e27f540c95ba68d5""
+    },
+    ""sass"": {
+      ""Package"": ""sass"",
+      ""Version"": ""0.3.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3ef1adfe46b7b144b970d74ce33ab0d6""
+    },
+    ""satellite"": {
+      ""Package"": ""satellite"",
+      ""Version"": ""1.0.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ee6f12377077643b0822de5130a9f597""
+    },
+    ""scales"": {
+      ""Package"": ""scales"",
+      ""Version"": ""1.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6f76f71042411426ec8df6c54f34e6dd""
+    },
+    ""selectr"": {
+      ""Package"": ""selectr"",
+      ""Version"": ""0.4-2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3838071b66e0c566d55cc26bd6e27bf4""
+    },
+    ""sf"": {
+      ""Package"": ""sf"",
+      ""Version"": ""0.9-7"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""9d6831c4c002137d99be6b946ac9da07""
+    },
+    ""shiny"": {
+      ""Package"": ""shiny"",
+      ""Version"": ""1.6.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6e3b6ae7fe02b5859e4bb277f218b8ae""
+    },
+    ""shinyjs"": {
+      ""Package"": ""shinyjs"",
+      ""Version"": ""2.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""9ddfc91d4280eaa34c2103951538976f""
+    },
+    ""sourcetools"": {
+      ""Package"": ""sourcetools"",
+      ""Version"": ""0.1.7"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""947e4e02a79effa5d512473e10f41797""
+    },
+    ""sp"": {
+      ""Package"": ""sp"",
+      ""Version"": ""1.4-5"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""dfd843ee98246cf932823acf613b05dd""
+    },
+    ""standardPrintOutput"": {
+      ""Package"": ""standardPrintOutput"",
+      ""Version"": ""0.0.0.9000"",
+      ""Source"": ""GitHub"",
+      ""RemoteType"": ""github"",
+      ""RemoteHost"": ""api.github.com"",
+      ""RemoteRepo"": ""standard-print-output"",
+      ""RemoteUsername"": ""terminological"",
+      ""RemoteRef"": ""HEAD"",
+      ""RemoteSha"": ""a913b4ec60c6604ccdc22ee913e184a1ea801ec0"",
+      ""Hash"": ""8407ee89c2972ade1aa83f20f2cc491b""
+    },
+    ""staplr"": {
+      ""Package"": ""staplr"",
+      ""Version"": ""3.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""496962330b511d7941648c9b5e060e1e""
+    },
+    ""stars"": {
+      ""Package"": ""stars"",
+      ""Version"": ""0.5-1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a59e20ffc0b402904e58d2f9e4d06c37""
+    },
+    ""statmod"": {
+      ""Package"": ""statmod"",
+      ""Version"": ""1.4.35"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""53c27113461e8abbe2dc7125e22b2a39""
+    },
+    ""stringi"": {
+      ""Package"": ""stringi"",
+      ""Version"": ""1.5.3"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""a063ebea753c92910a4cca7b18bc1f05""
+    },
+    ""stringr"": {
+      ""Package"": ""stringr"",
+      ""Version"": ""1.4.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""0759e6b6c0957edb1311028a49a35e76""
+    },
+    ""svglite"": {
+      ""Package"": ""svglite"",
+      ""Version"": ""2.0.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""8fb6188960bf0f90996ce52f9c2106ac""
+    },
+    ""sys"": {
+      ""Package"": ""sys"",
+      ""Version"": ""3.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b227d13e29222b4574486cfcbde077fa""
+    },
+    ""systemfonts"": {
+      ""Package"": ""systemfonts"",
+      ""Version"": ""1.0.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6e899d7c097698d50ec87b1d8e65f246""
+    },
+    ""tibble"": {
+      ""Package"": ""tibble"",
+      ""Version"": ""3.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""4d894a114dbd4ecafeda5074e7c538e6""
+    },
+    ""tidyr"": {
+      ""Package"": ""tidyr"",
+      ""Version"": ""1.1.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c40b2d5824d829190f4b825f4496dfae""
+    },
+    ""tidyselect"": {
+      ""Package"": ""tidyselect"",
+      ""Version"": ""1.1.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6ea435c354e8448819627cf686f66e0a""
+    },
+    ""tidyverse"": {
+      ""Package"": ""tidyverse"",
+      ""Version"": ""1.3.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""bd51be662f359fa99021f3d51e911490""
+    },
+    ""tinytex"": {
+      ""Package"": ""tinytex"",
+      ""Version"": ""0.30"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""066f49a225dc3215cb1f32bc23535f88""
+    },
+    ""units"": {
+      ""Package"": ""units"",
+      ""Version"": ""0.7-0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""57404a7676b139cdcc3e2530508c864e""
+    },
+    ""utf8"": {
+      ""Package"": ""utf8"",
+      ""Version"": ""1.2.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""c3ad47dc6da0751f18ed53c4613e3ac7""
+    },
+    ""uuid"": {
+      ""Package"": ""uuid"",
+      ""Version"": ""0.1-4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e4169eb989a5d03ccb6b628cad1b1b50""
+    },
+    ""vctrs"": {
+      ""Package"": ""vctrs"",
+      ""Version"": ""0.3.6"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""5cf1957f93076c19fdc81d01409d240b""
+    },
+    ""viridis"": {
+      ""Package"": ""viridis"",
+      ""Version"": ""0.5.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""6f6b49e5b3b5ee5a6d0c28bf1b4b9eb3""
+    },
+    ""viridisLite"": {
+      ""Package"": ""viridisLite"",
+      ""Version"": ""0.3.0"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ce4f6271baa94776db692f1cb2055bee""
+    },
+    ""visNetwork"": {
+      ""Package"": ""visNetwork"",
+      ""Version"": ""2.0.9"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""12545f2acf49d1d346d075580122d89c""
+    },
+    ""webshot"": {
+      ""Package"": ""webshot"",
+      ""Version"": ""0.5.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""e99d80ad34457a4853674e89d5e806de""
+    },
+    ""whisker"": {
+      ""Package"": ""whisker"",
+      ""Version"": ""0.4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""ca970b96d894e90397ed20637a0c1bbe""
+    },
+    ""withr"": {
+      ""Package"": ""withr"",
+      ""Version"": ""2.4.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""caf4781c674ffa549a4676d2d77b13cc""
+    },
+    ""xfun"": {
+      ""Package"": ""xfun"",
+      ""Version"": ""0.22"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""eab2f8ba53809c321813e72ecbbd19ba""
+    },
+    ""xml2"": {
+      ""Package"": ""xml2"",
+      ""Version"": ""1.3.2"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""d4d71a75dd3ea9eb5fa28cc21f9585e2""
+    },
+    ""xtable"": {
+      ""Package"": ""xtable"",
+      ""Version"": ""1.8-4"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""b8acdf8af494d9ec19ccb2481a9b11c2""
+    },
+    ""yaml"": {
+      ""Package"": ""yaml"",
+      ""Version"": ""2.2.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""2826c5d9efb0a88f657c7a679c7106db""
+    },
+    ""zip"": {
+      ""Package"": ""zip"",
+      ""Version"": ""2.1.1"",
+      ""Source"": ""Repository"",
+      ""Repository"": ""CRAN"",
+      ""Hash"": ""3bc8405c637d988801ec5ea88372d0c2""
+    }
+  }
+}",False,False,Dependency / Package,6
dfo-mar-odis,shinySpatialApp,8226d97b742bd3c4f01627388832c9de59208de4,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-07-22T16:40:49Z,Stoyel,Quentin.Stoyel@dfo-mpo.gc.ca,2021-07-22T16:40:49Z,fix boolean and calls to here in intro,app/Rmd/intro_EN.Rmd;app/tests/helper_functions_for_tests.R,True,False,True,False,9,9,18,"---FILE: app/Rmd/intro_EN.Rmd---
@@ -30,21 +30,21 @@ knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, fig.align=""lef
 
 ```{r load data and functions, echo=FALSE, include=FALSE, cache=FALSE}
 minYear <- 2010
-load(here(""app/data/OpenData.RData""))
-load(here(""app/data/OpenData_sardist.RData""))
-load(here(""app/data/SecureData.RData""))
+load(here::here(""app/data/OpenData.RData""))
+load(here::here(""app/data/OpenData_sardist.RData""))
+load(here::here(""app/data/SecureData.RData""))
 #load(""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting\\data\\SecureData.Rdata"")
-lapply(list.files(here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE),source) # check helpers.R for a list of packages
+lapply(list.files(here::here(""app/R""), pattern = "".[Rr]$"", full.names = TRUE),source) # check helpers.R for a list of packages
 ```
 
 ```{r Search Area and setup.R, echo=FALSE, include=FALSE, cache=FALSE}
 studyArea <- sf::st_read(""{{path_to_geoms}}"")
 #studyArea <- sf::st_read(""geoms_slc.geojson"")
 # Uncomment the following to test fixed polygon:
 # studyArea <- st_read(""../studyAreaTest/geoms_slc_test.geojson"")#Offshore
-#studyArea <- st_read(""../studyAreaTest/geoms_slc_coastal_test.geojson"")#coastal 
+# studyArea <- st_read(""../studyAreaTest/geoms_slc_coastal_test.geojson"")#coastal 
 # studyArea <- st_read(""../studyAreaTest/geoms_slc_no_land.geojson"") #no land
-Region <- st_read(here(""app/studyAreaTest/geoms_slc_MarBioRegion.geojson""))
+Region <- st_read(here::here(""app/studyAreaTest/geoms_slc_MarBioRegion.geojson""))
 site <- sf::st_centroid(studyArea) 
 ```
  
@@ -112,7 +112,7 @@ The output from the search includes the following sections:
 This report incorporates information from a variety of sources with differing levels of quality control. Consequently, data sources in the report are categorized into tiers of data quality, and associated usage recommendations.
 
 ```{r table tiers read, echo=FALSE, cache=FALSE, include = FALSE}
-table_tier <- read.csv(here(""app/data/misc/table_tiers_EN.csv""))
+table_tier <- read.csv(here::here(""app/data/misc/table_tiers_EN.csv""))
 ```
 ```{r}
 knitr::kable(table_tier,align=""l"", 
@@ -145,7 +145,7 @@ The following are definitions relevant for species listed by the _Species At Ris
 
 # **CONTRIBUTORS**
 ```{r read contributors, echo=FALSE, cache=FALSE, include = FALSE}
-people <- read.csv(here(""app/data/misc/contributors.csv""))
+people <- read.csv(here::here(""app/data/misc/contributors.csv""))
 people <- people$list
 sort(people)
 ```

---FILE: app/tests/helper_functions_for_tests.R---
@@ -16,7 +16,7 @@ render_check_delete <- function(section_path, delete_file=TRUE) {
   unlink(test_out_dir) # empty the folder
   out_html <- rmarkdown::render(section_path, output_dir = test_out_dir)
   success <- file.exists(out_html)
-  if (file.exists(out_html) & delete_file) {
+  if (file.exists(out_html) && delete_file) {
     file.remove(out_html)
   }
   return(success)",True,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,d74f27bbab35a5fc63cffd15ffac557af489a8cb,Greyson,Philip.Greyson@dfo-mpo.gc.ca,2021-06-28T15:40:22Z,Greyson,Philip.Greyson@dfo-mpo.gc.ca,2021-06-28T15:40:22Z,"Fixed some mapping commands in report_cetaceans
Editted SaveDataSets_asRdata.R",app/Rmd/report_cetaceans_EN.Rmd;dataprocessing/SaveDataSets_asRdata.R,True,False,True,False,19,17,36,"---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -26,7 +26,8 @@ Report_wsdb <- if (is.null(outputList)) {
 
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whale Sightings Database (WSDB) (including sightings of groups of animals), for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
 if (!is.null(outputList)) {
-  areaMap + geom_point(data = wsdb_points, aes(x = long, y = lat, color=Legend), size = 2, shape = 20) +
+  areaMap+ 
+    geom_point(data = wsdb_points, aes(x = long, y = lat, color=Legend), size = 2, shape = 20) +
     ggplot2::scale_colour_manual(values=whale_col)
 }
 ```
@@ -52,7 +53,10 @@ writeLines(Report_whitehead)
 
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Whitehead Lab, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>'}
 if (!is.null(outputList)) {
-  areaMap + geom_point(data = whitehead_points, aes(x = long, y = lat, color=Legend), size = 2, shape = 20) + ggplot2::scale_colour_manual(values=whale_col)
+  areaMap+ 
+    geom_point(data = whitehead_points, aes(x = long, y = lat, color=Legend),
+               size = 2, shape = 20)+ 
+    ggplot2::scale_colour_manual(values=whale_col)
 }
 ```
 
@@ -77,7 +81,10 @@ writeLines(Report_narwc)
 ```
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the North Atlantic Right Whale Consortium (NARWC) Sightings Database, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. <b>Absence of a species in the map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area</b> since survey effort is biased towards the Northeast US, and data on species presence from acoustic detections is not included. For more information, please visit: <https://www.narwc.org/sightings-database.html>'}
 if (!is.null(outputList)) {
-  areaMap + geom_point(data = narwc_points, aes(x = long, y = lat, color = Legend), size = 2, shape = 20) + ggplot2::scale_colour_manual(values=whale_col)
+  areaMap+ 
+    geom_point(data = narwc_points, aes(x = long, y = lat, color = Legend),
+                       size = 2, shape = 20)+ 
+    ggplot2::scale_colour_manual(values=whale_col)
 }
 ```
 
@@ -104,9 +111,10 @@ writeLines(Report_obis_cet)
 
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: none. Map showing the search area defined by the user (red outline). Map displays information from the Ocean Biodiversity Information System (OBIS), for cetacean species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
 if (!is.null(outputList)) {
-  areaMap + 
+  areaMap+ 
     geom_point(data = obis_cet_points, aes(x = long, y = lat, color = Legend),
-               size = 2, shape = 20) + ggplot2::scale_colour_manual(values=whale_col)
+               size = 2, shape = 20)+
+    ggplot2::scale_colour_manual(values=whale_col)
 }
 ```
 
@@ -143,9 +151,9 @@ Report <- if (is.null(outputList)) {
 }
 writeLines(Report)
 
-areaMap <- areaMap+
+areaMapBW <- areaMap+
            geom_sf(data=outputList[[2]],fill=""red"",col=""black"")
-regionMap <- regionMap+
+regionMapBW <- regionMap+
              geom_sf(data=outputList[[3]],fill=""red"",col=""black"")
 ```
 
@@ -160,9 +168,7 @@ regionMap <- regionMap+
 #              nrow = 1,
 #              widths = c(4.1/10, 5.9/10))
 if (!is.null(outputList)) {
-grid.arrange(regionMap, areaMap, bottom = expression(paste(""Longitude "",degree,""N"",sep="""")), 
-             left = expression(paste(""Latitude "",degree,""N"",sep="""")), nrow = 1, 
-             widths = c(4.1/10, 5.9/10))
+   grid.arrange(regionMapBW, areaMapBW, nrow = 1, widths = c(4.1/10, 5.9/10))
 }
 ```
 
@@ -178,9 +184,9 @@ Report <- if (is.null(outputList)) {
 }
 writeLines(Report)
 
-areaMap <- areaMap+
+areaMapNBNW <- areaMap+
            geom_sf(data=outputList[[2]],fill=""red"",col=""black"")
-regionMap <- regionMap+
+regionMapNBNW <- regionMap+
              geom_sf(data=outputList[[3]],fill=""red"",col=""black"")
 
 
@@ -196,8 +202,6 @@ regionMap <- regionMap+
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Proposed Northern Bottlenose Whales important habitat in inter-canyon areas on the eastern Scotian Shelf. Northern Bottlenose Whales are present year-round in the inter-canyon areas, which function as foraging habitat and movement corridors. Note that the full extent of important habitat for Scotian Shelf Northern Bottlenose Whales remains unknown. Please see additional information in <a href=""http://publications.gc.ca/collections/collection_2020/mpo-dfo/fs70-6/Fs70-6-2020-008-eng.pdf"">DFO 2020</a>.'}
 # grid.arrange(NBNW_wide, NBNW_zoom, bottom = expression(paste(""Longitude "",degree,""N"",sep="""")), left = expression(paste(""Latitude "",degree,""N"",sep="""")), nrow = 1, widths = c(4.1/10, 5.9/10))
 if (!is.null(outputList)) {
-grid.arrange(regionMap, areaMap, bottom = expression(paste(""Longitude "",degree,""N"",sep="""")), 
-             left = expression(paste(""Latitude "",degree,""N"",sep="""")), nrow = 1, 
-             widths = c(4.1/10, 5.9/10))
+   grid.arrange(regionMapNBNW, areaMapNBNW, nrow = 1, widths = c(4.1/10, 5.9/10))
 }
 ```
\ No newline at end of file

---FILE: dataprocessing/SaveDataSets_asRdata.R---
@@ -7,8 +7,6 @@ library(lubridate)
 # change directory
 source(""SearchPEZ/code/fn_SurveyData_GetRV.R"")
 
-# RANDOM CHANGE TO CODE
-
 #### Arguments for RV survey data #################-
 # for SelectRV_fn
 SurveyPrefix <- c(""4VSW"", ""FALL"", ""SPRING"", ""SUMMER"")",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,f67bccf51f59e26dca2284a4abb1cd2984d1acab,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-04-20T23:30:33Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-04-20T23:30:33Z,Minor tweaks to fix some functions that were not allowing app to run. Hadd to comment plot EBSA section and MARFIS.,app/R/fn_intersect_operations.R;app/R/fn_maps.R;app/Rmd/intro_EN.Rmd;app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/report_fish_EN.Rmd;app/Rmd/report_planning_EN.Rmd,True,True,True,False,41,38,79,"---FILE: app/R/fn_intersect_operations.R---
@@ -271,7 +271,7 @@ intersect_points_wsdb <- function(wsdb_filter, studyArea) {
   return(wsdb_intersect_points)
 }
 
-table_wsdb <- function(wsdb_filter, studyArea) {
+table_wsdb <- function(wsdb_filter, studyArea, listed_cetacean_species) {
   wsdb_sf<-st_as_sf(wsdb_filter, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
   intersect_wsdb <- sf::st_intersection(wsdb_sf,studyArea)
   wsdb_table<-merge(intersect_wsdb, listed_cetacean_species, by='Scientific_Name')
@@ -317,7 +317,7 @@ table_whitehead <- function(whitehead_filter, studyArea) {
  
  
 # #North Atlantic Right Whale Consortium (NARWC) database
-filter_narwc <- function(narwc) {
+filter_narwc <- function(narwc, listed_cetacean_species) {
   narwc_filt <- narwc[narwc$SPECCODE %in% c('HAPO', 'SEWH', 'FIWH','RIWH', 'NBWH','KIWH', 'BLWH',  ""SOBW""), ]
   narwc_filt$SPECCODE[which(narwc_filt$SPECCODE==""HAPO"")]= ""Phocoena phocoena""
   narwc_filt$SPECCODE[which(narwc_filt$SPECCODE==""FIWH"")]= ""Balaenoptera physalus""
@@ -363,7 +363,7 @@ filter_obis_cet <- function(obis_sf) {
   return(obis_sf_filter)
 }
 
-intersect_points_obis_cet <- function(obis_sf_filter, studyArea) {
+intersect_points_obis_cet <- function(obis_sf_filter, studyArea, listed_cetacean_species) {
   intersect_obis <- sf::st_intersection(obis_sf_filter,studyArea)
   intersect_obis <- merge(intersect_obis, listed_cetacean_species, by='Scientific_Name')
   obis_intersect_points <- intersect_obis %>%

---FILE: app/R/fn_maps.R---
@@ -299,7 +299,7 @@ plot_NBNW_hab_zoom <- function(critHab, studyArea, land_layer, buf, bound) {
 ########## Habitat Section ##########
 
 # Rockweed presence [by Gordana Lazin]
-plot_rockweed<-function(rockweed_sf, areaMap, bboxMap) {
+plot_rockweed <- function(rockweed_sf, areaMap, bboxMap) {
   
   # crop rockweed layer to the map area to speed up plotting
   rockweed=st_crop(st_make_valid(rockweed_sf),bboxMap)
@@ -318,10 +318,10 @@ plot_rockweed<-function(rockweed_sf, areaMap, bboxMap) {
     rockweed$Rockweed[which(rockweed$RWP==5)]=""5-Unknown""
     rockweed$Rockweed[which(rockweed$RWP==0)]=""Not Present""
     
-    rockweedMap <- areaMap+
+    rockweedMap <- areaMap +
       geom_sf(data=rockweed, aes(fill=Rockweed), colour=NA)+
       scale_fill_manual(values=c(""#009E73"", ""#E69F00"", ""#0072B2"",""#999999""))+
-      studyBox_geom+
+      studyBox_geom +
       axLim
   }
   
@@ -378,7 +378,7 @@ plot_EBSA<-function(EBSA_sf, studyArea, land_layer, buf, bound) {
   latmin<-bbox$ymin-buf_lat
   latmax<-bbox$ymax+buf_lat
   
-  ggplot()+
+  EBSAmap <- ggplot()+
     geom_sf(data=EBSA_sf, fill=""plum"",col=""black"")+
     geom_sf(data=bound, col = ""darkgrey"", linetype = ""dashed"", size = 1.1) + # creates US boundary line, 200 nm limit
     geom_sf(data=studyArea, fill=NA, col=""red"", size=1)+
@@ -391,6 +391,6 @@ plot_EBSA<-function(EBSA_sf, studyArea, land_layer, buf, bound) {
          y=expression(paste(""Latitude "",degree,""N"",sep="""")),
          col="""")+
     watermark(show = TRUE, lab = ""DFO Internal Use Only"")
-  
+  return(EBSAmap)
 }
  

---FILE: app/Rmd/intro_EN.Rmd---
@@ -55,6 +55,9 @@ site <- sf::st_centroid(studyArea)
 #```{r child = '../Rmd/report_fish_EN.Rmd'}
 #```
 
+#```{r child = '../Rmd/report_planning_EN.Rmd'}
+#```
+
 ```{r parameters for area_map.r, echo=FALSE, include=FALSE, cache=FALSE}
 land_layer<-land50k_sf
 

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -133,7 +133,7 @@ The NARWC Sightings Database contains records of thousands of sightings of Right
 
 #### ***Area-specific NARWC search results***
 ```{r narwc, include=FALSE, cache=FALSE}
- narwc_filter <- filter_narwc(narwc)
+ narwc_filter <- filter_narwc(narwc, listed_cetacean_species)
  narwc_intersect_points <-intersect_points_narwc(narwc_filter, studyArea)
  Total_number_records_narwc <- nrow(narwc_intersect_points)
 ```
@@ -167,7 +167,7 @@ An OBIS search [@OBIS] was conducted to find additional relevant records for cet
 #### ***Area-specific OBIS cetacean search results***
 ```{r obis, include=FALSE, cache=FALSE}
  obis_sf_filter <- filter_obis_cet(obis_sf)
- obis_intersect_points_cet <-intersect_points_obis_cet(obis_sf_filter, studyArea)
+ obis_intersect_points_cet <-intersect_points_obis_cet(obis_sf_filter, studyArea, listed_cetacean_species)
  Total_number_cet_records_obis <- nrow(obis_intersect_points_cet)
 ```
 *

---FILE: app/Rmd/report_fish_EN.Rmd---
@@ -117,27 +117,27 @@ isdb_summary_table<- isdb_summary_table %>%
   dplyr::rename(""Total organisms recorded in polygon""=Total_organisms_recorded_in_polygon,""Listed organisms recorded in polygon""=LISTED_organisms_recorded_in_polygon)
 ```
 ```{r, include=FALSE, cache=FALSE}
-marfis1 <- marfis1 %>% dplyr::filter(DATE_FISHED >= minYear)
-marfis1$YEAR <- lubridate::year(marfis1$DATE_FISHED)
-marfis_sf <- sf::st_as_sf(marfis1, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
-marfis_intersect <- sf::st_intersection(marfis_sf,studyArea)
+# marfis1 <- marfis1 %>% dplyr::filter(DATE_FISHED >= minYear)
+# marfis1$YEAR <- lubridate::year(marfis1$DATE_FISHED)
+# marfis_sf <- sf::st_as_sf(marfis1, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
+# marfis_intersect <- sf::st_intersection(marfis_sf,studyArea)
 
 # marfis_intersect <- marfis_intersect %>%
 #   tidyr::extract(geometry, c('long', 'lat'), '\\((.*), (.*)\\)', convert = TRUE)
-marfis_sites <- data.frame(longitude = marfis_intersect$long, latitude = marfis_intersect$lat)
-
-marfis_table <- table_marfis(marfis_intersect)
-marfis_SAR_table <- table_marfis_SAR(marfis_intersect, listed_fish_invert_species)
+# marfis_sites <- data.frame(longitude = marfis_intersect$long, latitude = marfis_intersect$lat)
+# 
+# marfis_table <- table_marfis(marfis_intersect)
+# marfis_SAR_table <- table_marfis_SAR(marfis_intersect, listed_fish_invert_species)
 ```
 
 ```{r}
-Total_number_records_marfis <- sum(marfis_table$Records)
-Total_number_SAR_records_marfis <- sum(marfis_SAR_table$Records)
-marfis_summary_table<-data.frame(Total_organisms_recorded_in_polygon="""", LISTED_organisms_recorded_in_polygon="""")
-marfis_summary_table[1,1] <- Total_number_records_marfis
-marfis_summary_table[1,2] <- Total_number_SAR_records_marfis
-marfis_summary_table <- marfis_summary_table %>%
-  dplyr::rename(""Total organisms recorded in polygon""=Total_organisms_recorded_in_polygon, ""Listed organisms recorded in polygon""=LISTED_organisms_recorded_in_polygon)
+# Total_number_records_marfis <- sum(marfis_table$Records)
+# Total_number_SAR_records_marfis <- sum(marfis_SAR_table$Records)
+# marfis_summary_table<-data.frame(Total_organisms_recorded_in_polygon="""", LISTED_organisms_recorded_in_polygon="""")
+# marfis_summary_table[1,1] <- Total_number_records_marfis
+# marfis_summary_table[1,2] <- Total_number_SAR_records_marfis
+# marfis_summary_table <- marfis_summary_table %>%
+#   dplyr::rename(""Total organisms recorded in polygon""=Total_organisms_recorded_in_polygon, ""Listed organisms recorded in polygon""=LISTED_organisms_recorded_in_polygon)
 ```
 *
 ```{r, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
@@ -152,39 +152,39 @@ writeLines(Report_isdb)
 
 *
 ```{r, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
-Report_marfis<-if(Total_number_SAR_records_marfis < 1){
-    ""There are no relevant records in the Maritimes Fishery Information System (MARFIS) for this search area.""
-  } else {
-    ""There are relevant records in the Maritimes Fishery Information System (MARFIS) for this search area.""
-  }
-Report_marfis<-noquote(Report_marfis)
-writeLines(Report_marfis)
+# Report_marfis<-if(Total_number_SAR_records_marfis < 1){
+#     ""There are no relevant records in the Maritimes Fishery Information System (MARFIS) for this search area.""
+#   } else {
+#     ""There are relevant records in the Maritimes Fishery Information System (MARFIS) for this search area.""
+#   }
+# Report_marfis<-noquote(Report_marfis)
+# writeLines(Report_marfis)
 ```
 
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: Medium. Security level: Protected B. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Buffer area was used to query aggregated information from Maritimes Fishery Information System (MARFIS) and/or Industry Survey Database (ISDB) observation records shown as black points, for all species. Rule of five was not applied.'}
 site_map(studyArea,site,land50k_sf,10,bounds_sf)+
   geom_point(data = isdb_sites, aes(x = longitude, y = latitude), size = 2,
-        shape = 16, fill = ""black"")+
-  geom_sf(data = marfis_sites, size = 2, shape = 16, fill = ""black"")
+        shape = 16, fill = ""black"") #+
+  #geom_sf(data = marfis_sites, size = 2, shape = 16, fill = ""black"")
 ```
 ```{r}
  knitr::kable(isdb_SAR_table, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listings (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")
 # %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 ```{r}
- knitr::kable(isdb_table, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")
+ # knitr::kable(isdb_table, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Industry Survey Database (ISDB) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")
 # %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 
 ```{r}
- knitr::kable(marfis_SAR_table, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listings (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")
+ # knitr::kable(marfis_SAR_table, align=""l"", caption=""Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of species contained within the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listings (B=Breeding, N=non-breeding, M=migratory). <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""")
 # %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 <br><br>
 ```{r}
- knitr::kable(marfis_table, caption=""Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""") %>% column_spec(1, width=""15cm"")
+ # knitr::kable(marfis_table, caption=""Quality Tier: Medium. Security level: Protected B. Maritimes Fishery Information System (MARFIS) observation records of <u>all species</u> contained within the search area, summarized by species or species group. <b>The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b>"", booktabs = T, escape = F, linesep="""") %>% column_spec(1, width=""15cm"")
 # %>% kable_styling(bootstrap_options = ""striped"", full_width = F, position = ""left"")
 ```
 ### **Ocean Biodiversity Information System (OBIS)**  

---FILE: app/Rmd/report_planning_EN.Rmd---
@@ -44,5 +44,5 @@ EBSA_bioregion(EBSA_sf, studyArea)
 ```
 
 ```{r, fig.height=8, fig.width=11, fig.cap= 'Quality Tier: High. Security level: none. Map showing Ecologically and Biologically Significant Areas (EBSA; pink) relative to the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue.'}
-plot_EBSA(EBSA_sf, studyArea, land10m_sf, 300, bounds_sf)
+#plot_EBSA(EBSA_sf, studyArea, land10m_sf, 300, bounds_sf)
 ```
\ No newline at end of file",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,c163dd49d1a22a02aeded9695b9c2b0f9c87379b,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-04-20T12:34:32Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-04-20T12:34:32Z,Version for App testing with fixed polygon,app/Rmd/intro_EN.Rmd,True,False,True,False,2,2,4,"---FILE: app/Rmd/intro_EN.Rmd---
@@ -40,11 +40,11 @@ lapply(list.files(""../R"", pattern = "".[Rr]$"", full.names = TRUE),source)
 ```
 
 ```{r Search Area and setup.R, echo=FALSE, include=FALSE, cache=FALSE}
-studyArea <- sf::st_read(""{{path_to_geoms}}"")
+#studyArea <- sf::st_read(""{{path_to_geoms}}"")
 #studyArea <- sf::st_read(""geoms_slc.geojson"")
 
 # Uncomment the following to test fixed polygon:
-# studyArea <- st_read(""../studyAreaTest/geoms_slc_test.geojson"")#Offshore
+ studyArea <- st_read(""../studyAreaTest/geoms_slc_test.geojson"")#Offshore
 # studyArea <- st_read(""../studyAreaTest/geoms_slc_coastal_test.geojson"")#coastal 
 # studyArea <- st_read(""../studyAreaTest/geoms_slc_no_land.geojson"")#no land
 ",False,True,Rendering / Conversion,3
dfo-mar-odis,shinySpatialApp,122ad11c40cc7c4c9362fe5d7d8f2f83b4e896d5,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-04-01T22:58:16Z,Gomez,Catalina.Gomez@dfo-mpo.gc.ca,2021-04-01T23:16:42Z,"Rmarkdown working independently of app to help troubleshootiong. Warning: this version is using a fixed dummy geom created by the app. Also, included additions by P. Greyson for sections of code that are working in cetacean and SARA module.",.gitignore;app/R/filter_wsdb.r;app/R/fn_intersect_operations.R;app/R/fn_maps.R;app/R/plot_wsdb.r;app/R/site_map.r;app/Rmd/geoms_slc_test.geojson;app/Rmd/intro_EN.Rmd;app/Rmd/report_SARA_EN.Rmd;app/Rmd/report_cetaceans_EN.Rmd;app/Rmd/setup.R;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000001.TablesByName.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000001.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000001.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000001.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000002.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000002.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000003.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000003.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000003.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.CatItemsByPhysicalName.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.CatItemsByType.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.FDO_UUID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.freelist;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000004.spx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000005.CatItemTypesByName.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000005.CatItemTypesByParentTypeID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000005.CatItemTypesByUUID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000005.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000005.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000005.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000006.CatRelsByDestinationID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000006.CatRelsByOriginID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000006.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000006.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000006.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.CatRelTypesByBackwardLabel.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.CatRelTypesByDestItemTypeID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.CatRelTypesByForwardLabel.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.CatRelTypesByName.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.CatRelTypesByOriginItemTypeID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.CatRelTypesByUUID.atx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000007.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000009.spx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000a.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000a.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000a.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000a.spx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000d.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000d.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000d.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000d.spx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000f.gdbindexes;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000f.gdbtable;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000f.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a0000000f.spx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000017.gdbtablx;app/data/Boundaries/Coast50k/Coastline50k.gdb/a00000017.spx;app/data/Boundaries/Coast50k/Coastline50k.gdb/gdb;app/data/Boundaries/Coast50k/Coastline50k.gdb/timestamps;app/data/Boundaries/Coast50k/metadata.txt;app/data/misc/contributors.csv,True,True,True,False,283,288,571,"---FILE: .gitignore---
@@ -1,7 +1,5 @@
 # Project-specific files 
-app/data/Boundaries/*
 app/data/*
-data/Boundaries/
 *.tiff
 *.html
 *.csv

---FILE: app/R/filter_wsdb.r---
@@ -1,17 +0,0 @@
-# filter_wsdb <- function(wsdb) {
-# 
-#   wsdb_filt <- wsdb[wsdb$COMMONNAME %in% c('PORPOISE-HARBOUR', 'WHALE-SEI','WHALE-FIN', 'WHALE-NORTH ATLANTIC RIGHT',
-#                                     'WHALE-NORTHERN BOTTLENOSE', 'WHALE-KILLER', 'WHALE-BLUE', ""WHALE-SOWERBY'S BEAKED""), ]
-# 
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""PORPOISE-HARBOUR"")]= ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-FIN"")]= ""Fin Whale: Special Concern (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTH ATLANTIC RIGHT"")]= ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTHERN BOTTLENOSE"")]= ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-KILLER"")]= ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-BLUE"")]= ""Blue Whale: Endangered (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SEI"")]= ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SOWERBY'S BEAKED"")]= ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)""
-# 
-#  return(wsdb_filt)
-# }
-

---FILE: app/R/fn_intersect_operations.R---
@@ -20,6 +20,15 @@
 # 
 # }
 # 
+
+#SAR distribution
+table_distPRG <- function(sardist_sf,studyArea) {
+  
+  intersect_dist <- st_intersection(sardist_sf,studyArea)
+  return(intersect_dist)
+}
+
+
 # #SAR critical habitat
 # table_crit <- function(ClippedCritHab_sf,studyArea, leatherback_sf) {
 #   
@@ -221,75 +230,100 @@
 # ###Cetacean section###
 # 
 # #Whale Sightings Database (WSDB)
-# filter_wsdb <- function(wsdb) {
-# 
-#   wsdb_filt <- wsdb[wsdb$COMMONNAME %in% c('PORPOISE-HARBOUR', 'WHALE-SEI','WHALE-FIN', 'WHALE-NORTH ATLANTIC RIGHT',
-#                                            'WHALE-NORTHERN BOTTLENOSE', 'WHALE-KILLER', 'WHALE-BLUE', ""WHALE-SOWERBY'S BEAKED""), ]
-# 
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""PORPOISE-HARBOUR"")]= ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-FIN"")]= ""Fin Whale: Special Concern (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTH ATLANTIC RIGHT"")]= ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTHERN BOTTLENOSE"")]= ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-KILLER"")]= ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-BLUE"")]= ""Blue Whale: Endangered (SARA & COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SEI"")]= ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)""
-#   wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SOWERBY'S BEAKED"")]= ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)""
-#   wsdb_filt<-wsdb_filt %>% rename(Scientific_Name = SCIENTIFICNAME)
-#   wsdb_filt<-merge(wsdb_filt, listed_cetacean_species, by='Scientific_Name')
-# 
-#   return(wsdb_filt)
-# }
-# 
-# 
-# intersect_points_wsdb <- function(wsdb_filter, studyArea) {
-# 
-#   wsdb_sf<-st_as_sf(wsdb_filter, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
-#   intersect_wsdb <- st_intersection(wsdb_sf,studyArea)
-#   wsdb_intersect_points <- intersect_wsdb %>%
-#     mutate(long = unlist(map(intersect_wsdb$geometry,1)),
-#            lat = unlist(map(intersect_wsdb$geometry,2)))
-# }
-# 
-# table_wsdb <- function(wsdb_filter, studyArea) {
-#   wsdb_sf<-st_as_sf(wsdb_filter, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
-#   intersect_wsdb <- st_intersection(wsdb_sf,studyArea)
-#   wsdb_table<-merge(intersect_wsdb, listed_cetacean_species, by='Scientific_Name')
-#   wsdb_table<-wsdb_table %>%
-#     transmute(Common_Name.x, Scientific_Name, Schedule.status.x, COSEWIC.status.x, Wild_Species.x)
-#   wsdb_table<- wsdb_table %>% rename(""SARA status""=Schedule.status.x,
-#                                    ""COSEWIC listing""=COSEWIC.status.x,
-#                                    ""Wild Species listing""=Wild_Species.x,
-#                                    ""Scientific Name""=Scientific_Name,
-#                                    ""Common Name""=Common_Name.x)
-# }
-# 
-# #Whitehead Lab database
-# 
-# filter_whitehead <- function(whitehead) {
-#   whitehead <- whitehead %>% rename(Scientific_Name = species.name)
-#   whitehead_filter <- merge(whitehead, listed_cetacean_species, by='Scientific_Name')
-# }
+filter_wsdb <- function(wsdb, listed_cetacean_species) {
+  
+  wsdb_filt <- wsdb[wsdb$COMMONNAME %in% c('PORPOISE-HARBOUR', 'WHALE-SEI','WHALE-FIN', 'WHALE-NORTH ATLANTIC RIGHT',
+                                           'WHALE-NORTHERN BOTTLENOSE', 'WHALE-KILLER', 'WHALE-BLUE', ""WHALE-SOWERBY'S BEAKED""), ]
+  
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""PORPOISE-HARBOUR"")]= ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-FIN"")]= ""Fin Whale: Special Concern (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTH ATLANTIC RIGHT"")]= ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTHERN BOTTLENOSE"")]= ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-KILLER"")]= ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-BLUE"")]= ""Blue Whale: Endangered (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SEI"")]= ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SOWERBY'S BEAKED"")]= ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)""
+  wsdb_filt<-dplyr::rename(wsdb_filt,c(""Scientific_Name"" = ""SCIENTIFICNAME""))
+  wsdb_filt<-merge(wsdb_filt, listed_cetacean_species, by='Scientific_Name')
+  
+  return(wsdb_filt)
+}
+
+filter_wsdbPRG <- function(wsdb, listed_cetacean_species) {
+  wsdb_filt <- wsdb %>% dplyr::filter(YEAR <= 2009)
+  wsdb_filt <- wsdb_filt[wsdb_filt$COMMONNAME %in% c('PORPOISE-HARBOUR', 'WHALE-SEI','WHALE-FIN', 'WHALE-NORTH ATLANTIC RIGHT',
+                                                     'WHALE-NORTHERN BOTTLENOSE', 'WHALE-KILLER', 'WHALE-BLUE', ""WHALE-SOWERBY'S BEAKED""), ]
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""PORPOISE-HARBOUR"")]= ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-FIN"")]= ""Fin Whale: Special Concern (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTH ATLANTIC RIGHT"")]= ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-NORTHERN BOTTLENOSE"")]= ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-KILLER"")]= ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-BLUE"")]= ""Blue Whale: Endangered (SARA & COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SEI"")]= ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)""
+  wsdb_filt$COMMONNAME[which(wsdb_filt$COMMONNAME==""WHALE-SOWERBY'S BEAKED"")]= ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)""
+  wsdb_filt<-dplyr::rename(wsdb_filt,c(""Scientific_Name"" = ""SCIENTIFICNAME""))
+  wsdb_filt<-merge(wsdb_filt, listed_cetacean_species, by='Scientific_Name')
+  # wsdb_filt <- st_as_sf(wsdb_filt, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
+  
+  return(wsdb_filt)
+}
+
 # 
-# intersect_points_whitehead <- function(whitehead_filter, studyArea) {
-#   whitehead_sf<-st_as_sf(whitehead_filter, coords = c(""Long"", ""Lat""), crs = 4326)
-#   intersect_whitehead <- st_intersection(whitehead_sf,studyArea)
-#   whitehead_intersect_points <- intersect_whitehead %>%
-#     mutate(long = unlist(map(intersect_whitehead$geometry,1)),
-#            lat = unlist(map(intersect_whitehead$geometry,2)))
-# }
 # 
-# table_whitehead <- function(whitehead_filter, studyArea) {
-#   whitehead_sf<-st_as_sf(whitehead_filter, coords = c(""Long"", ""Lat""), crs = 4326)
-#   intersect_whitehead <- st_intersection(whitehead_sf,studyArea)
-#   whitehead_table<-merge(intersect_whitehead, listed_species, by='Scientific_Name')
-#   whitehead_table<-whitehead_table %>% 
-#     transmute(Common_Name.x, Scientific_Name, Schedule.status.x, COSEWIC.status.x, Wild_Species.x)
-#   whitehead_table<- whitehead_table %>% rename(""SARA status""=Schedule.status.x,
-#                                                ""COSEWIC listing""=COSEWIC.status.x,
-#                                                ""Wild Species listing""=Wild_Species.x,
-#                                                ""Scientific Name""=Scientific_Name,
-#                                                ""Common Name""=Common_Name.x)
-# }
+intersect_points_wsdb <- function(wsdb_filter, studyArea) {
+  
+  wsdb_sf<-st_as_sf(wsdb_filter, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
+  intersect_wsdb <- st_intersection(wsdb_sf,studyArea)
+  wsdb_intersect_points <- intersect_wsdb %>%
+    mutate(long = unlist(map(intersect_wsdb$geometry,1)),
+           lat = unlist(map(intersect_wsdb$geometry,2)))
+  
+  return(wsdb_intersect_points)
+}
+
+table_wsdb <- function(wsdb_filter, studyArea) {
+  wsdb_sf<-st_as_sf(wsdb_filter, coords = c(""LONGITUDE"", ""LATITUDE""), crs = 4326)
+  intersect_wsdb <- st_intersection(wsdb_sf,studyArea)
+  wsdb_table<-merge(intersect_wsdb, listed_cetacean_species, by='Scientific_Name')
+  wsdb_table<-wsdb_table %>%
+    transmute(Common_Name.x, Scientific_Name, Schedule.status.x, COSEWIC.status.x, Wild_Species.x)
+  wsdb_table<- wsdb_table %>% rename(""SARA status""=Schedule.status.x,
+                                     ""COSEWIC listing""=COSEWIC.status.x,
+                                     ""Wild Species listing""=Wild_Species.x,
+                                     ""Scientific Name""=Scientific_Name,
+                                     ""Common Name""=Common_Name.x)
+}
+# 
+# Whitehead Lab database
+
+filter_whitehead <- function(whitehead, listed_cetacean_species) {
+  whitehead <- whitehead %>% rename(Scientific_Name = species.name)
+  whitehead_filter <- merge(whitehead, listed_cetacean_species, by='Scientific_Name')
+  return(whitehead_filter)
+}
+
+intersect_points_whitehead <- function(whitehead_filter, studyArea) {
+  whitehead_filter$Long <- whitehead_filter$Long *-1
+  whitehead_sf<-st_as_sf(whitehead_filter, coords = c(""Long"", ""Lat""), crs = 4326)
+  intersect_whitehead <- st_intersection(whitehead_sf,studyArea)
+  whitehead_intersect_points <- intersect_whitehead %>%
+    mutate(long = unlist(map(intersect_whitehead$geometry,1)),
+           lat = unlist(map(intersect_whitehead$geometry,2)))
+  return(whitehead_intersect_points)
+}
+
+table_whitehead <- function(whitehead_filter, studyArea) {
+  whitehead_sf<-st_as_sf(whitehead_filter, coords = c(""Long"", ""Lat""), crs = 4326)
+  intersect_whitehead <- st_intersection(whitehead_sf,studyArea)
+  whitehead_table<-merge(intersect_whitehead, listed_species, by='Scientific_Name')
+  whitehead_table<-whitehead_table %>%
+    transmute(Common_Name.x, Scientific_Name, Schedule.status.x, COSEWIC.status.x, Wild_Species.x)
+  whitehead_table<- whitehead_table %>% rename(""SARA status""=Schedule.status.x,
+                                               ""COSEWIC listing""=COSEWIC.status.x,
+                                               ""Wild Species listing""=Wild_Species.x,
+                                               ""Scientific Name""=Scientific_Name,
+                                               ""Common Name""=Common_Name.x)
+}
 # 
 # 
 # #North Atlantic Right Whale Consortium (NARWC) database

---FILE: app/R/fn_maps.R---
@@ -1,22 +1,23 @@
 # #site map
 # 
-site_map <- function(studyArea,site_sf,land_layer,buf) {
-
+site_map <- function(studyArea,site_sf,land_layer,buf, bound) {
+  
   # buf is in km, and now converted to degrees
   buf=buf/100
-
+  
   # bounding box
   bbox=st_bbox(studyArea)
-
+  
   # longitude and latitude limits for the map
   longmin<-(bbox$xmin)-buf
   longmax<-bbox$xmax+buf
   latmin<-bbox$ymin-buf
   latmax<-bbox$ymax+buf
-
+  
   ggplot()+
     geom_sf(data=studyArea,fill=""deepskyblue"", col=""black"", size=0.6, alpha=0.4)+
     geom_sf(data=site_sf,fill=""yellow"",col=""black"", size=0.6)+
+    geom_sf(data=bound, col = ""red"")+
     geom_sf(data=land_layer,fill=c(""lightgrey""), col=""black"", size=0.7)+
     watermark(show = TRUE, lab = ""DFO Internal Use Only"")+
     annotation_scale(location=""bl"")+
@@ -25,9 +26,10 @@ site_map <- function(studyArea,site_sf,land_layer,buf) {
     labs(x=""Longitude"", y=""Latitude"", col="""")+
     theme(axis.title.y = element_text(size = 13))+
     theme(axis.title.x = element_text(size = 13))
-
+  
 }
 
+
 # #critical habitat
 # plot_crithab<-function(ClippedCritHab_sf, studyArea, land_layer, buf) {
 #   

---FILE: app/R/plot_wsdb.r---
@@ -1,77 +0,0 @@
-# This function is created to search a polygon
-#
-# It adds sightings of the multiple species from the whale sightings database 
-# on the map displaying the study area polygon.
-# 
-# Map has to be plotted outside of the function.
-
-# Species are represented by different symbols.
-# Legend with species names is poltted in a separate figure.
-#
-# Input: - study area polygon (from shape file)
-#        - data frame with sightings from the whale sightings database
-#        - buf - distance in km from the study area to be plotted on the map
-#          this controls the ""zoom"" of the plot
-#
-# Written for MSP, Gordana Lazin, September 13, 2019
-
-
-# plot_wsdb <- function(studyArea, wsdb, buf) {
-#   
-#   
-#   # data frame for the whale sightings database
-#   df=wsdb
-#   
-#   # bounding box for studyArea
-#   # KC: did a minor tweak here
-#   bb=as.data.frame(bbox(studyArea))
-#   
-#   # buffer around bounding box
-#   buf=buf/100
-#   
-#   # longitude and latitude limits for the map
-#   lonLim=c(bb$min[1]-buf, bb$max[1]+buf)
-#   latLim=c(bb$min[2]-buf, bb$max[2]+buf)
-#   
-#   # find sighting points within the box
-#   lt=which(df$LATITUDE>latLim[1] & df$LATITUDE<latLim[2] )
-#   lg=which(df$LONGITUDE>lonLim[1] & df$LONGITUDE<lonLim[2] )
-#   
-#   # points from the wsdb in the box
-#   inBox=intersect(lt,lg)
-#   
-#   # data in the box
-#   dfBox=df[inBox,]
-# 
-#   # unique species in the box
-#   species=as.character(unique(dfBox$COMMONNAME))
-#   
-#   # define colours to circle through
-#   colors=c(""darkgoldenrod1"",""darkgrey"",""blue"", ""red"",""blueviolet"", ""darkorange2"", ""cyan"",""magenta"",""darkgreen"")
-#   colors=rep(colors, times=ceiling(length(species)/length(colors)))
-#   colors=colors[1:length(species)]
-#   
-#   # define shapes of symbols to use
-#   shapes=c(16,15,17,18,8)
-#   shapes=rep(shapes, times=ceiling(length(species)/length(shapes)))
-#   shapes=shapes[1:length(species)]
-#   
-#   # create a legend dataframe that defines symbology for each species
-#   leg=as.data.frame(cbind(species,colors,shapes))
-#   leg$shapes=as.numeric(as.character(leg$shapes))
-#   leg$colors=as.character(leg$colors)
-#   
-#   # add sybology to species dataframe, columns colors and shapes
-#   dfBox=merge(dfBox,leg,by.x=""COMMONNAME"",by.y=""species"")
-#   
-#   # ADD POINT DATA, only in the box
-#   points(dfBox$LONGITUDE,dfBox$LATITUDE, col=dfBox$colors, cex=0.8, pch=dfBox$shapes)
-#   
-#   # add legend on separate plot
-#   #par(mar = c(5.1, 1, 4.1,1))
-#   plot(NULL ,xaxt='n',yaxt='n',bty='n',ylab='',xlab='', xlim=0:1, ylim=0:1)
-#   legend(""topleft"", legend=leg$species,col=leg$colors,pch=leg$shapes, cex=0.8,
-#          inset=-0.01,y.intersp=1.5,bty = ""n"")
-#   #par(mar = c(5.1, 4.1, 4.1, 2.1))
-#   
-# }
\ No newline at end of file

---FILE: app/R/site_map.r---
@@ -1,60 +0,0 @@
-# This function is created specifically for the Aquaculture request purposes
-#
-# It plots aquaculture site map and zone of influence (PEZ)
-#
-# Input polygons (from shape files): 
-# 1. studyArea- study area or zone of influence (PEZ)
-# 2. site- aquaculture site polygon
-# 3. land- landmask
-# 
-# Input parameters:
-# buf - distance in km from the study area to be plotted on the map
-# this controls the ""zoom"" of the plot
-#
-# Output: map 
-#
-# Written for MSP, Gordana Lazin, September 13, 2019
-
-
-# site_map <- function(studyArea, site, land, buf) {
-# 
-#   # buf is in km, and now converted to degrees
-#   buf=buf/100
-#   #png(""pez_and_site.png"", width=1616, height=1410)
-#   
-#   # bounding box
-#   # KC: did a minor tweak here
-#   bb=as.data.frame(bbox(studyArea))
-#   
-#   # buffer around bounding box
-#   #buf=0.05
-#   
-#   # longitude and latitude limits for the map
-#   lonLim=c(bb$min[1]-buf, bb$max[1]+buf)
-#   latLim=c(bb$min[2]-buf, bb$max[2]+buf)
-#   
-#   # par(oma = c(0, 0, 0, 0))
-#   # plot studyArea on the map with buffer around polygon, specified in buf
-#   map(studyArea,fill=T, col=""deepskyblue"",xlim=lonLim, ylim=latLim)
-#   
-#   # ADD LAND
-#   map(land, fill=TRUE, col=""lightgrey"", add = TRUE) 
-#   
-#   
-#   # ADD AXES
-#   map.axes(las=1, cex.axis=0.8)
-#   
-#   # add axis labels - does not want to add y label???
-#   title(xlab=""Longitude [deg]"",ylab=""Latitude [deg]"")
-#   
-#   # ADD SITE 
-#   # KC : I used the plot() function to add a point 
-#   # note I do it at the end otherwise axes would be affected
-#   plot(site, col=""yellow"", pch = 20, cex =3, add = TRUE)
-#   
-#   #watermark
-#   # watermark(""For Internal Use Only"", col=""grey"")
-#   #watermark(show = TRUE, lab = ""DFO Internal Use Only"")
-#   
-# 
-# }

---FILE: app/Rmd/geoms_slc_test.geojson---
@@ -0,0 +1,8 @@
+{
+""type"": ""FeatureCollection"",
+""name"": ""geoms_slc"",
+""crs"": { ""type"": ""name"", ""properties"": { ""name"": ""urn:ogc:def:crs:OGC:1.3:CRS84"" } },
+""features"": [
+{ ""type"": ""Feature"", ""properties"": { ""name"": ""from_map_2_2"" }, ""geometry"": { ""type"": ""Polygon"", ""coordinates"": [ [ [ -59.969157, 43.162139 ], [ -59.969157, 44.462686 ], [ -57.419613, 44.462686 ], [ -57.419613, 43.162139 ], [ -59.969157, 43.162139 ] ] ] } }
+]
+}

---FILE: app/Rmd/intro_EN.Rmd---
@@ -6,7 +6,7 @@ date: '`r format(Sys.time(), ""%d %B, %Y"")`'
 output:
   bookdown::html_document2:
     number_sections: FALSE
-    theme: journal
+    theme: paper
     toc: true
     toc_depth: 5
   pdf_document:
@@ -46,26 +46,31 @@ library(ggspatial) #required for mapping
 library(standardPrintOutput) # required for watermarks on maps
 ```
 ```{r load data, echo=FALSE, include=FALSE, cache=FALSE}
+minYear <- 2002
 load(""../data/OpenData.RData"")
-#load(""../data/SecureData.RData"")
+load(""../data/SecureData.RData"")
 #load(""\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting\\data\\SecureData.Rdata"")
-# load(""data/MARFISSCI.SPECIES.RData"")
-# ISDB_info<-file.info(""data/ISDB.ISSETTYPECODES.RData"")
-# MARFIS_info<-file.info(""data/MARFISSCI.SPECIES.RData"")
-#landGDB <- ""../data/Boundaries/Coast50k/Coastline50k.gdb""
-#land <- readOGR(dsn=landGDB,layer=""Land50k_Maritimes"",stringsAsFactors=F)
+load(""../data/MARFISSCI.SPECIES.RData"")
+ISDB_info<-file.info(""../data/ISDB.ISSETTYPECODES.RData"")
+MARFIS_info<-file.info(""../data/MARFISSCI.SPECIES.RData"")
+rockweed_sf<-st_read(""../data/MAR_rockweed_presence_validated.shp"")
+rockweed_sf<-st_transform(rockweed_sf, 4326)
+land50k_sf <- st_read(""../data/Coastline50k_SHP/Land_AtlCanada_ESeaboardUS.shp"")
+listed_species<-read.csv(""../data/MAR_listed_species.csv"")
 ```
 
-```{r Select Search Area, echo=FALSE, include=FALSE, cache=FALSE}
-# Search Area generated interactively by the app!
-#studyArea <- as(st_read(""{{path_to_geoms}}""), ""Spatial"")
-studyArea <- st_read(""{{path_to_geoms}}"")
-# site <- readOGR(polyPath,layer=paste0(""Site_"",AquaSiteName)) #old, static selection
+```{r Test outside app, echo=FALSE, include=FALSE, cache=FALSE}
+lapply(list.files(""../Rmd"", pattern = "".[Rr]$"", full.names = TRUE),source)
+lapply(list.files(""../R"", pattern = "".[Rr]$"", full.names = TRUE),source)
+studyArea <- st_read(""../Rmd/geoms_slc_test.geojson"")
 ```
 
-```{r}
-plot(st_geometry(studyArea))
-#site_map(studyArea, site, land10m_sf, 40)
+```{r Select Search Area interactively, echo=FALSE, include=FALSE, cache=FALSE}
+#studyArea <- st_read(""{{path_to_geoms}}"")
+#studyArea <- st_read(""geoms_slc.geojson"")
+site <- sf::st_centroid(studyArea)  
+```
+```{r child = c('../Rmd/report_cetaceans_EN.Rmd', 'report_fish_EN.Rmd', 'report_habitat_EN.Rmd', 'report_planning_EN.Rmd', 'report_SARA_EN.Rmd')}
 ```
 
 <!-- END  -->
@@ -83,11 +88,9 @@ plot(st_geometry(studyArea))
 This document summarizes regional data, including information on species and habitats, available at the time of report creation. Data summaries and products (e.g., plots and tables) are presented with source descriptions, caveats, disclaimers, sources of uncertainty, references to the literature, and contacts of relevant staff who can provide further interpretation. This report streamlines the process of generating science information and advice relevant to a variety of cross-sectoral departmental assessments, regulatory reviews, and reporting activities.
 
 This document is developed as a reproducible reporting tool, supported by the R markdown language and generated by an R-Shiny application interface hosted on the DFO network. Report summaries and outputs are based on data extracted from a user-provided search area (a focal polygon of interest) with a user-defined buffer (Figure 1). Instructions for use of the R-Shiny interface are provided in the technical manual. Due to the potential sensitivity of some data and information, access to the data in the application has to be granted, and the report is intended for internal use only. 
+
 ````{r Fig 1 search polygon, fig.height=8, fig.width=11, fig.cap='Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Buffer area is used by this tool to query information and automatically generate a report. '}
-# KC: this is a way of getting the center of a searching area and make it a sp object
-#site <- SpatialPoints(coordinates(studyArea), studyArea@proj4string)
-# KC: this is your map but note that site is no longer used in code
-#site_map(studyArea, site, land, 40)
+site_map(studyArea, site, land10m_sf, 40, bounds_sf)
 ```
 
 Species that have been listed by the _Species At Risk Act_ (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings, are the current focus of this reproducible reporting framework. Recognizing the importance of considering ecosystem-based approaches for management, this report also includes information on other (e.g., commercial, recreational, ecologically significant) species, ecosystem components (e.g., coastal habitat), and areas designated for spatial planning (e.g., Ecologically and Biologically Significant Areas) for each user-defined area. 
@@ -118,11 +121,6 @@ kable(table_tier,align=""l"",
       caption = ""Quality Tiers defined to describe sources of information queried and summarized in this report."")
 ```
 
-#```{r}
-kable(table_tier, align=""l"", 
-      caption = ""Quality Tiers defined to describe sources of information queried and summarized in this report."") %>%  kable_styling(bootstrap_options = ""striped"", full_width = T, position = ""left"")
-#```
-
 # **SEARCH RESULTS**  
 
 #### **EMPHASIS ON SPECIES LISTED BY THE <i>SPECIES AT RISK ACT</i>, ASSESSED BY THE COMMITTEE ON THE STATUS OF THE ENDANGERED WILDLIFE IN CANADA (COSEWIC) AND/OR WILD SPECIES**  

---FILE: app/Rmd/report_SARA_EN.Rmd---
@@ -38,6 +38,9 @@ Critical habitat presented in this section are available in the Government of Ca
 **under-development**
 
 ```{r, fig.height=6, fig.width=11, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with distribution (range) of Species At Risk listed as Endangered, Threatened or Special Concern under the <i>Species At Risk Act</i>. This is not the authoritative source or advice for Species At Risk data. Please access the Species At Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create an authoritative SARA report.'}
+dist_table<-table_distPRG(ClippedCritHab_sf,studyArea)
+site <- dist_table
+site_map(studyArea, site, land10m_sf, 40, bounds_sf)
 ```
 
 ```{r, fig.cap='Quality Tier: High. Security level: none. This map summarizes areas where the search polygon overlaps with critical habitat of Species At Risk listed as Endangered or Threatened under the <i>Species At Risk Act</i> (SARA). Critical habitat is defined under section 2 of SARA as: “the habitat that is necessary for the survival or recovery of a listed wildlife species and that is identified as the species’ critical habitat in the recovery strategy or in an action plan for the species”. Critical Habitat is identified in a species’ recovery strategy or action plan, posted on the [SAR Public Registry](http://www.sararegistry.gc.ca). This is not the authoritative source or advice for Species At Risk data. Please access the Species At Risk [GIS tool](http://dfonl7swvgip001.ent.dfo-mpo.ca/Html5Viewer/index.html?viewer=NationalSARMap_EN&LayerTheme=0&locale=en-US) to create an authoritative report.', fig.height=6, fig.width=11}

---FILE: app/Rmd/report_cetaceans_EN.Rmd---
@@ -36,16 +36,30 @@ Please note the following important disclaimers and caveats associated with sigh
 
 #### ***Area-specific WSDB search results***
 <br><br>
-**under-development**
+
+```{r wsdb, include=FALSE, cache=FALSE}
+wsdb_filter <- filter_wsdb(wsdb, listed_cetacean_species)
+wsdb_intersect_points <- intersect_points_wsdb(wsdb_filter, studyArea)
+Total_number_records_WSDB <- nrow(wsdb_intersect_points)
+```
+*
+```{r wsdb result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+ Query_output_wsdb <- if(Total_number_records_WSDB < 1){
+   ""There are no relevant records in the WSDB for this search area.""
+ } else {
+   ""There are relevant records in the WSDB for this search area.""
+ }
+ writeLines(Query_output_wsdb)
+```
+
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: Low. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Map displays information from the Whale Sightings Database (WSDB) (including sightings of groups of animals), for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. This map also does not include acoustic detections. Sightings on land are an indicator that the sighting data have not yet been completely error-checked or that animals were sighted from shore.'}
-# test for interactivity!
-#wsdbFile <- ""../data/MarWSDBSightingsForCGomez_27Oct2020.csv""
-#wsdb <- read.csv(wsdbFile)
-#wsdb <- wsdb[which(wsdb$YEAR>=minYear), ]
-#wsdb_filter <- filter_wsdb(wsdb)
-#par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)#it goes c(bottom, left, top, right)
-#site_map(studyArea, site, land, 5)
-#plot_wsdb(studyArea, wsdb_filter, 5)
+par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)
+wsdb_plot <- site_map(studyArea, site, land10m_sf, 5 , bounds_sf)+
+  geom_point(data = wsdb_intersect_points, aes(x = long, y = lat, color=Common_Name), 
+              size = 3.5)
+# the scale_colour_manual() command FAILS.  Not reading whale_col? (which are set in intro_EN)
+#if(Total_number_records_WSDB > 1){print(wsdb_plot + scale_colour_manual(values=whale_col))}
+if(Total_number_records_WSDB > 1){print(wsdb_plot)}
 ```
 
 ### **The Whitehead Lab, Dalhousie University**
@@ -60,10 +74,33 @@ The following information is summarized in this website (https://whiteheadlab.we
 The following description of cetacean sightings data collection methods used by the Whitehead Lab is summarized from @Whitehead2013: cetacean sightings data include sightings of species of research focus as well as incidental sightings of cetaceans during studies of Northern Bottlenose Whales and, to a lesser extent, Sperm Whales in the northwest Atlantic, primarily in the Gully MPA, and adjacent canyons along the edge of the eastern Scotian Shelf (the Shortland and Haldimand canyons). Data collection was carried out in a comparable manner, from two similar research vessels: a 10 m auxiliary sailing vessel (used in earlier efforts), and a 13 m auxiliary sailing vessel (used in later efforts). All cetaceans sighted were recorded, together with time of sighting, species (where ascertainable), and position. As definitions of group size changed over the course of the study, group size estimates may be inaccurate and can be biased by factors such as the behaviour of the animals and weather. Consequently, sightings locations represent groups sightings, which could be one or more animals, rather than numbers of individuals. The Whitehead Lab provides cetacean sightings to the Whale Sightings Database (WSDB). However, due to its high Quality Tier, this database is summarized independently in this section of the report.
 
 #### ***Area-specific Whitehead Lab search results***
-<br><br>
-**under-development**
+
+```{r whitehead, include=FALSE, cache=FALSE}
+whitehead_filter <- filter_whitehead(whitehead, listed_cetacean_species)
+whitehead_intersect_points <-intersect_points_whitehead(whitehead_filter, studyArea)
+Total_number_records_whitehead <- nrow(whitehead_intersect_points)
+```
+
+```{r whitehead result, comment="""", prompt=TRUE, echo=FALSE, results='asis'}
+Query_output_whitehead<-if(Total_number_records_whitehead < 1){
+  ""There are no relevant records in the Whitehead Lab database for this search area.""
+} else {
+  ""There are relevant records in the Whitehead Lab database for this search area.""
+}
+writeLines(Query_output_whitehead)
+```
 
 ```{r, fig.height=8, fig.width=11, fig.cap='Quality Tier: High. Security level: none. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Map displays information from the Whitehead Lab, for cetacean species in the search area and listed by the <i>Species At Risk Act</i> (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild species listing. Field efforts were primarily conducted in the Gully Marine Protected Area, and adjacent canyons along the edge of the eastern Scotian Shelf, during good weather conditions (for example, see Whitehead 2013 for a map of effort between 1988-2011), though some data from surveys along the shelf edge off Nova Scotia, Newfoundland and Labrador are included. <b>The absence of a species in this map should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area.</b> Absence may be related to low or no survey effort. This map also does not include acoustic detections. Sightings information is known to underrepresent the presence of cetaceans, particularly deep diving species (e.g., beaked whales) that spend little time at the surface. For more information, please visit: <https://whiteheadlab.weebly.com/contact.html>'}
+par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)#it goes c(bottom, left, top, right)
+whitehead_plot <- site_map(studyArea,site,land10m_sf,5, bounds_sf) +
+  geom_point(data = whitehead_intersect_points, aes(x = long, y = lat, color=Common_Name), 
+              size = 3.5)
+# whitehead_plot<-site_map(studyArea,site_sf,land50k_sf,5, bounds_sf)+
+#   geom_point(data = whitehead_intersect_points, aes(x = long, y = lat, color=Common_Name), 
+#              size = 3.5)+
+#   theme(legend.text=element_text(size=rel(1.2)))
+# if(Total_number_records_whitehead > 1){print(whitehead_plot + scale_colour_manual(values=whale_col))}
+if(Total_number_records_whitehead > 1){print(whitehead_plot)}
 ```
 
 ### **North Atlantic Right Whale Consortium (NARWC) Sightings Database**  

---FILE: app/Rmd/setup.R---
@@ -0,0 +1,93 @@
+####### Species Lists  #######
+cetacean_list<-c(""Beluga Whale"", ""North Atlantic Right Whale"", ""Fin Whale"", ""Northern Bottlenose Whale"", 
+                 ""Harbour Porpoise"", ""Killer Whale"", ""Blue Whale"", ""Sei Whale"", ""Sowerby's Beaked Whale"")
+other_species_list<-c(""Loggerhead Sea Turtle"", ""Atlantic Walrus"", ""Harbour Seal Lacs des Loups Marins subspecies"", ""Leatherback Sea Turtle"")
+listed_cetacean_species<-subset(listed_species, Common_Name %in% cetacean_list)
+listed_other_species<-subset(listed_species, Common_Name %in% other_species_list)
+listed_fish_invert_species<-listed_species[ ! listed_species$Common_Name %in% c(other_species_list,cetacean_list), ]
+
+# load(""../../../Data/mar.wrangling/MARFISSCI.SPECIES.RData"")
+
+
+###### Modify file formats ######
+fin_whale[fin_whale==0] <- NA
+fin_whale_sf<-st_as_stars(fin_whale)%>%st_as_sf()
+
+harbour_porpoise[harbour_porpoise==0] <- NA
+harbour_porpoise_sf<-st_as_stars(harbour_porpoise)%>%st_as_sf()
+
+humpback_whale[humpback_whale==0] <- NA
+humpback_whale_sf<-st_as_stars(humpback_whale)%>%st_as_sf()
+
+sei_whale[sei_whale==0] <- NA
+sei_whale_sf<-st_as_stars(sei_whale)%>%st_as_sf()
+
+Blue_Whale_sf<-setNames(Blue_Whale_sf, replace(names(Blue_Whale_sf), names(Blue_Whale_sf) == 'activité', 'activite'))
+Blue_Whale_sf$activity[Blue_Whale_sf$activity == ""foraging/Feeding""] <- ""Foraging/Feeding""
+Blue_Whale_sf$activity[Blue_Whale_sf$activity == ""Migrant""] <- ""Migration""
+Blue_Whale_sf$months[Blue_Whale_sf$months == ""all year""] <- ""All year""
+Blue_Whale_sf$months[Blue_Whale_sf$months == ""December to February/March to May""] <- ""Dec-Feb/Mar-May""
+Blue_Whale_sf$months[Blue_Whale_sf$months == ""December to February/June to August""] <- ""Dec-Feb/Jun-Aug""
+Blue_Whale_sf$months[Blue_Whale_sf$months == ""March to May/June to August""] <- ""Mar-May/Jun-Aug""
+Blue_Whale_sf$Activity<-paste(Blue_Whale_sf$activity,""-"",Blue_Whale_sf$months)
+
+####### Filter files used in multiple sections by minYear  #######
+
+obis_sf <- obis_sf %>% dplyr::filter(year >= minYear)
+wsdb <- wsdb %>% dplyr::filter(YEAR >= minYear)
+whitehead$YEAR<-lubridate::year(whitehead$Date)
+whitehead <- whitehead %>% dplyr::filter(YEAR >= minYear)
+narwc <- narwc %>% dplyr::filter(YEAR >= minYear)
+
+
+####### Define colour coding for all cetacean plots for consistency
+whale_col=values=c(""Blue Whale: Endangered (SARA & COSEWIC)""=""darkgoldenrod1"",
+                   ""Fin Whale: Special Concern (SARA & COSEWIC)""=""chartreuse4"",
+                   ""Harbour Porpoise: Threatened (SARA) Special Concern (COSEWIC)""=""black"",
+                   ""Killer Whale: No Status (SARA) & Special Concern (COSEWIC)""=""#00AFBB"",
+                   ""North Atlantic Right Whale: Endangered (SARA & COSEWIC)""=""darkorchid4"",
+                   ""Northern Bottlenose Whale: Endangered (SARA & COSEWIC)""=""#0827EF"",
+                   ""Sei Whale: No Status (SARA) & Endangered (COSEWIC)""=""#EF6408"",
+                   ""Sowerby's Beaked Whale: Special Concern (SARA & COSEWIC)""=""#F5A4E7""
+                   )
+
+######## Habitat Information########
+
+rockweed_sf$RWP[which(rockweed_sf$RWP==""1"")]= ""Present""
+rockweed_sf$RWP[which(rockweed_sf$RWP==""2"")]= ""Likely Present""
+rockweed_sf$RWP[which(rockweed_sf$RWP==""5"")]= ""Unknown""
+
+####### Data sets that have been replaced with OpenData.RData and SecureData.RData files ######
+#ClippedCritHab_sf <- st_read(""../../../Data/NaturalResources/Species/SpeciesAtRisk/clipped_layers/ClipCritHab.shp"", quiet=TRUE)
+#sardist_sf<-st_read(""../../../Data/NaturalResources/Species/SpeciesAtRisk/clipped_layers/sardist_4326.shp"", quiet=TRUE)
+#leatherback_sf<-st_read(""../../../Data/NaturalResources/Species/SpeciesAtRisk/LeatherBackTurtleCriticalHabitat/LBT_CH_2013.shp"", quiet=TRUE)
+#obis<-read.csv(""../../../Data/NaturalResources/Species/OBIS_GBIF_iNaturalist/OBIS_MAR_priority_records.csv"")
+#fin_whale<- raster(""../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Fin_Whale.tif"")
+#harbour_porpoise<- raster(""../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Harbour_Porpoise.tif"")
+#humpback_whale<- raster(""../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Humpback_Whale.tif"")
+#sei_whale<- raster(""../../../Data/NaturalResources/Species/Cetaceans/PriorityAreas_FGP/Sei_Whale.tif"")
+#Blue_32198 <- st_read(""../../../Data/NaturalResources/Species/Cetaceans/BlueWhaleHabitat_FGP/BlueWhaleHabitat_HabitatBaleineBleue.shp"", quiet=TRUE)
+#wsdb <- read.csv(""../../../Data/NaturalResources/Species/Cetaceans/WSDB/MarWSDBSightingsForCGomez_27Oct2020.csv"")
+#whitehead <- read.csv(""../../../Data/NaturalResources/Species/Cetaceans/Whitehead_Lab/whitehead_lab.csv"")
+#narwc <- read.csv(""../../../Data/NaturalResources/Species/Cetaceans/NARWC/NARWC_09-18-2020.csv"")
+#EBSA_sf <- st_read(""../../../Data/Zones/DFO_EBSA_FGP/DFO_EBSA.shp"", quiet=TRUE)
+# EBSA_sf <- st_transform(EBSA_sf, crs = 4326)
+# EBSA_sf$Report_URL<-str_replace(EBSA_sf$Report_URL, "".pdf"", "".html"")
+#landfile10m <- file.path(RDataPath,""Land10M.rds"")
+#land10m_sf <- readRDS(landfile10m)
+#SurveyPrefix <- c(""4VSW"", ""FALL"", ""SPRING"", ""SUMMER"")
+#File <- c(""_2020_GSCAT.csv"", ""_2020_GSINF.csv"", ""_2020_GSSPECIES.csv"")
+#RVCatch <-  SelectRV_fn(SurveyPrefix, File, AquaSiteName, PEZversion, minYear)
+#modify land files
+#landfile50k <-  file.path(RDataPath,""land50k.rds"")
+#land50k_sf <- readRDS(landfile50k)
+#remove State and Province column from land10m
+#land10m_sf <- land10m_sf[-c(2)]
+
+####### Currently unfeatured data sets #######
+#cws<-read.csv(""../../../Data/NaturalResources/Species/CWS_ECCC/CWS_ECCC_OBIS_records.csv"")
+#cws<-subset(cws,year>minYear)
+#inat<-read.csv(""../../../Data/NaturalResources/Species/OBIS_GBIF_iNaturalist/iNaturalist_MAR_priority_records.csv"", stringsAsFactors = FALSE)
+#inat<-subset(inat,datetime>minYear)
+#gbif<-read.csv(""../../../Data/NaturalResources/Species/OBIS_GBIF_iNaturalist/GBIF_MAR_priority_records.csv"",stringsAsFactors = FALSE)
+#gbif<-subset(gbif,year>minYear)
\ No newline at end of file

---FILE: app/data/Boundaries/Coast50k/metadata.txt---
@@ -1,23 +0,0 @@
-Title: Landmass and Ocean mask, scale - 1:50,000, WGS84
-
-Land_AtlCanada_ESeaboardUS - Landmass for NE North America derived from the CanVec 1:50,000 coastline (Canada) and GADM.ORG for the NE US States (ME, NH, MA, RI)
-Ocean_AtlCanada_ESeaboardUS - Ocean mask for NE North America
-
-Land50k_Maritimes - Landmass for Maritimes Region (NS, NB, PE) derived from CanVec 1:50,000 coastline
-Ocean50k_Maritimes - Ocean mask for Maritimes Region (NS, NB, PE) derived from CanVec 1:50,000 coastline
- 
-Land50k_Atl - Landmass for Atlantic Canada derived from CanVec 1:50,000 coastline.
-Ocean50k_Atl - Ocean mask for Atlantic Canada derived from CanVec 1:50,000 coastline.  This includes the 100 m bathymetric contour to select nearshore/offshore
-
-
-
-Source of underlying data: CanVec 1:50,000 coastline
-https://open.canada.ca/data/en/dataset/be0165a8-ad5d-4adb-a27a-2d4117c3967c
-
-
-Usage: 
-- Reproducible reporting (2020-2021, Greg Puncher et al.)
-- Marine Planning and Conservation (Kasia et al.)
-- A version of this layer edited by Phil Greyson is used to calculate fetch (Ryan Stanley, 2020-2021) (same as this and added State of Maine)
-
-

---FILE: app/data/misc/contributors.csv---
@@ -6,7 +6,6 @@ Angelia Vanderlaan
 Brent Law
 Brian Bower
 Catalina Gomez
-Caroline Longtine
 Christine Stortini
 Clark Richards
 Colin O�Neil�",True,True,Rendering / Conversion,6
dfo-mar-odis,shinySpatialApp,bd2fa5862fc0f3ca312455e0bad150f13ef33451,Kevin Cazelles,kcazelle@uoguelph.ca,2021-02-03T17:00:19Z,Kevin Cazelles,kcazelle@uoguelph.ca,2021-02-03T17:00:19Z,:bug: fix report Rmd default filename,app/R/renderReport.R;app/Rmd/report_pt1_generic_intro_EN.Rmd;app/server.R;app/www/report_pt1_generic_intro_EN.html,True,True,True,False,608,9,617,"---FILE: app/R/renderReport.R---
@@ -14,12 +14,15 @@ renderReport <- function(data, input, fl = NULL, dir_out = ""output/doc"",
   # 
   lang <- input$report_lang
   # nasty trick due to current rmarkdown behavior
-  if (!is.null(fl)) fl <- rep(fl, 20)
+  if (fl != """" & !is.null(fl)) {
+     fl <- rep(fl, 20)
+  } else fl <- NULL
   x <- glue(""{dir_in}/report_pt1_generic_intro_{lang}.Rmd"")
   
   # Save data as rds 
   # dtrmd <- switch_ext(glue(""data_{basename(x)}""), ""rds"")
   # saveRDS(data, glue(""{dir_out}/{dtrmd}""))
+
   
   # Section(s) to be added
   s_main <- main_parts(input$main_sections, lang)
@@ -38,7 +41,7 @@ renderReport <- function(data, input, fl = NULL, dir_out = ""output/doc"",
     add_main_sections = add_sections(s_main, dir_in, dir_out),
     add_ebsa_section = add_sections(s_ebsa, dir_in, dir_out),
     add_appendix = add_sections(s_appendix, dir_in, dir_out)
-  )
+  )  
   writeLines(whisker::whisker.render(template, data_all), flrmd)
 
   # First rendering

---FILE: app/Rmd/report_pt1_generic_intro_EN.Rmd---
@@ -135,10 +135,7 @@ cat(AquaSiteName)
 cat(PEZversion)
 ```
 
-**PEZ features/comments from user:**
-```{r echo=FALSE, results='asis', eval = FALSE}
-cat(""{{user_comments}}"")
-```
+**PEZ features/comments from user:** {{author_comments}}
 
 
 

---FILE: app/server.R---
@@ -5,9 +5,6 @@ server <- function(input, output, session) {
   # list of data and areas 
   data_in$data_src <- data_in$geoms <- list()
   
-  
-  # kk <- reactive({data_in$geoms})
-  
   nb_geom <- reactive({
     n <- length(data_in$geoms)
     output$nb_geoms <- info_valid(glue(""Number of geoms saved so far: {n}""), n)",True,True,Implementation / Logic,6
dfo-mar-odis,shinySpatialApp,347e0db01858fc9eb448899c027d0c23756f72f1,Kevin Cazelles,kcazelle@uoguelph.ca,2021-01-24T22:32:40Z,Kevin Cazelles,kcazelle@uoguelph.ca,2021-01-24T22:32:40Z,fix id tab,app/output/doc/species_at_risk.Rmd;app/server.R;app/www/species_at_risk.html,True,False,True,False,1709,3,1712,"---FILE: app/output/doc/species_at_risk.Rmd---
@@ -1,8 +1,8 @@
 ---
 title: ""Reproducible Report for Species in Maritimes Region - for Internal DFO use only""
 author: Synthesis prepared by the MSP Team
-email: 
-user: 
+email: lipsum@dfo-mpo.gc.ca
+user: Lorem ipsum
 notes: """"
 date: '`r format(Sys.time(), ""%d %B, %Y"")`'
 output:

---FILE: app/server.R---
@@ -17,7 +17,6 @@ server <- function(input, output, session) {
     # VALID AND STORE USER INFO
     valid_details <- reactive({
       output$invalid_details <- output$valid_details <- renderText("""")
-      output$consent <- input$user_consent
       if (check_name(input$user_name)) {
         data_in$user <- input$user_name
         if (check_email(input$user_email)) {",True,True,Documentation / Formatting,6
dfo-mar-odis,shinySpatialApp,adb1af5b83af5bdf3b57928b1fe10c1aa2bedc7e,Kevin Cazelles,kcazelle@uoguelph.ca,2021-01-22T16:15:41Z,Kevin Cazelles,kcazelle@uoguelph.ca,2021-01-22T16:15:41Z,handle error/success messages better,app/R/renderReport.R;app/Rmd/report_01.Rmd;app/output/doc/report_01.Rmd;app/output/doc/species_at_risk.Rmd;app/server.R;app/ui.R;app/www/extra.css,True,True,True,False,69,44,113,"---FILE: app/R/renderReport.R---
@@ -1,7 +1,6 @@
-renderReport <- function(x, fl = """", dir = ""output/doc"", data) {
+renderReport <- function(x, fl = """", data, dir = ""output/doc"") {
   msgInfo(""Generating report"", x)
 
-  
   if (fl == """") {
     fl <- NULL 
   } else {
@@ -21,11 +20,9 @@ renderReport <- function(x, fl = """", dir = ""output/doc"", data) {
       output_dir = dir, 
       output_file = fl, 
       quiet = TRUE)
-    paste(shiny::icon(""info""), x, ""has been successfully rendered (see, "", 
-    paste0(dir, ""/"", fl, ""*).""))
+    TRUE
   }, 
-  error = function(x) paste(shiny::icon(""info""), ""issue"")
+  error = function(x) FALSE
   )
-  shiny::HTML(out)
-  # check how to do that properly (err)
+  list(ok = out, fl = flrmd)
 }
\ No newline at end of file

---FILE: app/Rmd/report_01.Rmd---
@@ -10,3 +10,8 @@ output:
 # First part 
 
 This is it the report to be used \#1.
+
+
+```{R}
+cool
+```
\ No newline at end of file

---FILE: app/output/doc/report_01.Rmd---
@@ -10,3 +10,8 @@ output:
 # First part 
 
 This is it the report to be used \#1.
+
+
+```{R}
+cool
+```

---FILE: app/output/doc/species_at_risk.Rmd---
@@ -1,9 +1,9 @@
 ---
 title: ""Reproducible Report for Species in Maritimes Region - for Internal DFO use only""
 author: Synthesis prepared by the MSP Team
-email: lipsum@dfo-mpo.gc.ca
-user: Lorem ipsum
-notes: ""ok""
+email: 
+user: 
+notes: """"
 date: '`r format(Sys.time(), ""%d %B, %Y"")`'
 output:
   html_document:

---FILE: app/server.R---
@@ -57,12 +57,12 @@ server <- function(input, output, session) {
             nm <- glue('output/spatial/{input$name_geom}.geojson')
             if (!file.exists(nm)) {
               sf::write_sf(geom, nm ,delete_layer = TRUE, delete_dsn = TRUE)
-              output$created_from_map <- renderText(glue('{nm}.geojson created'))
+              output$created_from_map <- info_valid(glue('{nm}.geojson created'))
               data_in$geoms <- append(data_in$geoms, 
                 list(list(geom = geom, name = basename(nm), method = ""drawn"")))
-            } else output$created_from_map_not <- renderText(""Cannot overwrite existing file"")
+            } else output$created_from_map_not <- info_valid(""Cannot overwrite existing file"", FALSE)
         } else {
-          output$created_from_map_not <- renderText(""Please use the map on the right."")
+          output$created_from_map_not <- info_valid(""Please use the map on the right."", FALSE)
         }
 
     })
@@ -82,7 +82,7 @@ server <- function(input, output, session) {
       edits <- callModule(editMod, leafmap = map2, id = ""map"")
       # spa_ext <- readSpatial(input$spa_ext$datapath)
     })
-    observeEvent(input$save_shp, {             
+    observeEvent(input$save_shp, {
       geom_ext <- readSpatial(input$import_shapefile$datapath)
       data_in$geoms <- append(data_in$geoms, 
             list(list(geom = geom_ext, name = input$import_shapefile$name, method = ""external"")))
@@ -127,8 +127,6 @@ server <- function(input, output, session) {
 
 
 
-
-    
     # GENERATE REPORT
     values <- reactiveValues()
     values$generate <- 0
@@ -152,11 +150,19 @@ server <- function(input, output, session) {
     ## generate report
     observeEvent(input$generate_rmd, {
       # intermediate var, so that Rmd not being rendered when values$rmd_path changes
-      # but only when we click 
+      # but only when we click
       path <- values$rmd_path
-      output$render_success <- renderText(
-        renderReport(path, fl = input$report_name, data =  data_in)
-      )
+      if (path == ""none"") {
+        output$render_success <- info_valid(""Please select a valid .Rmd file."", FALSE)  
+      } else {
+        chk <- renderReport(path, fl = input$report_name, data =  data_in)
+        if (chk$ok) {
+          output$render_success <- info_valid(""All good"")
+          shinyjs::hide(id = ""map-map"")
+          # then show html 2Bdone
+        } else 
+         output$render_success <- info_valid(""Issue while rendering"", FALSE)  
+      }
     })
     
     

---FILE: app/ui.R---
@@ -57,10 +57,15 @@ ui <- fluidPage(
               tabPanel(
                 ""Bounding box"",
                 h4(""Enter coordinates of the bounding box""),
-                numericInput(""bbox_xmin"", label = ""Xmin"", value = ""0"", min = -180, max = 180),
-                numericInput(""bbox_xmax"", label = ""Xmax"", value = ""0"", min = -180, max = 180),
-                numericInput(""bbox_ymin"", label = ""Ymin"", value = ""0"", min = -90, max = 90),
-                numericInput(""bbox_ymax"", label = ""Ymax"", value = ""0"", min = -90, max = 90),
+                div(style=""display: inline-block;vertical-align:top;"",
+                  numericInput(""bbox_xmin"", label = ""Xmin"", value = ""0"", min = -180, max = 180)),
+                div(style=""display: inline-block;vertical-align:top;"",
+                  numericInput(""bbox_xmax"", label = ""Xmax"", value = ""0"", min = -180, max = 180)),
+                br(),
+                div(style=""display: inline-block;vertical-align:top;"",
+                  numericInput(""bbox_ymin"", label = ""Ymin"", value = ""0"", min = -90, max = 90)),
+                div(style=""display: inline-block;vertical-align:top;"",
+                  numericInput(""bbox_ymax"", label = ""Ymax"", value = ""0"", min = -90, max = 90)),
                 br(),
                 actionButton('add_bbox', 'Add to map', icon = icon(""pencil"")),
                 actionButton('save_bbox', 'Save', icon = icon(""download""))
@@ -71,8 +76,8 @@ ui <- fluidPage(
                 textInput(""name_geom"", label = ""Enter layer name (also used as file name)"", value = ""new_geom""),
                 actionButton('save_from_map', 'Save from map', icon = icon(""download"")),
                 hspace(2),
-                textOutput(""created_from_map"", inline = TRUE),
-                textOutput(""created_from_map_not"", inline = TRUE)
+                uiOutput(""created_from_map"", inline = TRUE),
+                uiOutput(""created_from_map_not"", inline = TRUE)
               ),
               tabPanel(
                 ""Input Shapefile"",
@@ -166,32 +171,39 @@ ui <- fluidPage(
               HTML(""</h4>""),
               hr(),
               actionButton(""generate_rmd"", ""Generate report"", icon(""book"")),
-              htmlOutput(""render_success""),
+              hspace(2),
+              uiOutput(""render_success"", inline = TRUE),
             )
           ),
             
             
+          br(),
+          br(),
+          hr(),
+          
+          HTML(
+          paste0(
+            ""<h5 align = 'center'>This shiny app was built with the "", 
+            a(""R package shiny"", href = ""https://shiny.rstudio.com/""), 
+            "", source code available on "")
+          ),
+          a(icon(""github""), href = ""https://github.com/inSilecoInc/shinySpatialApp""),
+          HTML(""</h5>"")
+            
         ),
+        
+
+          
 
 
         # add map
         mainPanel(
             mapedit::editModUI(""map"")
             # includeHTML(""include.html"")
-            # restire map 2Bdone
+            # restore map 2Bdone
         )
 
     ), 
     
-    hr(),
-    
-    HTML(
-    paste0(
-      ""<h4 align = 'center'>This shiny app was built with the "", 
-      a(""R package shiny"", href = ""https://shiny.rstudio.com/""), 
-      "", source code available on "")
-    ),
-    a(icon(""github""), href = ""https://github.com/inSilecoInc/shinySpatialApp""),
-    HTML(""</h4>"")
 )
 

---FILE: app/www/extra.css---
@@ -1,18 +1,18 @@
 #map-map {
-  height : 90vh !important;
+  height : 95vh !important;
 }
 
 #file_report {
   color: #337ab7;
 }
 
-.valid, #valid_details, #created_from_map {
+.valid{
   color: #34c369;
-  font-size: 1.2em;
+  font-size: 1.1em;
 }
 
-.invalid, #invalid_details, #created_from_map_not {
-  color: #b83343;
-  font-size: 1.2em;
+.invalid {
+  color: #f03561;
+  font-size: 1.1em;
 }
 ",True,True,Rendering / Conversion,6
